function safeval(expr,vars){for(var variable in vars)eval("var "+variable+" = "+JSON.stringify(vars[variable]));try{return eval(expr)}catch(e){return"ERROR!"}}!function(){function t(t,e){return t instanceof Node||t instanceof Window?[t]:[].slice.call("string"==typeof t?(e||document).querySelectorAll(t):t||[])}if(self.Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||null),Element.prototype.matches)){var e=self.Stretchy={selectors:{base:'textarea, select:not([size]), input:not([type]), input[type="'+"text url email tel".split(" ").join('"], input[type="')+'"]',filter:"*"},script:document.currentScript||t("script").pop(),resize:function(t){if(e.resizes(t)){var i=getComputedStyle(t),r=0;if(!t.value&&t.placeholder){var n=!0;t.value=t.placeholder}var s=t.nodeName.toLowerCase();if("textarea"==s)t.style.height="0","border-box"==i.boxSizing?r=t.offsetHeight:"content-box"==i.boxSizing&&(r=-t.clientHeight),t.style.height=t.scrollHeight+r+"px";else if("input"==s){t.style.width="0","border-box"==i.boxSizing?r=t.offsetWidth:"padding-box"==i.boxSizing&&(r=t.clientWidth),t.scrollLeft=1e10;var o=Math.max(t.scrollLeft+r,t.scrollWidth-t.clientWidth);t.style.width=o+"px"}else if("select"==s){var a=document.createElement("_");a.textContent=t.options[t.selectedIndex].textContent,t.parentNode.insertBefore(a,t.nextSibling);var c;for(var u in i)/^(width|webkitLogicalWidth)$/.test(u)||(a.style[u]=i[u],/appearance$/i.test(u)&&(c=u));a.style.width="",a.offsetWidth>0&&(t.style.width=a.offsetWidth+"px",i[c]&&"none"===i[c]||(t.style.width="calc("+t.style.width+" + 2em)")),a.parentNode.removeChild(a),a=null}n&&(t.value="")}},resizeAll:function(i){t(i||e.selectors.base).forEach(function(t){e.resize(t)})},active:!0,resizes:function(t){return t&&t.parentNode&&t.matches&&t.matches(e.selectors.base)&&t.matches(e.selectors.filter)},init:function(){e.selectors.filter=e.script.getAttribute("data-filter")||(t("[data-stretchy-filter]").pop()||document.body).getAttribute("data-stretchy-filter")||Stretchy.selectors.filter||"*",e.resizeAll()},$$:t};"loading"!==document.readyState?e.init():document.addEventListener("DOMContentLoaded",e.init);var i=function(t){e.active&&e.resize(t.target)};document.body.addEventListener("input",i),document.body.addEventListener("change",i),self.MutationObserver&&new MutationObserver(function(t){e.active&&t.forEach(function(t){"childList"==t.type&&Stretchy.resizeAll(t.addedNodes)})}).observe(document.body,{childList:!0,subtree:!0})}}(),function(t,e){var i=self.Wysie=t.Class({constructor:function(r){var n=this;i.all.push(this);var s=r.getAttribute("data-store")||"#";this.store="none"===s?null:new URL(s||this.id,location),this.id=r.id||"wysie-"+i.all.length,this.element=i.is("scope",r)?r:t(i.selectors.scope,r),this.element||(r.setAttribute("typeof",""),this.element=r),this.element.classList.add("wysie-root"),this.wrapper=r,r===this.element&&i.is("multiple",r)&&(this.wrapper=r.closest(".wysie-wrapper")||t.create("div",{around:this.element})),this.wrapper.classList.add("wysie-wrapper"),r.removeAttribute("data-store"),e("li:only-of-type, tr:only-of-type",this.wrapper).forEach(function(t){(i.is("property",t)||i.is("scope",t))&&t.setAttribute("data-multiple","")}),this.bar=t.create({className:"wysie-bar",start:this.wrapper,contents:[{tag:"button",className:"edit",innerHTML:"<span class='icon'>✎</span> Edit",onclick:function(t){return n.edit()}},{tag:"button",innerHTML:"<span class='icon'>✓</span> Save",className:"save",onclick:function(t){return n.save()}},{tag:"button",innerHTML:"<span class='icon'>✘</span> Cancel",className:"cancel",onclick:function(t){return n.cancel()}}]}),this.root=new(i.is("multiple",this.element)?i.Collection:i.Scope)(this.element,this),this.store&&this.store.href?(this.storage=i.Storage.create(this),this.storage.load()):this.wrapper._.fire("wysie:load")},get data(){return this.getData()},getData:function(t){return this.root.getData(t)},toJSON:function(){return JSON.stringify(this.data,null,"	")},render:function(t){this.root.render(t.data||t)},edit:function(){this.editing=!0,this.root.edit()},save:function(){this.root.save(),this.editing=!1,this.storage&&this.storage.save()},cancel:function(){this.editing=!1,this.root.cancel()},live:{readonly:function(t){this.wrapper.classList[t?"add":"remove"]("readonly")},editing:{set:function(t){t?this.wrapper.setAttribute("data-editing",""):this.wrapper.removeAttribute("data-editing")}}},"static":{all:[],readable:function(t){return t&&t.replace(/([a-z])([A-Z][a-z])/g,function(t,e,i){return e+" "+i.toLowerCase()}).replace(/([a-z])[_\/-](?=[a-z])/g,"$1 ").replace(/^[a-z]/,function(t){return t.toUpperCase()})},identifier:function(t){return t&&t.replace(/\s+/g,"-").replace(/[^\w-]/g,"").toLowerCase()},queryJSON:function(t,e){if(!e||!t)return t;e=e.split("/");for(var i,r=0;i=e[r++];){if(!t)return null;t=t[i]}return t},timed:function(t,e){return function(){console.time(t),e.apply(this,arguments),console.timeEnd(t)}},selectors:{property:"[property], [itemprop]",output:"[property=output], [itemprop=output], .output, .value",primitive:"[property]:not([typeof]), [itemprop]:not([itemscope])",scope:"[typeof], [itemscope], [itemtype], .scope",multiple:"[multiple], [data-multiple], .multiple",required:"[required], [data-required], .required",formControl:"input, select, textarea",computed:".computed"},is:function(t,e){return e.matches&&e.matches(i.selectors[t])}}});t.ready().then(function(t){e("[data-store]").forEach(function(t){new Wysie(t)})}),i.prototype.render=i.timed("render",i.prototype.render)}(Bliss,Bliss.$),self.Promise&&!Promise.prototype.done&&(Promise.prototype.done=function(t){return this.then(t,t)}),function(t){var e=Wysie.Storage=t.Class({"abstract":!0,constructor:function(t){var e=this;this.wysie=t,this.originalHref=new URL(this.href,location),this.loaded=new Promise(function(t,i){e.wysie.wrapper.addEventListener("wysie:load",t)})},get url(){return this.wysie.store},get href(){return this.url.href},get backup(){return JSON.parse(localStorage[this.originalHref]||null)},set backup(t){localStorage[this.originalHref]=JSON.stringify(t,null,"	")},ready:Promise.resolve(),live:{inProgress:function(e){if(e){t.create("div",{textContent:e+"…",className:"progress",inside:this.wysie.wrapper})}else t.remove(t(".progress",this.wysie.wrapper))},loginToEdit:function(e){var i=this;if(e){this.loginHash="#login"+(Wysie.all[0]===this.wysie?"":"-"+this.wysie.id),this.authControls={logout:t.create({tag:"button",textContent:"Logout",className:"logout",events:{click:this.logout.bind(this)},start:this.wysie.bar}),login:t.create({tag:"a",href:this.loginHash,textContent:"Login to edit",className:"login button",events:{click:function(t){t.preventDefault(),i.login()}},start:this.wysie.bar}),status:t.create({tag:"span",className:"status",start:this.wysie.bar})};var r;return(r=function(){location.hash===i.loginHash&&(history.replaceState(null,document.title,new URL("",location)+""),i.login())})(),window.addEventListener("hashchange",r),this.wysie.wrapper.addEventListener("wysie:login",function(t){i.authControls.status.innerHTML="Logged in to "+i.id+" as <strong>"+t.name+"</strong>",Stretchy.resizeAll()}),this.wysie.wrapper.addEventListener("wysie:logout",function(t){i.authControls.status.textContent=""}),e}},authenticated:function(t){this.wysie.wrapper.classList[t?"add":"remove"]("authenticated")}},load:function(){var e=this,i=this.ready,r=this.backup;return this.inProgress="Loading",r&&r.synced===!1?i.then(function(){return e.wysie.render(r),e.inProgress=!1,e.wysie.wrapper._.fire("wysie:load"),e.save()}):(i=this.url.origin!==location.origin||this.url.pathname!==location.pathname?i.then(function(){return e.backendLoad?e.backendLoad():t.fetch(e.href,{responseType:"json"})}).then(function(t){if(e.inProgress=!1,e.wysie.wrapper._.fire("wysie:load"),t.response){var i=Wysie.queryJSON(t.response,e.url.hash.slice(1));e.wysie.render(i)}e.backup={synced:!0,data:e.wysie.data}}):i.done(function(){return Promise.reject()}),i["catch"](function(t){e.inProgress=!1,t&&(console.error(t),console.log(t.stack)),r&&e.wysie.render(r),e.wysie.wrapper._.fire("wysie:load")}))},save:function(){var t=this;return this.backup={synced:!this._save,data:this.wysie.data},this.backendSave?this.login().then(function(){return t.inProgress="Saving",t.backendSave().then(function(){var e=t.backup;e.synced=!0,t.backup=e,t.wysie.wrapper._.fire("wysie:save")}).done(function(){t.inProgress=!1})}):void 0},login:function(){return Promise.resolve()},logout:function(){return Promise.resolve()},param:function(t){if(this.params=this.params||{},!(t in this.params)){var e="data-store-"+t;this.params[t]=this.wysie.wrapper.getAttribute(e)||this.wysie.element.getAttribute(e),this.wysie.wrapper.removeAttribute(e),this.wysie.element.removeAttribute(e)}return this.params[t]},"static":{create:function(t){var i,r=-1;for(var n in e){var s=e[n];s&&s["super"]===e&&s.test(t.store)&&(s.priority=s.priority||0,r<=s.priority&&(i=n,r=s.priority))}if(i){var o=new e[i](t);return o.id=i,o}return new e.Default(t)}}});e.Default=t.Class({"extends":e,constructor:function(){this.wysie.readonly=this.url.origin!==location.origin||this.url.pathname!==location.pathname},"static":{test:function(){return!1}}})}(Bliss),function(t,e){var i=Wysie.Unit=t.Class({"abstract":!0,constructor:function(t,e,r){if(!t||!e)throw new Error("Wysie.Unit constructor requires an element argument and a wysie object");this.wysie=e,this.element=t,this.element._.data.unit=this,this.property=i.normalizeProperty(this.element),this.collection=r,this.computed=this.element.matches(Wysie.selectors.computed),this.parentScope=this.scope=this.property?this.element.closest(Wysie.selectors.scope):null,this.scope===this.element&&(this.parentScope=r&&r.parentScope||this.scope.parentNode.closest(Wysie.selectors.scope)),this.required=this.element.matches("[required], [data-required]")},toJSON:Wysie.prototype.toJSON,get data(){return this.getData()},"static":{create:function(t,i,r){if(!t||!i)throw new TypeError("Wysie.Unit.create() requires an element argument and a wysie object");Wysie.is("scope",t)||e(Wysie.selectors.property,t).length&&(Wysie.is("multiple",t)||!t.matches("[data-attribute], [href], [src], time[datetime]"));return new(Wysie[Wysie.Scope.is(t)?"Scope":"Primitive"])(t,i,r)},normalizeProperty:function(t){var e=t.getAttribute("property")||t.getAttribute("itemprop");return!e&&t.hasAttribute("property")&&(e=(t.getAttribute("class")||"").match(/^[^\s]*/)[0]),e&&t.setAttribute("property",e),e}}})}(Bliss,Bliss.$),function(t,e){var i=Wysie.Scope=t.Class({"extends":Wysie.Unit,constructor:function(t,e,r){var n=this,s=this;this.type=i.normalize(this.element),this.collections=[],this.properties.forEach(function(t){Wysie.is("multiple",t)?n.collections.push(new Wysie.Collection(t,s.wysie)):t._.data.unit=i["super"].create(t,n.wysie)}),this.cacheReferences(),this.element.addEventListener("wysie:propertychange",function(t){t.stopPropagation(),n.updateReferences()}),this.updateReferences()},get isRoot(){return!this.property},get properties(){var t=this;return e(Wysie.selectors.property,this.element).filter(function(e){return t.element===e.parentNode.closest(Wysie.selectors.scope)})},get propertyNames(){return this.properties.map(function(t){return t._.data.unit.property})},getData:function(t){if(t=t||{},this.editing&&!this.everSaved&&!t.dirty||this.computed&&!t.computed)return null;var e={};return this.properties.forEach(function(i){var r=i._.data.unit;if((!r.computed||t.computed)&&!(r.property in e)){var n=r.getData(t);null!==n&&(e[r.property]=r.collection?[]:r.getData(t))}}),this.collections.forEach(function(i){e[i.property]=i.getData(t)}),e},edit:function(){this.collections.forEach(function(t){return t.edit()}),this.properties.forEach(function(t){var e=t._.data.unit;e[e instanceof i?"edit":"preEdit"]()})},save:function(){this.properties.forEach(function(t){return t._.data.unit.save()}),this.everSaved=!0},cancel:function(){this.properties.forEach(function(t){t._.data.unit.cancel()}),this.collection&&!this.everSaved&&t.remove(this.element)},render:function(e){var i=this;if(e){var r=Object.keys(e).filter(function(t){return-1===i.propertyNames.indexOf(t)&&"object"!=typeof e[t]});this.properties.forEach(function(t){var i=t._.data.unit;if(!i.collection){var r=Wysie.queryJSON(e,i.property);r&&i.render(r)}}),this.collections.forEach(function(t){return t.render(e[t.property])}),r.forEach(function(r){var n=t.create("meta",{property:r,content:e[r],inside:i.element});/number|boolean/.test(typeof e[r])&&n.setAttribute("datatype",typeof e[r]),n._.data.unit=Wysie.Unit.create(n,i.wysie)}),this.everSaved=!0}},cacheReferences:function(){var i=this,r=this.propertyNames.join("|");this.refRegex=RegExp("{(?:"+r+")}|\\${.+?}","gi"),this.references=[];var n=function(e,r){var n=r?r.value:e.textContent,s=n.match(i.refRegex),o=t.value(e._.data.unit,"attribute");s&&i.references.push({element:e,attribute:r&&r.name,text:n,expressions:s.map(function(t){return{isSimple:0!==t.indexOf("$"),expression:t.replace(/^\$?{|}$/g,""),isProperty:Wysie.is("property",e)&&r.name==o}})})};(function s(t){this.refRegex.lastIndex=0,this.refRegex.test(t.outerHTML||t.textContent)&&(e(t.attributes).forEach(function(e){n(t,e)}),e(t.childNodes).forEach(s,this),3===t.nodeType&&n(t,null))}).call(this,this.element),this.updateReferences()},getRelativeData:function(){for(var e=this,i={};e;){e.property;i=t.extend(e.getData({dirty:!0,computed:!0}),i);var r=e.parentScope;e=r&&r._.data.unit}return function n(e){t.each(e,function(e,r){e in i||(i[e]=r),"object"===t.type(r)&&n(r)})}.call(this,i),i},updateReferences:function(){this.references.length&&(data=this.getRelativeData(),e(this.references).forEach(function(t){var i=t.text;e(t.expressions).forEach(function(e){var r=e.isSimple?data[e.expression]:safeval(e.expression,data);e.isSimple&&/^(class|id)$/i.test(t.attribute)&&(r=Wysie.identifier(r)),i=i.replace((e.isSimple?"{":"${")+e.expression+"}",r||"")}),t.attribute?t.element.setAttribute(t.attribute,i):t.element.textContent=i}))},"static":{is:function(t){var i=Wysie.is("scope",t);return i||e(Wysie.selectors.property,t).length&&(i=Wysie.is("multiple",t)||null===Wysie.Primitive.getValueAttribute(t)),i},normalize:function(t){var e=t.getAttribute("typeof")||t.getAttribute("itemtype");return!e&&i.is(t)&&(e="Item"),e&&t.setAttribute("typeof",e),e}}})}(Bliss,Bliss.$),function(t,e){var i=Wysie.Primitive=t.Class({"extends":Wysie.Unit,constructor:function(r,n,s){var o=this;this.attribute=i.getValueAttribute(this.element),this.datatype=i.getDatatype(this.element,this.attribute),Wysie.is("formControl",this.element)?(this.editor=this.element,this.exposed&&(this.element.addEventListener("change",function(t){t.target!==o.editor||!o.scope._.data.unit.everSaved&&o.scope.collection||o.wysie.save()}),this.edit())):this.editor||(this.editor=e(this.element.children).filter(function(t){return t.matches(Wysie.selectors.formControl)&&!t.matches(Wysie.selectors.property)})[0],t.remove(this.editor)),this["default"]=this.editor?this.editorValue:this.value,this.update(this.value),this.attribute?Wysie.is("formControl",this.element)||(this.observer=new MutationObserver(function(t){o.update(o.value)}),this.observer.observe(this.element,{attributes:!0,attributeFilter:[this.attribute]})):(this.observer=new MutationObserver(function(t){o.editing||o.update(o.value)}),this.observer.observe(this.element,{characterData:!0,childList:!0,subtree:!0}))},get value(){return this.editing?this.editorValue:i.getValue(this.element,this.attribute,this.datatype)},set value(t){this.editing&&(this.editorValue=t),i.setValue(this.element,t,this.attribute,this.datatype),(Wysie.is("formControl",this.element)||!this.attribute)&&this.update(t)},get editorValue(){if(this.editor){if(this.editor.matches(Wysie.selectors.formControl))return i.getValue(this.editor,void 0,this.datatype);var e=t(Wysie.selectors.output+", "+Wysie.selectors.formControl,this.editor);if(e)return e._.data.unit?e._.data.unit.value:i.getValue(e)}},set editorValue(e){if(this.editor)if(this.editor.matches(Wysie.selectors.formControl))i.setValue(this.editor,e);else{var r=t(Wysie.selectors.output+", "+Wysie.selectors.formControl,this.editor);r&&(r._.data.unit?r._.data.unit.value=e:i.setValue(r,e))}},get exposed(){return this.editor===this.element},getData:function(t){if(t=t||{},this.computed&&!t.computed)return null;var e=!this.editing||t.dirty||this.exposed?this.value:this.savedValue;return t.dirty||""!==e||e!==this["default"]?e:null},update:function(t){this.empty=""===t||null===t,t=t||0===t?t:"",this.humanReadable&&this.attribute&&(this.element.textContent=this.humanReadable(t)),this.element._.fire("wysie:propertychange",{property:this.property,value:t,wysie:this.wysie,unit:this,dirty:this.editing})},save:function(){this.popup?(t.remove(this.popup),this.popup.classList.add("hidden")):this.attribute||this.exposed||!this.editing||(this.element.textContent=this.editorValue,t.remove(this.editor)),this.exposed||(this.editing=!1),null!==this.element._.data.prevTabindex?this.element.tabIndex=this.element._.data.prevTabindex:this.element.removeAttribute("tabindex"),this.element._.fire("wysie:propertysave",{unit:this})},cancel:function(){void 0!==this.savedValue&&(this.value=this.savedValue),this.save()},preEdit:function(){var t=this;if(this.empty&&!this.attribute)return void this.edit();var e={"mousedown focus click":function(e){return t.edit()},"wysie:propertysave":function(i){return t.element._.unbind(e)}};this.element._.events(e),this.element._.data.prevTabindex=this.element.getAttribute("tabindex"),this.element.tabIndex=0},edit:function(){var r=this;if(!this.editing){if(void 0===this.savedValue){if(this.element.hasAttribute("data-input")){var n=this.element.getAttribute("data-input");n&&(this.editor=t.clone(t(n)),Wysie.is("formControl",this.editor)||(t(Wysie.selectors.output,this.editor)?(this.editor.setAttribute("data-store","none"),new Wysie(this.editor)):this.editor=null))}if(!this.editor){var s=i.getMatch(this.element,i.editors);s.create&&t.extend(this,s,function(t){return"create"!=t});var o=s.create||s;this.editor=t.create("function"===t.type(o)?o.call(this):o),this.editorValue=this.value}if(this.editor._.events({input:function(t){r.attribute&&r.element.setAttribute(r.attribute,r.editorValue),(r.exposed||!r.attribute)&&r.update(r.editorValue)},focus:function(){this.select&&this.select()},keyup:function(t){(r.popup&&13==t.keyCode||27==t.keyCode)&&(t.stopPropagation(),r.popup.classList.add("hidden"))},"wysie:propertychange":function(e){"output"===e.property&&(e.stopPropagation(),t.fire(r.editor,"input"))}}),"placeholder"in this.editor&&(this.editor.placeholder="("+this.label+")"),!this.exposed){var a=/^data-input-/i;e(this.element.attributes).forEach(function(t){a.test(t.name)&&this.editor.setAttribute(t.name.replace(a,""),t.value)},this),this.attribute&&(this.element.classList.add("using-popup"),this.popup=this.popup||t.create("div",{className:"popup hidden",contents:[this.label+":",this.editor]}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length)),this.popup.addEventListener("focus",function(t){return r.showPopup()},!0),this.popup.addEventListener("blur",function(t){return r.popup.classList.add("hidden")},!0))}this.popup||this.editor.classList.add("wysie-editor")}var c={click:function(t){t.target!==r.editor&&(t.preventDefault(),t.stopPropagation()),r.popup&&r.element!=document.activeElement&&(r.popup.classList.contains("hidden")?r.showPopup():r.popup.classList.add("hidden"))},focus:function(t){return r.showPopup()},blur:function(t){return r.popup&&r.popup.classList.add("hidden")},"wysie:propertysave":function(t){return r.element._.unbind(c)}};this.element._.events(c),this.popup&&this.popup._.after(this.element),this.savedValue=this.value,this.editing=!0,this.attribute||this.editor.parentNode==this.element||this.exposed||(this.editorValue=this.element.textContent,this.element.textContent="",this.exposed||this.element.appendChild(this.editor))}},showPopup:function(){this.popup&&(this.popup.classList.remove("hidden"),this.popup._.style({top:this.element.offsetTop+this.element.offsetHeight+"px",left:this.element.offsetLeft+"px"}))},render:function(t){this.value=t},lazy:{label:function(){return Wysie.readable(this.property)}},live:{empty:function(t){this.element.classList[t?"add":"remove"]("empty")},editing:function(t){this.element.classList[t?"add":"remove"]("editing")}},"static":{getMatch:function(t,e){var i=null;for(var r in e)t.matches(r)&&(i=e[r]);return i},getValueAttribute:function r(t){var e=(r.cache=r.cache||new WeakMap).get(t);return void 0===e&&(e=t.getAttribute("data-attribute")||i.getMatch(t,i.attributes),e&&(e.humanReadable&&t._.data.unit instanceof i&&(t._.data.unit.humanReadable=e.humanReadable),e=e.value||e),e&&"null"!==e||(e=null),r.cache.set(t,e)),e},getDatatype:function n(t,e){var r=(n.cache=n.cache||new WeakMap).get(t);if(void 0===r){if(r=t.getAttribute("datatype"),!r)for(var s in i.datatypes)t.matches(s)&&(r=i.datatypes[s][e]);r=r||"string",n.cache.set(t,r)}return r},getValue:function s(t,e,r){var n=(s.cache=s.cache||new WeakMap).get(t);return n||(e=e||null===e?e:i.getValueAttribute(t),r=r||i.getDatatype(t,e),n=function(){var i;switch(i=e in t?t[e]:e?t.getAttribute(e):t.getAttribute("content")||t.textContent||null,r){case"number":return+i;case"boolean":return!!i;default:return i}},s.cache.set(t,n)),n()},setValue:function(t,e,r){r=r||i.getValueAttribute(t),r in t?t[r]=e:r?t.setAttribute(r,e):t.textContent=e}}});i.attributes={"img, video, audio":"src","a, link":"href","select, input, textarea":"value","input[type=checkbox]":"checked",time:{value:"datetime",humanReadable:function(t){var e=new Date(t);if(!t||isNaN(e))return"("+this.label+")";var i="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");return e.getDate()+" "+i[e.getMonth()]+" "+e.getFullYear()}},meta:"content"},i.datatypes={"input[type=checkbox]":{checked:"boolean"},"input[type=range], input[type=number]":{value:"number"}},i.editors={"*":{tag:"input"},".number":{tag:"input",type:"number"},".boolean":{tag:"input",type:"checkbox"},"a, img, video, audio, .url":{tag:"input",type:"url",placeholder:"http://"},"p, div, .multiline":{create:{tag:"textarea"},get editorValue(){return this.editor&&this.editor.value},set editorValue(t){this.editor&&(this.editor.value=t.replace(/\r?\n/g,""))}},"time, .date":function(){var e={date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i,month:/^[Y\d]{4}-[M\d]{2}$/i,time:/^[H\d]{2}:[M\d]{2}/i,week:/[Y\d]{4}-W[W\d]{2}$/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[M\d]{2}/i},i=this.element.getAttribute("datetime")||"YYYY-MM-DD";for(var r in e)if(e[r].test(i))break;return t.create("input",{type:r})}},Stretchy.selectors.filter=".wysie-editor"}(Bliss,Bliss.$),function(t,e){var i=Wysie.Collection=function(i,r){var n=this;if(!i||!r)throw new TypeError("No template and/or Wysie object");this.template=i,this.wysie=r,this.property=Wysie.Unit.normalizeProperty(this.template),this.type=Wysie.Scope.normalize(this.template),this.parentScope=this.template.parentNode.closest(Wysie.selectors.scope),this.required=this.template.matches(Wysie.selectors.required);var s=this.template.parentNode.closest(".wysie-item");this.addButton=e("button.add-"+this.property+", .wysie-add, button.add",s).filter(function(t){return!n.template.contains(t)})[0],this.addButton=this.addButton||document.createElement("button")._.set({className:"add",textContent:"Add "+this.name.replace(/s$/i,"")}),this.addButton.addEventListener("click",function(t){t.preventDefault(),n.addEditable()}),this.template.hasAttribute("data-bottomup")?this.bottomUp=!0:this.addButton.parentNode?this.bottomUp=!!(this.addButton.compareDocumentPosition(this.template)&Node.DOCUMENT_POSITION_FOLLOWING):this.bottomUp=!1,this.marker=t.create("div",{hidden:!0,className:"wysie-marker",after:this.template}),this.template._.remove(),this.template.classList.add("wysie-item"),t.create({tag:"button",textContent:"✖",title:"Delete this "+this.name.replace(/s$/i,""),className:"delete",inside:this.template}),this.addButton.parentNode||(this.bottomUp?this.addButton._.before(this.items[0]||this.marker):this.addButton._.after(this.marker)),this.wysie.wrapper.addEventListener("wysie:load",function(t){n.required&&!n.length&&n.addEditable()})};i.prototype={get name(){return Wysie.readable(this.property||this.type).toLowerCase()},get selector(){return".wysie-item"+(this.property?'[property="'+this.property+'"]':"")+(this.type?'[typeof="'+this.type+'"]':"")},get items(){return e(this.selector,this.parentScope||this.wysie.wrapper)},get length(){return this.items.length},get data(){return this.getData()},getData:function(t){return t=t||{},this.items.map(function(e){var i=e._.data.unit;return i.getData(t)}).filter(function(t){return null!==t})},toJSON:Wysie.prototype.toJSON,createItem:function(){var t=this.template.cloneNode(!0);return t._.delegate({click:{"button.delete":function(t){confirm("Are you sure you want to "+t.target.title.toLowerCase()+"?")&&me["delete"](this),t.stopPropagation()}},mouseover:{"button.delete":function(t){this.classList.add("delete-hover"),t.stopPropagation()}},mouseout:{"button.delete":function(t){this.classList.remove("delete-hover"),t.stopPropagation()}}}),Wysie.Unit.create(t,this.wysie,this),t},add:function(){var t=this.createItem();return t._.before(this.marker),t},addEditable:function(){var t=this.createItem();return t._.before(this.bottomUp?this.items[0]||this.marker:this.marker),t._.data.unit.edit(),t},edit:function(){if(0===this.length&&this.required){this.addEditable()}},"delete":function(e){var i=this;return t.transition(e,{opacity:0}).then(function(){t.remove(e),e._.data.unit.isRoot&&i.wysie.save()})},save:function(){this.items.forEach(function(t){t._.data.unit.save()})},cancel:function(){this.items.forEach(function(t){t._.data.unit.cancel()})},render:function(t){if(t){t&&!Array.isArray(t)&&(t=[t]);var e=document.createDocumentFragment();t.forEach(function(t){var i=this.createItem();i._.data.unit.render(t),e.appendChild(i)},this),this.marker.parentNode.insertBefore(e,this.marker)}}}}(Bliss,Bliss.$),function(t){if(self.Wysie){var e="//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js";Wysie.Storage.Dropbox=t.Class({"extends":Wysie.Storage,constructor:function(){var i=this;this.wysie.readonly=!0,this.ready=t.include(self.Dropbox,e).then(function(){var e=new URL(document.referrer,location);return"www.dropbox.com"===e.hostname&&0===location.hash.indexOf("#access_token=")?(Dropbox.AuthDriver.Popup.oauthReceiver(),t.fire(window,"load"),void close()):(i.wysie.store.hostname="dl.dropboxusercontent.com",i.wysie.store.search=i.wysie.store.search.replace(/\bdl=0|^$/,"raw=1"),i.filename=(i.param("path")||"")+new URL(i.wysie.store).pathname.match(/[^\/]*$/)[0],i.client=new Dropbox.Client({key:i.param("key")}),void(i.loginToEdit=!0))}).then(function(){i.login(!0)})},backendSave:function(){return this.put({name:this.filename,data:this.wysie.toJSON()})},put:function(t){var e=this;return new Promise(function(i,r){e.client.writeFile(t.name,t.data,function(t,e){return t?r(Error(t)):(console.log("File saved as revision "+e.versionTag),void i(e))})})},login:function(t){var e=this;return this.ready.then(function(){return e.client.isAuthenticated()?Promise.resolve():new Promise(function(i,r){e.client.authDriver(new Dropbox.AuthDriver.Popup({receiverUrl:new URL(location)+""})),e.client.authenticate({interactive:!t},function(t,n){t&&r(Error(t)),e.client.isAuthenticated()?(e.authenticated=!0,e.wysie.readonly=!1,i()):(e.authenticated=!1,e.wysie.readonly=!0,r())})})}).then(function(){e.client.getAccountInfo(function(t,i){t||e.wysie.wrapper._.fire("wysie:login",i)})})["catch"](function(){})},logout:function(){var t=this;return this.client.isAuthenticated()?new Promise(function(e,i){t.client.signOut(null,function(){t.authenticated=!1,t.wysie.wrapper._.fire("wysie:logout"),e()})}):Promise.resolve()},"static":{test:function(t){return/dropbox.com/.test(t.host)||"dropbox:"===t.protocol}}})}}(Bliss);