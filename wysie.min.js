"use strict";!function(){function t(t,e){return t instanceof Node||t instanceof Window?[t]:[].slice.call("string"==typeof t?(e||document).querySelectorAll(t):t||[])}if(self.Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||null),Element.prototype.matches)){var e=self.Stretchy={selectors:{base:'textarea, select:not([size]), input:not([type]), input[type="'+"text url email tel".split(" ").join('"], input[type="')+'"]',filter:"*"},script:document.currentScript||t("script").pop(),resize:function(t){if(e.resizes(t)){var i=getComputedStyle(t),s=0;if(!t.value&&t.placeholder){var n=!0;t.value=t.placeholder}var r=t.nodeName.toLowerCase();if("textarea"==r)t.style.height="0","border-box"==i.boxSizing?s=t.offsetHeight:"content-box"==i.boxSizing&&(s=-t.clientHeight),t.style.height=t.scrollHeight+s+"px";else if("input"==r){t.style.width="0",
"border-box"==i.boxSizing?s=t.offsetWidth:"padding-box"==i.boxSizing&&(s=t.clientWidth),t.scrollLeft=1e10;var o=Math.max(t.scrollLeft+s,t.scrollWidth-t.clientWidth);t.style.width=o+"px"}else if("select"==r){var a=document.createElement("_");a.textContent=t.options[t.selectedIndex].textContent,t.parentNode.insertBefore(a,t.nextSibling);var c;for(var u in i)/^(width|webkitLogicalWidth)$/.test(u)||(a.style[u]=i[u],/appearance$/i.test(u)&&(c=u));a.style.width="",a.offsetWidth>0&&(t.style.width=a.offsetWidth+"px",i[c]&&"none"===i[c]||(t.style.width="calc("+t.style.width+" + 2em)")),a.parentNode.removeChild(a),a=null}n&&(t.value="")}},resizeAll:function(i){t(i||e.selectors.base).forEach(function(t){e.resize(t)})},active:!0,resizes:function(t){return t&&t.parentNode&&t.matches&&t.matches(e.selectors.base)&&t.matches(e.selectors.filter)},init:function(){e.selectors.filter=e.script.getAttribute("data-filter")||(t("[data-stretchy-filter]").pop()||document.body).getAttribute("data-stretchy-filter")||Stretchy.selectors.filter||"*",
e.resizeAll()},$$:t};"loading"!==document.readyState?e.init():document.addEventListener("DOMContentLoaded",e.init);var i=function(t){e.active&&e.resize(t.target)};document.body.addEventListener("input",i),document.body.addEventListener("change",i),self.MutationObserver&&new MutationObserver(function(t){e.active&&t.forEach(function(t){"childList"==t.type&&Stretchy.resizeAll(t.addedNodes)})}).observe(document.body,{childList:!0,subtree:!0})}}(),function(t,e){var i=self.Wysie=t.Class({constructor:function(s){var n=this;i.all.push(this);var r=s.getAttribute("data-store")||"none";if(this.store="none"===r?null:new URL(r||this.id,location),this.id=s.id||"wysie-"+i.all.length,this.element=i.is("scope",s)?s:t(i.selectors.scope,s),this.element||(s.setAttribute("typeof",s.getAttribute("property")||""),s.removeAttribute("property"),this.element=s),this.element.classList.add("wysie-root"),e(i.selectors.property+", "+i.selectors.scope).concat([this.element]).forEach(function(t){i.is("autoMultiple",t)&&!t.hasAttribute("data-multiple")&&t.setAttribute("data-multiple","");
}),this.wrapper=s.closest(".wysie-wrapper")||s,this.wrapper===this.element&&i.is("multiple",s)){var o=this.element;this.element.matches("li, option")?o=o.parentNode:this.element.matches("td, tr, tbody, thead, tfoot")&&(o=o.closest("table")),this.wrapper=t.create({around:o})}this.wrapper.classList.add("wysie-wrapper"),s.removeAttribute("data-store"),this.root=new(i.is("multiple",this.element)?i.Collection:i.Scope)(this.element,this),this.permissions=new Wysie.Permissions(null,this),this.bar=t(".wysie-bar",this.wrapper)||t.create({className:"wysie-bar",start:this.wrapper,contents:{tag:"span",className:"status"}}),this.permissions.can(["edit","add","delete"],function(){t.contents(n.bar,[{tag:"button",className:"edit",innerHTML:"<span class='icon'>✎</span> Edit",onclick:function(t){return n.edit()}},{tag:"button",innerHTML:"<span class='icon'>✓</span> Save",className:"save",onclick:function(t){return n.save()}},{tag:"button",innerHTML:"<span class='icon'>✘</span> Cancel",className:"cancel",
onclick:function(t){return n.cancel()}}])},function(){e(".edit, .save, .cancel",n.bar)._.remove()}),this.store&&this.store.href?(this.storage=i.Storage.create(this),this.permissions.can("read",function(){return n.storage.load()})):this.wrapper._.fire("wysie:load")},get data(){return this.getData()},getData:function(t){return this.root.getData(t)},toJSON:function(){return JSON.stringify(this.data,null,"	")},render:function(t){this.root.render(t.data||t)},edit:function(){this.editing=!0,this.root.edit()},save:function(){this.root.save(),this.editing=!1,this.storage&&this.storage.save()},cancel:function(){this.editing=!1,this.root.cancel()},live:{editing:{set:function(t){this.wrapper._.toggleClass("editing",t),t?this.wrapper.setAttribute("data-editing",""):this.wrapper.removeAttribute("data-editing")}}},"static":{all:[],readable:function(t){return t&&t.replace(/([a-z])([A-Z][a-z])/g,function(t,e,i){return e+" "+i.toLowerCase()}).replace(/([a-z])[_\/-](?=[a-z])/g,"$1 ").replace(/^[a-z]/,function(t){
return t.toUpperCase()})},identifier:function(t){return t&&t.replace(/\s+/g,"-").replace(/[^\w-]/g,"").toLowerCase()},queryJSON:function(e,i){return i&&e?t.value.apply(t,[e].concat(i.split("/"))):e},timed:function(t,e){return function(){console.time(t),e.apply(this,arguments),console.timeEnd(t)}},observe:function(e,i,s,n){var r="function"==t.type(s)?new MutationObserver(s):s,o=i?{attributes:!0,attributeFilter:[i],attributeOldValue:!!n}:{characterData:!0,childList:!0,subtree:!0,characterDataOldValue:!!n};return r.observe(e,o),r},selectors:{property:"[property], [itemprop]",specificProperty:function(t){return"[property="+t+"], [itemprop="+t+"]"},output:"[property=output], [itemprop=output], .output, .value",primitive:"[property]:not([typeof]), [itemprop]:not([itemscope])",scope:"[typeof], [itemscope], [itemtype], .scope",multiple:"[multiple], [data-multiple], .multiple",autoMultiple:["li","tr","option"].map(function(t){return t+":only-of-type"}).join(", "),required:"[required], [data-required], .required",
formControl:"input, select, textarea",computed:".computed"},is:function(t,e){return e.matches&&e.matches(i.selectors[t])},hooks:new t.Hooks}});t.add("toggleClass",function(t,e){this.classList[e?"add":"remove"](t)}),t.proxy=t.classProps.proxy=t.overload(function(t,e,i){return Object.defineProperty(t,e,{get:function(){return this[i][e]},configurable:!0,enumerable:!0}),t}),t.ready().then(function(t){e("[data-store]").forEach(function(t){new Wysie(t)})}),i.prototype.render=i.timed("render",i.prototype.render)}(Bliss,Bliss.$),self.Promise&&!Promise.prototype.done&&(Promise.prototype.done=function(t){return this.then(t,t)}),function(t){var e=Wysie.Permissions=t.Class({constructor:function(t,e){this.triggers=[],this.wysie=e,this.set(t)},set:function(t){for(var e in t)this[e]=t[e]},on:function(t){var e=this;return t=Array.isArray(t)?t:[t],t.forEach(function(t){return e[t]=!0}),this},off:function(t){var e=this;return t=Array.isArray(t)?t:[t],t.forEach(function(t){return e[t]=!1}),this},can:function(t,e,i){
this.observe(t,!0,e),i&&this.observe(t,!1,i)},when:function(t){var e=this;return new Promise(function(i,s){e.can(t,i,s)})},observe:function(t,e,i){t=Array.isArray(t)?t:[t],this.is(t,e)&&i(),this.triggers.push({actions:t,value:e,callback:i,active:!0})},is:function(t,e){var i=this,s=t.map(function(t){return!!i[t]}).reduce(function(t,e){return t||e});return e?s:!s},changed:function(t,e,i){var s=this;i=!!i,e=!!e,e!=i&&(this.wysie.wrapper._.toggleClass("can-"+t,e),this["_"+t]=e,this.triggers.forEach(function(e){var i=s.is(e.actions,e.value);e.active&&e.actions.indexOf(t)>-1&&i?(e.active=!1,e.callback()):i||(e.active=!0)}))},"static":{actions:[],register:function(i,s){return Array.isArray(i)?void i.forEach(function(t){return e.register(t,s)}):(t.live(e.prototype,i,function(t,e){s&&s.call(this,t,e),this.changed(i,t,e)}),void e.actions.push(i))}}});e.register("read"),e.register("login",function(t){t&&this.logout&&(this.logout=!1)}),e.register("logout",function(t){t&&this.login&&(this.login=!1)}),
e.register("edit",function(t){t&&(this.add=this["delete"]=!0)}),e.register(["add","delete"],function(t){t||(this.edit=!1)})}(Bliss),function(t){var e=Wysie.Storage=t.Class({"abstract":!0,constructor:function(e){var i=this;this.wysie=e,this.originalHref=new URL(this.href,location),this.loaded=new Promise(function(t,e){i.wysie.wrapper.addEventListener("wysie:load",t)}),this.authControls={},this.permissions.can("login",function(){i.loginHash="#login"+(Wysie.all[0]===i.wysie?"":"-"+i.wysie.id),i.authControls.login=t.create({tag:"a",href:i.loginHash,textContent:"Login",className:"login button",events:{click:function(t){t.preventDefault(),i.login()}},after:t(".status",i.wysie.bar)});var e;(e=function(){location.hash===i.loginHash&&(history.replaceState(null,document.title,new URL("",location)+""),i.login())})(),window.addEventListener("hashchange.wysie",e)},function(){t.remove(i.authControls.login),i.wysie.wrapper._.unbind("hashchange.wysie")}),this.permissions.can("logout",function(){i.authControls.logout=t.create({
tag:"button",textContent:"Logout",className:"logout",events:{click:i.logout.bind(i)},after:t(".status",i.wysie.bar)})},function(){t.remove(i.authControls.logout)}),this.wysie.wrapper.addEventListener("wysie:login.wysie",function(e){t(".status",i.wysie.bar).innerHTML="Logged in to "+i.id+" as <strong>"+e.name+"</strong>"}),this.wysie.wrapper.addEventListener("wysie:logout.wysie",function(e){t(".status",i.wysie.bar).textContent=""})},get url(){return this.wysie.store},get permissions(){return this.wysie.permissions},get href(){return this.url.href},get backup(){return JSON.parse(localStorage[this.originalHref]||null)},set backup(t){localStorage[this.originalHref]=JSON.stringify(t,null,"	")},ready:Promise.resolve(),load:function(){var e=this,i=this.ready,s=this.backup;return this.inProgress="Loading",s&&s.synced===!1?i.then(function(){return e.wysie.render(s),e.inProgress=!1,e.wysie.wrapper._.fire("wysie:load"),e.save()}):(i=this.url.origin!==location.origin||this.url.pathname!==location.pathname?i.then(function(){
return e.backendLoad?e.backendLoad():t.fetch(e.href,{responseType:"json"})}).then(function(t){if(e.inProgress=!1,e.wysie.wrapper._.fire("wysie:load"),t.response){var i=Wysie.queryJSON(t.response,e.url.hash.slice(1));e.wysie.render(i)}e.backup={synced:!0,data:e.wysie.data}}):i.done(function(){return Promise.reject()}),i["catch"](function(t){e.inProgress=!1,t&&(console.error(t),console.log(t.stack)),s&&e.wysie.render(s),e.wysie.wrapper._.fire("wysie:load")}))},save:function(){var t=this;return this.backup={synced:!this._save,data:this.wysie.data},this.backendSave?this.login().then(function(){return t.inProgress="Saving",t.backendSave().then(function(){var e=t.backup;e.synced=!0,t.backup=e,t.wysie.wrapper._.fire("wysie:save")}).done(function(){t.inProgress=!1})}):void 0},login:function(){return Promise.resolve()},logout:function(){return Promise.resolve()},param:function(t){if(this.params=this.params||{},!(t in this.params)){var e="data-store-"+t;this.params[t]=this.wysie.wrapper.getAttribute(e)||this.wysie.element.getAttribute(e),
this.wysie.wrapper.removeAttribute(e),this.wysie.element.removeAttribute(e)}return this.params[t]},live:{inProgress:function(e){if(e){t.create("div",{textContent:e+"…",className:"progress",inside:this.wysie.wrapper})}else t.remove(t(".progress",this.wysie.wrapper))}},"static":{create:function(t){var i,s=-1;for(var n in e){var r=e[n];r&&r["super"]===e&&r.test(t.store)&&(r.priority=r.priority||0,s<=r.priority&&(i=n,s=r.priority))}if(i){var o=new e[i](t);return o.id=i,o}return new e.Default(t)}}});e.Default=t.Class({"extends":e,constructor:function(){this.permissions.set({read:!0,edit:this.url.origin===location.origin&&this.url.pathname===location.pathname,login:!1,logout:!1})},"static":{test:function(){return!1}}})}(Bliss),function(t,e){var i=Wysie.Unit=t.Class({"abstract":!0,constructor:function(t,e,s){if(!t||!e)throw new Error("Wysie.Unit constructor requires an element argument and a wysie object");this.wysie=e,this.element=t,this.element._.data.unit=this,this.property=i.normalizeProperty(this.element),
this.collection=s,this.computed=this.element.matches(Wysie.selectors.computed),this.required=this.element.matches("[required], [data-required]")},toJSON:Wysie.prototype.toJSON,get data(){return this.getData()},live:{deleted:function(t){this.element._.toggleClass("deleted",t)}},"static":{create:function(t,i,s){if(!t||!i)throw new TypeError("Wysie.Unit.create() requires an element argument and a wysie object");Wysie.is("scope",t)||e(Wysie.selectors.property,t).length&&(Wysie.is("multiple",t)||!t.matches("[data-attribute], [href], [src], time[datetime]"));return new(Wysie[Wysie.Scope.is(t)?"Scope":"Primitive"])(t,i,s)},normalizeProperty:function(t){var e=t.getAttribute("property")||t.getAttribute("itemprop");return!e&&t.hasAttribute("property")&&(e=t.name||t.id||t.classList[0]),e&&t.setAttribute("property",e),e}}})}(Bliss,Bliss.$),function(t,e){var i=Wysie.Expression=t.Class({constructor:function(t){this.simple="$"!==t[0],this.expression=t.replace(/\$?\{|\}/g,"").trim()},get regex(){return RegExp((this.simple?"\\{":"\\$\\{")+this.expression+"\\}");
},eval:function(t){return this.oldValue=this.value,this.value=this.simple?t[this.expression]:i.eval(this.expression,t)},toString:function(){return(this.simple?"{":"${")+this.expression+"}"},"static":{eval:function(t,e){var i=Object.keys(e);try{var s=Function.apply(null,i.concat("return "+t+";"));return s.apply(self,i.map(function(t){return e[t]}))}catch(n){return console.warn("Error in "+t+": "+n),"N/A"}}}});!function(){var e=Wysie.Expression.Text=t.Class({constructor:function(t){this.element=t.element,this.attribute=t.attribute||null,this.all=t.all,this.template=this.tokenize(this.text)},get text(){return this.attribute?this.attribute.value:this.element.textContent},set text(t){this.oldText=this.text,this.attribute?this.attribute.value=t:this.element.textContent=t},update:function(t){var e=this;this.text=this.template.map(function(i){if(i instanceof Wysie.Expression){var s=i.eval(t)||"";return i.simple?e.transform(s):s}return i}).join("")},tokenize:function(t){return e.tokenize(t,this.expressionRegex);
},lazy:{transform:function(){var t=function(t){return t};if(this.element.matches){var i=this.attribute&&RegExp("\\b"+this.attribute.name+"\\b","i");for(var s in e.special)if(this.element.matches(s)){var n=e.special[s];for(var r in n)if(this.attribute&&i.test(r)||!this.attribute&&"null"==r){var o=t;t=function(t){return n[r](o(t))}}}}return t}},proxy:{scope:"all",allProperties:"all",expressionRegex:"all"},"static":{tokenize:function(t,e){var i,s=[],n=0;for(e.lastIndex=0;null!==(i=e.exec(t));)i.index>n&&s.push(t.substring(n,i.index)),s.push(new Wysie.Expression(i[0])),n=e.lastIndex;return n<t.length&&s.push(t.substring(n)),s},special:{"*":{"id, class, name":Wysie.identifier}}}})}(),function(){var i=Wysie.Expressions=t.Class({constructor:function(t){var e=this;this.scope=t,this.scope.expressions=this,this.all=[],this.allProperties=Object.keys(this.scope.getRelativeData()),this.expressionRegex=RegExp("{(?:"+this.allProperties.join("|")+")}|\\${.+?}","g"),this.traverse(),this.all.length>0&&(this.lastUpdated=0,
this.update(),this.scope.element.addEventListener("wysie:datachange",function(t){return e.update()}))},update:function s(){var t=this,n=performance.now()-this.lastUpdated;if(this.lastUpdated&&n<i.THROTTLE)return void(s.timeout||(s.timeout=setTimeout(function(){return t.update()},i.THROTTLE-n)));clearTimeout(s.timeout);var r=this.scope.getRelativeData();e(this.all).forEach(function(t){return t.update(r)}),this.lastUpdated=performance.now(),s.timeout=0},extract:function(t,e){this.expressionRegex.lastIndex=0,this.expressionRegex.test(e?e.value:t.textContent)&&this.all.push(new Wysie.Expression.Text({element:t,attribute:e,all:this}))},traverse:function(t){var i=this;t=t||this.scope.element,this.expressionRegex.lastIndex=0,this.expressionRegex.test(t.outerHTML||t.textContent)&&(e(t.attributes).forEach(function(e){return i.extract(t,e)}),3===t.nodeType&&this.extract(t,null),t!=this.scope.element&&t._.data.unit instanceof Wysie.Scope||e(t.childNodes).forEach(function(t){return i.traverse(t)}));
},"static":{THROTTLE:25}})}(),Wysie.hooks.add("scope-init-end",function(t){new Wysie.Expressions(t)})}(Bliss,Bliss.$),function(t,e){var i=Wysie.Scope=t.Class({"extends":Wysie.Unit,constructor:function(t,s,n){var r=this,o=this;this.type=i.normalize(this.element),this.properties={},e(Wysie.selectors.property,this.element).filter(function(t){return r.contains(t)}).forEach(function(t){if(Wysie.is("multiple",t))var e=new Wysie.Collection(t,o.wysie);else e=i["super"].create(t,r.wysie),e.scope=e instanceof i?e:r;e.parentScope=r,r.properties[e.property]=e}),Wysie.hooks.run("scope-init-end",this)},get isRoot(){return!this.property},get propertyNames(){return Object.keys(this.properties)},getData:function(e){if(e=e||{},this.editing&&!this.everSaved&&!e.dirty||this.computed&&!e.computed)return null;var i={};return t.each(this.properties,function(t,s){if((!s.computed||e.computed)&&!(s.property in i)){var n=s.getData(e);(null!==n||e["null"])&&(i[t]=n)}}),t.extend(i,this.unhandled),i},getRelativeData:function(){
for(var e=this,i={};e;){e.property;i=t.extend(e.getData({dirty:!0,computed:!0,"null":!0}),i);var s=e.parentScope;e=s}return function n(e){t.each(e,function(e,s){e in i||(i[e]=s),"object"===t.type(s)&&n(s)})}.call(this,i),i},edit:function(){this.editing=!0,t.each(this.properties,function(t,e){e instanceof Wysie.Collection?e.edit():e[e instanceof i?"edit":"preEdit"]()})},save:function(){this.editing=!1,t.each(this.properties,function(t,e){e.save()}),t.unbind(this.element,".wysie:edit"),this.everSaved=!0},cancel:function(){this.editing=!1,t.each(this.properties,function(t,e){e.cancel()}),t.unbind(this.element,".wysie:edit")},render:function(e){var i=this;e&&(e=e.isArray?e[0]:e,this.unhandled={},t.each(e,function(t,e){t in i.properties?i.properties[t].render(e):i.unhandled[t]=e}),this.everSaved=!0)},contains:function(t){return t instanceof Wysie.Unit?t.parentScope===this:this.element===t.parentNode.closest(Wysie.selectors.scope)},"static":{is:function(t){var i=Wysie.is("scope",t);return i||e(Wysie.selectors.property,t).length&&(i=Wysie.is("multiple",t)||null===Wysie.Primitive.getValueAttribute(t)),
i},normalize:function(t){var e=t.getAttribute("typeof")||t.getAttribute("itemtype");return!e&&i.is(t)&&(e="Item"),e&&t.setAttribute("typeof",e),e}}})}(Bliss,Bliss.$),function(t,e){var i=!1,s=Wysie.Primitive=t.Class({"extends":Wysie.Unit,constructor:function(i,n,r){var o=this;this.attribute=s.getValueAttribute(this.element),this.datatype=s.getDatatype(this.element,this.attribute),this.templateValue=this.value,Wysie.is("formControl",this.element)?(this.editor=this.element,this.exposed&&(this.element.addEventListener("change",function(t){o.wysie.editing||t.target!==o.editor||!o.scope.everSaved&&o.scope.collection||o.wysie.save()}),this.edit())):this.editor||(this.editor=e(this.element.children).filter(function(t){return t.matches(Wysie.selectors.formControl)&&!t.matches(Wysie.selectors.property)})[0],t.remove(this.editor)),this["default"]=this.element.hasAttribute("data-default")?this.templateValue:this.editor?this.editorValue:"",this.update(this.value),this.observer=Wysie.observe(this.element,this.attribute,function(t){
if(o.attribute){var e=o.value;t[0].oldValue!=e&&o.update(e)}else o.editing||o.update(o.value)})},get value(){return this.editing?this.editorValue:s.getValue(this.element,this.attribute,this.datatype)},set value(t){this.editing&&(this.editorValue=t),s.setValue(this.element,t,this.attribute,this.datatype),(Wysie.is("formControl",this.element)||!this.attribute)&&this.update(t)},get editorValue(){if(this.editor){if(this.editor.matches(Wysie.selectors.formControl))return s.getValue(this.editor,void 0,this.datatype);var e=t(Wysie.selectors.output+", "+Wysie.selectors.formControl,this.editor);if(e)return e._.data.unit?e._.data.unit.value:s.getValue(e)}},set editorValue(e){if(this.editor)if(this.editor.matches(Wysie.selectors.formControl))s.setValue(this.editor,e);else{var i=t(Wysie.selectors.output+", "+Wysie.selectors.formControl,this.editor);i&&(i._.data.unit?i._.data.unit.value=e:s.setValue(i,e))}},get exposed(){return this.editor===this.element},getData:function(t){if(t=t||{},this.computed&&!t.computed)return null;
var e=!this.editing||t.dirty||this.exposed?this.value:this.savedValue;return t.dirty||""!==e||e!==this["default"]?e:null},update:function(t){this.empty=""===t||null===t,t=t||0===t?t:"",this.humanReadable&&this.attribute&&(this.element.textContent=this.humanReadable(t));var e={property:this.property,value:t,wysie:this.wysie,unit:this,dirty:this.editing};this.element._.fire("wysie:propertychange",e),this.element._.fire("wysie:datachange",e)},save:function(){this.popup?this.hidePopup():this.attribute||this.exposed||!this.editing||(this.element.textContent=this.editorValue,t.remove(this.editor)),this.exposed||(this.editing=!1),null!==this.element._.data.prevTabindex?this.element.tabIndex=this.element._.data.prevTabindex:this.element.removeAttribute("tabindex"),this.element._.unbind(".wysie:edit .wysie:preedit .wysie:showpopup"),this.element._.fire("wysie:propertysave",{unit:this})},cancel:function(){void 0!==this.savedValue&&(this.value=this.savedValue),this.save()},preEdit:function(){var t=this;
return this.empty&&!this.attribute?void this.edit():(this.element._.events({"mousedown.wysie:preedit click.wysie:preedit":function(e){return t.edit()},"focus.wysie:preedit":function(e){t.edit(),t.popup||t.editor.focus()},"click.wysie:edit":function(e){t.exposed||e.preventDefault()}}),this.element._.data.prevTabindex=this.element.getAttribute("tabindex"),void(this.element.tabIndex=0))},initEdit:function(){var i=this;if(this.element.hasAttribute("data-input")){var n=this.element.getAttribute("data-input");n&&(this.editor=t.clone(t(n)),Wysie.is("formControl",this.editor)||(t(Wysie.selectors.output,this.editor)?(this.editor.setAttribute("data-store","none"),new Wysie(this.editor)):this.editor=null))}if(!this.editor){var r=s.getMatch(this.element,s.editors);r.create&&t.extend(this,r,function(t){return"create"!=t});var o=r.create||r;this.editor=t.create("function"===t.type(o)?o.call(this):o),this.editorValue=this.value}if(this.editor._.events({input:function(t){i.attribute&&i.element.setAttribute(i.attribute,i.editorValue),
(i.exposed||!i.attribute)&&i.update(i.editorValue)},focus:function(t){i.editor.select&&i.editor.select()},keyup:function(t){(i.popup&&13==t.keyCode||27==t.keyCode)&&(i.popup.contains(document.activeElement)&&i.element.focus(),t.stopPropagation(),i.hidePopup())},"wysie:propertychange":function(e){"output"===e.property&&(e.stopPropagation(),t.fire(i.editor,"input"))}}),"placeholder"in this.editor&&(this.editor.placeholder="("+this.label+")"),!this.exposed){var a=/^data-input-/i;if(e(this.element.attributes).forEach(function(t){a.test(t.name)&&this.editor.setAttribute(t.name.replace(a,""),t.value)},this),this.attribute){this.element.classList.add("using-popup"),this.popup=this.popup||t.create("div",{className:"wysie-popup",hidden:!0,contents:[this.label+":",this.editor]}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length));var c=function(t){i.popup.contains(t.target)||i.element.contains(t.target)||i.hidePopup()};this.showPopup=function(){t.unbind([this.element,this.popup],".wysie:showpopup"),
this.popup._.after(this.element),this.popup._.style({top:this.element.offsetTop+this.element.offsetHeight+"px",left:this.element.offsetLeft+"px"}),this.popup._.removeAttribute("hidden"),t.events(document,"focus click",c,!0)},this.hidePopup=function(){var e=this;t.unbind(document,"focus click",c,!0),this.popup.setAttribute("hidden",""),setTimeout(function(){t.remove(e.popup)},400),t.events(this.element,"focus.wysie:showpopup click.wysie:showpopup",function(t){e.showPopup()},!0)}}}this.popup||this.editor.classList.add("wysie-editor"),this.initEdit=null},edit:function(){this.editing||(this.element._.unbind(".wysie:preedit"),this.initEdit&&this.initEdit(),this.popup&&this.showPopup(),this.savedValue=this.value,this.editing=!0,this.attribute||this.editor.parentNode==this.element||this.exposed||(this.editorValue=this.element.textContent,this.element.textContent="",this.exposed||this.element.appendChild(this.editor)))},render:function(t){this.value=this.savedValue=t},lazy:{label:function(){return Wysie.readable(this.property);
}},live:{empty:function(e){!e||this.attribute&&t(Wysie.selectors.property,this.element)?this.element.classList.remove("empty"):this.element.classList.add("empty")},editing:function(t){this.element.classList[t?"add":"remove"]("editing")}},"static":{getMatch:function(t,e){var i=null;for(var s in e)t.matches(s)&&(i=e[s]);return i},getValueAttribute:function n(t){var e=(n.cache=n.cache||new WeakMap).get(t);return(void 0===e||i)&&(e=t.getAttribute("data-attribute")||s.getMatch(t,s.attributes),e&&(e.humanReadable&&t._.data.unit instanceof s&&(t._.data.unit.humanReadable=e.humanReadable),e=e.value||e),e&&"null"!==e||(e=null),n.cache.set(t,e)),e},getDatatype:function r(t,e){var n=(r.cache=r.cache||new WeakMap).get(t);if(void 0===n||i){if(n=t.getAttribute("datatype"),!n)for(var o in s.datatypes)t.matches(o)&&(n=s.datatypes[o][e]);n=n||"string",r.cache.set(t,n)}return n},getValue:function o(t,e,n){var r=(o.cache=o.cache||new WeakMap).get(t);return(!r||i)&&(e=e||null===e?e:s.getValueAttribute(t),n=n||s.getDatatype(t,e),
r=function(){var i;switch(i=e in t?t[e]:e?t.getAttribute(e):t.getAttribute("content")||t.textContent||null,n){case"number":return+i;case"boolean":return!!i;default:return i}},o.cache.set(t,r)),r()},setValue:function(t,e,i){i=i||s.getValueAttribute(t),i in t?t[i]=e:i?t.setAttribute(i,e):t.textContent=e}}});s.attributes={"img, video, audio":"src","a, link":"href","select, input, textarea":"value","input[type=checkbox]":"checked",time:{value:"datetime",humanReadable:function(t){var e=new Date(t);if(!t||isNaN(e))return"("+this.label+")";var i="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");return e.getDate()+" "+i[e.getMonth()]+" "+e.getFullYear()}},meta:"content"},s.datatypes={"input[type=checkbox]":{checked:"boolean"},"input[type=range], input[type=number]":{value:"number"}},s.editors={"*":{tag:"input"},".number":{tag:"input",type:"number"},".boolean":{tag:"input",type:"checkbox"},"a, img, video, audio, .url":{tag:"input",type:"url",placeholder:"http://"},"p, div, .multiline":{
create:{tag:"textarea"},get editorValue(){return this.editor&&this.editor.value},set editorValue(t){this.editor&&(this.editor.value=t.replace(/\r?\n/g,""))}},"time, .date":function(){var e={date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i,month:/^[Y\d]{4}-[M\d]{2}$/i,time:/^[H\d]{2}:[M\d]{2}/i,week:/[Y\d]{4}-W[W\d]{2}$/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[M\d]{2}/i},i=this.element.getAttribute("datetime")||"YYYY-MM-DD";for(var s in e)if(e[s].test(i))break;return t.create("input",{type:s})}},Stretchy.selectors.filter=".wysie-editor"}(Bliss,Bliss.$),function(t,e){var i=Wysie.Collection=function(i,s){var n=this;if(!i||!s)throw new TypeError("No template and/or Wysie object");this.template=i,this.wysie=s,this.items=[],this.property=Wysie.Unit.normalizeProperty(this.template),this.type=Wysie.Scope.normalize(this.template),this.required=this.template.matches(Wysie.selectors.required);var r=this.template.parentNode.closest(".wysie-item");this.addButton=e("button.add-"+this.property+", .wysie-add, button.add",r).filter(function(t){
return!n.template.contains(t)})[0],this.addButton=this.addButton||document.createElement("button")._.set({className:"add",textContent:"Add "+this.name.replace(/s$/i,"")}),this.addButton.addEventListener("click",function(t){t.preventDefault(),n.add().edit()}),this.template.hasAttribute("data-bottomup")?this.bottomUp=!0:this.addButton.parentNode?this.bottomUp=!!(this.addButton.compareDocumentPosition(this.template)&Node.DOCUMENT_POSITION_FOLLOWING):this.bottomUp=!1,this.marker=t.create("div",{hidden:!0,className:"wysie-marker",after:this.template}),this.template.classList.add("wysie-item"),this.template.remove(),this.addButton.parentNode||(this.bottomUp?this.addButton._.before(t.value(this.items[0],"element")||this.marker):this.addButton._.after(this.marker))};i.prototype={get name(){return Wysie.readable(this.property||this.type).toLowerCase()},get length(){return this.items.length},get data(){return this.getData()},getData:function(t){return t=t||{},this.items.map(function(e){return e.deleted?null:e.getData(t);
}).filter(function(t){return null!==t})},toJSON:Wysie.prototype.toJSON,createItem:function(){var e=this,i=this.template.cloneNode(!0),s=Wysie.Unit.create(i,this.wysie,this);s.parentScope=this.parentScope,s.scope=s.scope||this.parentScope;t.create({tag:"menu",type:"toolbar",className:"wysie-item-controls",contents:[{tag:"button",title:"Delete this "+this.name.replace(/s$/i,""),className:"delete",events:{click:function(t){confirm("Are you sure you want to "+t.target.title.toLowerCase()+"?")&&e["delete"](s)},"mouseenter mouseleave":function(t){i.classList["mouseenter"==t.type?"add":"remove"]("delete-hover")}}},{tag:"button",title:"Add new "+this.name.replace(/s$/i,""),textContent:"✚",className:"add",events:{click:function(t){var n=e.items.indexOf(s);if(n>-1){var r=e.createItem();e.items.splice(n,0,r),r.element._.after(i),r.edit()}}}}],inside:i});return s},add:function(){var t=this.createItem();return t.element._.before(this.bottomUp&&this.items.length>0?this.items[0].element:this.marker),this.items.push(t),
t.element._.fire("wysie:datachange",{collection:this,wysie:this.wysie,action:"add",item:t}),t},edit:function(){0===this.length&&this.required&&this.add(),this.items.forEach(function(t){t.preEdit?t.preEdit():t.edit(),t.element._.events({"mouseover.wysie:edit":function(e){if(t.editing){var i=e.target.closest(".wysie-item")===t.element;t.element._.toggleClass("wysie-item-hovered",i),e.stopPropagation()}},"mouseout.wysie:edit":function(e){t.editing&&t.element.classList.remove("wysie-item-hovered")}})})},"delete":function(e){var i=this;return t.transition(e.element,{opacity:0}).then(function(){e.deleted=!0,e.element.style.opacity="",e.element._.fire("wysie:datachange",{collection:i,wysie:i.wysie,action:"delete",item:e})})},save:function(){var e=this;this.items.forEach(function(i){i.deleted?(t.remove(i.element),e.items.splice(e.items.indexOf(i),1)):(i.save(),i.element.classList.remove("wysie-item-hovered"))})},cancel:function(){var e=this;this.items.forEach(function(i,s){i.deleted=!1,i.cancel(),
i.element.classList.remove("wysie-item-hovered"),i instanceof Wysie.Scope&&!i.everSaved&&(e.items.splice(s,1),t.remove(i.element))})},render:function(t){if(t){t&&!Array.isArray(t)&&(t=[t]);var e=document.createDocumentFragment();t.forEach(function(t){var i=this.createItem();i.render(t),this.items.push(i),e.appendChild(i.element)},this),this.marker.parentNode.insertBefore(e,this.marker)}}}}(Bliss,Bliss.$),function(t){if(self.Wysie){var e="//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js";Wysie.Storage.Dropbox=t.Class({"extends":Wysie.Storage,constructor:function(){var i=this;"dropbox:"!=this.wysie.store.protocol&&(this.wysie.store.hostname="dl.dropboxusercontent.com",this.wysie.store.search=this.wysie.store.search.replace(/\bdl=0|^$/,"raw=1"),this.permissions.read=!0),this.permissions.login=!0,this.ready=t.include(self.Dropbox,e).then(function(){var e=new URL(document.referrer,location);return"www.dropbox.com"===e.hostname&&0===location.hash.indexOf("#access_token=")?(Dropbox.AuthDriver.Popup.oauthReceiver(),
t.fire(window,"load"),void close()):(i.filename=(i.param("path")||"")+new URL(i.wysie.store).pathname.match(/[^\/]*$/)[0],void(i.client=new Dropbox.Client({key:i.param("key")})))}).then(function(){i.login(!0)})},backendSave:function(){return this.put({name:this.filename,data:this.wysie.toJSON()})},put:function(t){var e=this;return new Promise(function(i,s){e.client.writeFile(t.name,t.data,function(t,e){return t?s(Error(t)):(console.log("File saved as revision "+e.versionTag),void i(e))})})},login:function(t){var e=this;return this.ready.then(function(){return e.client.isAuthenticated()?Promise.resolve():new Promise(function(i,s){e.client.authDriver(new Dropbox.AuthDriver.Popup({receiverUrl:new URL(location)+""})),e.client.authenticate({interactive:!t},function(t,n){t&&s(Error(t)),e.client.isAuthenticated()?(e.permissions.on(["logout","edit"]),i()):(e.permissions.off(["logout","edit","add","delete"]),s())})})}).then(function(){e.client.getAccountInfo(function(t,i){t||e.wysie.wrapper._.fire("wysie:login",i);
})})["catch"](function(){})},logout:function(){var t=this;return this.client.isAuthenticated()?new Promise(function(e,i){t.client.signOut(null,function(){t.permissions.off(["edit","add","delete"]).on("login"),t.wysie.wrapper._.fire("wysie:logout"),e()})}):Promise.resolve()},"static":{test:function(t){return/dropbox.com/.test(t.host)||"dropbox:"===t.protocol}}})}}(Bliss);