"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},_slicedToArray=function(){function t(t,e){var i=[],n=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(u){r=!0,s=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw s}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function t(e,n,r){return n=void 0===n?1:n,r=r||n+1,1>=r-n?function(){if(arguments.length<=n||"string"===i.type(arguments[n]))return e.apply(this,arguments);var t,r=arguments[n];for(var s in r){var o=Array.from(arguments);
o.splice(n,1,s,r[s]),t=e.apply(this,o)}return t}:t(t(e,n+1,r),n,r-1)}function e(t,e,n){for(var r in e){if(n){var s=i.type(n);if("own"===n&&!e.hasOwnProperty(r)||"array"===s&&-1===n.indexOf(r)||"regexp"===s&&!n.test(r)||"function"===s&&!n.call(e,r))continue}var o=Object.getOwnPropertyDescriptor(e,r);!o||o.writable&&o.configurable&&o.enumerable&&!o.get&&!o.set?t[r]=e[r]:(delete t[r],Object.defineProperty(t,r,o))}return t}var i=self.Bliss=e(function(t,e){return"string"===i.type(t)?(e||document).querySelector(t):t||null},self.Bliss);e(i,{extend:e,overload:t,property:i.property||"_",sources:{},noop:function(){},$:function(t,e){return t instanceof Node||t instanceof Window?[t]:Array.from("string"==typeof t?(e||document).querySelectorAll(t):t||[])},type:function(t){if(null===t)return"null";if(void 0===t)return"undefined";var e=(Object.prototype.toString.call(t).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase();return"number"==e&&isNaN(t)?"nan":e},defined:function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t];
},create:function(t,e){return t instanceof Node?i.set(t,e):(1===arguments.length&&("string"===i.type(t)?e={}:(e=t,t=e.tag,e=i.extend({},e,function(t){return"tag"!==t}))),i.set(document.createElement(t||"div"),e))},each:function(t,e,i){i=i||{};for(var n in t)i[n]=e.call(t,n,t[n]);return i},ready:function(t){return t=t||document,new Promise(function(e,i){"loading"!==t.readyState?e():t.addEventListener("DOMContentLoaded",function(){e()})})},Class:function(t){var e=["constructor","extends","abstract","static"].concat(Object.keys(i.classProps)),n=t.hasOwnProperty("constructor")?t.constructor:i.noop,r=function a(){if(t["abstract"]&&this.constructor===a)throw new Error("Abstract classes cannot be directly instantiated.");a["super"]&&a["super"].apply(this,arguments),n.apply(this,arguments)};r["super"]=t["extends"]||null,r.prototype=i.extend(Object.create(r["super"]?r["super"].prototype:Object),{constructor:r});var s=function(t){return this.hasOwnProperty(t)&&-1===e.indexOf(t)};if(t["static"]){i.extend(r,t["static"],s);
for(var o in i.classProps)o in t["static"]&&i.classProps[o](r,t["static"][o])}i.extend(r.prototype,t,s);for(var o in i.classProps)o in t&&i.classProps[o](r.prototype,t[o]);return r.prototype["super"]=r["super"]?r["super"].prototype:null,r},classProps:{lazy:t(function(t,e,i){return Object.defineProperty(t,e,{get:function(){var t=i.call(this);return Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0}),t},configurable:!0,enumerable:!0}),t}),live:t(function(t,e,n){return"function"===i.type(n)&&(n={set:n}),Object.defineProperty(t,e,{get:function(){var t=this["_"+e],i=n.get&&n.get.call(this,t);return void 0!==i?i:t},set:function(t){var i=this["_"+e],r=n.set&&n.set.call(this,t,i);this["_"+e]=void 0!==r?r:t},configurable:n.configurable,enumerable:n.enumerable}),t})},include:function(){var t=arguments[arguments.length-1],e=2===arguments.length?arguments[0]:!1,n=document.createElement("script");return e?Promise.resolve():new Promise(function(e,r){i.set(n,{async:!0,onload:function(){
e(),i.remove(n)},onerror:function(){r()},src:t,inside:document.head})})},fetch:function(t,n){if(!t)throw new TypeError("URL parameter is mandatory and cannot be "+t);var r=e({url:new URL(t,location),data:"",method:"GET",headers:{},xhr:new XMLHttpRequest},n);r.method=r.method.toUpperCase(),i.hooks.run("fetch-args",r),"GET"===r.method&&r.data&&(r.url.search+=r.data),document.body.setAttribute("data-loading",r.url),r.xhr.open(r.method,r.url.href,r.async!==!1,r.user,r.password);for(var s in n)if(s in r.xhr)try{r.xhr[s]=n[s]}catch(o){self.console&&console.error(o)}"GET"===r.method||r.headers["Content-type"]||r.headers["Content-Type"]||r.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var a in r.headers)r.xhr.setRequestHeader(a,r.headers[a]);return new Promise(function(t,e){r.xhr.onload=function(){document.body.removeAttribute("data-loading"),0===r.xhr.status||r.xhr.status>=200&&r.xhr.status<300||304===r.xhr.status?t(r.xhr):e(i.extend(Error(r.xhr.statusText),{get status(){
return this.xhr.status},xhr:r.xhr}))},r.xhr.onerror=function(){document.body.removeAttribute("data-loading"),e(i.extend(Error("Network Error"),{xhr:r.xhr}))},r.xhr.ontimeout=function(){document.body.removeAttribute("data-loading"),e(i.extend(Error("Network Timeout"),{xhr:r.xhr}))},r.xhr.send("GET"===r.method?null:r.data)})},value:function(t){var e="string"!==i.type(t);return i.$(arguments).slice(+e).reduce(function(t,e){return t&&t[e]},e?t:self)}}),i.Hooks=new i.Class({add:function(t,e){this[t]=this[t]||[],this[t].push(e)},run:function(t,e){(this[t]||[]).forEach(function(t){t(e)})}}),i.hooks=new i.Hooks;var n=i.property;i.Element=function(t){this.subject=t,this.data={},this.bliss={}},i.Element.prototype={set:t(function(t,e){t in i.setProps?i.setProps[t].call(this,e):t in this?this[t]=e:this.setAttribute(t,e)},0),transition:function(t,e){return e=+e||400,new Promise(function(n,r){if("transition"in this.style){var s=i.extend({},this.style,/^transition(Duration|Property)$/);i.style(this,{transitionDuration:(e||400)+"ms",
transitionProperty:Object.keys(t).join(", ")}),i.once(this,"transitionend",function(){clearTimeout(o),i.style(this,s),n(this)});var o=setTimeout(n,e+50,this);i.style(this,t)}else i.style(this,t),n(this)}.bind(this))},fire:function(t,e){var n=document.createEvent("HTMLEvents");return n.initEvent(t,!0,!0),this.dispatchEvent(i.extend(n,e))},unbind:t(function(t,e){(t||"").split(/\s+/).forEach(function(t){if(n in this&&(t.indexOf(".")>-1||!e)){t=(t||"").split(".");var i=t[1];t=t[0];var r=this[n].bliss.listeners=this[n].bliss.listeners||{};for(var s in r)if(!t||s===t)for(var o,a=0;o=r[s][a];a++)i&&i!==o.className||e&&e!==o.callback||(this.removeEventListener.call(this,s,o.callback,o.capture),a--)}else this.removeEventListener(t,e)},this)},0)},i.setProps={style:function(t){i.extend(this.style,t)},attributes:function(t){for(var e in t)this.setAttribute(e,t[e])},properties:function(t){i.extend(this,t)},events:function(t){if(t&&t.addEventListener){var e=this;if(t[n]&&t[n].bliss){var r=t[n].bliss.listeners;
for(var s in r)r[s].forEach(function(t){e.addEventListener(s,t.callback,t.capture)})}for(var o in t)0===o.indexOf("on")&&(this[o]=t[o])}else if(arguments.length>1&&"string"===i.type(t)){var a=arguments[1],u=arguments[2];t.split(/\s+/).forEach(function(t){this.addEventListener(t,a,u)},this)}else for(var c in t)i.events(this,c,t[c])},once:t(function(t,e){t=t.split(/\s+/);var i=this,n=function r(){return t.forEach(function(t){i.removeEventListener(t,r)}),e.apply(i,arguments)};t.forEach(function(t){i.addEventListener(t,n)})},0),delegate:t(function(t,e,i){this.addEventListener(t,function(t){t.target.closest(e)&&i.call(this,t)})},0,2),contents:function(t){(t||0===t)&&(Array.isArray(t)?t:[t]).forEach(function(t){var e=i.type(t);/^(string|number)$/.test(e)?t=document.createTextNode(t+""):"object"===e&&(t=i.create(t)),t instanceof Node&&this.appendChild(t)},this)},inside:function(t){t.appendChild(this)},before:function(t){t.parentNode.insertBefore(this,t)},after:function(t){t.parentNode.insertBefore(this,t.nextSibling);
},start:function(t){t.insertBefore(this,t.firstChild)},around:function(t){t.parentNode&&i.before(this,t),(/^template$/i.test(this.nodeName)?this.content||this:this).appendChild(t)}},i.Array=function(t){this.subject=t},i.Array.prototype={all:function(t){var e=$$(arguments).slice(1);return this[t].apply(this,e)}},i.add=t(function(t,e,n,r){n=i.extend({$:!0,element:!0,array:!0},n),"function"==i.type(e)&&(!n.element||t in i.Element.prototype&&r||(i.Element.prototype[t]=function(){return this.subject&&i.defined(e.apply(this.subject,arguments),this.subject)}),!n.array||t in i.Array.prototype&&r||(i.Array.prototype[t]=function(){var t=arguments;return this.subject.map(function(n){return n&&i.defined(e.apply(n,t),n)})}),n.$&&(i.sources[t]=i[t]=e,(n.array||n.element)&&(i[t]=function(){var e=[].slice.apply(arguments),r=e.shift(),s=n.array&&Array.isArray(r)?"Array":"Element";return i[s].prototype[t].apply({subject:r},e)})))},0),i.add(i.Array.prototype,{element:!1}),i.add(i.Element.prototype),i.add(i.setProps),
i.add(i.classProps,{element:!1,array:!1});var r=document.createElement("_");i.add(i.extend({},HTMLElement.prototype,function(t){return"function"===i.type(r[t])}),null,!0)}(),function(t){if(Bliss&&!Bliss.shy){var e=Bliss.property;if(t.add({clone:function(){var e=this.cloneNode(!0),i=t.$("*",e).concat(e);return t.$("*",this).concat(this).forEach(function(e,n,r){t.events(i[n],e),i[n]._.data=t.extend({},e._.data)}),e}},{array:!1}),Object.defineProperty(Node.prototype,e,{get:function o(){return Object.defineProperty(Node.prototype,e,{get:void 0}),Object.defineProperty(this,e,{value:new t.Element(this)}),Object.defineProperty(Node.prototype,e,{get:o}),this[e]},configurable:!0}),Object.defineProperty(Array.prototype,e,{get:function(){return Object.defineProperty(this,e,{value:new t.Array(this)}),this[e]},configurable:!0}),self.EventTarget&&"addEventListener"in EventTarget.prototype){var i=EventTarget.prototype.addEventListener,n=EventTarget.prototype.removeEventListener,r=function(t,e,i){return i.callback===t&&i.capture==e;
},s=function(){return!r.apply(this,arguments)};EventTarget.prototype.addEventListener=function(t,n,s){if(this&&this[e]&&n){var o=this[e].bliss.listeners=this[e].bliss.listeners||{};if(t.indexOf(".")>-1){t=t.split(".");var a=t[1];t=t[0]}o[t]=o[t]||[],0===o[t].filter(r.bind(null,n,s)).length&&o[t].push({callback:n,capture:s,className:a})}return i.call(this,t,n,s)},EventTarget.prototype.removeEventListener=function(t,i,r){if(this&&this[e]&&i){var o=this[e].bliss.listeners=this[e].bliss.listeners||{};o[t]&&(o[t]=o[t].filter(s.bind(null,i,r)))}return n.call(this,t,i,r)}}self.$=self.$||t,self.$$=self.$$||t.$}}(Bliss),function(){function t(t,e){return t instanceof Node||t instanceof Window?[t]:[].slice.call("string"==typeof t?(e||document).querySelectorAll(t):t||[])}if(self.Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||null),Element.prototype.matches)){
var e=self.Stretchy={selectors:{base:'textarea, select:not([size]), input:not([type]), input[type="'+"text url email tel".split(" ").join('"], input[type="')+'"]',filter:"*"},script:document.currentScript||t("script").pop(),resize:function(t){if(e.resizes(t)){var i=getComputedStyle(t),n=0;if(!t.value&&t.placeholder){var r=!0;t.value=t.placeholder}var s=t.nodeName.toLowerCase();if("textarea"==s)t.style.height="0","border-box"==i.boxSizing?n=t.offsetHeight:"content-box"==i.boxSizing&&(n=-t.clientHeight),t.style.height=t.scrollHeight+n+"px";else if("input"==s){t.style.width="0","border-box"==i.boxSizing?n=t.offsetWidth:"padding-box"==i.boxSizing&&(n=t.clientWidth),t.scrollLeft=1e10;var o=Math.max(t.scrollLeft+n,t.scrollWidth-t.clientWidth);t.style.width=o+"px"}else if("select"==s){var a=document.createElement("_");a.textContent=t.options[t.selectedIndex].textContent,t.parentNode.insertBefore(a,t.nextSibling);var u;for(var c in i)/^(width|webkitLogicalWidth)$/.test(c)||(a.style[c]=i[c],/appearance$/i.test(c)&&(u=c));
a.style.width="",a.offsetWidth>0&&(t.style.width=a.offsetWidth+"px",i[u]&&"none"===i[u]||(t.style.width="calc("+t.style.width+" + 2em)")),a.parentNode.removeChild(a),a=null}r&&(t.value="")}},resizeAll:function(i){t(i||e.selectors.base).forEach(function(t){e.resize(t)})},active:!0,resizes:function(t){return t&&t.parentNode&&t.matches&&t.matches(e.selectors.base)&&t.matches(e.selectors.filter)},init:function(){e.selectors.filter=e.script.getAttribute("data-filter")||(t("[data-stretchy-filter]").pop()||document.body).getAttribute("data-stretchy-filter")||Stretchy.selectors.filter||"*",e.resizeAll()},$$:t};"loading"!==document.readyState?e.init():document.addEventListener("DOMContentLoaded",e.init);var i=function(t){e.active&&e.resize(t.target)};document.body.addEventListener("input",i),document.body.addEventListener("change",i),self.MutationObserver&&new MutationObserver(function(t){e.active&&t.forEach(function(t){"childList"==t.type&&Stretchy.resizeAll(t.addedNodes)})}).observe(document.body,{
childList:!0,subtree:!0})}}(),function(t,e){var i=self.Wysie=t.Class({constructor:function(n){var r=this;i.all.push(this);var s=n.getAttribute("data-store")||"none";if(this.store="none"===s?null:new URL(s||this.id,location),this.id=n.id||"wysie-"+i.all.length,this.element=i.is("scope",n)?n:t(i.selectors.rootScope,n),this.element||(n.setAttribute("typeof",n.getAttribute("property")||""),n.removeAttribute("property"),this.element=n),this.element.classList.add("wysie-root"),e(i.selectors.property+", "+i.selectors.scope).concat([this.element]).forEach(function(t){i.is("autoMultiple",t)&&!t.hasAttribute("data-multiple")&&t.setAttribute("data-multiple","")}),this.wrapper=n.closest(".wysie-wrapper")||n,e(i.selectors.primitive).forEach(function(e){var i=t(Wysie.selectors.property,e)&&(Wysie.is("multiple",e)||null===Wysie.Primitive.getValueAttribute(e));i&&e.setAttribute("typeof","")}),this.wrapper===this.element&&i.is("multiple",n)){var o=this.element;this.element.matches("li, option")?o=o.parentNode:this.element.matches("td, tr, tbody, thead, tfoot")&&(o=o.closest("table")),
this.wrapper=t.create({around:o})}this.wrapper.classList.add("wysie-wrapper"),n.removeAttribute("data-store"),e(i.selectors.property,this.wrapper).forEach(function(t){return Wysie.Node.normalizeProperty(t)}),this.needsEdit=!1,console.time("Building wysie tree"),this.root=new(i.is("multiple",this.element)?i.Collection:i.Scope)(this.element,this),console.timeEnd("Building wysie tree"),this.permissions=new Wysie.Permissions(null,this),this.ui={bar:t(".wysie-bar",this.wrapper)||t.create({className:"wysie-bar wysie-ui",start:this.wrapper,contents:{tag:"span",className:"status"}})},this.permissions.can(["edit","add","delete"],function(){r.ui.edit=t.create("button",{className:"edit",textContent:"Edit",onclick:function(t){return r[r.editing?"done":"edit"]()}}),r.ui.save=t.create("button",{className:"save",textContent:"Save",events:{click:function(t){return r.save()},"mouseenter focus":function(t){r.wrapper.classList.add("save-hovered"),r.unsavedChanges=r.calculateUnsavedChanges()},"mouseleave blur":function(t){
return r.wrapper.classList.remove("save-hovered")}}}),r.ui.revert=t.create("button",{className:"revert",textContent:"Revert",events:{click:function(t){return r.revert()},"mouseenter focus":function(t){r.wrapper.classList.add("revert-hovered"),r.unsavedChanges=r.calculateUnsavedChanges()},"mouseleave blur":function(t){return r.wrapper.classList.remove("revert-hovered")}}}),r.ui.editButtons=[r.ui.edit,r.ui.save,r.ui.revert],t.contents(r.ui.bar,r.ui.editButtons)},function(){t.remove(r.ui.editButtons)}),this.store&&this.store.href?(this.storage=i.Storage.create(this),this.permissions.can("read",function(){return r.storage.load()})):(this.permissions.on(["read","edit"]),this.root["import"](),t.fire(this.wrapper,"wysie:load")),this.needsEdit||this.permissions.off(["edit","add","delete"]),Wysie.hooks.run("init-end",this)},get data(){return this.getData()},getData:function(t){return this.root.getData(t)},toJSON:function(t){return JSON.stringify(t||this.data,null,"	")},render:function(t){t?this.root.render(t.data||t):this.root["import"](),
this.unsavedChanges=!1},edit:function(){this.editing=!0,this.root.edit(),t.events(this.wrapper,"mouseenter.wysie:edit mouseleave.wysie:edit",function(e){if(e.target.matches(".wysie-item-controls .delete")){var n=e.target.closest(i.selectors.item);t.toggleClass(n,"delete-hover","mouseenter"==e.type)}if(e.target.matches(i.selectors.item)){e.target.classList.remove("has-hovered-item");var r=e.target.parentNode.closest(i.selectors.item);r&&r._.toggleClass("has-hovered-item","mouseenter"==e.type)}},!0),this.unsavedChanges=this.calculateUnsavedChanges()},calculateUnsavedChanges:function(){var t=!1;return this.walk(function(e){return e.unsavedChanges?(t=!0,!1):void 0}),t},done:function(){this.root.done(),t.unbind(this.wrapper,".wysie:edit"),this.editing=!1},save:function(){this.root.save(),this.storage&&this.storage.save(),this.unsavedChanges=!1},revert:function(){this.root.revert()},walk:function(t){this.root.walk(t)},live:{editing:{set:function(t){this.wrapper._.toggleClass("editing",t),t?this.wrapper.setAttribute("data-editing",""):this.wrapper.removeAttribute("data-editing");
}},unsavedChanges:function(t){this.wrapper._.toggleClass("unsaved-changes",t),this.ui&&(this.ui.save.disabled=this.ui.revert.disabled=!t)}},"static":{all:[],readable:function(t){return t&&t.replace(/([a-z])([A-Z][a-z])/g,function(t,e,i){return e+" "+i.toLowerCase()}).replace(/([a-z])[_\/-](?=[a-z])/g,"$1 ").replace(/^[a-z]/,function(t){return t.toUpperCase()})},identifier:function(t){return t&&t.replace(/\s+/g,"-").replace(/[^\w-]/g,"").toLowerCase()},queryJSON:function(e,i){return i&&e?t.value.apply(t,[e].concat(i.split("/"))):e},timed:function(t,e){return function(){console.time(t),e.apply(this,arguments),console.timeEnd(t)}},observe:function(e,i,n,r){var s="function"==t.type(n)?new MutationObserver(n):n,o=i?{attributes:!0,attributeFilter:[i],attributeOldValue:!!r}:{characterData:!0,childList:!0,subtree:!0,characterDataOldValue:!!r};return s.observe(e,o),s},toArray:function(t){return Array.isArray(t)?t:[t]},flatten:function(t){return Array.isArray(t)?t.reduce(function(t,e){return i.toArray(t).concat(i.flatten(e));
},[]):[t]},is:function(t,e){return e.matches&&e.matches(i.selectors[t])},hooks:new t.Hooks}});!function(){var e=i.selectors={property:"[property], [itemprop]",specificProperty:function(t){return"[property="+t+"], [itemprop="+t+"]"},scope:"[typeof], [itemscope], [itemtype], .scope",multiple:"[multiple], [data-multiple], .multiple",required:"[required], [data-required], .required",formControl:"input, select, textarea",computed:".computed",item:".wysie-item",ui:".wysie-ui"},n=e.arr=function(t){return t.split(/\s*,\s*/g)},r=e.not=function(t){return n(t).map(function(t){return":not("+t+")"}).join("")},s=e.or=function(t,e){return t+", "+e},o=e.and=function(t,e){return i.flatten(n(t).map(function(t){return n(e).map(function(e){return t+e})})).join(", ")},a=e.andNot=function(t,e){return o(t,r(e))};t.extend(i.selectors,{primitive:a(e.property,e.scope),rootScope:a(e.scope,e.property),output:s(e.specificProperty("output"),".output, .value"),autoMultiple:o("li, tr, option",":only-of-type")})}(),t.add("toggleClass",function(t,e){
this.classList[e?"add":"remove"](t)}),t.proxy=t.classProps.proxy=t.overload(function(t,e,i){return Object.defineProperty(t,e,{get:function(){return this[i][e]},configurable:!0,enumerable:!0}),t}),t.classProps.propagated=function(t,e){Wysie.toArray(e).forEach(function(e){var i=t[e];t[e]=function(){var t=i&&i.apply(this,arguments);this.propagate&&t!==!1&&this.propagate(e)}})},document.addEventListener("focus",function(t){e(".focus-within")._.toggleClass("focus-within",!1);for(var i=t.target;i=i.parentNode;)i.classList&&i.classList.add("focus-within")},!0),t.ready().then(function(t){e("[data-store]").forEach(function(t){new Wysie(t)})}),i.prototype.render=i.timed("render",i.prototype.render)}(Bliss,Bliss.$),function(t){var e=Wysie.Permissions=t.Class({constructor:function(t,e){this.triggers=[],this.wysie=e,this.set(t)},set:function(t){for(var e in t)this[e]=t[e]},on:function(t){var e=this;return t=Array.isArray(t)?t:[t],t.forEach(function(t){return e[t]=!0}),this},off:function(t){var e=this;
return t=Array.isArray(t)?t:[t],t.forEach(function(t){return e[t]=!1}),this},can:function(t,e,i){this.observe(t,!0,e),i&&this.observe(t,!1,i)},when:function(t){var e=this;return new Promise(function(i,n){e.can(t,i,n)})},observe:function(t,e,i){t=Array.isArray(t)?t:[t],this.is(t,e)&&i(),this.triggers.push({actions:t,value:e,callback:i,active:!0})},is:function(t,e){var i=this,n=t.map(function(t){return!!i[t]}).reduce(function(t,e){return t||e});return e?n:!n},changed:function(t,e,i){var n=this;i=!!i,e=!!e,e!=i&&(this.wysie.wrapper._.toggleClass("can-"+t,e),this["_"+t]=e,this.triggers.forEach(function(e){var i=n.is(e.actions,e.value);e.active&&e.actions.indexOf(t)>-1&&i?(e.active=!1,e.callback()):i||(e.active=!0)}))},"static":{actions:[],register:function(i,n){return Array.isArray(i)?void i.forEach(function(t){return e.register(t,n)}):(t.live(e.prototype,i,function(t,e){n&&n.call(this,t,e),this.changed(i,t,e)}),void e.actions.push(i))}}});e.register("read"),e.register("login",function(t){t&&this.logout&&(this.logout=!1);
}),e.register("logout",function(t){t&&this.login&&(this.login=!1)}),e.register("edit",function(t){t&&(this.add=this["delete"]=!0)}),e.register(["add","delete"],function(t){t||(this.edit=!1)})}(Bliss),function(t){var e=Wysie.Storage=t.Class({"abstract":!0,constructor:function(e){var i=this;this.wysie=e,this.originalHref=new URL(this.href,location),this.loaded=new Promise(function(t,e){i.wysie.wrapper.addEventListener("wysie:load",t)}),this.authControls={},this.permissions.can("login",function(){i.loginHash="#login"+(Wysie.all[0]===i.wysie?"":"-"+i.wysie.id),i.authControls.login=t.create({tag:"a",href:i.loginHash,textContent:"Login",className:"login button",events:{click:function(t){t.preventDefault(),i.login()}},after:t(".status",i.wysie.bar)});var e;(e=function(){location.hash===i.loginHash&&(history.replaceState(null,document.title,new URL("",location)+""),i.login())})(),window.addEventListener("hashchange.wysie",e)},function(){t.remove(i.authControls.login),i.wysie.wrapper._.unbind("hashchange.wysie");
}),this.permissions.can("logout",function(){i.authControls.logout=t.create({tag:"button",textContent:"Logout",className:"logout",events:{click:i.logout.bind(i)},after:t(".status",i.wysie.bar)})},function(){t.remove(i.authControls.logout)}),this.wysie.wrapper.addEventListener("wysie:login.wysie",function(e){t(".status",i.wysie.bar).innerHTML="Logged in to "+i.id+" as <strong>"+e.name+"</strong>"}),this.wysie.wrapper.addEventListener("wysie:logout.wysie",function(e){t(".status",i.wysie.bar).textContent=""})},get url(){return this.wysie.store},get permissions(){return this.wysie.permissions},get href(){return this.url.href},get backup(){return JSON.parse(localStorage[this.originalHref]||null)},set backup(t){localStorage[this.originalHref]=JSON.stringify(t,null,"	")},get isHash(){return this.url.origin===location.origin&&this.url.pathname===location.pathname&&!!this.url.hash},ready:Promise.resolve(),load:function(){var e=this,i=this.ready,n=this.backup;return this.inProgress="Loading",n&&n.synced===!1?i.then(function(){
return e.wysie.render(n),e.inProgress=!1,e.wysie.wrapper._.fire("wysie:load"),e.save()}):(i=!this.isHash||this.get?i.then(function(){return e.get?e.get():t.fetch(e.href,{responseType:"json"}).then(function(t){return Promise.resolve(t.response)})}).then(function(i){e.inProgress=!1,e.wysie.wrapper._.fire("wysie:load");var i=i&&"string"==t.type(i)?JSON.parse(i):i,n=Wysie.queryJSON(i,e.param("root"));e.wysie.render(n),e.backup={synced:!0,data:e.wysie.data}}):i.then(function(){e.inProgress=!1,n&&e.wysie.render(n),e.wysie.wrapper._.fire("wysie:load")}),i["catch"](function(t){e.inProgress=!1,t&&(console.error(t),console.log(t.stack)),n&&e.wysie.render(n),e.wysie.wrapper._.fire("wysie:load")}))},save:function(){var t=this,e=this.wysie.data;return this.backup={synced:!this.put,data:e},this.put?this.login().then(function(){return t.inProgress="Saving",t.put({name:t.filename,data:t.wysie.toJSON(e)}).then(function(){var e=t.backup;e.synced=!0,t.backup=e,t.wysie.wrapper._.fire("wysie:save"),t.inProgress=!1;
})["catch"](function(){t.inProgress=!1,err&&(console.error(err),console.log(err.stack))})}):void 0},login:function(){return Promise.resolve()},logout:function(){return Promise.resolve()},param:function(t){if(this.params=this.params||{},!(t in this.params)){var e="data-store-"+t;this.params[t]=this.wysie.wrapper.getAttribute(e)||this.wysie.element.getAttribute(e),this.wysie.wrapper.removeAttribute(e),this.wysie.element.removeAttribute(e)}return this.params[t]},live:{inProgress:function(e){if(e){t.create("div",{textContent:e+"…",className:"progress",inside:this.wysie.wrapper})}else t.remove(t(".progress",this.wysie.wrapper))}},"static":{create:function(t){var i,n=-1;for(var r in e){var s=e[r];s&&s["super"]===e&&s.test(t.store)&&(s.priority=s.priority||0,n<=s.priority&&(i=r,n=s.priority))}if(i){var o=new e[i](t);return o.id=i,o}return new e.Default(t)}}});e.Default=t.Class({"extends":e,constructor:function(){var e=this;if(this.permissions.set({read:!0,edit:this.isHash,save:this.isHash,login:!1,
logout:!1}),this.isHash){var i=t(this.url.hash);i&&(this.get=function(){return i.textContent},this.put=function(){return i.textContent=e.wysie.toJSON(),Promise.resolve()})}},"static":{test:function(){return!1}}})}(Bliss),function(t,e){Wysie.Node=t.Class({"abstract":!0,constructor:function(t,e){if(!t||!e)throw new Error("Wysie.Unit constructor requires an element argument and a wysie object");this.wysie=e,this.property=t.getAttribute("property"),this.type=Wysie.Scope.normalize(t),Wysie.hooks.run("node-init-end",this)},get isRoot(){return!this.property},get name(){return Wysie.readable(this.property||this.type).toLowerCase()},get data(){return this.getData()},walk:function(t){var e=function i(e){var n=t(e);n!==!1&&e.propagate&&e.propagate(i)};e(this)},walkUp:function(t){for(var e=this;e=e.parentScope;){var i=t(e);if(void 0!==i)return i}},call:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;e>n;n++)i[n-1]=arguments[n];return i=i||[],"string"==typeof t?this[t].apply(this,i):t.apply(this,[this].concat(i));
},edit:function(){this.propagate(function(t){return t[t.preEdit?"preEdit":"edit"]()})},propagated:["save","revert","done","import"],toJSON:Wysie.prototype.toJSON,"static":{normalizeProperty:function(t){var e=t.getAttribute("property")||t.getAttribute("itemprop");return!e&&t.hasAttribute("property")&&(e=t.name||t.id||t.classList[0]),e&&t.setAttribute("property",e),e}}})}(Bliss,Bliss.$),function(t,e){Wysie.Unit=t.Class({"abstract":!0,"extends":Wysie.Node,constructor:function(t,e,i){if(!t||!e)throw new Error("Wysie.Unit constructor requires an element argument and a wysie object");this.element=t,this.constructor.all.set(this.element,this),this.collection=i,this.collection&&(this.scope=this.parentScope=this.collection.parentScope),this.computed=this.element.matches(Wysie.selectors.computed),this.required=this.element.matches(Wysie.selectors.required)},get closestCollection(){if(this.collection)return this.collection;if(this.scope.collection)return this.scope.collection;for(var t;t=this.parentScope;)if(t.collection)return t.collection;
return null},isDeleted:function(){this.deleted;return this.deleted?!0:!!this.parentScope&&this.parentScope.isDeleted()},getData:function(t){t=t||{};var e=function(e){return!e.everSaved&&!t.dirty||e.deleted&&t.dirty||e.computed&&!t.computed||e.placeholder};return e(this)?null:void this.walkUp(function(t){return e(t)?null:void 0})},live:{deleted:function(i){var n=this;this.element._.toggleClass("deleted",i),i?(this.elementContents=document.createDocumentFragment(),e(this.element.childNodes).forEach(function(t){n.elementContents.appendChild(t)}),t.contents(this.element,["Deleted "+this.name,{tag:"button",textContent:"Undo",events:{click:function(t){return n.deleted=!1}}}]),this.element.classList.remove("delete-hover")):this.deleted&&(this.element.textContent="",this.element.appendChild(this.elementContents),this._deleted=!1,t.fire(this.element,"wysie:datachange",{unit:this.collection,wysie:this.wysie,action:"undelete",item:this}))},unsavedChanges:function(e){return this.placeholder&&(e=!1),
t.toggleClass(this.element,"unsaved-changes",e),e},placeholder:function(e){t.toggleClass(this.element,"placeholder",e)}},"static":{get:function(t,e){var i=Wysie.Scope.all.get(t);return e||!i?Wysie.Primitive.all.get(t):i},create:function(t,e,i){if(!t||!e)throw new TypeError("Wysie.Unit.create() requires an element argument and a wysie object");return new(Wysie[Wysie.is("scope",t)?"Scope":"Primitive"])(t,e,i)}}})}(Bliss,Bliss.$),function($,$$){var _=Wysie.Expression=$.Class({constructor:function(t,e){this.simple=!!e,this.expression=t.trim()},get regex(){return RegExp((this.simple?"\\{":"\\$\\{")+this.expression+"\\}")},eval:function(t){return this.oldValue=this.value,this.value=this.simple?t[this.expression]:_.eval(this.expression,t)},toString:function(){return(this.simple?"{":"${")+this.expression+"}"},"static":{eval:function _eval(expr,data){try{return eval("with (Math) with(Wysie.Functions) with(data) { "+expr+" }")}catch(e){return console.warn("Error in expression "+expr+": "+e),"N/A";
}}}});!function(){var t=Wysie.Expression.Text=$.Class({constructor:function(e){this.node=e.node,this.element=3===this.node.nodeType?this.node.parentNode:this.node,this.attribute=e.attribute||null,this.all=e.all,this.template=this.tokenize(this.text.trim()),t.elements.set(this.element,[].concat(_toConsumableArray(t.elements.get(this.element)||[]),[this]))},get text(){return this.attribute?this.attribute.value:this.node.textContent},set text(t){this.oldText=this.text,Wysie.Primitive.setValue(this.node,t,this.attribute)},update:function(e){var i=this,n=[];this.text=this.template.map(function(r){if(r instanceof Wysie.Expression){var s=r.eval(e);return void 0===s||null===s?"":(n.push(s),"number"!=typeof s||i.attribute||(s=t.formatNumber(s)),r.simple?i.transform(s):s)}return n.push(r),r}).join(""),this.primitive&&(1===this.template.length&&"number"==typeof n[0]&&(this.primitive.datatype="number"),this.attribute||Wysie.Primitive.setValue(this.element,n.join(""),"content"))},tokenize:function(e){
return t.tokenize(e,this.expressionRegex)},lazy:{transform:function(){var e=function(t){return t};if(this.node.matches){var i=this.attribute&&RegExp("\\b"+this.attribute.name+"\\b","i");for(var n in t.special)if(this.node.matches(n)){var r=t.special[n];for(var s in r)if(this.attribute&&i.test(s)||!this.attribute&&"null"==s){var o=e;e=function(t){return r[s](o(t))}}}}return e}},proxy:{scope:"all",expressionRegex:"all"},"static":{elements:new WeakMap,tokenize:function(e,i){var n,r=[],s=0;for(i.lastIndex=0;null!==(n=i.exec(e));){n.index>s&&r.push(e.substring(s,n.index));var o,a=n[0];if(0===a.indexOf("="))if(t.rootFunctionRegExp.lastIndex=0,t.rootFunctionRegExp.test(a)){for(var u=["("],c=i.lastIndex;e[c]&&("("===e[c]?u.push("("):")"===e[c]&&u.pop(),a+=e[c],i.lastIndex=s=c+1,0!==u.length);c++);a=a.replace(/^=\s*if\(/,"=iff(").replace(/^=/,"")}else{s=i.lastIndex,o=!0;var l=e.slice(n.index+1).match(/^\s*\w+/)||[],h=_slicedToArray(l,1);a=h[0]}else s=i.lastIndex,o="{"===a[0],a=a.replace(/\$?\{|\}/g,"");
r.push(new Wysie.Expression(a,o))}return s<e.length&&r.push(e.substring(s)),r},special:{"*":{"id, class, name":Wysie.identifier}},formatNumber:function(){var t=new Intl.NumberFormat("latn",{maximumFractionDigits:2});return function(e){return e===1/0||e===-(1/0)?0>e?"-∞":"∞":t.format(e)}}(),lazy:{rootFunctionRegExp:function(){return RegExp("^=\\s*(?:"+Wysie.Expressions.rootFunctions.join("|")+")\\($","i")}}}})}(),function(){var t=Wysie.Expressions=$.Class({constructor:function(t){this.scope=t,this.scope.expressions=this,this.all=[],this.traverse(),this.updateAlso=new Set},init:function(){var t=this;this.all.length>0&&(this.lastUpdated=0,this.update(),this.scope.element.addEventListener("wysie:datachange",function(e){return t.update()}),this.THROTTLE=0,this.scope.wysie.wrapper.addEventListener("wysie:load",function(e){setTimeout(function(){return t.THROTTLE=25},100)}))},update:function e(){var t=this;if(!this.scope.isDeleted()){if(this.THROTTLE>0){var i=performance.now()-this.lastUpdated;if(clearTimeout(e.timeout),
this.lastUpdated&&i<this.THROTTLE)return void(e.timeout=setTimeout(function(){return t.update()},this.THROTTLE-i))}var n=this.scope.getRelativeData();$$(this.all).forEach(function(t){return t.update(n)}),this.THROTTLE>0&&(this.lastUpdated=performance.now()),this.updateAlso.forEach(function(t){return t.update()})}},extract:function(t,e){this.expressionRegex.lastIndex=0,this.expressionRegex.test(e?e.value:t.textContent)&&this.all.push(new Wysie.Expression.Text({node:t,attribute:e,all:this}))},traverse:function(t){var e=this;t=t||this.scope.element,t.classList&&t.classList.contains("ignore-expressions")||(3===t.nodeType&&this.extract(t,null),t!=this.scope.element&&Wysie.is("scope",t)||($$(t.attributes).forEach(function(i){return e.extract(t,i)}),$$(t.childNodes).forEach(function(t){return e.traverse(t)})))},lazy:{expressionRegex:function(){this.propertyNames=$$("[property]",this.scope.element).map(function(t){return t.getAttribute("property")});var e="(?:"+this.propertyNames.join("|")+")";return RegExp(["{\\s*"+e+"\\s*}","\\${.+?}","=\\s*(?:"+t.rootFunctions.join("|")+")\\((?=.*\\))","="+e+"\\b"].join("|"),"gi");
}},"static":{THROTTLE:0,lazy:{rootFunctions:function(){return[].concat(_toConsumableArray(Object.keys(Wysie.Functions)),_toConsumableArray(Object.getOwnPropertyNames(Math)),["if",""])}}}})}(),Wysie.hooks.add("scope-init-start",function(t){new Wysie.Expressions(t)}),Wysie.hooks.add("scope-init-end",function(t){t.expressions.init()})}(Bliss,Bliss.$),function(){function t(t,e){return t=Array.isArray(t)?t:e?$$(e):[t],t.filter(function(t){return!isNaN(t)}).map(function(t){return+t})}var e=Wysie.Functions={sum:function(e){return t(e,arguments).reduce(function(t,e){return+t+(+e||0)},0)},average:function(i){return i=t(i,arguments),i.length&&e.sum(i)/i.length},min:function(e){var i;return(i=Math).min.apply(i,_toConsumableArray(t(e,arguments)))},max:function(e){var i;return(i=Math).max.apply(i,_toConsumableArray(t(e,arguments)))},count:function(t){return Array.isArray(t)?t.length:+(null===t)},add:function(){for(var e=0,i=arguments.length,n=Array(i),r=0;i>r;r++)n[r]=arguments[r];return n.forEach(function(i){
if(Array.isArray(i))i=t(i),Array.isArray(e)?i.forEach(function(t,i){e[i]=(e[i]||0)+t}):e=i.map(function(t){return e+t});else{if(isNaN(i))return;i=+i,Array.isArray(e)?e=e.map(function(t){return t+i}):e+=i}}),e},round:function(t,e){function i(t,e){return+(t+"").replace(/e([+-]\d+)$|$/,function(t,i){var n=(+i||0)+e;return"e"+(n>0?"+":"")+n})}return t?i(Math.round(i(t,2)),-2):t},log:function(){var t;return(t=console).log.apply(t,arguments),arguments[0]},iff:function(t,e){var i=arguments.length<=2||void 0===arguments[2]?"":arguments[2];return t?e:i}};e.avg=e.average,e.iif=e.iff,self.Proxy&&(e=Wysie.Functions=new Proxy(e,{get:function(t,e){return e=e.toLowerCase?e.toLowerCase():e,t[e]},has:function(t,e){return e=e.toLowerCase?e.toLowerCase():e,e in t}}))}(),function(t,e){var i=Wysie.Scope=t.Class({"extends":Wysie.Unit,constructor:function(t,n,r){var s=this;if(this.properties={},this.scope=this,Wysie.hooks.run("scope-init-start",this),Wysie.Primitive.getValueAttribute(this.element)){var o=this.properties[this.property]=new Wysie.Primitive(this.element,this.wysie);
o.scope=o.parentScope=this}e(Wysie.selectors.property,this.element).forEach(function(t){var e=t.getAttribute("property");if(s.contains(t)){var n=s.properties[e];if(n){var r=n;n instanceof Wysie.Collection||(r=new Wysie.Collection(t,s.wysie),r.parentScope=s,s.properties[e]=r,r.add(n)),r.add(t)}else{if(Wysie.is("multiple",t))var o=new Wysie.Collection(t,s.wysie);else o=i["super"].create(t,s.wysie),o.scope=o instanceof i?o:s;o.parentScope=s,s.properties[e]=o}}}),Wysie.hooks.run("scope-init-end",this)},get propertyNames(){return Object.keys(this.properties)},getData:function(e){e=e||{};var i=this["super"].getData.call(this,e);return void 0!==i?i:(i={},this.propagate(function(t){if((!t.computed||e.computed)&&!(t.property in i)){var n=t.getData(e);(null!==n||e["null"])&&(i[t.property]=n)}}),t.extend(i,this.unhandled),i)},getRelativeData:function(){var t=this,e={dirty:!0,computed:!0,"null":!0},i=this.getData(e);return self.Proxy&&i&&(i=new Proxy(i,{get:function(i,n){if(n in i)return i[n];var r=t.walkUp(function(i){
return n in i.properties?(i.expressions.updateAlso.add(t.expressions),i.properties[n].getData(e)):void 0});return void 0!==r?r:void 0},has:function(i,n){if(n in i)return!0;var r=t.walkUp(function(t){return n in t.properties?!0:void 0});return void 0!==r?r:(r=t.find(n),void 0!==r?(r=Array.isArray(r)?r.map(function(t){return t.getData(e)}).filter(function(t){return null!==t}):r.getData(e),i[n]=r,!0):void 0)}})),i},find:function(t){if(this.property==t)return this;if(t in this.properties)return this.properties[t].find(t);for(var e in this.properties){var i=this.properties[e].find(t);if(void 0!==i)return i}},propagate:function(e){var i=arguments;t.each(this.properties,function(t,e){e.call.apply(e,i)})},save:function(){return this.placeholder?!1:(this.everSaved=!0,void(this.unsavedChanges=!1))},done:function(){t.unbind(this.element,".wysie:edit")},"import":function(){this.everSaved=!0},propagated:["save","done","import"],render:function(e){var i=this;e&&(e=e.isArray?e[0]:e,this.unhandled=t.extend({},e,function(t){
return!(t in i.properties)}),this.propagate(function(t){t.render(e[t.property])}),this.save())},contains:function(t){return t instanceof Wysie.Unit?t.parentScope===this:this.element===t.parentNode.closest(Wysie.selectors.scope)},"static":{all:new WeakMap,normalize:function(t){if(Wysie.is("scope",t)){var e=t.getAttribute("typeof")||t.getAttribute("itemtype")||"Item";return t.setAttribute("typeof",e),e}return null}}})}(Bliss,Bliss.$),function(t,e){var i=!1,n=Wysie.Primitive=t.Class({"extends":Wysie.Unit,constructor:function(i,r,s){var o=this;this.attribute=n.getValueAttribute(this.element),this.attribute||this.element.normalize(),this.datatype=n.getDatatype(this.element,this.attribute);var a=Wysie.Expression.Text.elements.get(this.element),u=a&&a.filter(function(t){return(t.attribute&&t.attribute.name)==o.attribute})[0];if(u&&(u.primitive=this,this.computed=!0),Wysie.is("formControl",this.element)?(this.editor=this.element,this.edit()):this.editor||(this.editor=e(this.element.children).filter(function(t){
return t.matches(Wysie.selectors.formControl)&&!t.matches(Wysie.selectors.property)})[0],t.remove(this.editor)),this.exposed||this.computed||(this.wysie.needsEdit=!0),this.templateValue=this.value,this["default"]=this.element.getAttribute("data-default"),this.observer=Wysie.observe(this.element,this.attribute,function(t){if(o.attribute){var e=o.value;t[0].oldValue!=e&&o.update(e)}else o.wysie.editing||o.update(o.value)},!0),this.computed||""===this["default"]?this["default"]=this.templateValue:(null===this["default"]&&(this["default"]=this.editor?this.editorValue:this.emptyValue),this.value=this["default"]),this.update(this.value),this.collection){var c=function(e){o.unobserve();var i=t.remove(t(Wysie.selectors.ui,o.element)),n=e();return t.inside(i,o.element),o.observe(),n};["textContent","innerHTML"].forEach(function(t){var e=Object.getOwnPropertyDescriptor(Node.prototype,"textContent");Object.defineProperty(o.element,t,{get:function(){var t=this;return c(function(){return e.get.call(t);
})},set:function(t){var i=this;c(function(){return e.set.call(i,t)})}})})}this.initialized=!0},get value(){if(this.editing){var t=this.editorValue;return""===t?null:t}return n.getValue(this.element,this.attribute,this.datatype)},set value(t){this.editing&&document.activeElement!=this.editor&&(this.editorValue=t),this.oldValue=this.value,(!this.editing||this.attribute)&&("number"!=this.datatype||this.attribute?n.setValue(this.element,t,this.attribute,this.datatype):(n.setValue(this.element,t,"content",this.datatype),n.setValue(this.element,Wysie.Expression.Text.formatNumber(t),null,this.datatype))),(Wysie.is("formControl",this.element)||!this.attribute)&&this.update(t),this.unsavedChanges=this.wysie.unsavedChanges=!0},get editorValue(){if(this.editor){if(this.editor.matches(Wysie.selectors.formControl))return n.getValue(this.editor,void 0,this.datatype);var e=t(Wysie.selectors.output+", "+Wysie.selectors.formControl,this.editor);if(e)return n.all.has(e)?n.all.get(e).value:n.getValue(e)}},
set editorValue(e){if(this.editor)if(this.editor.matches(Wysie.selectors.formControl))n.setValue(this.editor,e);else{var i=t(Wysie.selectors.output+", "+Wysie.selectors.formControl,this.editor);i&&(n.all.has(i)?n.all.get(i).value=e:n.setValue(i,e))}},get exposed(){return this.editor===this.element},getData:function(t){t=t||{};var e=this["super"].getData.call(this,t);if(void 0!==e)return e;var e=t.dirty||this.exposed?this.value:this.savedValue;return t.dirty||""!==e?e:null},update:function(e){e=e||0===e?e:"",this.empty=""===e,this.humanReadable&&this.attribute&&(this.element.textContent=this.humanReadable(e)),this.initialized&&t.fire(this.element,"wysie:datachange",{property:this.property,value:e,wysie:this.wysie,unit:this,dirty:this.editing,action:"propertychange"})},save:function(){return this.placeholder?!1:(this.savedValue=this.value,this.everSaved=!0,void(this.unsavedChanges=!1))},done:function(){this.unobserve(),this.popup?this.hidePopup():this.attribute||this.exposed||!this.editing||(t.remove(this.editor),
this.element.textContent=this.editorValue),this.exposed||(this.editing=!1),null!==this.element._.data.prevTabindex?this.element.tabIndex=this.element._.data.prevTabindex:this.element.removeAttribute("tabindex"),this.element._.unbind(".wysie:edit .wysie:preedit .wysie:showpopup"),this.observe()},revert:function(){this.unsavedChanges&&void 0!==this.savedValue&&(this.value=this.savedValue,this.unsavedChanges=!1)},preEdit:function(){var t=this;if(this.empty&&!this.attribute)return void this.edit();var e;this.element._.events({"click.wysie:preedit":function(e){return t.edit()},"focus.wysie:preedit":function(e){t.edit(),t.popup||t.editor.focus()},"click.wysie:edit":function(e){t.exposed||e.preventDefault()}}),this.attribute||this.element._.events({"mouseenter.wysie:preedit":function(i){clearTimeout(e),e=setTimeout(function(){return t.edit()},150)},"mouseleave.wysie:preedit":function(t){clearTimeout(e)}}),this.element._.data.prevTabindex=this.element.getAttribute("tabindex"),this.element.tabIndex=0;
},initEdit:function(){var i=this;if(this.element.hasAttribute("data-input")){var r=this.element.getAttribute("data-input");r&&(this.editor=t.clone(t(r)),Wysie.is("formControl",this.editor)||(t(Wysie.selectors.output,this.editor)?(this.editor.setAttribute("data-store","none"),new Wysie(this.editor)):this.editor=null))}if(!this.editor){var s=n.getMatch(this.element,n.editors);s.create&&t.extend(this,s,function(t){return"create"!=t});var o=s.create||s;this.editor=t.create("function"===t.type(o)?o.call(this):o),this.editorValue=this.value}if(this.editor._.events({"input change":function(t){var e=i.wysie.unsavedChanges;i.value=i.editorValue,i.exposed&&!i.wysie.editing&&i.wysie.permissions.save&&i.scope.everSaved&&(i.unsavedChanges=!1,i.wysie.unsavedChanges=e,"change"==t.type&&(i.save(),i.wysie.storage.save(),i.wysie.unsavedChanges=i.wysie.calculateUnsavedChanges()))},focus:function(t){i.editor.select&&i.editor.select()},keyup:function(t){(i.popup&&13==t.keyCode||27==t.keyCode)&&(i.popup.contains(document.activeElement)&&i.element.focus(),
t.stopPropagation(),i.hidePopup())},"wysie:datachange":function(e){"output"===e.property&&(e.stopPropagation(),t.fire(i.editor,"input"))}}),"placeholder"in this.editor&&(this.editor.placeholder="("+this.label+")"),!this.exposed){var a=/^data-input-/i;if(e(this.element.attributes).forEach(function(t){a.test(t.name)&&this.editor.setAttribute(t.name.replace(a,""),t.value)},this),this.attribute){this.element.classList.add("using-popup"),this.popup=this.popup||t.create("div",{className:"wysie-popup",hidden:!0,contents:[this.label+":",this.editor]}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length));var u=function(t){i.popup.contains(t.target)||i.element.contains(t.target)||i.hidePopup()};this.showPopup=function(){t.unbind([this.element,this.popup],".wysie:showpopup"),this.popup._.after(this.element),this.popup._.style({top:this.element.offsetTop+this.element.offsetHeight+"px",left:this.element.offsetLeft+"px"}),this.popup._.removeAttribute("hidden"),t.events(document,"focus click",u,!0);
},this.hidePopup=function(){var e=this;t.unbind(document,"focus click",u,!0),this.popup.setAttribute("hidden",""),setTimeout(function(){t.remove(e.popup)},400),t.events(this.element,"focus.wysie:showpopup click.wysie:showpopup",function(t){e.showPopup()},!0)}}}this.popup||this.editor.classList.add("wysie-editor"),this.initEdit=null},edit:function(){this.editing||(this.element._.unbind(".wysie:preedit"),this.initEdit&&this.initEdit(),this.popup&&this.showPopup(),this.attribute||this.editor.parentNode==this.element||this.exposed||(this.editorValue=this.value,this.element.textContent="",this.exposed||this.element.appendChild(this.editor)),this.editing=!0)},"import":function(){this.computed||(this.value=this.templateValue)},render:function(t){Array.isArray(t)&&(t=t[0]),"object"===("undefined"==typeof t?"undefined":_typeof(t))&&(t=t[this.property]),this.value=void 0===t?this.emptyValue:t,this.save()},find:function(t){return this.property==t?this:void 0},observe:function(){Wysie.observe(this.element,this.attribute,this.observer);
},unobserve:function(){this.observer.disconnect()},lazy:{label:function(){return Wysie.readable(this.property)},emptyValue:function(){switch(this.datatype){case"boolean":return!1;case"number":return 0}return""}},live:{empty:function(e){var i=!(""!==e&&null!==e||this.attribute&&t(Wysie.selectors.property,this.element));t.toggleClass(this.element,"empty",i)},editing:function(e){t.toggleClass(this.element,"editing",e)},datatype:function(t){n.getValue.cache&&n.getValue.cache["delete"](this.element)}},"static":{all:new WeakMap,getMatch:function(t,e){var i=null;for(var n in e)t.matches(n)&&(i=e[n]);return i},getValueAttribute:function r(t){var e=(r.cache=r.cache||new WeakMap).get(t);return(void 0===e||i)&&(e=t.getAttribute("data-attribute")||n.getMatch(t,n.attributes),e&&(e.humanReadable&&n.all.has(t)&&(n.all.get(t).humanReadable=e.humanReadable),e=e.value||e),e&&"null"!==e||(e=null),r.cache.set(t,e)),e},getDatatype:function s(t,e){var r=(s.cache=s.cache||new WeakMap).get(t);if(void 0===r||i){
if(r=t.getAttribute("datatype"),!r)for(var o in n.datatypes)t.matches(o)&&(r=n.datatypes[o][e]);r=r||"string",s.cache.set(t,r)}return r},getValue:function o(t,e,r){var s=(o.cache=o.cache||new WeakMap).get(t);return(!s||i)&&(e=e||null===e?e:n.getValueAttribute(t),r=r||n.getDatatype(t,e),s=function(){var i;switch(i=e in t&&n.useProperty(t,e)?t[e]:e?t.getAttribute(e):t.getAttribute("content")||t.textContent||null,r){case"number":return+i;case"boolean":return!!i;default:return i}},o.cache.set(t,s)),s()},setValue:function(t,e,i){null!==i&&(i=i?i.name||i:n.getValueAttribute(t)),i in t&&n.useProperty(t,i)&&t[i]!=e&&(t[i]=e),i?t.getAttribute(i)!=e&&t.setAttribute(i,e):t.textContent=e},useProperty:function(t,e){return["href","src"].indexOf(e)>-1?!1:"http://www.w3.org/2000/svg"==t.namespaceURI?!1:!0}}});n.attributes={"img, video, audio":"src","a, link":"href","select, input, textarea":"value","input[type=checkbox]":"checked",time:{value:"datetime",humanReadable:function(t){var e=new Date(t);if(!t||isNaN(e))return"("+this.label+")";
var i="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");return e.getDate()+" "+i[e.getMonth()]+" "+e.getFullYear()}},meta:"content"},n.datatypes={"input[type=checkbox]":{checked:"boolean"},"input[type=range], input[type=number]":{value:"number"}},n.editors={"*":{tag:"input"},".number":{tag:"input",type:"number"},".boolean":{tag:"input",type:"checkbox"},"a, img, video, audio, .url":{tag:"input",type:"url",placeholder:"http://"},"p, div, .multiline":{create:{tag:"textarea"},get editorValue(){return this.editor&&this.editor.value},set editorValue(t){this.editor&&(this.editor.value=t?t.replace(/\r?\n/g,""):"")}},"time, .date":function(){var e={date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i,month:/^[Y\d]{4}-[M\d]{2}$/i,time:/^[H\d]{2}:[M\d]{2}/i,week:/[Y\d]{4}-W[W\d]{2}$/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[M\d]{2}/i},i=this.element.getAttribute("datetime")||"YYYY-MM-DD";for(var n in e)if(e[n].test(i))break;return t.create("input",{type:n})}},Stretchy.selectors.filter=".wysie-editor";
}(Bliss,Bliss.$),function(t,e){Wysie.Collection=t.Class({"extends":Wysie.Node,constructor:function(i,n){this.template=i,this.items=[],this.properties=e(Wysie.selectors.property,this.template)._.getAttribute("property"),this.mutable=this.template.matches(Wysie.selectors.multiple),this.mutable&&(this.wysie.needsEdit=!0,this.required=this.template.matches(Wysie.selectors.required),this.marker=t.create("div",{hidden:!0,className:"wysie-marker",after:this.template}),this.template.classList.add("wysie-item"),this.template.remove(),this.addButton.parentNode||(this.bottomUp?this.addButton._.before(t.value(this.items[0],"element")||this.marker):this.addButton._.after(this.marker)),this.element=i,this.template=this.element.cloneNode(!0)),Wysie.hooks.run("collection-init-end",this)},get length(){return this.items.length},get containsTemplate(){return this.items.length&&this.items[0].element===this.element},getData:function(t){t=t||{};var e=[];return this.items.forEach(function(i){if(!i.deleted){var n=i.getData(t);
n&&e.push(n)}}),!t.dirty&&this.unhandled&&(e=this.unhandled.before.concat(e,this.unhandled.after)),e},createItem:function(e){var i=this,e=e||this.template.cloneNode(!0),n=Wysie.Unit.create(e,this.wysie,this);return this.mutable&&t.create({tag:"menu",type:"toolbar",className:"wysie-item-controls wysie-ui",contents:[{tag:"button",title:"Delete this "+this.name,className:"delete",events:{click:function(t){return i["delete"](n)}}},{tag:"button",title:"Add new "+this.name.replace(/s$/i,""),className:"add",events:{click:function(t){return i.add(null,i.items.indexOf(n)).edit()}}}],inside:e}),n},add:function(t,e,i){return t=t instanceof Node?Wysie.Unit.get(t)||this.createItem(t):t||this.createItem(),e in this.items?(t.element._.after(this.items[e].element),this.items.splice(e,0,t)):(t.element.parentNode||t.element._.before(this.bottomUp&&this.items.length>0?this.items[0].element:this.marker),this.items.push(t)),i||(t.element._.fire("wysie:datachange",{unit:this,wysie:this.wysie,action:"add",item:t
}),t.unsavedChanges=this.wysie.unsavedChanges=!0),t},propagate:function(){var t=arguments;this.items.forEach(function(e){return e.call.apply(e,t)})},"delete":function(e,i){var n=this;return i?(t.remove(e.element),void this.items.splice(this.items.indexOf(e),1)):t.transition(e.element,{opacity:0}).then(function(){e.deleted=!0,e.element.style.opacity="",e.element._.fire("wysie:datachange",{unit:n,wysie:n.wysie,action:"delete",item:e}),e.unsavedChanges=n.wysie.unsavedChanges=!0})},edit:function(){if(0===this.length&&this.required){var e=this.add(null,null,!0);e.placeholder=!0,e.walk(function(t){return t.unsavedChanges=!1}),t.once(e.element,"wysie:datachange",function(t){e.unsavedChanges=!0,e.placeholder=!1})}this.propagate(function(t){return t[t.preEdit?"preEdit":"edit"]()})},clear:function(){this.propagate(function(t){return t.element.remove()}),this.items=[]},save:function(){var t=this;this.items.forEach(function(e){e.deleted?t["delete"](e,!0):e.unsavedChanges=!1})},done:function(){var t=this;
this.items.forEach(function(e){return e.placeholder?void t["delete"](e,!0):void 0})},propagated:["save","done"],revert:function(){var t=this;this.items.forEach(function(e,i){e.everSaved||e.placeholder?(e.deleted&&(e.deleted=!1),e.revert()):t["delete"](e,!0)})},"import":function(){var t=this.add(this.element);t["import"]()},render:function(t){var e=this;if(this.unhandled={before:[],after:[]},!t)return void((null===t||void 0===t)&&(!this.closestCollection||this.closestCollection.containsTemplate)&&this["import"]());if(t=t&&Wysie.toArray(t),this.mutable){if(t&&t.length>0){var i=document.createDocumentFragment();t.forEach(function(t){var n=e.createItem();n.render(t),e.items.push(n),i.appendChild(n.element)}),this.marker.parentNode.insertBefore(i,this.marker)}}else this.items.forEach(function(e,i){return e.render(t&&t[i])}),t&&(this.unhandled.after=t.slice(this.items.length));this.save()},find:function(t){var e=this.items.filter(function(t){return!t.deleted});if(this.property==t)return e;if(this.properties.indexOf(t)>-1){
var i=e.map(function(e){return e.find(t)});return Wysie.flatten(i)}},lazy:{bottomUp:function(){return this.template.hasAttribute("data-bottomup")?!0:this.addButton.parentNode?!!(this.addButton.compareDocumentPosition(this.template)&Node.DOCUMENT_POSITION_FOLLOWING):!1},closestCollection:function(){var t=this.marker?this.marker.parentNode:this.template.parentNode;return t.closest(Wysie.selectors.item)},addButton:function(){var i=this,n="button.add-"+this.property+", .wysie-add, button.add",r=this.closestCollection||this.marker.closest(Wysie.selectors.scope);if(r)var s=e(n,r).filter(function(t){return!i.template.contains(t)})[0];return s||(s=t.create("button",{className:"add",textContent:"Add "+this.name})),s.classList.add("wysie-ui"),s.addEventListener("click",function(t){t.preventDefault(),i.add().edit()}),s}}})}(Bliss,Bliss.$),function(t){if(self.Wysie){var e="//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js";Wysie.Storage.Dropbox=t.Class({"extends":Wysie.Storage,constructor:function(){
var i=this;"dropbox:"!=this.wysie.store.protocol&&(this.wysie.store.hostname="dl.dropboxusercontent.com",this.wysie.store.search=this.wysie.store.search.replace(/\bdl=0|^$/,"raw=1"),this.permissions.read=!0),this.permissions.login=!0,this.ready=t.include(self.Dropbox,e).then(function(){var e=new URL(document.referrer,location);return"www.dropbox.com"===e.hostname&&0===location.hash.indexOf("#access_token=")?(Dropbox.AuthDriver.Popup.oauthReceiver(),t.fire(window,"load"),void close()):(i.filename=(i.param("path")||"")+new URL(i.wysie.store).pathname.match(/[^\/]*$/)[0],void(i.client=new Dropbox.Client({key:i.param("key")})))}).then(function(){i.login(!0)})},put:function(t){var e=this;return new Promise(function(i,n){e.client.writeFile(t.name,t.data,function(t,e){return t?n(Error(t)):(console.log("File saved as revision "+e.versionTag),void i(e))})})},login:function(t){var e=this;return this.ready.then(function(){return e.client.isAuthenticated()?Promise.resolve():new Promise(function(i,n){
e.client.authDriver(new Dropbox.AuthDriver.Popup({receiverUrl:new URL(location)+""})),e.client.authenticate({interactive:!t},function(t,r){t&&n(Error(t)),e.client.isAuthenticated()?(e.permissions.on(["logout","edit"]),i()):(e.permissions.off(["logout","edit","add","delete"]),n())})})}).then(function(){e.client.getAccountInfo(function(t,i){t||e.wysie.wrapper._.fire("wysie:login",i)})})["catch"](function(){})},logout:function(){var t=this;return this.client.isAuthenticated()?new Promise(function(e,i){t.client.signOut(null,function(){t.permissions.off(["edit","add","delete"]).on("login"),t.wysie.wrapper._.fire("wysie:logout"),e()})}):Promise.resolve()},"static":{test:function(t){return/dropbox.com/.test(t.host)||"dropbox:"===t.protocol}}})}}(Bliss);