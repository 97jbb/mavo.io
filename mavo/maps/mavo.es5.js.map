{"version":3,"sources":["ui.itembar.js"],"names":["$","$$","_","Mavo","UI","Itembar","Class","constructor","item","element","filter","el","closest","selectors","multiple","data","create","className","set","contents","tag","title","name","events","collection","delete","replace","bottomUp","newItem","add","index","evt","superKey","render","scrollIntoViewIfNeeded","editItem","click","target","focus","keydown","keyCode","move","stopPropagation","preventDefault","mouseenter","classList","mouseleave","remove","parentNode","revocably","Primitive","attribute","after","appendChild","proxy","mavo","Bliss"],"mappings":"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","file":"../mavo.es5.js","sourcesContent":["(function($, $$) {\n\nvar _ = Mavo.UI.Itembar = $.Class({\n\tconstructor: function(item) {\n\t\tthis.item = item;\n\n\t\tthis.element = $$(\".mv-item-controls\", this.item.element).filter(el => {\n\t\t\t\t\t\t\t\t   // Remove item controls meant for other collections\n\t\t\t\t\t\t\t\t   return el.closest(Mavo.selectors.multiple) == this.item.element && !Mavo.data(el, \"item\");\n\t\t\t\t\t\t\t   })[0];\n\n\t\tthis.element = this.element || $.create({\n\t\t\tclassName: \"mv-item-controls mv-ui\"\n\t\t});\n\n\t\tMavo.data(this.element, \"item\", this.item);\n\n\t\t$.set(this.element, {\n\t\t\tcontents: [\n\t\t\t\t{\n\t\t\t\t\ttag: \"button\",\n\t\t\t\t\ttitle: \"Delete this \" + this.item.name,\n\t\t\t\t\tclassName: \"mv-delete\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t\"click\": evt => this.item.collection.delete(item)\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\ttag: \"button\",\n\t\t\t\t\ttitle: `Add new ${this.item.name.replace(/s$/i, \"\")} ${this.collection.bottomUp? \"after\" : \"before\"}`,\n\t\t\t\t\tclassName: \"mv-add\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t\"click\": evt => {\n\t\t\t\t\t\t\tvar newItem = this.collection.add(null, this.item.index);\n\n\t\t\t\t\t\t\tif (evt[Mavo.superKey]) {\n\t\t\t\t\t\t\t\tnewItem.render(this.item.data);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tMavo.scrollIntoViewIfNeeded(newItem.element);\n\n\t\t\t\t\t\t\treturn this.collection.editItem(newItem);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\ttag: \"button\",\n\t\t\t\t\ttitle: \"Drag to reorder \" + this.item.name,\n\t\t\t\t\tclassName: \"mv-drag-handle\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: evt => evt.target.focus(),\n\t\t\t\t\t\tkeydown: evt => {\n\t\t\t\t\t\t\tif (evt.keyCode >= 37 && evt.keyCode <= 40) {\n\t\t\t\t\t\t\t\t// Arrow keys\n\t\t\t\t\t\t\t\tthis.move(this.item, evt.keyCode <= 38? -1 : 1);\n\n\t\t\t\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\t\t\tevt.target.focus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tmouseenter: evt => {\n\t\t\t\t\tthis.item.element.classList.add(\"mv-highlight\");\n\t\t\t\t},\n\t\t\t\tmouseleave: evt => {\n\t\t\t\t\tthis.item.element.classList.remove(\"mv-highlight\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tadd: function() {\n\t\tif (!this.element.parentNode) {\n\t\t\tif (!Mavo.revocably.add(this.element)) {\n\t\t\t\tif (this.item instanceof Mavo.Primitive && !this.item.attribute) {\n\t\t\t\t\tthis.element.classList.add(\"mv-adjacent\");\n\t\t\t\t\t$.after(this.element, this.item.element);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.item.element.appendChild(this.element);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tremove: function() {\n\t\t Mavo.revocably.remove(this.element);\n\t},\n\n\tproxy: {\n\t\tcollection: \"item\",\n\t\tmavo: \"item\"\n\t}\n});\n\n})(Bliss, Bliss.$);\n"]}