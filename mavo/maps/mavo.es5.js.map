{"version":3,"sources":["backend.github.js"],"names":["$","self","Mavo","_","Backend","register","Class","extends","id","constructor","permissions","on","key","mavo","element","getAttribute","parsedURL","parseURL","url","username","extend","repo","branch","path","apiCall","pathname","slice","login","authenticated","accessToken","req","call","data","method","o","JSON","stringify","request","responseType","headers","fetch","apiDomain","catch","err","xhr","Promise","reject","error","then","resolve","response","get","atob","content","put","serialized","fileCall","repoInfo","name","ref","message","fileInfo","btoa","sha","status","passive","ready","localStorage","popup","width","Math","min","innerWidth","height","innerHeight","top","screen","screenTop","left","screenLeft","authPopup","open","location","href","addEventListener","evt","source","Error","getUser","logout","user","push","toLowerCase","removeItem","off","fire","backend","info","avatar","avatar_url","static","test","URL","host","ret","split","shift","join","unescape","encodeURIComponent","str","decodeURIComponent","escape","window","Bliss"],"mappings":"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","file":"../mavo.es5.js","sourcesContent":["(function($) {\n\nif (!self.Mavo) {\n\treturn;\n}\n\nvar _ = Mavo.Backend.register($.Class({\n\textends: Mavo.Backend,\n\tid: \"Github\",\n\tconstructor: function() {\n\t\tthis.permissions.on(\"login\");\n\n\t\tthis.key = this.mavo.element.getAttribute(\"mv-github-key\") || \"7e08e016048000bc594e\";\n\n\t\t// Extract info for username, repo, branch, filepath from URL\n\t\tvar parsedURL = _.parseURL(this.url);\n\n\t\tif (parsedURL.username) {\n\t\t\t$.extend(this, parsedURL);\n\t\t\tthis.repo = this.repo || \"mv-data\";\n\t\t\tthis.branch = this.branch || \"master\";\n\t\t\tthis.path = this.path || `${this.mavo.id}.json`;\n\t\t\tthis.apiCall = `repos/${this.username}/${this.repo}/contents/${this.path}`;\n\t\t}\n\t\telse {\n\t\t\tthis.apiCall = this.url.pathname.slice(1);\n\t\t}\n\n\t\tthis.permissions.on(\"read\");\n\n\t\tthis.login(true);\n\t},\n\n\tget authenticated () {\n\t\treturn !!this.accessToken;\n\t},\n\n\t/**\n\t * Helper method to make a request with the Github API\n\t */\n\treq: function(call, data, method = \"GET\", o = {method: method}) {\n\t\tif (data) {\n\t\t\to.data =  JSON.stringify(data);\n\t\t}\n\n\t\tvar request = $.extend(o, {\n\t\t\tresponseType: \"json\"\n\t\t});\n\n\t\tif (this.authenticated) {\n\t\t\trequest.headers = {\n\t\t\t\t\"Authorization\": `token ${this.accessToken}`\n\t\t\t};\n\t\t}\n\n\t\treturn $.fetch(_.apiDomain + call, request)\n\t\t.catch(err => {\n\t\t\tif (err && err.xhr) {\n\t\t\t\treturn Promise.reject(err.xhr);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.mavo.error(\"Something went wrong while connecting to Github\", err);\n\t\t\t}\n\t\t})\n\t\t.then(xhr => Promise.resolve(xhr.response));\n\t},\n\n\tget: function() {\n\t\treturn this.req(this.apiCall)\n\t\t       .then(response => Promise.resolve(this.repo? _.atob(response.content) : response));\n\t},\n\n\t/**\n\t * Saves a file to the backend.\n\t * @param {String} serialized - Serialized data\n\t * @param {String} path - Optional file path\n\t * @return {Promise} A promise that resolves when the file is saved.\n\t */\n\tput: function(serialized, path) {\n\t\tvar fileCall = path? `repos/${this.username}/${this.repo}/contents/${path}` : this.apiCall;\n\n\t\treturn Promise.resolve(this.repoInfo || this.req(\"user/repos\", {\n\t\t\tname: this.repo\n\t\t}, \"POST\"))\n\t\t.then(repoInfo => {\n\t\t\tthis.repoInfo = repoInfo;\n\n\t\t\treturn this.req(fileCall, {\n\t\t\t\tref: this.branch\n\t\t\t});\n\t\t})\n\t\t.then(fileInfo => this.req(fileCall, {\n\t\t\tmessage: `Updated ${fileInfo.name || \"file\"}`,\n\t\t\tcontent: _.btoa(serialized),\n\t\t\tbranch: this.branch,\n\t\t\tsha: fileInfo.sha\n\t\t}, \"PUT\"), xhr => {\n\t\t\tif (xhr.status == 404) {\n\t\t\t\t// File does not exist, create it\n\t\t\t\treturn this.req(fileCall, {\n\t\t\t\t\tmessage: \"Created file\",\n\t\t\t\t\tcontent: _.btoa(serialized),\n\t\t\t\t\tbranch: this.branch\n\t\t\t\t}, \"PUT\");\n\t\t\t}\n\n\t\t\treturn xhr;\n\t\t});\n\t},\n\n\tlogin: function(passive) {\n\t\treturn this.ready.then(() => {\n\t\t\tif (this.authenticated) {\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\treturn (new Promise((resolve, reject) => {\n\t\t\t\tif (passive) {\n\t\t\t\t\tthis.accessToken = localStorage[\"mavo:githubtoken\"];\n\n\t\t\t\t\tif (this.accessToken) {\n\t\t\t\t\t\tresolve(this.accessToken);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Show window\n\t\t\t\t\tvar popup = {\n\t\t\t\t\t\twidth: Math.min(1000, innerWidth - 100),\n\t\t\t\t\t\theight: Math.min(800, innerHeight - 100)\n\t\t\t\t\t};\n\n\t\t\t\t\tpopup.top = (innerHeight - popup.height)/2 + (screen.top || screenTop);\n\t\t\t\t\tpopup.left = (innerWidth - popup.width)/2 + (screen.left || screenLeft);\n\n\t\t\t\t\tthis.authPopup = open(`https://github.com/login/oauth/authorize?client_id=${this.key}&scope=repo,gist&state=${location.href}`,\n\t\t\t\t\t\t\"popup\", `width=${popup.width},height=${popup.height},left=${popup.left},top=${popup.top}`);\n\n\t\t\t\t\taddEventListener(\"message\", evt => {\n\t\t\t\t\t\tif (evt.source === this.authPopup) {\n\t\t\t\t\t\t\tthis.accessToken = localStorage[\"mavo:githubtoken\"] = evt.data;\n\n\t\t\t\t\t\t\tif (!this.accessToken) {\n\t\t\t\t\t\t\t\treject(Error(\"Authentication error\"));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(this.accessToken);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}))\n\t\t\t.then(() => this.getUser())\n\t\t\t.catch(xhr => {\n\t\t\t\tif (xhr.status == 401) {\n\t\t\t\t\t// Unauthorized. Access token we have is invalid, discard it\n\t\t\t\t\tthis.logout();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(u => {\n\t\t\t\tif (this.user) {\n\t\t\t\t\tthis.permissions.on(\"logout\");\n\n\t\t\t\t\tif (this.repo) {\n\t\t\t\t\t\treturn this.req(`repos/${this.username}/${this.repo}`)\n\t\t\t\t\t\t\t.then(repoInfo => {\n\t\t\t\t\t\t\t\tthis.repoInfo = repoInfo;\n\n\t\t\t\t\t\t\t\tif (repoInfo.permissions.push) {\n\t\t\t\t\t\t\t\t\tthis.permissions.on([\"edit\", \"save\"]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(xhr => {\n\t\t\t\t\t\t\t\tif (xhr.status == 404) {\n\t\t\t\t\t\t\t\t\t// Repo does not exist so we can't check permissions\n\t\t\t\t\t\t\t\t\t// Just check if authenticated user is the same as our URL username\n\t\t\t\t\t\t\t\t\tif (this.user.username.toLowerCase() == this.username.toLowerCase()) {\n\t\t\t\t\t\t\t\t\t\tthis.permissions.on([\"edit\", \"save\"]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tlogout: function() {\n\t\tif (this.authenticated) {\n\t\t\tlocalStorage.removeItem(\"mavo:githubtoken\");\n\t\t\tdelete this.accessToken;\n\n\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\", \"save\"]).on(\"login\");\n\n\t\t\tthis.mavo.element._.fire(\"mavo:logout\", {backend: this});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t},\n\n\tgetUser: function() {\n\t\treturn this.req(\"user\").then(info => {\n\t\t\tthis.user = {\n\t\t\t\tusername: info.login,\n\t\t\t\tname: info.name || info.login,\n\t\t\t\tavatar: info.avatar_url,\n\t\t\t\turl: \"https://github.com/\" + info.login,\n\t\t\t\tinfo\n\t\t\t};\n\n\t\t\t$.fire(this.mavo.element, \"mavo:login\", { backend: this });\n\t\t});\n\t},\n\n\tstatic: {\n\t\tapiDomain: \"https://api.github.com/\",\n\n\t\ttest: function(url) {\n\t\t\turl = new URL(url, location);\n\t\t\treturn /\\bgithub.com|raw.githubusercontent.com/.test(url.host);\n\t\t},\n\n\t\t/**\n\t\t * Parse Github URLs, return username, repo, branch, path\n\t\t */\n\t\tparseURL: function(url) {\n\t\t\tvar ret = {};\n\n\t\t\turl = new URL(url, location);\n\n\t\t\tvar path = url.pathname.slice(1).split(\"/\");\n\n\t\t\tret.username = path.shift();\n\t\t\tret.repo = path.shift();\n\n\t\t\tif (/raw.githubusercontent.com$/.test(url.host)) {\n\t\t\t\tret.branch = path.shift();\n\t\t\t}\n\t\t\telse if (/api.github.com$/.test(url.host)) {\n\t\t\t\t// raw API call, stop parsing and just return\n\t\t\t\treturn {};\n\t\t\t}\n\t\t\telse if (/github.com$/.test(url.host) && path[0] == \"blob\") {\n\t\t\t\tpath.shift();\n\t\t\t\tret.branch = path.shift();\n\t\t\t}\n\n\t\t\tret.path = path.join(\"/\");\n\n\t\t\treturn ret;\n\t\t},\n\n\t\t// Fix atob() and btoa() so they can handle Unicode\n\t\tbtoa: str => btoa(unescape(encodeURIComponent(str))),\n\t\tatob: str => decodeURIComponent(escape(window.atob(str)))\n\t}\n}));\n\n})(Bliss);\n"]}