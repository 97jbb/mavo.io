{"version":3,"sources":["plugins.js"],"names":["$","Mavo","attributes","push","_","Plugins","loaded","load","plugins","Set","$$","element","getAttribute","trim","split","plugin","add","size","Promise","resolve","fetch","url","responseType","then","all","xhr","response","filter","has","id","map","repo","base","include","register","name","o","hooks","Class","extend","existing","type","ready","dependencies","document","currentScript","src","location","length","init","Bliss"],"mappings":"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","file":"../mavo.es5.js","sourcesContent":["(function ($) {\n\nMavo.attributes.push(\"mv-plugins\");\n\nvar _ = Mavo.Plugins = {\n\tloaded: {},\n\n\tload: function() {\n\t\t_.plugins = new Set();\n\n\t\tfor (let element of $$(\"[mv-plugins]\")) {\n\t\t\tlet plugins = element.getAttribute(\"mv-plugins\").trim().split(/\\s+/);\n\n\t\t\tfor (let plugin of plugins) {\n\t\t\t\t_.plugins.add(plugin);\n\t\t\t}\n\t\t}\n\n\t\tif (!_.plugins.size) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\t// Fetch plugin index\n\t\treturn $.fetch(_.url + \"/plugins.json\", {\n\t\t\tresponseType: \"json\"\n\t\t}).then(xhr => {\n\t\t\t// Fetch plugins\n\t\t\treturn Mavo.all(xhr.response.plugin\n\t\t\t\t.filter(plugin => _.plugins.has(plugin.id))\n\t\t\t\t.map(plugin => {\n\t\t\t\t\t// Load plugin\n\n\t\t\t\t\tif (plugin.repo) {\n\t\t\t\t\t\t// Plugin hosted in a separate repo\n\t\t\t\t\t\tvar base = `https://raw.githubusercontent.com/${plugin.repo}/`;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Plugin hosted in the mavo-plugins repo\n\t\t\t\t\t\tvar base = `${_.url}/${plugin.id}/`;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar url = `${base}mavo-${plugin.id}.js`;\n\n\t\t\t\t\treturn $.include(_.loaded[plugin.id], url);\n\t\t\t\t}));\n\t\t});\n\t},\n\n\tregister: function(name, o = {}) {\n\t\tif (_.loaded[name]) {\n\t\t\t// Do not register same plugin twice\n\t\t\treturn;\n\t\t}\n\n\t\tMavo.hooks.add(o.hooks);\n\n\t\tfor (let Class in o.extend) {\n\t\t\tlet existing = Class == \"Mavo\"? Mavo : Mavo[Class];\n\n\t\t\tif ($.type(existing) === \"function\") {\n\t\t\t\t$.Class(existing, o.extend[Class]);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$.extend(existing, o.extend[Class]);\n\t\t\t}\n\t\t}\n\n\t\tvar ready = [];\n\n\t\tif (o.ready) {\n\t\t\tready.push(o.ready);\n\t\t}\n\n\t\tif (o.dependencies) {\n\t\t\tvar base = document.currentScript? document.currentScript.src : location;\n\t\t\tvar dependencies = o.dependencies.map(url => Mavo.load(url, base));\n\t\t\tready.push(...dependencies);\n\t\t}\n\n\t\tif (ready.length) {\n\t\t\tMavo.dependencies.push(...ready);\n\t\t}\n\n\t\t_.loaded[name] = o;\n\n\t\tif (o.init) {\n\t\t\tPromise.all(ready).then(() => o.init());\n\t\t}\n\t},\n\n\turl: \"https://plugins.mavo.io/\"\n};\n\n})(Bliss);\n"]}