{"version":3,"sources":["ui.itembar.js"],"names":["$","$$","_","Mavo","UI","Itembar","Class","constructor","item","element","property","filter","el","closest","selectors","multiple","data","create","className","buttons","tag","title","name","events","collection","delete","bottomUp","newItem","add","index","evt","superKey","render","scrollIntoViewIfNeeded","editItem","Group","dragHandle","click","target","focus","push","addEventListener","editing","keyCode","move","stopPropagation","preventDefault","set","contents","mouseenter","classList","mouseleave","remove","parentNode","revocably","Primitive","attribute","after","appendChild","reposition","proxy","mavo","Bliss"],"mappings":"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","file":"../mavo.es5.js","sourcesContent":["(function($, $$) {\n\nvar _ = Mavo.UI.Itembar = $.Class({\n\tconstructor: function(item) {\n\t\tthis.item = item;\n\n\t\tthis.element = $$(`.mv-item-bar:not([mv-rel]), .mv-item-bar[mv-rel=\"${this.item.property}\"]`, this.item.element).filter(el => {\n\t\t\t\t// Remove item controls meant for other collections\n\t\t\t\treturn el.closest(Mavo.selectors.multiple) == this.item.element && !Mavo.data(el, \"item\");\n\t\t\t})[0];\n\n\t\tthis.element = this.element || $.create({\n\t\t\tclassName: \"mv-item-bar mv-ui\"\n\t\t});\n\n\t\tMavo.data(this.element, \"item\", this.item);\n\n\t\tvar buttons = [\n\t\t\t{\n\t\t\t\ttag: \"button\",\n\t\t\t\ttitle: \"Delete this \" + this.item.name,\n\t\t\t\tclassName: \"mv-delete\",\n\t\t\t\tevents: {\n\t\t\t\t\t\"click\": evt => this.item.collection.delete(item)\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\ttag: \"button\",\n\t\t\t\ttitle: `Add new ${this.item.name} ${this.collection.bottomUp? \"after\" : \"before\"}`,\n\t\t\t\tclassName: \"mv-add\",\n\t\t\t\tevents: {\n\t\t\t\t\t\"click\": evt => {\n\t\t\t\t\t\tvar newItem = this.collection.add(null, this.item.index);\n\n\t\t\t\t\t\tif (evt[Mavo.superKey]) {\n\t\t\t\t\t\t\tnewItem.render(this.item.data);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tMavo.scrollIntoViewIfNeeded(newItem.element);\n\n\t\t\t\t\t\treturn this.collection.editItem(newItem);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tif (this.item instanceof Mavo.Group) {\n\t\t\tthis.dragHandle = $.create({\n\t\t\t\ttag: \"button\",\n\t\t\t\ttitle: \"Drag to reorder \" + this.item.name,\n\t\t\t\tclassName: \"mv-drag-handle\",\n\t\t\t\tevents: {\n\t\t\t\t\tclick: evt => evt.target.focus()\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tbuttons.push(this.dragHandle);\n\t\t}\n\t\telse {\n\t\t\tthis.dragHandle = this.item.element;\n\t\t}\n\n\t\tthis.dragHandle.addEventListener(\"keydown\", evt => {\n\t\t\tif (this.item.editing && evt.keyCode >= 37 && evt.keyCode <= 40) {\n\t\t\t\t// Arrow keys\n\t\t\t\tthis.collection.move(this.item, evt.keyCode <= 38? -1 : 1);\n\n\t\t\t\tevt.stopPropagation();\n\t\t\t\tevt.preventDefault();\n\t\t\t\tevt.target.focus();\n\t\t\t}\n\t\t});\n\n\t\t$.set(this.element, {\n\t\t\t\"mv-rel\": this.item.property,\n\t\t\tcontents: buttons,\n\t\t\tevents: {\n\t\t\t\tmouseenter: evt => {\n\t\t\t\t\tthis.item.element.classList.add(\"mv-highlight\");\n\t\t\t\t},\n\t\t\t\tmouseleave: evt => {\n\t\t\t\t\tthis.item.element.classList.remove(\"mv-highlight\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tadd: function() {\n\t\tif (!this.element.parentNode) {\n\t\t\tif (!Mavo.revocably.add(this.element)) {\n\t\t\t\tif (this.item instanceof Mavo.Primitive && !this.item.attribute) {\n\t\t\t\t\tthis.element.classList.add(\"mv-adjacent\");\n\t\t\t\t\t$.after(this.element, this.item.element);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.item.element.appendChild(this.element);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.dragHandle == this.item.element) {\n\t\t\tthis.item.element.classList.add(\"mv-drag-handle\");\n\t\t}\n\t},\n\n\tremove: function() {\n\t\tMavo.revocably.remove(this.element);\n\n\t\tif (this.dragHandle == this.item.element) {\n\t\t\tthis.item.element.classList.remove(\"mv-drag-handle\");\n\t\t}\n\t},\n\n\treposition: function() {\n\t\tthis.element.remove();\n\t\tthis.add();\n\t},\n\n\tproxy: {\n\t\tcollection: \"item\",\n\t\tmavo: \"item\"\n\t}\n});\n\n})(Bliss, Bliss.$);\n"]}