{"version":3,"sources":["node.js"],"names":["$","$$","_","Mavo","Node","Class","abstract","constructor","element","mavo","options","Error","env","context","uid","maxId","nodeType","property","extend","all","set","get","group","parentGroup","template","copies","push","fromTemplate","getProperty","type","Group","normalize","storage","getAttribute","modes","hooks","run","mode","getStyle","collection","expressions","map","DOMExpression","et","item","editing","isRoot","name","Functions","readable","toLowerCase","saved","parent","postInit","edit","destroy","delete","getData","o","isDataNull","result","deleted","live","walk","callback","path","walker","obj","ret","i","children","node","call","walkUp","undefined","done","parentNode","unbind","propagate","clear","propagated","toJSON","prototype","properties","render","data","oldData","subset","inPath","Array","isArray","Object","keys","length","dataRender","save","dataChanged","action","fire","toString","getClosestCollection","mutable","closestCollection","isDeleted","relativizeData","Proxy","proxy","has","index","find","filter","root","value","lazy","split","p","Set","union","itemTemplate","store","toggleAttribute","unsavedChanges","classList","toggle","_mode","Collection","indexOf","Observer","sneak","modeObserver","_modes","elementContents","document","createDocumentFragment","childNodes","forEach","appendChild","contents","tag","className","textContent","events","evt","remove","_deleted","static","WeakMap","create","is","hasAttribute","id","setAttribute","prioritizePrimitive","nodes","selectors","e","contains","unique","Bliss"],"mappings":"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","file":"../mavo.es5.js","sourcesContent":["(function($, $$) {\n\nvar _ = Mavo.Node = $.Class({\n\tabstract: true,\n\tconstructor: function (element, mavo, options = {}) {\n\t\tif (!element || !mavo) {\n\t\t\tthrow new Error(\"Mavo.Node constructor requires an element argument and a mavo object\");\n\t\t}\n\n\t\tvar env = {context: this, options};\n\n\t\t// Set these first, for debug reasons\n\t\tthis.uid = ++_.maxId;\n\t\tthis.nodeType = this.nodeType;\n\t\tthis.property = null;\n\t\tthis.element = element;\n\n\t\t$.extend(this, env.options);\n\n\t\t_.all.set(element, [...(_.all.get(this.element) || []), this]);\n\n\t\tthis.mavo = mavo;\n\t\tthis.group = this.parentGroup = env.options.group;\n\n\t\tthis.template = env.options.template;\n\n\t\tif (this.template) {\n\t\t\tthis.template.copies.push(this);\n\t\t}\n\t\telse {\n\t\t\t// First (or only) of its kind\n\t\t\tthis.copies = [];\n\t\t}\n\n\t\tif (!this.fromTemplate(\"property\", \"type\")) {\n\t\t\tthis.property = _.getProperty(element);\n\t\t\tthis.type = Mavo.Group.normalize(element);\n\t\t\tthis.storage = this.element.getAttribute(\"mv-storage\"); // TODO rename to storage\n\t\t}\n\n\t\tthis.modes = this.element.getAttribute(\"mv-mode\");\n\n\t\tMavo.hooks.run(\"node-init-start\", env);\n\n\t\tthis.mode = Mavo.getStyle(this.element, \"--mv-mode\") || \"read\";\n\n\t\tthis.collection = env.options.collection;\n\n\t\tif (this.collection) {\n\t\t\t// This is a collection item\n\t\t\tthis.group = this.parentGroup = this.collection.parentGroup;\n\t\t}\n\n\t\t// Must run before collections have a marker which messes up paths\n\t\tvar template = this.template;\n\n\t\tif (template && template.expressions) {\n\t\t\t// We know which expressions we have, don't traverse again\n\t\t\tthis.expressions = template.expressions.map(et => new Mavo.DOMExpression({\n\t\t\t\ttemplate: et,\n\t\t\t\titem: this,\n\t\t\t\tmavo: this.mavo\n\t\t\t}));\n\t\t}\n\n\t\tMavo.hooks.run(\"node-init-end\", env);\n\t},\n\n\tget editing() {\n\t\treturn this.mode == \"edit\";\n\t},\n\n\tget isRoot() {\n\t\treturn !this.property;\n\t},\n\n\tget name() {\n\t\treturn Mavo.Functions.readable(this.property || this.type).toLowerCase();\n\t},\n\n\tget saved() {\n\t\treturn this.storage !== \"none\";\n\t},\n\n\tget parent() {\n\t\treturn this.collection || this.parentGroup;\n\t},\n\n\t/**\n\t * Runs after the constructor is done (including the constructor of the inheriting class), synchronously\n\t */\n\tpostInit: function() {\n\t\tif (this.modes == \"edit\") {\n\t\t\tthis.edit();\n\t\t}\n\t},\n\n\tdestroy: function() {\n\t\tif (this.template) {\n\t\t\tMavo.delete(this.template.copies, this);\n\t\t}\n\t},\n\n\tgetData: function(o = {}) {\n\t\tif (this.isDataNull(o)) {\n\t\t\treturn null;\n\t\t}\n\t},\n\n\tisDataNull: function(o) {\n\t\tvar env = {\n\t\t\tcontext: this,\n\t\t\toptions: o,\n\t\t\tresult: this.deleted || !this.saved && !o.live\n\t\t};\n\n\t\tMavo.hooks.run(\"unit-isdatanull\", env);\n\n\t\treturn env.result;\n\t},\n\n\t/**\n\t * Execute a callback on every node of the Mavo tree\n\t * If callback returns (strict) false, walk stops.\n\t * @return false if was stopped via a false return value, true otherwise\n\t */\n\twalk: function(callback, path = []) {\n\t\tvar walker = (obj, path) => {\n\t\t\tvar ret = callback(obj, path);\n\n\t\t\tif (ret !== false) {\n\t\t\t\tfor (let i in obj.children) {\n\t\t\t\t\tlet node = obj.children[i];\n\n\t\t\t\t\tif (node instanceof Mavo.Node) {\n\t\t\t\t\t\tvar ret = walker.call(node, node, [...path, i]);\n\n\t\t\t\t\t\tif (ret === false) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret !== false;\n\t\t};\n\n\t\treturn walker(this, path);\n\t},\n\n\twalkUp: function(callback) {\n\t\tvar group = this;\n\n\t\twhile (group = group.parentGroup) {\n\t\t\tvar ret = callback(group);\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t},\n\n\tedit: function() {\n\t\tthis.mode = \"edit\";\n\n\t\tif (this.mode != \"edit\") {\n\t\t\treturn false;\n\t\t}\n\n\t\tMavo.hooks.run(\"node-edit-end\", this);\n\t},\n\n\tdone: function() {\n\t\tthis.mode = Mavo.getStyle(this.element.parentNode, \"--mv-mode\") || \"read\";\n\n\t\tif (this.mode != \"read\") {\n\t\t\treturn false;\n\t\t}\n\n\t\t$.unbind(this.element, \".mavo:edit\");\n\n\t\tthis.propagate(\"done\");\n\n\t\tMavo.hooks.run(\"node-done-end\", this);\n\t},\n\n\tclear: function() {\n\t\tif (this.modes != \"read\") {\n\t\t\tthis.propagate(\"clear\");\n\t\t}\n\t},\n\n\tpropagate: function(callback) {\n\t\tfor (let i in this.children) {\n\t\t\tlet node = this.children[i];\n\n\t\t\tif (node instanceof Mavo.Node) {\n\t\t\t\tif (typeof callback === \"function\") {\n\t\t\t\t\tcallback.call(node, node);\n\t\t\t\t}\n\t\t\t\telse if (callback in node) {\n\t\t\t\t\tnode[callback]();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tpropagated: [\"save\", \"destroy\"],\n\n\ttoJSON: Mavo.prototype.toJSON,\n\n\tfromTemplate: function(...properties) {\n\t\tif (this.template) {\n\t\t\tfor (let property of properties) {\n\t\t\t\tthis[property] = this.template[property];\n\t\t\t}\n\t\t}\n\n\t\treturn !!this.template;\n\t},\n\n\trender: function(data) {\n\t\tthis.oldData = this.data;\n\t\tthis.data = data;\n\n\t\tdata = Mavo.subset(data, this.inPath);\n\n\t\tvar env = {context: this, data};\n\n\t\tMavo.hooks.run(\"node-render-start\", env);\n\n\t\tif (this.nodeType != \"Collection\" && Array.isArray(data)) {\n\t\t\t// We are rendering an array on a singleton, what to do?\n\t\t\tvar properties;\n\t\t\tif (this.isRoot && (properties = Object.keys(this.children)).length === 1 && this.children[properties[0]].nodeType === \"Collection\") {\n\t\t\t\t// If it's root with only one collection property, render on that property\n\t\t\t\tenv.data = {\n\t\t\t\t\t[properties[0]]: env.data\n\t\t\t\t};\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Otherwise, render first item\n\t\t\t\tthis.inPath.push(\"0\");\n\t\t\t\tenv.data = env.data[0];\n\t\t\t}\n\t\t}\n\n\t\tif (this.editing) {\n\t\t\tthis.done();\n\t\t\tthis.dataRender(env.data);\n\t\t\tthis.edit();\n\t\t}\n\t\telse {\n\t\t\tthis.dataRender(env.data);\n\t\t}\n\n\t\tthis.save();\n\n\t\tMavo.hooks.run(\"node-render-end\", env);\n\t},\n\n\tdataChanged: function(action, o = {}) {\n\t\t$.fire(o.element || this.element, \"mavo:datachange\", $.extend({\n\t\t\tproperty: this.property,\n\t\t\taction,\n\t\t\tmavo: this.mavo,\n\t\t\tnode: this\n\t\t}, o));\n\t},\n\n\ttoString: function() {\n\t\treturn `#${this.uid}: ${this.nodeType} (${this.property})`;\n\t},\n\n\tgetClosestCollection: function() {\n\t\tif (this.collection && this.collection.mutable) {\n\t\t\treturn this.collection;\n\t\t}\n\n\t\tif (this.group.collection && this.group.collection.mutable) {\n\t\t\treturn this.group.collection;\n\t\t}\n\n\t\treturn this.parentGroup? this.parentGroup.closestCollection : null;\n\t},\n\n\t/**\n\t * Check if this unit is either deleted or inside a deleted group\n\t */\n\tisDeleted: function() {\n\t\tvar ret = this.deleted;\n\n\t\tif (this.deleted) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn !!this.parentGroup && this.parentGroup.isDeleted();\n\t},\n\n\trelativizeData: function(data, options = {live: true}) {\n\t\treturn new Proxy(data, {\n\t\t\tget: (data, property, proxy) => {\n\t\t\t\t// Checking if property is in proxy might add it to the data\n\t\t\t\tif (property in data || (property in proxy && property in data)) {\n\t\t\t\t\tvar ret = data[property];\n\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\thas: (data, property) => {\n\t\t\t\tif (property in data) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Property does not exist, look for it elsewhere\n\n\t\t\t\t// Special values\n\t\t\t\tswitch (property) {\n\t\t\t\t\tcase \"$index\":\n\t\t\t\t\t\tdata[property] = this.index || 0;\n\t\t\t\t\t\treturn true; // if index is 0 it's falsy and has would return false!\n\t\t\t\t\tcase \"$next\":\n\t\t\t\t\tcase \"$previous\":\n\t\t\t\t\t\tif (this.closestCollection) {\n\t\t\t\t\t\t\tdata[property] = this.closestCollection.getData(options)[this.index + (property == \"$next\"? 1 : -1)];\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdata[property] = null;\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (this instanceof Mavo.Group && property == this.property && this.collection) {\n\t\t\t\t\tdata[property] = data;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// First look in ancestors\n\t\t\t\tvar ret = this.walkUp(group => {\n\t\t\t\t\tif (property in group.children) {\n\t\t\t\t\t\treturn group.children[property];\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tif (ret === undefined) {\n\t\t\t\t\t// Still not found, look in descendants\n\t\t\t\t\tret = this.find(property);\n\t\t\t\t}\n\n\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\tif (Array.isArray(ret)) {\n\t\t\t\t\t\tret = ret.map(item => item.getData(options))\n\t\t\t\t\t\t\t\t .filter(item => item !== null);\n\t\t\t\t\t}\n\t\t\t\t\telse if (ret instanceof Mavo.Node) {\n\t\t\t\t\t\tret = ret.getData(options);\n\t\t\t\t\t}\n\n\t\t\t\t\tdata[property] = ret;\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Does it reference another Mavo?\n\t\t\t\tif (property in Mavo.all && Mavo.all[property].root) {\n\t\t\t\t\treturn data[property] = Mavo.all[property].root.getData(options);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\n\t\t\tset: function(data, property, value) {\n\t\t\t\tthrow Error(\"You can’t set data via expressions.\");\n\t\t\t}\n\t\t});\n\t},\n\n\tlazy: {\n\t\tclosestCollection: function() {\n\t\t\treturn this.getClosestCollection();\n\t\t},\n\n\t\t// Are were only rendering and editing a subset of the data?\n\t\tinPath: function() {\n\t\t\tif (this.nodeType != \"Collection\") {\n\t\t\t\treturn (this.element.getAttribute(\"mv-path\") || \"\").split(\"/\").filter(p => p.length);\n\t\t\t}\n\n\t\t\treturn [];\n\t\t},\n\n\t\tproperties: function() {\n\t\t\tif (this.template) {\n\t\t\t\treturn this.template.properties;\n\t\t\t}\n\n\t\t\tvar ret = new Set(this.property && [this.property]);\n\n\t\t\tif (this.nodeType == \"Group\") {\n\t\t\t\tfor (var property in this.children) {\n\t\t\t\t\tret = Mavo.union(ret, this.children[property].properties);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.nodeType == \"Collection\") {\n\t\t\t\tret = Mavo.union(ret, this.itemTemplate.properties);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\t},\n\n\tlive: {\n\t\tstore: function(value) {\n\t\t\t$.toggleAttribute(this.element, \"mv-storage\", value);\n\t\t},\n\n\t\tunsavedChanges: function(value) {\n\t\t\tif (value && (!this.saved || !this.editing)) {\n\t\t\t\tvalue = false;\n\t\t\t}\n\n\t\t\tthis.element.classList.toggle(\"mv-unsaved-changes\", value);\n\n\t\t\treturn value;\n\t\t},\n\n\t\tmode: function (value) {\n\t\t\tif (this._mode != value) {\n\t\t\t\t// Is it allowed?\n\t\t\t\tif (this.modes && value != this.modes) {\n\t\t\t\t\tvalue = this.modes;\n\t\t\t\t}\n\n\t\t\t\t// If we don't do this, setting the attribute below will\n\t\t\t\t// result in infinite recursion\n\t\t\t\tthis._mode = value;\n\n\t\t\t\tif (!(this instanceof Mavo.Collection) && [null, \"\", \"read\", \"edit\"].indexOf(this.element.getAttribute(\"mv-mode\")) > -1) {\n\t\t\t\t\t// If attribute is not one of the recognized values, leave it alone\n\t\t\t\t\tvar set = this.modes || value == \"edit\";\n\t\t\t\t\tMavo.Observer.sneak(this.mavo.modeObserver, () => {\n\t\t\t\t\t\t$.toggleAttribute(this.element, \"mv-mode\", value, set);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t},\n\n\t\tmodes: function(value) {\n\t\t\tif (value && value != \"read\" && value != \"edit\") {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tthis._modes = value;\n\n\t\t\tif (value && this.mode != value) {\n\t\t\t\tthis.mode = value;\n\t\t\t}\n\t\t},\n\n\t\tdeleted: function(value) {\n\t\t\tthis.element.classList.toggle(\"mv-deleted\", value);\n\n\t\t\tif (value) {\n\t\t\t\t// Soft delete, store element contents in a fragment\n\t\t\t\t// and replace them with an undo prompt.\n\t\t\t\tthis.elementContents = document.createDocumentFragment();\n\t\t\t\t$$(this.element.childNodes).forEach(node => {\n\t\t\t\t\tthis.elementContents.appendChild(node);\n\t\t\t\t});\n\n\t\t\t\t$.contents(this.element, [\n\t\t\t\t\t{\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\tclassName: \"mv-close mv-ui\",\n\t\t\t\t\t\ttextContent: \"×\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": function(evt) {\n\t\t\t\t\t\t\t\t$.remove(this.parentNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"Deleted \" + this.name,\n\t\t\t\t\t{\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\tclassName: \"mv-undo mv-ui\",\n\t\t\t\t\t\ttextContent: \"Undo\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": evt => this.deleted = false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]);\n\n\t\t\t\tthis.element.classList.remove(\"mv-highlight\");\n\t\t\t}\n\t\t\telse if (this.deleted) {\n\t\t\t\t// Undelete\n\t\t\t\tthis.element.textContent = \"\";\n\t\t\t\tthis.element.appendChild(this.elementContents);\n\n\t\t\t\t// otherwise expressions won't update because this will still seem as deleted\n\t\t\t\t// Alternatively, we could fire datachange with a timeout.\n\t\t\t\tthis._deleted = false;\n\n\t\t\t\tthis.dataChanged(\"undelete\");\n\t\t\t}\n\t\t},\n\n\t\tpath: {\n\t\t\tget: function() {\n\t\t\t\tvar path = this.parent? this.parent.path : [];\n\n\t\t\t\treturn this.property? [...path, this.property] : path;\n\t\t\t}\n\t\t}\n\t},\n\n\tstatic: {\n\t\tmaxId: 0,\n\n\t\tall: new WeakMap(),\n\n\t\tcreate: function(element, mavo, o = {}) {\n\t\t\tif (Mavo.is(\"multiple\", element) && !o.collection) {\n\t\t\t\treturn new Mavo.Collection(element, mavo, o);\n\t\t\t}\n\n\t\t\treturn new Mavo[Mavo.is(\"group\", element)? \"Group\" : \"Primitive\"](element, mavo, o);\n\t\t},\n\n\t\t/**\n\t\t * Get & normalize property name, if exists\n\t\t */\n\t\tgetProperty: function(element) {\n\t\t\tvar property = element.getAttribute(\"property\") || element.getAttribute(\"itemprop\");\n\n\t\t\tif (!property && element.hasAttribute(\"property\")) {\n\t\t\t\tproperty = element.name || element.id || element.classList[0];\n\t\t\t}\n\n\t\t\tif (property) {\n\t\t\t\telement.setAttribute(\"property\", property);\n\t\t\t}\n\n\t\t\treturn property;\n\t\t},\n\n\t\tget: function(element, prioritizePrimitive) {\n\t\t\tvar nodes = (_.all.get(element) || []).filter(node => !(node instanceof Mavo.Collection));\n\n\t\t\tif (nodes.length < 2 || !prioritizePrimitive) {\n\t\t\t\treturn nodes[0];\n\t\t\t}\n\n\t\t\tif (nodes[0] instanceof Mavo.Group) {\n\t\t\t\treturn node[1];\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Get all properties that are inside an element but not nested into other properties\n\t\t */\n\t\tchildren: function(element) {\n\t\t\tvar ret = Mavo.Node.get(element);\n\n\t\t\tif (ret) {\n\t\t\t\t// element is a Mavo node\n\t\t\t\treturn [ret];\n\t\t\t}\n\n\t\t\tret = $$(Mavo.selectors.property, element)\n\t\t\t\t.map(e => Mavo.Node.get(e))\n\t\t\t\t.filter(e => !element.contains(e.parentGroup.element)) // drop nested properties\n\t\t\t\t.map(e => e.collection || e);\n\n\t\t\treturn Mavo.Functions.unique(ret);\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n"]}