{"version":3,"sources":["mavo.js"],"names":[],"mappings":"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","file":"mavo.es5.js","sourcesContent":["/*\n * Stretchy: Form element autosizing, the way it should be.\n * by Lea Verou http://lea.verou.me\n * MIT license\n */\n(function() {\n\nif (!self.Element) {\n\treturn; // super old browser\n}\n\nif (!Element.prototype.matches) {\n\tElement.prototype.matches = Element.prototype.webkitMatchesSelector || Element.prototype.mozMatchesSelector || Element.prototype.msMatchesSelector || Element.prototype.oMatchesSelector || null;\n}\n\nif (!Element.prototype.matches) {\n\treturn;\n}\n\nfunction $$(expr, con) {\n\treturn expr instanceof Node || expr instanceof Window? [expr] :\n\t       [].slice.call(typeof expr == \"string\"? (con || document).querySelectorAll(expr) : expr || []);\n}\n\nvar _ = self.Stretchy = {\n\tselectors: {\n\t\tbase: 'textarea, select:not([size]), input:not([type]), input[type=\"' + \"text url email tel\".split(\" \").join('\"], input[type=\"') + '\"]',\n\t\tfilter: \"*\"\n\t},\n\n\t// Script element this was included with, if any\n\tscript: document.currentScript || $$(\"script\").pop(),\n\n\t// Autosize one element. The core of Stretchy.\n\tresize: function(element) {\n\t\tif (!_.resizes(element)) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar cs = getComputedStyle(element);\n\t\tvar offset = 0;\n\n\t\tif (!element.value && element.placeholder) {\n\t\t\tvar empty = true;\n\t\t\telement.value = element.placeholder;\n\t\t}\n\n\t\tvar type = element.nodeName.toLowerCase();\n\n\t\tif (type == \"textarea\") {\n\t\t\telement.style.height = \"0\";\n\n\t\t\tif (cs.boxSizing == \"border-box\") {\n\t\t\t\toffset = element.offsetHeight;\n\t\t\t}\n\t\t\telse if (cs.boxSizing == \"content-box\") {\n\t\t\t\toffset = -element.clientHeight;\n\t\t\t}\n\n\t\t\telement.style.height = element.scrollHeight + offset + \"px\";\n\t\t}\n\t\telse if(type == \"input\") {\n\t\t\telement.style.width = \"0\";\n\n\t\t\tif (cs.boxSizing == \"border-box\") {\n\t\t\t\toffset = element.offsetWidth;\n\t\t\t}\n\t\t\telse if (cs.boxSizing == \"padding-box\") {\n\t\t\t\toffset = element.clientWidth;\n\t\t\t}\n\n\t\t\t// Safari misreports scrollWidth, so we will instead set scrollLeft to a\n\t\t\t// huge number, and read that back to see what it was clipped to\n\t\t\telement.scrollLeft = 1e+10;\n\n\t\t\tvar width = Math.max(element.scrollLeft + offset, element.scrollWidth - element.clientWidth);\n\n\t\t\telement.style.width = width + \"px\";\n\t\t}\n\t\telse if (type == \"select\") {\n\t\t\tvar selectedIndex = element.selectedIndex > 0? element.selectedIndex : 0;\n\n\t\t\t// Need to use dummy element to measure :(\n\t\t\tvar option = document.createElement(\"_\");\n\t\t\toption.textContent = element.options[selectedIndex].textContent;\n\t\t\telement.parentNode.insertBefore(option, element.nextSibling);\n\n\t\t\t// The name of the appearance property, as it might be prefixed\n\t\t\tvar appearance;\n\n\t\t\tfor (var property in cs) {\n\t\t\t\tvar value = cs[property];\n\t\t\t\tif (!/^(width|webkitLogicalWidth|length)$/.test(property) && typeof value == \"string\") {\n\t\t\t\t\t//console.log(property, option.offsetWidth, cs[property]);\n\t\t\t\t\toption.style[property] = value;\n\n\t\t\t\t\tif (/appearance$/i.test(property)) {\n\t\t\t\t\t\tappearance = property;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\toption.style.width = \"\";\n\n\t\t\tif (option.offsetWidth > 0) {\n\t\t\t\telement.style.width = option.offsetWidth + \"px\";\n\n\t\t\t\tif (!cs[appearance] || cs[appearance] !== \"none\") {\n\t\t\t\t\t// Account for arrow\n\t\t\t\t\telement.style.width = \"calc(\" + element.style.width + \" + 2em)\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\toption.parentNode.removeChild(option);\n\t\t\toption = null;\n\t\t}\n\n\t\tif (empty) {\n\t\t\telement.value = \"\";\n\t\t}\n\t},\n\n\t// Autosize multiple elements\n\tresizeAll: function(elements) {\n\t\t$$(elements || _.selectors.base).forEach(function (element) {\n\t\t\t_.resize(element);\n\t\t});\n\t},\n\n\tactive: true,\n\n\t// Will stretchy do anything for this element?\n\tresizes: function(element) {\n\t\treturn element &&\n\t\t       element.parentNode &&\n\t\t       element.matches &&\n\t\t       element.matches(_.selectors.base) &&\n\t\t       element.matches(_.selectors.filter);\n\t},\n\n\tinit: function(){\n\t\t_.selectors.filter = _.script.getAttribute(\"data-filter\") ||\n\t\t                     ($$(\"[data-stretchy-filter]\").pop() || document.body).getAttribute(\"data-stretchy-filter\") || Stretchy.selectors.filter || \"*\";\n\n\t\t_.resizeAll();\n\t},\n\n\t$$: $$\n};\n\n// Autosize all elements once the DOM is loaded\n\n// DOM already loaded?\nif (document.readyState !== \"loading\") {\n\t_.init();\n}\nelse {\n\t// Wait for it\n\tdocument.addEventListener(\"DOMContentLoaded\", _.init);\n}\n\n// Listen for changes\nvar listener = function(evt) {\n\tif (_.active) {\n\t\t_.resize(evt.target);\n\t}\n};\n\ndocument.documentElement.addEventListener(\"input\", listener);\n\n// Firefox fires a change event instead of an input event\ndocument.documentElement.addEventListener(\"change\", listener);\n\n// Listen for new elements\nif (self.MutationObserver) {\n\t(new MutationObserver(function(mutations) {\n\t\tif (_.active) {\n\t\t\tmutations.forEach(function(mutation) {\n\t\t\t\tif (mutation.type == \"childList\") {\n\t\t\t\t\tStretchy.resizeAll(mutation.addedNodes);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t})).observe(document.documentElement, {\n\t\tchildList: true,\n\t\tsubtree: true\n\t});\n}\n\n})();\n\n(function() {\n\"use strict\";\n\nfunction overload(callback, start, end) {\n\tstart = start === undefined ? 1 : start;\n\tend = end || start + 1;\n\n\tif (end - start <= 1) {\n\t\treturn function() {\n\t\t\tif (arguments.length <= start || $.type(arguments[start]) === \"string\") {\n\t\t\t\treturn callback.apply(this, arguments);\n\t\t\t}\n\n\t\t\tvar obj = arguments[start], ret;\n\n\t\t\tfor (var key in obj) {\n\t\t\t\tvar args = Array.from(arguments);\n\t\t\t\targs.splice(start, 1, key, obj[key]);\n\t\t\t\tret = callback.apply(this, args);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t};\n\t}\n\n\treturn overload(overload(callback, start + 1, end), start, end - 1);\n}\n\n// Copy properties from one object to another. Overwrites allowed.\nfunction extend(to, from, whitelist) {\n\tfor (var property in from) {\n\t\tif (whitelist) {\n\t\t\tvar type = $.type(whitelist);\n\n\t\t\tif (whitelist === \"own\" && !from.hasOwnProperty(property) ||\n\t\t\t\ttype === \"array\" && whitelist.indexOf(property) === -1 ||\n\t\t\t\ttype === \"regexp\" && !whitelist.test(property) ||\n\t\t\t\ttype === \"function\" && !whitelist.call(from, property)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\t// To copy gettters/setters, preserve flags etc\n\t\tvar descriptor = Object.getOwnPropertyDescriptor(from, property);\n\n\t\tif (descriptor && (!descriptor.writable || !descriptor.configurable || !descriptor.enumerable || descriptor.get || descriptor.set)) {\n\t\t\tdelete to[property];\n\t\t\tObject.defineProperty(to, property, descriptor);\n\t\t}\n\t\telse {\n\t\t\tto[property] = from[property];\n\t\t}\n\t}\n\n\treturn to;\n}\n\nvar $ = self.Bliss = extend(function(expr, context) {\n\treturn $.type(expr) === \"string\"? (context || document).querySelector(expr) : expr || null;\n}, self.Bliss);\n\nextend($, {\n\textend: extend,\n\n\toverload: overload,\n\n\tproperty: $.property || \"_\",\n\n\tsources: {},\n\n\tnoop: function() {},\n\n\t$: function(expr, context) {\n\t\tif (expr instanceof Node || expr instanceof Window) {\n\t\t\treturn [expr];\n\t\t}\n\n\t\treturn Array.from(typeof expr == \"string\"? (context || document).querySelectorAll(expr) : expr || []);\n\t},\n\n\t/**\n\t * Returns the [[Class]] of an object in lowercase (eg. array, date, regexp, string etc)\n\t */\n\ttype: function(obj) {\n\t\tif (obj === null) {\n\t\t\treturn \"null\";\n\t\t}\n\n\t\tif (obj === undefined) {\n\t\t\treturn \"undefined\";\n\t\t}\n\n\t\tvar ret = (Object.prototype.toString.call(obj).match(/^\\[object\\s+(.*?)\\]$/)[1] || \"\").toLowerCase();\n\n\t\tif (ret == \"number\" && isNaN(obj)) {\n\t\t\treturn \"nan\";\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\t/*\n\t * Return first non-undefined value. Mainly used internally.\n\t */\n\tdefined: function () {\n\t\tfor (var i=0; i<arguments.length; i++) {\n\t\t\tif (arguments[i] !== undefined) {\n\t\t\t\treturn arguments[i];\n\t\t\t}\n\t\t}\n\t},\n\n\tcreate: function (tag, o) {\n\t\tif (tag instanceof Node) {\n\t\t\treturn $.set(tag, o);\n\t\t}\n\n\t\t// 4 signatures: (tag, o), (tag), (o), ()\n\t\tif (arguments.length === 1) {\n\t\t\tif ($.type(tag) === \"string\") {\n\t\t\t\to = {};\n\t\t\t}\n\t\t\telse {\n\t\t\t\to = tag;\n\t\t\t\ttag = o.tag;\n\t\t\t\to = $.extend({}, o, function(property) {\n\t\t\t\t\treturn property !== \"tag\";\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn $.set(document.createElement(tag || \"div\"), o);\n\t},\n\n\teach: function(obj, callback, ret) {\n\t\tret = ret || {};\n\n\t\tfor (var property in obj) {\n\t\t\tret[property] = callback.call(obj, property, obj[property]);\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tready: function(context) {\n\t\tcontext = context || document;\n\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tif (context.readyState !== \"loading\") {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcontext.addEventListener(\"DOMContentLoaded\", function() {\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\t// Helper for defining OOP-like “classes”\n\tClass: function(o) {\n\t\tvar special = [\"constructor\", \"extends\", \"abstract\", \"static\"].concat(Object.keys($.classProps));\n\t\tvar init = o.hasOwnProperty(\"constructor\")? o.constructor : $.noop;\n\n\t\tvar Class = function() {\n\t\t\tif (this.constructor.__abstract && this.constructor === Class) {\n\t\t\t\tthrow new Error(\"Abstract classes cannot be directly instantiated.\");\n\t\t\t}\n\n\t\t\tClass.super && Class.super.apply(this, arguments);\n\n\t\t\tinit.apply(this, arguments);\n\t\t};\n\n\t\tClass.super = o.extends || null;\n\n\t\tClass.prototype = $.extend(Object.create(Class.super? Class.super.prototype : Object), {\n\t\t\tconstructor: Class\n\t\t});\n\n\t\tvar specialFilter = function(property) {\n\t\t\treturn this.hasOwnProperty(property) && special.indexOf(property) === -1;\n\t\t};\n\n\t\t// Static methods\n\t\tif (o.static) {\n\t\t\t$.extend(Class, o.static, specialFilter);\n\n\t\t\tfor (var property in $.classProps) {\n\t\t\t\tif (property in o.static) {\n\t\t\t\t\t$.classProps[property](Class, o.static[property]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Instance methods\n\t\t$.extend(Class.prototype, o, specialFilter);\n\n\t\tfor (var property in $.classProps) {\n\t\t\tif (property in o) {\n\t\t\t\t$.classProps[property](Class.prototype, o[property]);\n\t\t\t}\n\t\t}\n\n\t\t// For easier calling of super methods\n\t\t// This doesn't save us from having to use .call(this) though\n\t\tClass.prototype.super = Class.super? Class.super.prototype : null;\n\n\t\tClass.__abstract = !!o.abstract;\n\n\t\treturn Class;\n\t},\n\n\t// Properties with special handling in classes\n\tclassProps: {\n\t\t// Lazily evaluated properties\n\t\tlazy: overload(function(obj, property, getter) {\n\t\t\tObject.defineProperty(obj, property, {\n\t\t\t\tget: function() {\n\t\t\t\t\tvar value = getter.call(this);\n\n\t\t\t\t\tObject.defineProperty(this, property, {\n\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\twritable: true\n\t\t\t\t\t});\n\n\t\t\t\t\treturn value;\n\t\t\t\t},\n\t\t\t\tset: function(value) {\n\t\t\t\t\t// Blind write: skip running the getter\n\t\t\t\t\tObject.defineProperty(this, property, {\n\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\twritable: true\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tconfigurable: true,\n\t\t\t\tenumerable: true\n\t\t\t});\n\n\t\t\treturn obj;\n\t\t}),\n\n\t\t// Properties that behave like normal properties but also execute code upon getting/setting\n\t\tlive: overload(function(obj, property, descriptor) {\n\t\t\tif ($.type(descriptor) === \"function\") {\n\t\t\t\tdescriptor = {set: descriptor};\n\t\t\t}\n\n\t\t\tObject.defineProperty(obj, property, {\n\t\t\t\tget: function() {\n\t\t\t\t\tvar value = this[\"_\" + property];\n\t\t\t\t\tvar ret = descriptor.get && descriptor.get.call(this, value);\n\t\t\t\t\treturn ret !== undefined? ret : value;\n\t\t\t\t},\n\t\t\t\tset: function(v) {\n\t\t\t\t\tvar value = this[\"_\" + property];\n\t\t\t\t\tvar ret = descriptor.set && descriptor.set.call(this, v, value);\n\t\t\t\t\tthis[\"_\" + property] = ret !== undefined? ret : v;\n\t\t\t\t},\n\t\t\t\tconfigurable: descriptor.configurable,\n\t\t\t\tenumerable: descriptor.enumerable\n\t\t\t});\n\n\t\t\treturn obj;\n\t\t})\n\n\t},\n\n\t// Includes a script, returns a promise\n\tinclude: function() {\n\t\tvar url = arguments[arguments.length - 1];\n\t\tvar loaded = arguments.length === 2? arguments[0] : false;\n\n\t\tvar script = document.createElement(\"script\");\n\n\t\treturn loaded? Promise.resolve() : new Promise(function(resolve, reject) {\n\t\t\t$.set(script, {\n\t\t\t\tasync: true,\n\t\t\t\tonload: function() {\n\t\t\t\t\tresolve();\n\t\t\t\t\t$.remove(script);\n\t\t\t\t},\n\t\t\t\tonerror: function() {\n\t\t\t\t\treject();\n\t\t\t\t},\n\t\t\t\tsrc: url,\n\t\t\t\tinside: document.head\n\t\t\t});\n\t\t});\n\n\t},\n\n\t/*\n\t * Fetch API inspired XHR wrapper. Returns promise.\n\t */\n\tfetch: function(url, o) {\n\t\tif (!url) {\n\t\t\tthrow new TypeError(\"URL parameter is mandatory and cannot be \" + url);\n\t\t}\n\n\t\t// Set defaults & fixup arguments\n\t\tvar env = extend({\n\t\t\turl: new URL(url, location),\n\t\t\tdata: \"\",\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {},\n\t\t\txhr: new XMLHttpRequest()\n\t\t}, o);\n\n\t\tenv.method = env.method.toUpperCase();\n\n\t\t$.hooks.run(\"fetch-args\", env);\n\n\t\t// Start sending the request\n\n\t\tif (env.method === \"GET\" && env.data) {\n\t\t\tenv.url.search += env.data;\n\t\t}\n\n\t\tdocument.body.setAttribute(\"data-loading\", env.url);\n\n\t\tenv.xhr.open(env.method, env.url.href, env.async !== false, env.user, env.password);\n\n\t\tfor (var property in o) {\n\t\t\tif (property in env.xhr) {\n\t\t\t\ttry {\n\t\t\t\t\tenv.xhr[property] = o[property];\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tself.console && console.error(e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (env.method !== \"GET\" && !env.headers[\"Content-type\"] && !env.headers[\"Content-Type\"]) {\n\t\t\tenv.xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\t\t}\n\n\t\tfor (var header in env.headers) {\n\t\t\tenv.xhr.setRequestHeader(header, env.headers[header]);\n\t\t}\n\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tenv.xhr.onload = function() {\n\t\t\t\tdocument.body.removeAttribute(\"data-loading\");\n\n\t\t\t\tif (env.xhr.status === 0 || env.xhr.status >= 200 && env.xhr.status < 300 || env.xhr.status === 304) {\n\t\t\t\t\t// Success!\n\t\t\t\t\tresolve(env.xhr);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treject($.extend(Error(env.xhr.statusText), {\n\t\t\t\t\t\txhr: env.xhr,\n\t\t\t\t\t\tget status() {\n\t\t\t\t\t\t\treturn this.xhr.status;\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tenv.xhr.onerror = function() {\n\t\t\t\tdocument.body.removeAttribute(\"data-loading\");\n\t\t\t\treject($.extend(Error(\"Network Error\"), {xhr: env.xhr}));\n\t\t\t};\n\n\t\t\tenv.xhr.ontimeout = function() {\n\t\t\t    document.body.removeAttribute(\"data-loading\");\n\t\t\t    reject($.extend(Error(\"Network Timeout\"), {xhr: env.xhr}));\n\t\t\t};\n\n\t\t\tenv.xhr.send(env.method === \"GET\"? null : env.data);\n\t\t});\n\t},\n\n\tvalue: function(obj) {\n\t\tvar hasRoot = $.type(obj) !== \"string\";\n\n\t\treturn $.$(arguments).slice(+hasRoot).reduce(function(obj, property) {\n\t        return obj && obj[property];\n\t    }, hasRoot? obj : self);\n\t}\n});\n\n$.Hooks = new $.Class({\n\tadd: function (name, callback, first) {\n\t\t(Array.isArray(name)? name : [name]).forEach(function(name) {\n\t\t\tthis[name] = this[name] || [];\n\t\t\tthis[name][first? \"unshift\" : \"push\"](callback);\n\t\t}, this);\n\t},\n\n\trun: function (name, env) {\n\t\tthis[name] = this[name] || [];\n\t\tthis[name].forEach(function(callback) {\n\t\t\tcallback.call(env && env.context? env.context : env, env);\n\t\t});\n\t}\n});\n\n$.hooks = new $.Hooks();\n\nvar _ = $.property;\n\n$.Element = function (subject) {\n\tthis.subject = subject;\n\n\t// Author-defined element-related data\n\tthis.data = {};\n\n\t// Internal Bliss element-related data\n\tthis.bliss = {};\n};\n\n$.Element.prototype = {\n\tset: overload(function(property, value) {\n\n\t\tif (property in $.setProps) {\n\t\t\t$.setProps[property].call(this, value);\n\t\t}\n\t\telse if (property in this) {\n\t\t\tthis[property] = value;\n\t\t}\n\t\telse {\n\t\t\tthis.setAttribute(property, value);\n\t\t}\n\n\t}, 0),\n\n\t// Run a CSS transition, return promise\n\ttransition: function(props, duration) {\n\t\tduration = +duration || 400;\n\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tif (\"transition\" in this.style) {\n\t\t\t\t// Get existing style\n\t\t\t\tvar previous = $.extend({}, this.style, /^transition(Duration|Property)$/);\n\n\t\t\t\t$.style(this, {\n\t\t\t\t\ttransitionDuration: (duration || 400) + \"ms\",\n\t\t\t\t\ttransitionProperty: Object.keys(props).join(\", \")\n\t\t\t\t});\n\n\t\t\t\t$.once(this, \"transitionend\", function() {\n\t\t\t\t\tclearTimeout(i);\n\t\t\t\t\t$.style(this, previous);\n\t\t\t\t\tresolve(this);\n\t\t\t\t});\n\n\t\t\t\t// Failsafe, in case transitionend doesn’t fire\n\t\t\t\tvar i = setTimeout(resolve, duration+50, this);\n\n\t\t\t\t$.style(this, props);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$.style(this, props);\n\t\t\t\tresolve(this);\n\t\t\t}\n\t\t}.bind(this));\n\t},\n\n\t// Fire a synthesized event on the element\n\tfire: function (type, properties) {\n\t\tvar evt = document.createEvent(\"HTMLEvents\");\n\n\t\tevt.initEvent(type, true, true );\n\n\t\t// Return the result of dispatching the event, so we\n\t\t// can know if `e.preventDefault` was called inside it\n\t\treturn this.dispatchEvent($.extend(evt, properties));\n\t},\n\n\tunbind: overload(function(events, callback) {\n\t\t(events || \"\").split(/\\s+/).forEach(function (type) {\n\t\t\tif ((_ in this) && (type.indexOf(\".\") > -1 || !callback)) {\n\t\t\t\t// Mass unbinding, need to go through listeners\n\t\t\t\ttype = (type || \"\").split(\".\");\n\t\t\t\tvar className = type[1];\n\t\t\t\ttype = type[0];\n\t\t\t\t// man, can’t wait to be able to do [type, className] = type.split(\".\");\n\n\t\t\t\tvar listeners = this[_].bliss.listeners = this[_].bliss.listeners || {};\n\n\t\t\t\tfor (var ltype in listeners) {\n\t\t\t\t\tif (!type || ltype === type) {\n\t\t\t\t\t\t// No forEach, because we’re mutating the array\n\t\t\t\t\t\tfor (var i=0, l; l=listeners[ltype][i]; i++) {\n\t\t\t\t\t\t\tif ((!className || className === l.className) &&\n\t\t\t\t\t\t\t    (!callback || callback === l.callback )) { // TODO what about capture?\n\t\t\t\t\t\t\t\tthis.removeEventListener(ltype, l.callback, l.capture);\n\t\t\t\t\t\t\t\ti--;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Normal event unbinding, defer to native JS\n\t\t\t\tthis.removeEventListener(type, callback);\n\t\t\t}\n\t\t}, this);\n\t}, 0)\n};\n\n/*\n * Properties with custom handling in $.set()\n * Also available as functions directly on element._ and on $\n */\n$.setProps = {\n\t// Set a bunch of inline CSS styles\n\tstyle: function (val) {\n\t\t$.extend(this.style, val);\n\t},\n\n\t// Set a bunch of attributes\n\tattributes: function (o) {\n\t\tfor (var attribute in o) {\n\t\t\tthis.setAttribute(attribute, o[attribute]);\n\t\t}\n\t},\n\n\t// Set a bunch of properties on the element\n\tproperties: function (val) {\n\t\t$.extend(this, val);\n\t},\n\n\t// Bind one or more events to the element\n\tevents: function (val) {\n\t\tif (val && val.addEventListener) {\n\t\t\t// Copy events from other element (requires Bliss Full)\n\t\t\tvar me = this;\n\n\t\t\t// Copy listeners\n\t\t\tif (val[_] && val[_].bliss) {\n\t\t\t\tvar listeners = val[_].bliss.listeners;\n\n\t\t\t\tfor (var type in listeners) {\n\t\t\t\t\tlisteners[type].forEach(function(l) {\n\t\t\t\t\t\tme.addEventListener(type, l.callback, l.capture);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Copy inline events\n\t\t\tfor (var onevent in val) {\n\t\t\t\tif (onevent.indexOf(\"on\") === 0) {\n\t\t\t\t\tthis[onevent] = val[onevent];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (arguments.length > 1 && $.type(val) === \"string\") {\n\t\t\tvar callback = arguments[1], capture = arguments[2];\n\n\t\t\tval.split(/\\s+/).forEach(function (event) {\n\t\t\t\tthis.addEventListener(event, callback, capture);\n\t\t\t}, this);\n\t\t}\n\t\telse {\n\t\t\tfor (var events in val) {\n\t\t\t\t$.events(this, events, val[events]);\n\t\t\t}\n\t\t}\n\t},\n\n\tonce: overload(function(events, callback) {\n\t\tevents = events.split(/\\s+/);\n\t\tvar me = this;\n\t\tvar once = function() {\n\t\t\tevents.forEach(function(event) {\n\t\t\t\tme.removeEventListener(event, once);\n\t\t\t});\n\n\t\t\treturn callback.apply(me, arguments);\n\t\t};\n\n\t\tevents.forEach(function (event) {\n\t\t\tme.addEventListener(event, once);\n\t\t});\n\t}, 0),\n\n\t// Event delegation\n\tdelegate: overload(function (type, selector, callback) {\n\t\tthis.addEventListener(type, function(evt) {\n\t\t\tif (evt.target.closest(selector)) {\n\t\t\t\tcallback.call(this, evt);\n\t\t\t}\n\t\t});\n\t}, 0, 2),\n\n\t// Set the contents as a string, an element, an object to create an element or an array of these\n\tcontents: function (val) {\n\t\tif (val || val === 0) {\n\t\t\t(Array.isArray(val)? val : [val]).forEach(function (child) {\n\t\t\t\tvar type = $.type(child);\n\n\t\t\t\tif (/^(string|number)$/.test(type)) {\n\t\t\t\t\tchild = document.createTextNode(child + \"\");\n\t\t\t\t}\n\t\t\t\telse if (type === \"object\") {\n\t\t\t\t\tchild = $.create(child);\n\t\t\t\t}\n\n\t\t\t\tif (child instanceof Node) {\n\t\t\t\t\tthis.appendChild(child);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\t},\n\n\t// Append the element inside another element\n\tinside: function (element) {\n\t\telement.appendChild(this);\n\t},\n\n\t// Insert the element before another element\n\tbefore: function (element) {\n\t\telement.parentNode.insertBefore(this, element);\n\t},\n\n\t// Insert the element after another element\n\tafter: function (element) {\n\t\telement.parentNode.insertBefore(this, element.nextSibling);\n\t},\n\n\t// Insert the element before another element's contents\n\tstart: function (element) {\n\t\telement.insertBefore(this, element.firstChild);\n\t},\n\n\t// Wrap the element around another element\n\taround: function (element) {\n\t\tif (element.parentNode) {\n\t\t\t$.before(this, element);\n\t\t}\n\n\t\t(/^template$/i.test(this.nodeName)? this.content || this : this).appendChild(element);\n\t}\n};\n\n$.Array = function (subject) {\n\tthis.subject = subject;\n};\n\n$.Array.prototype = {\n\tall: function(method) {\n\t\tvar args = $$(arguments).slice(1);\n\n\t\treturn this[method].apply(this, args);\n\t}\n};\n\n// Extends Bliss with more methods\n$.add = overload(function(method, callback, on, noOverwrite) {\n\ton = $.extend({$: true, element: true, array: true}, on);\n\n\tif ($.type(callback) == \"function\") {\n\t\tif (on.element && (!(method in $.Element.prototype) || !noOverwrite)) {\n\t\t\t$.Element.prototype[method] = function () {\n\t\t\t\treturn this.subject && $.defined(callback.apply(this.subject, arguments), this.subject);\n\t\t\t};\n\t\t}\n\n\t\tif (on.array && (!(method in $.Array.prototype) || !noOverwrite)) {\n\t\t\t$.Array.prototype[method] = function() {\n\t\t\t\tvar args = arguments;\n\t\t\t\treturn this.subject.map(function(element) {\n\t\t\t\t\treturn element && $.defined(callback.apply(element, args), element);\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tif (on.$) {\n\t\t\t$.sources[method] = $[method] = callback;\n\n\t\t\tif (on.array || on.element) {\n\t\t\t\t$[method] = function () {\n\t\t\t\t\tvar args = [].slice.apply(arguments);\n\t\t\t\t\tvar subject = args.shift();\n\t\t\t\t\tvar Type = on.array && Array.isArray(subject)? \"Array\" : \"Element\";\n\n\t\t\t\t\treturn $[Type].prototype[method].apply({subject: subject}, args);\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n}, 0);\n\n$.add($.Array.prototype, {element: false});\n$.add($.Element.prototype);\n$.add($.setProps);\n$.add($.classProps, {element: false, array: false});\n\n// Add native methods on $ and _\nvar dummy = document.createElement(\"_\");\n$.add($.extend({}, HTMLElement.prototype, function(method) {\n\treturn $.type(dummy[method]) === \"function\";\n}), null, true);\n\n\n})();\n\n(function($) {\n\"use strict\";\n\nif (!Bliss || Bliss.shy) {\n\treturn;\n}\n\nvar _ = Bliss.property;\n\n// Methods requiring Bliss Full\n$.add({\n\t// Clone elements, with events and data\n\tclone: function () {\n\t\tvar clone = this.cloneNode(true);\n\t\tvar descendants = $.$(\"*\", clone).concat(clone);\n\n\t\t$.$(\"*\", this).concat(this).forEach(function(element, i, arr) {\n\t\t\t$.events(descendants[i], element);\n\t\t\tdescendants[i]._.data = $.extend({}, element._.data);\n\t\t});\n\n\t\treturn clone;\n\t}\n}, {array: false});\n\n// Define the _ property on arrays and elements\n\nObject.defineProperty(Node.prototype, _, {\n\t// Written for IE compatability (see #49)\n\tget: function getter () {\n\t\tObject.defineProperty(Node.prototype, _, {\n\t\t\tget: undefined\n\t\t});\n\t\tObject.defineProperty(this, _, {\n\t\t\tvalue: new $.Element(this)\n\t\t});\n\t\tObject.defineProperty(Node.prototype, _, {\n\t\t\tget: getter\n\t\t});\n\t\treturn this[_];\n\t},\n\tconfigurable: true\n});\n\nObject.defineProperty(Array.prototype, _, {\n\tget: function () {\n\t\tObject.defineProperty(this, _, {\n\t\t\tvalue: new $.Array(this)\n\t\t});\n\n\t\treturn this[_];\n\t},\n\tconfigurable: true\n});\n\n// Hijack addEventListener and removeEventListener to store callbacks\n\nif (self.EventTarget && \"addEventListener\" in EventTarget.prototype) {\n\tvar addEventListener = EventTarget.prototype.addEventListener,\n\t    removeEventListener = EventTarget.prototype.removeEventListener,\n\t    equal = function(callback, capture, l) {\n\t\t\treturn l.callback === callback && l.capture == capture;\n\t    },\n\t    notEqual = function() { \n\t\t\treturn !equal.apply(this, arguments); \n\t\t};\n\n\tEventTarget.prototype.addEventListener = function(type, callback, capture) {\n\t\tif (this && this[_] && this[_].bliss && callback) {\n\t\t\tvar listeners = this[_].bliss.listeners = this[_].bliss.listeners || {};\n\n\t\t\tif (type.indexOf(\".\") > -1) {\n\t\t\t\ttype = type.split(\".\");\n\t\t\t\tvar className = type[1];\n\t\t\t\ttype = type[0];\n\t\t\t}\n\n\t\t\tlisteners[type] = listeners[type] || [];\n\n\t\t\tif (listeners[type].filter(equal.bind(null, callback, capture)).length === 0) {\n\t\t\t\tlisteners[type].push({callback: callback, capture: capture, className: className});\n\t\t\t}\n\t\t}\n\n\t\treturn addEventListener.call(this, type, callback, capture);\n\t};\n\n\tEventTarget.prototype.removeEventListener = function(type, callback, capture) {\n\t\tif (this && this[_] && this[_].bliss  && callback) {\n\t\t\tvar listeners = this[_].bliss.listeners = this[_].bliss.listeners || {};\n\n\t\t\tif (listeners[type]) {\n\t\t\t\tlisteners[type] = listeners[type].filter(notEqual.bind(null, callback, capture));\n\t\t\t}\n\t\t}\n\n\t\treturn removeEventListener.call(this, type, callback, capture);\n\t};\n}\n\n// Set $ and $$ convenience methods, if not taken\nself.$ = self.$ || $;\nself.$$ = self.$$ || $.$;\n\n})(Bliss);\n\n(function ($, $$) {\n\n\"use strict\";\n\nvar _ = self.Mavo = $.Class({\n\tconstructor: function (element) {\n\t\t// Index among other mavos in the page, 1 is first\n\t\tthis.index = _.all.push(this);\n\n\t\t// Assign a unique (for the page) id to this mavo instance\n\t\tthis.id = element.getAttribute(\"data-mavo\") || Mavo.Node.getProperty(element) || element.id || `mavo${this.index}`;\n\n\t\tif (this.index == 1) {\n\t\t\tthis.store = _.urlParam(\"store\");\n\t\t\tthis.source = _.urlParam(\"source\");\n\t\t}\n\n\t\tthis.store = this.store || _.urlParam(`${this.id}_store`) || element.getAttribute(\"data-store\") || null;\n\t\tthis.source = this.source || _.urlParam(`${this.id}_source`) || element.getAttribute(\"data-source\") || null;\n\n\t\tthis.autoEdit = _.has(\"autoedit\", element);\n\n\t\tthis.element = _.is(\"scope\", element)? element : $(_.selectors.rootScope, element);\n\n\t\tif (!this.element) {\n\t\t\telement.setAttribute(\"typeof\", element.getAttribute(\"property\") || \"\");\n\t\t\telement.removeAttribute(\"property\");\n\t\t\tthis.element = element;\n\t\t}\n\n\t\tthis.element.classList.add(\"mv-root\");\n\n\t\t// Apply heuristic for collections\n\t\t$$(_.selectors.property + \", \" + _.selectors.scope).concat([this.element]).forEach(element => {\n\t\t\tif (_.is(\"autoMultiple\", element) && !element.hasAttribute(\"data-multiple\")) {\n\t\t\t\telement.setAttribute(\"data-multiple\", \"\");\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper = element.closest(\".mv-wrapper\") || element;\n\n\t\t// Ctrl + S or Cmd + S to save\n\t\tthis.wrapper.addEventListener(\"keydown\", evt => {\n\t\t\tif (evt.keyCode == 83 && evt[_.superKey]) {\n\t\t\t\tevt.preventDefault();\n\t\t\t\tthis.save();\n\t\t\t}\n\t\t});\n\n\t\t// Apply heuristic for scopes\n\t\t$$(_.selectors.primitive).forEach(element => {\n\t\t\tvar isScope = $(Mavo.selectors.property, element) && (// Contains other properties and...\n\t\t\t                Mavo.is(\"multiple\", element) || // is a collection...\n\t\t\t                Mavo.Primitive.getValueAttribute(element) === null  // ...or its content is not in an attribute\n\t\t\t\t\t\t) || element.matches(\"template\");\n\n\t\t\tif (isScope) {\n\t\t\t\telement.setAttribute(\"typeof\", \"\");\n\t\t\t}\n\t\t});\n\n\t\tif (this.wrapper === this.element && _.is(\"multiple\", element)) {\n\t\t\t// Need to create a wrapper\n\t\t\tvar around = this.element;\n\n\t\t\t// Avoid producing invalid HTML\n\t\t\tif (this.element.matches(\"li, option\")) {\n\t\t\t\taround = around.parentNode;\n\t\t\t}\n\t\t\telse if (this.element.matches(\"td, tr, tbody, thead, tfoot\")) {\n\t\t\t\taround = around.closest(\"table\");\n\t\t\t}\n\n\t\t\tthis.wrapper = $.create({ around });\n\t\t}\n\n\t\tthis.wrapper.classList.add(\"mv-wrapper\");\n\n\t\tthis.ui = {\n\t\t\tbar: $(\".mv-bar\", this.wrapper) || $.create({\n\t\t\t\tclassName: \"mv-bar mv-ui\",\n\t\t\t\tstart: this.wrapper\n\t\t\t})\n\t\t};\n\n\t\tthis.ui.status = $(\".status\", this.ui.bar) || $.create(\"span\", {\n\t\t\tclassName: \"status\",\n\t\t\tinside: this.ui.bar\n\t\t});\n\n\t\t// Normalize property names\n\t\tthis.propertyNames = [];\n\n\t\t// Is there any control that requires an edit button?\n\t\tthis.needsEdit = false;\n\n\t\t// Build mavo objects\n\t\tMavo.hooks.run(\"init-tree-before\", this);\n\n\t\tthis.root = Mavo.Node.create(this.element, this);\n\t\tthis.propertyNames = this.propertyNames.sort((a, b) => b.length - a.length);\n\n\t\tMavo.hooks.run(\"init-tree-after\", this);\n\n\t\tthis.setUnsavedChanges(false);\n\n\t\tthis.permissions = new Mavo.Permissions(null, this);\n\n\t\t_.observe(this.wrapper, \"class\", () => {\n\t\t\tvar p = this.permissions;\n\t\t\tvar floating = !this.editing && (p.login || p.edit && !p.login && !(p.save && this.unsavedChanges));\n\t\t\tthis.ui.bar.classList.toggle(\"floating\", floating);\n\t\t});\n\n\t\tthis.permissions.onchange(({action, value}) => {\n\t\t\tthis.wrapper.classList.toggle(`can-${action}`, value);\n\t\t});\n\n\t\tthis.permissions.can([\"edit\", \"add\", \"delete\"], () => {\n\t\t\tthis.ui.edit = $.create(\"button\", {\n\t\t\t\tclassName: \"edit\",\n\t\t\t\ttextContent: \"Edit\",\n\t\t\t\tonclick: e => this.editing? this.done() : this.edit(),\n\t\t\t\tinside: this.ui.bar\n\t\t\t});\n\n\t\t\tif (this.autoEdit) {\n\t\t\t\trequestAnimationFrame(() => this.ui.edit.click());\n\t\t\t}\n\t\t}, () => { // cannot\n\t\t\t$.remove(this.ui.edit);\n\n\t\t\tif (this.editing) {\n\t\t\t\tthis.done();\n\t\t\t}\n\t\t});\n\n\t\tif (this.needsEdit) {\n\t\t\tthis.permissions.can(\"save\", () => {\n\t\t\t\tthis.ui.save = $.create(\"button\", {\n\t\t\t\t\tclassName: \"save\",\n\t\t\t\t\ttextContent: \"Save\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: e => this.save(),\n\t\t\t\t\t\t\"mouseenter focus\": e => {\n\t\t\t\t\t\t\tthis.wrapper.classList.add(\"save-hovered\");\n\t\t\t\t\t\t\tthis.setUnsavedChanges();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"mouseleave blur\": e => this.wrapper.classList.remove(\"save-hovered\")\n\t\t\t\t\t},\n\t\t\t\t\tinside: this.ui.bar\n\t\t\t\t});\n\n\t\t\t\tthis.ui.revert = $.create(\"button\", {\n\t\t\t\t\tclassName: \"revert\",\n\t\t\t\t\ttextContent: \"Revert\",\n\t\t\t\t\tdisabled: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: e => this.revert(),\n\t\t\t\t\t\t\"mouseenter focus\": e => {\n\t\t\t\t\t\t\tif (!this.unsavedChanges) {\n\t\t\t\t\t\t\t\tthis.wrapper.classList.add(\"revert-hovered\");\n\t\t\t\t\t\t\t\tthis.setUnsavedChanges();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"mouseleave blur\": e => this.wrapper.classList.remove(\"revert-hovered\")\n\t\t\t\t\t},\n\t\t\t\t\tinside: this.ui.bar\n\t\t\t\t});\n\t\t\t}, () => {\n\t\t\t\t$.remove([this.ui.save, this.ui.revert]);\n\t\t\t\tthis.ui.save = this.ui.revert = null;\n\t\t\t});\n\t\t}\n\n\t\tthis.permissions.can(\"delete\", () => {\n\t\t\tthis.ui.clear = $.create(\"button\", {\n\t\t\t\tclassName: \"clear\",\n\t\t\t\ttextContent: \"Clear\",\n\t\t\t\tonclick: e => this.clear()\n\t\t\t});\n\n\t\t\tthis.ui.bar.appendChild(this.ui.clear);\n\t\t});\n\n\t\tthis.permissions.cannot([\"delete\", \"edit\"], () => {\n\t\t\t$.remove(this.ui.clear);\n\t\t});\n\n\t\tif (this.store || this.source) {\n\t\t\t// Fetch existing data\n\t\t\tthis.storage = new _.Storage(this);\n\n\t\t\tthis.permissions.can(\"read\", () => this.storage.load());\n\t\t}\n\t\telse {\n\t\t\t// No storage\n\t\t\tthis.permissions.on([\"read\", \"edit\"]);\n\n\t\t\t$.fire(this.wrapper, \"mavo:load\");\n\t\t}\n\n\t\tif (!this.needsEdit) {\n\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\"]);\n\t\t}\n\n\t\tMavo.hooks.run(\"init-end\", this);\n\t},\n\n\tget data() {\n\t\treturn this.getData();\n\t},\n\n\tgetData: function(o) {\n\t\treturn this.root.getData(o);\n\t},\n\n\ttoJSON: function(data = this.data) {\n\t\treturn _.toJSON(data);\n\t},\n\n\trender: function(data) {\n\t\t_.hooks.run(\"render-start\", {context: this, data});\n\n\t\tif (data) {\n\t\t\tthis.root.render(data);\n\t\t}\n\n\t\tthis.unsavedChanges = false;\n\t},\n\n\tclear: function() {\n\t\tif (confirm(\"This will delete all your data. Are you sure?\")) {\n\t\t\tthis.storage && this.storage.clear();\n\t\t\tthis.root.clear();\n\t\t}\n\t},\n\n\tedit: function() {\n\t\tthis.editing = true;\n\n\t\tthis.root.edit();\n\n\t\t$.events(this.wrapper, \"mouseenter.mavo:edit mouseleave.mavo:edit\", evt => {\n\t\t\tif (evt.target.matches(\".mv-item-controls .delete\")) {\n\t\t\t\tvar item = evt.target.closest(_.selectors.item);\n\t\t\t\titem.classList.toggle(\"delete-hover\", evt.type == \"mouseenter\");\n\t\t\t}\n\n\t\t\tif (evt.target.matches(_.selectors.item)) {\n\t\t\t\tevt.target.classList.remove(\"has-hovered-item\");\n\n\t\t\t\tvar parent = evt.target.parentNode.closest(_.selectors.item);\n\n\t\t\t\tif (parent) {\n\t\t\t\t\tparent.classList.toggle(\"has-hovered-item\", evt.type == \"mouseenter\");\n\t\t\t\t}\n\t\t\t}\n\t\t}, true);\n\n\t\tthis.setUnsavedChanges();\n\t},\n\n\tsetUnsavedChanges: function(value) {\n\t\tvar unsavedChanges = !!value;\n\n\t\tif (!value) {\n\t\t\tthis.walk(obj => {\n\t\t\t\tif (obj.unsavedChanges) {\n\t\t\t\t\tunsavedChanges = true;\n\n\t\t\t\t\tif (value === false) {\n\t\t\t\t\t\tobj.unsavedChanges = false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this.unsavedChanges = unsavedChanges;\n\t},\n\n\t// Conclude editing\n\tdone: function() {\n\t\tthis.root.done();\n\t\t$.unbind(this.wrapper, \".mavo:edit\");\n\t\tthis.editing = false;\n\t\tthis.unsavedChanges = false;\n\t},\n\n\tsave: function() {\n\t\tthis.root.save();\n\n\t\tif (this.storage) {\n\t\t\tthis.storage.save();\n\t\t}\n\n\t\tthis.unsavedChanges = false;\n\t},\n\n\trevert: function() {\n\t\tthis.root.revert();\n\t},\n\n\twalk: function(callback) {\n\t\tthis.root.walk(callback);\n\t},\n\n\tlive: {\n\t\tediting: {\n\t\t\tset: function(value) {\n\t\t\t\tthis.wrapper.classList.toggle(\"editing\", value);\n\n\t\t\t\tif (value) {\n\t\t\t\t\tthis.wrapper.setAttribute(\"data-editing\", \"\");\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.wrapper.removeAttribute(\"data-editing\");\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tunsavedChanges: function(value) {\n\t\t\tthis.wrapper.classList.toggle(\"unsaved-changes\", value);\n\n\t\t\tif (this.ui && this.ui.save) {\n\t\t\t\tthis.ui.save.disabled = !value;\n\t\t\t\tthis.ui.revert.disabled = !value;\n\t\t\t}\n\t\t},\n\n\t\tneedsEdit: function(value) {\n\t\t\tthis.ui.bar[`${value? \"remove\" : \"set\"}Attribute`](\"hidden\", \"\");\n\t\t}\n\t},\n\n\tstatic: {\n\t\tall: [],\n\n\t\tsuperKey: navigator.platform.indexOf(\"Mac\") === 0? \"metaKey\" : \"ctrlKey\",\n\n\t\tinit: container => $$(_.selectors.init, container).map(element => new _(element)),\n\n\t\thooks: new $.Hooks()\n\t}\n});\n\n{\n\nlet s = _.selectors = {\n\tinit: \".mavo, [mavo], [data-mavo], [data-store]\",\n\tproperty: \"[property], [itemprop]\",\n\tspecificProperty: name => `[property=${name}], [itemprop=${name}]`,\n\tscope: \"[typeof], [itemscope], [itemtype], .mv-group\",\n\tmultiple: \"[multiple], [data-multiple], .multiple\",\n\trequired: \"[required], [data-required], .required\",\n\tformControl: \"input, select, textarea\",\n\tcomputed: \".computed\", // Properties or scopes with computed properties, will not be saved\n\titem: \".mv-item\",\n\tui: \".mv-ui\",\n\toption: name => `[${name}], [data-${name}], [data-mv-options~='${name}'], .${name}`,\n\tcontainer: {\n\t\t\"li\": \"ul, ol\",\n\t\t\"tr\": \"table\",\n\t\t\"option\": \"select\",\n\t\t\"dt\": \"dl\",\n\t\t\"dd\": \"dl\"\n\t},\n\tdocumentFragment: \".document-fragment\"\n};\n\nlet arr = s.arr = selector => selector.split(/\\s*,\\s*/g);\nlet not = s.not = selector => arr(selector).map(s => `:not(${s})`).join(\"\");\nlet or = s.or = (selector1, selector2) => selector1 + \", \" + selector2;\nlet and = s.and = (selector1, selector2) => {\n\tvar ret = [], arr2 = arr(selector2);\n\n\tarr(selector1).forEach(s1 => ret.push(...arr2.map(s2 => s1 + s2)));\n\n\treturn ret.join(\", \");\n};\nlet andNot = s.andNot = (selector1, selector2) => and(selector1, not(selector2));\n\n$.extend(_.selectors, {\n\tprimitive: andNot(s.property, s.scope),\n\trootScope: andNot(s.scope, s.property),\n\toutput: or(s.specificProperty(\"output\"), \".output, .value\"),\n\tautoMultiple: and(\"li, tr, option\", \":only-of-type\")\n});\n\n}\n\n// Init mavo\nPromise.all([\n\t$.ready(),\n\t$.include(Array.from && window.Intl && document.documentElement.closest, \"https://cdn.polyfill.io/v2/polyfill.min.js?features=blissfuljs,Intl.~locale.en\")\n])\n.catch(err => console.error(err))\n.then(() => Mavo.init());\n\nStretchy.selectors.filter = \".mv-editor:not([property])\";\n\n})(Bliss, Bliss.$);\n\n(function ($, $$) {\n\nvar _ = $.extend(Mavo, {\n\ttoJSON: data => {\n\t\tif (data === null) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tif (typeof data === \"string\") {\n\t\t\t// Do not stringify twice!\n\t\t\treturn data;\n\t\t}\n\n\t\treturn JSON.stringify(data, null, \"\\t\");\n\t},\n\n\t// Convert an identifier to readable text that can be used as a label\n\treadable: function (identifier) {\n\t\t// Is it camelCase?\n\t\treturn identifier && identifier\n\t\t\t\t .replace(/([a-z])([A-Z])(?=[a-z])/g, ($0, $1, $2) => $1 + \" \" + $2.toLowerCase()) // camelCase?\n\t\t\t\t .replace(/([a-z])[_\\/-](?=[a-z])/g, \"$1 \") // Hyphen-separated / Underscore_separated?\n\t\t\t\t .replace(/^[a-z]/, $0 => $0.toUpperCase()); // Capitalize\n\t},\n\n\t// Inverse of _.readable(): Take a readable string and turn it into an identifier\n\tidentifier: function (readable) {\n\t\treadable = readable + \"\";\n\t\treturn readable && readable\n\t\t\t\t .replace(/\\s+/g, \"-\") // Convert whitespace to hyphens\n\t\t\t\t .replace(/[^\\w-]/g, \"\") // Remove weird characters\n\t\t\t\t .toLowerCase();\n\t},\n\n\tqueryJSON: function(data, path) {\n\t\tif (!path || !data) {\n\t\t\treturn data;\n\t\t}\n\n\t\treturn $.value.apply($, [data].concat(path.split(\"/\")));\n\t},\n\n\tobserve: function(element, attribute, observer, oldValue) {\n\t\tif (!(observer instanceof MutationObserver)) {\n\t\t\tobserver = new MutationObserver(observer);\n\t\t}\n\n\t\tvar options = attribute? {\n\t\t\t\tattributes: true,\n\t\t\t\tattributeFilter: [attribute],\n\t\t\t\tattributeOldValue: !!oldValue\n\t\t\t} : {\n\t\t\t\tcharacterData: true,\n\t\t\t\tchildList: true,\n\t\t\t\tsubtree: true,\n\t\t\t\tcharacterDataOldValue: !!oldValue\n\t\t\t};\n\n\t\tobserver.observe(element, options);\n\n\t\treturn observer;\n\t},\n\n\t// If the passed value is not an array, convert to an array\n\ttoArray: arr => {\n\t\treturn Array.isArray(arr)? arr : [arr];\n\t},\n\n\t// Recursively flatten a multi-dimensional array\n\tflatten: arr => {\n\t\tif (!Array.isArray(arr)) {\n\t\t\treturn [arr];\n\t\t}\n\n\t\treturn arr.reduce((prev, c) => _.toArray(prev).concat(_.flatten(c)), []);\n\t},\n\n\tis: function(thing, element) {\n\t\treturn element.matches && element.matches(_.selectors[thing]);\n\t},\n\n\thas: function(option, element) {\n\t\treturn element.matches && element.matches(_.selectors.option(option));\n\t},\n\n\turlParam: function(...names) {\n\t\tvar searchParams = \"searchParams\" in URL.prototype? new URL(location).searchParams : null;\n\t\tvar value = null;\n\n\t\tfor (let name of names) {\n\t\t\tif (searchParams) {\n\t\t\t\tvalue = searchParams.get(name);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar match = location.search.match(RegExp(`[?&]${name}(?:=([^&]+))?(?=&|$)`, \"i\"));\n\t\t\t\tvalue = match && (match[1] || \"\");\n\t\t\t}\n\n\t\t\tif (value !== null) {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n});\n\n// Bliss plugins\n\n// Provide shortcuts to long property chains\n$.proxy = $.classProps.proxy = $.overload(function(obj, property, proxy) {\n\tObject.defineProperty(obj, property, {\n\t\tget: function() {\n\t\t\treturn this[proxy][property];\n\t\t},\n\t\tset: function(value) {\n\t\t\tthis[proxy][property] = value;\n\t\t},\n\t\tconfigurable: true,\n\t\tenumerable: true\n\t});\n\n\treturn obj;\n});\n\n$.classProps.propagated = function(proto, names) {\n\tMavo.toArray(names).forEach(name => {\n\t\tvar existing = proto[name];\n\n\t\tproto[name] = function() {\n\t\t\tvar ret = existing && existing.apply(this, arguments);\n\n\t\t\tif (this.propagate && ret !== false) {\n\t\t\t\tthis.propagate(name);\n\t\t\t}\n\t\t};\n\t});\n};\n\n// :focus-within shim\ndocument.addEventListener(\"focus\", evt => {\n\t$$(\".focus-within\").forEach(el => el.classList.remove(\"focus-within\"));\n\n\tvar element = evt.target;\n\n\twhile (element = element.parentNode) {\n\t\tif (element.classList) {\n\t\t\telement.classList.add(\"focus-within\");\n\t\t}\n\t}\n}, true);\n\n})(Bliss, Bliss.$);\n\n(function($) {\n\nvar _ = Mavo.Permissions = $.Class({\n\tconstructor: function(o) {\n\t\tthis.triggers = [];\n\n\t\tthis.set(o);\n\n\t\tthis.hooks = new $.Hooks();\n\t},\n\n\t// Set multiple permissions at once\n\tset: function(o) {\n\t\tfor (var action in o) {\n\t\t\tthis[action] = o[action];\n\t\t}\n\t},\n\n\t// Set a bunch of permissions to true. Chainable.\n\ton: function(actions) {\n\t\tMavo.toArray(actions).forEach(action => this[action] = true);\n\n\t\treturn this;\n\t},\n\n\t// Set a bunch of permissions to false. Chainable.\n\toff: function(actions) {\n\t\tactions = Array.isArray(actions)? actions : [actions];\n\n\t\tactions.forEach(action => this[action] = false);\n\n\t\treturn this;\n\t},\n\n\t// Fired once at least one of the actions passed can be performed\n\t// Kind of like a Promise that can be resolved multiple times.\n\tcan: function(actions, callback, cannot) {\n\t\tthis.observe(actions, true, callback);\n\n\t\tif (cannot) {\n\t\t\t// Fired once the action cannot be done anymore, even though it could be done before\n\t\t\tthis.cannot(actions, cannot);\n\t\t}\n\t},\n\n\t// Fired once NONE of the actions can be performed\n\tcannot: function(actions, callback) {\n\t\tthis.observe(actions, false, callback);\n\t},\n\n\t// Like this.can(), but returns a promise\n\t// Useful for things that you want to do only once\n\twhen: function(actions) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.can(actions, resolve, reject);\n\t\t});\n\t},\n\n\t// Schedule a callback for when a set of permissions changes value\n\tobserve: function(actions, value, callback) {\n\t\tactions = Mavo.toArray(actions);\n\n\t\tif (this.is(actions, value)) {\n\t\t\t// Should be fired immediately\n\t\t\tcallback();\n\t\t}\n\n\t\t// For future transitions\n\t\tthis.triggers.push({ actions, value, callback, active: true });\n\t},\n\n\t// Compare a set of permissions with true or false\n\t// If comparing with true, we want at least one to be true, i.e. OR\n\t// If comparing with false, we want ALL to be false, i.e. NOR\n\tis: function(actions, able) {\n\t\tvar or = actions.map(action => !!this[action])\n\t\t                .reduce((prev, current) => prev || current);\n\n\t\treturn able? or : !or;\n\t},\n\n\t// Monitor all changes\n\tonchange: function(callback) {\n\t\tthis.hooks.add(\"change\", callback);\n\t},\n\n\t// A single permission changed value\n\tchanged: function(action, value, from) {\n\t\tfrom = !!from;\n\t\tvalue = !!value;\n\n\t\tif (value == from) {\n\t\t\t// Nothing changed\n\t\t\treturn;\n\t\t}\n\n\t\t// $.live() calls the setter before the actual property is set so we\n\t\t// need to set it manually, otherwise it still has its previous value\n\t\tthis[\"_\" + action] = value;\n\n\t\t// TODO add classes to wrapper\n\t\tthis.triggers.forEach(trigger => {\n\t\t\tvar match = this.is(trigger.actions, trigger.value);\n\n\t\t\tif (trigger.active && trigger.actions.indexOf(action) > -1 && match) {\n\n\t\t\t\ttrigger.active = false;\n\t\t\t\ttrigger.callback();\n\t\t\t}\n\t\t\telse if (!match) {\n\t\t\t\t// This is so that triggers can only be executed in an actual transition\n\t\t\t\t// And that if there is a trigger for [a,b] it won't be executed twice\n\t\t\t\t// if a and b are set to true one after the other\n\t\t\t\ttrigger.active = true;\n\t\t\t}\n\t\t});\n\n\t\tthis.hooks.run(\"change\", {action, value, permissions: this});\n\t},\n\n\tor: function(permissions) {\n\t\t_.actions.forEach(action => {\n\t\t\tthis[action] = this[action] || permissions[action];\n\t\t});\n\n\t\treturn this;\n\t},\n\n\tstatic: {\n\t\tactions: [],\n\n\t\t// Register a new permission type\n\t\tregister: function(action, setter) {\n\t\t\tif (Array.isArray(action)) {\n\t\t\t\taction.forEach(action => _.register(action, setter));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$.live(_.prototype, action, function(able, previous) {\n\t\t\t\tif (setter) {\n\t\t\t\t\tsetter.call(this, able, previous);\n\t\t\t\t}\n\n\t\t\t\tthis.changed(action, able, previous);\n\t\t\t});\n\n\t\t\t_.actions.push(action);\n\t\t}\n\t}\n});\n\n_.register([\"read\", \"save\"]);\n\n_.register(\"login\", function(can) {\n\tif (can && this.logout) {\n\t\tthis.logout = false;\n\t}\n});\n\n_.register(\"logout\", function(can) {\n\tif (can && this.login) {\n\t\tthis.login = false;\n\t}\n});\n\n_.register(\"edit\", function(can) {\n\tif (can) {\n\t\tthis.add = this.delete = true;\n\t}\n});\n\n_.register([\"add\", \"delete\"], function(can) {\n\tif (!can) {\n\t\tthis.edit = false;\n\t}\n});\n\n})(Bliss);\n\n(function($) {\n\nvar _ = Mavo.Storage = $.Class({\n\tconstructor: function(mavo) {\n\t\tthis.mavo = mavo;\n\n\t\tthis.backend = _.Backend.create(this.mavo.store, this);\n\t\tthis.sourceBackend = _.Backend.create(this.mavo.source, this);\n\n\t\tif (this.backend) {\n\t\t\t// Permissions of first backend become the permissions of the app\n\t\t\t// TODO just use global permissions\n\t\t\tthis.backend.permissions = this.permissions.or(this.backend.permissions);\n\t\t}\n\t\telse {\n\t\t\tthis.permissions.on(\"read\");\n\t\t}\n\n\t\tthis.loaded = new Promise((resolve, reject) => {\n\t\t\tthis.mavo.wrapper.addEventListener(\"mavo:load\", resolve);\n\t\t});\n\n\t\tthis.authControls = {};\n\n\t\tthis.permissions.can(\"login\", () => {\n\t\t\t// #login authenticates if only 1 mavo on the page, or if the first.\n\t\t\t// Otherwise, we have to generate a slightly more complex hash\n\t\t\tthis.loginHash = \"#login\" + (Mavo.all[0] === this.mavo? \"\" : \"-\" + this.mavo.id);\n\n\t\t\tthis.authControls.login = $.create({\n\t\t\t\ttag: \"a\",\n\t\t\t\thref: this.loginHash,\n\t\t\t\ttextContent: \"Login\",\n\t\t\t\tclassName: \"login button\",\n\t\t\t\tevents: {\n\t\t\t\t\tclick: evt => {\n\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\tthis.login();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tafter: $(\".status\", this.mavo.ui.bar)\n\t\t\t});\n\n\t\t\t// We also support a hash to trigger login, in case the user doesn't want visible login UI\n\t\t\tvar login;\n\t\t\t(login = () => {\n\t\t\t\tif (location.hash === this.loginHash) {\n\t\t\t\t\t// This just does location.hash = \"\" without getting a pointless # at the end of the URL\n\t\t\t\t\thistory.replaceState(null, document.title, new URL(\"\", location) + \"\");\n\t\t\t\t\tthis.login();\n\t\t\t\t}\n\t\t\t})();\n\t\t\twindow.addEventListener(\"hashchange.mavo\", login);\n\t\t}, () => {\n\t\t\t$.remove(this.authControls.login);\n\t\t\tthis.mavo.wrapper._.unbind(\"hashchange.mavo\");\n\t\t});\n\n\t\t// Update login status\n\t\tthis.mavo.wrapper.addEventListener(\"mavo:login.mavo\", evt => {\n\t\t\tif (evt.backend == this.backend) { // ignore logins from source backend\n\t\t\t\tvar status = $(\".status\", this.mavo.ui.bar);\n\t\t\t\tstatus.innerHTML = \"\";\n\t\t\t\tstatus._.contents([\n\t\t\t\t\t\"Logged in to \" + evt.backend.id + \" as \",\n\t\t\t\t\t{tag: \"strong\", innerHTML: evt.name},\n\t\t\t\t\t{\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttextContent: \"Logout\",\n\t\t\t\t\t\tclassName: \"logout\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: e => evt.backend.logout()\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t}\n\t\t});\n\n\t\tthis.mavo.wrapper.addEventListener(\"mavo:logout.mavo\", evt => {\n\t\t\t$(\".status\", this.mavo.ui.bar).textContent = \"\";\n\t\t});\n\t},\n\n\tproxy: {\n\t\tpermissions: \"mavo\"\n\t},\n\n\t/**\n\t * load - Fetch data from source and render it.\n\t *\n\t * @return {Promise}  A promise that resolves when the data is loaded.\n\t */\n\tload: function() {\n\t\tthis.inProgress = \"Loading\";\n\n\t\tvar backend = this.backend || this.sourceBackend;\n\n\t\treturn backend.ready.then(() => backend.get())\n\t\t.catch(err => {\n\t\t\t// Try again with source\n\t\t\tif (this.sourceBackend && backend !== this.sourceBackend) {\n\t\t\t\treturn this.sourceBackend.ready.then(() => this.sourceBackend.get());\n\t\t\t}\n\n\t\t\treturn Promise.reject(err);\n\t\t})\n\t\t.then(response => {\n\t\t\tif (response && $.type(response) == \"string\") {\n\t\t\t\tresponse = JSON.parse(response);\n\t\t\t}\n\n\t\t\tthis.mavo.render(response);\n\t\t})\n\t\t.catch(err => {\n\t\t\tif (err) {\n\t\t\t\tif (err.xhr && err.xhr.status == 404) {\n\t\t\t\t\tthis.mavo.render(\"\");\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// TODO display error to user\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t\tconsole.log(err.stack);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t.then(() => {\n\t\t\tthis.inProgress = false;\n\t\t\t$.fire(this.mavo.wrapper, \"mavo:load\");\n\t\t});\n\t},\n\n\tsave: function() {\n\t\tthis.inProgress = \"Saving\";\n\n\t\tthis.backend.login()\n\t\t.then(() => this.backend.put())\n\t\t.then(file => {\n\t\t\t$.fire(this.mavo.wrapper, \"mavo:save\", {\n\t\t\t\tdata: file.data,\n\t\t\t\tdataString: file.dataString\n\t\t\t});\n\t\t})\n\t\t.catch(err => {\n\t\t\tif (err) {\n\t\t\t\tconsole.error(err);\n\t\t\t\tconsole.log(err.stack);\n\t\t\t}\n\t\t})\n\t\t.then(() => {\n\t\t\tthis.inProgress = false;\n\t\t});\n\t},\n\n\tlogin: function() {\n\t\treturn this.backend.login();\n\t},\n\n\tlogout: function() {\n\t\treturn this.backend.logout();\n\t},\n\n\tclear: function() {\n\t\tthis.save(null);\n\t},\n\n\t// Get storage parameters from the main element and cache them. Used for API keys and the like.\n\tparam: function(id) {\n\t\t// TODO traverse all properties and cache params in constructor, to avoid\n\t\t// collection items carrying all of these\n\t\tthis.params = this.params || {};\n\n\t\tif (!(id in this.params)) {\n\t\t\tvar attribute = \"data-store-\" + id;\n\n\t\t\tthis.params[id] = this.mavo.wrapper.getAttribute(attribute) || this.mavo.element.getAttribute(attribute);\n\n\t\t\tthis.mavo.wrapper.removeAttribute(attribute);\n\t\t\tthis.mavo.element.removeAttribute(attribute);\n\t\t}\n\n\t\treturn this.params[id];\n\t},\n\n\tlive: {\n\t\tinProgress: function(value) {\n\t\t\tif (value) {\n\t\t\t\tvar p = $.create(\"div\", {\n\t\t\t\t\ttextContent: value + \"…\",\n\t\t\t\t\tclassName: \"progress\",\n\t\t\t\t\tinside: this.mavo.wrapper\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$.remove($(\".progress\", this.mavo.wrapper));\n\t\t\t}\n\t\t}\n\t},\n\n\tstatic: {\n\t\tisHash: url => (url.origin === location.origin) && (url.pathname === location.pathname) && !!url.hash,\n\t}\n});\n\n// Base class for all backends\n_.Backend = $.Class({\n\tconstructor: function(url, storage) {\n\t\tthis.url = url;\n\t\tthis.storage = storage;\n\n\t\t// Permissions of this particular backend.\n\t\tthis.permissions = new Mavo.Permissions();\n\t},\n\n\t// To be be overriden by subclasses\n\tready: Promise.resolve(),\n\tlogin: () => Promise.resolve(),\n\tlogout: () => Promise.resolve(),\n\n\tgetFile: function() {\n\t\tvar data = this.mavo.data;\n\n\t\treturn {\n\t\t\tdata,\n\t\t\tdataString: Mavo.toJSON(data),\n\t\t\tfilename: this.filename,\n\t\t\tpath: this.path || \"\"\n\t\t};\n\t},\n\n\ttoString: function() {\n\t\treturn `${this.id} (${this.url})`;\n\t},\n\n\tproxy: {\n\t\tmavo: \"storage\"\n\t},\n\n\tstatic: {\n\t\t// Return the appropriate backend(s) for this url\n\t\tcreate: function(url, storage) {\n\t\t\tif (url) {\n\t\t\t\tvar Backend = _.Backend.types.filter(Backend => Backend.test(url))[0] || _.Backend.Remote;\n\n\t\t\t\treturn new Backend(url, storage);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\n\t\ttypes: [],\n\n\t\tregister: function(Class) {\n\t\t\t_.Backend[Class.prototype.id] = Class;\n\t\t\t_.Backend.types.push(Class);\n\t\t\treturn Class;\n\t\t}\n\t}\n});\n\n// Save in an element\n_.Backend.register($.Class({\n\tid: \"Element\",\n\textends: _.Backend,\n\tconstructor: function () {\n\t\tthis.permissions.on([\"read\", \"edit\", \"save\"]);\n\n\t\tthis.element = $(this.url) || $.create(\"script\", {\n\t\t\ttype: \"application/json\",\n\t\t\tid: this.url.slice(1),\n\t\t\tinside: document.body\n\t\t});\n\t},\n\n\tget: function() {\n\t\treturn Promise.resolve(this.element.textContent);\n\t},\n\n\tput: function(file = this.getFile()) {\n\t\tthis.element.textContent = file.dataString;\n\t\treturn Promise.resolve(file);\n\t},\n\n\tstatic: {\n\t\ttest: url => url.indexOf(\"#\") === 0\n\t}\n}));\n\n// Load from a remote URL, no save\n_.Backend.register($.Class({\n\tid: \"Remote\",\n\textends: _.Backend,\n\tconstructor: function() {\n\t\tthis.permissions.on(\"read\");\n\t\tthis.url = new URL(this.url, location);\n\t},\n\n\tget: function() {\n\t\treturn $.fetch(this.url.href, {\n\t\t\tresponseType: \"json\"\n\t\t})\n\t\t.then(xhr => Promise.resolve(xhr.response), () => Promise.resolve(null));\n\t},\n\n\tstatic: {\n\t\ttest: url => false\n\t}\n}));\n\n// Save in localStorage\n_.Backend.register($.Class({\n\textends: _.Backend,\n\tid: \"Local\",\n\tconstructor: function() {\n\t\tthis.permissions.on([\"read\", \"edit\", \"save\"]);\n\t\tthis.key = this.mavo.id;\n\t},\n\n\tget: function() {\n\t\treturn Promise[this.key in localStorage? \"resolve\" : \"reject\"](localStorage[this.key]);\n\t},\n\n\tput: function(file = this.getFile()) {\n\t\tif (file.data === null) {\n\t\t\tdelete localStorage[this.key];\n\t\t}\n\t\telse {\n\t\t\tlocalStorage[this.key] = file.dataString;\n\t\t}\n\n\t\treturn Promise.resolve(file);\n\t},\n\n\tstatic: {\n\t\ttest: value => value == \"local\"\n\t}\n}));\n\n})(Bliss);\n\n(function($, $$) {\n\nvar _ = Mavo.Node = $.Class({\n\tabstract: true,\n\tconstructor: function (element, mavo, o = {}) {\n\t\tif (!element || !mavo) {\n\t\t\tthrow new Error(\"Mavo.Node constructor requires an element argument and a mavo object\");\n\t\t}\n\n\t\tthis.element = element;\n\t\tthis.template = o.template;\n\n\t\tthis.mavo = mavo;\n\n\t\tif (!this.fromTemplate([\"property\", \"type\"])) {\n\t\t\tthis.property = _.getProperty(element);\n\t\t\tthis.type = Mavo.Scope.normalize(element);\n\t\t}\n\n\t\tthis.scope = this.parentScope = o.scope;\n\n\t\tMavo.hooks.run(\"node-init-end\", this);\n\t},\n\n\tget isRoot() {\n\t\treturn !this.property;\n\t},\n\n\tget name() {\n\t\treturn Mavo.readable(this.property || this.type).toLowerCase();\n\t},\n\n\tget data() {\n\t\treturn this.getData();\n\t},\n\n\tgetRelativeData: function(o = { dirty: true, computed: true, null: true }) {\n\t\tvar ret = this.getData(o);\n\n\t\tif (self.Proxy && ret && typeof ret === \"object\") {\n\t\t\tret = new Proxy(ret, {\n\t\t\t\tget: (data, property) => {\n\t\t\t\t\tif (property in data) {\n\t\t\t\t\t\treturn data[property];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (property == \"$index\") {\n\t\t\t\t\t\treturn this.index + 1;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Look in ancestors\n\t\t\t\t\tvar ret = this.walkUp(scope => {\n\t\t\t\t\t\tif (property in scope.properties) {\n\t\t\t\t\t\t\t// TODO decouple\n\t\t\t\t\t\t\tscope.expressions.updateAlso.add(this.expressions);\n\n\t\t\t\t\t\t\treturn scope.properties[property].getRelativeData(o);\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\n\t\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\thas: (data, property) => {\n\t\t\t\t\tif (property in data) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Property does not exist, look for it elsewhere\n\t\t\t\t\tif (property == \"$index\") {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// First look in ancestors\n\t\t\t\t\tvar ret = this.walkUp(scope => {\n\t\t\t\t\t\tif (property in scope.properties) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\n\t\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Still not found, look in descendants\n\t\t\t\t\tret = this.find(property);\n\n\t\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t\tif (Array.isArray(ret)) {\n\t\t\t\t\t\t\tret = ret.map(item => item.getData(o))\n\t\t\t\t\t\t\t         .filter(item => item !== null);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tret = ret.getData(o);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdata[property] = ret;\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tset: function(data, property, value) {\n\t\t\t\t\tthrow Error(\"You can’t set data via expressions.\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\twalk: function(callback) {\n\t\tvar walker = obj => {\n\t\t\tvar ret = callback(obj);\n\n\t\t\tif (ret !== false) {\n\t\t\t\tobj.propagate && obj.propagate(walker);\n\t\t\t}\n\t\t};\n\n\t\twalker(this);\n\t},\n\n\twalkUp: function(callback) {\n\t\tvar scope = this;\n\n\t\twhile (scope = scope.parentScope) {\n\t\t\tvar ret = callback(scope);\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t},\n\n\tcall: function(callback, ...args) {\n\t\targs = args || [];\n\n\t\tif (typeof callback === \"string\") {\n\t\t\treturn this[callback](...args);\n\t\t}\n\t\telse {\n\t\t\treturn callback.apply(this, [this, ...args]);\n\t\t}\n\t},\n\n\tedit: function() {\n\t\tthis.propagate(obj => obj[obj.preEdit? \"preEdit\" : \"edit\"]());\n\t},\n\n\tpropagated: [\"save\", \"revert\", \"done\", \"import\"],\n\n\ttoJSON: Mavo.prototype.toJSON,\n\n\tfromTemplate: function(properties) {\n\t\tif (this.template) {\n\t\t\tproperties.forEach(property => {\n\t\t\t\tthis[property] = this.template[property];\n\t\t\t});\n\t\t}\n\n\t\treturn !!this.template;\n\t},\n\n\tstatic: {\n\t\tcreate: function(element, mavo, o = {}) {\n\t\t\tif (Mavo.is(\"multiple\", element) && !o.collection) {\n\t\t\t\treturn new Mavo.Collection(element, mavo, o);\n\t\t\t}\n\n\t\t\treturn Mavo.Unit.create(...arguments);\n\t\t},\n\n\t\t/**\n\t\t * Get & normalize property name, if exists\n\t\t */\n\t\tgetProperty: function(element) {\n\t\t\tvar property = element.getAttribute(\"property\") || element.getAttribute(\"itemprop\");\n\n\t\t\tif (!property && element.hasAttribute(\"property\")) {\n\t\t\t\tproperty = element.name || element.id || element.classList[0];\n\t\t\t}\n\n\t\t\tif (property) {\n\t\t\t\telement.setAttribute(\"property\", property);\n\t\t\t}\n\n\t\t\treturn property;\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n/*\n * Mavo Unit: Super class that Scope and Primitive inherit from\n */\n(function($, $$) {\n\nvar _ = Mavo.Unit = $.Class({\n\tabstract: true,\n\textends: Mavo.Node,\n\tconstructor: function(element, mavo, o = {}) {\n\t\tthis.constructor.all.set(this.element, this);\n\n\t\tthis.collection = o.collection;\n\t\tthis.dirty = o.dirty;\n\n\t\tif (this.collection) {\n\t\t\t// This is a collection item\n\t\t\tthis.scope = this.parentScope = this.collection.parentScope;\n\t\t}\n\n\t\tif (!this.fromTemplate([\"computed\", \"required\"])) {\n\t\t\tthis.computed = Mavo.is(\"computed\", this.element);\n\t\t\tthis.required = Mavo.is(\"required\", this.element);\n\t\t}\n\n\t\tMavo.hooks.run(\"unit-init-end\", this);\n\t},\n\n\t/**\n\t * Check if this unit is either deleted or inside a deleted scope\n\t */\n\tisDeleted: function() {\n\t\tvar ret = this.deleted;\n\n\t\tif (this.deleted) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn !!this.parentScope && this.parentScope.isDeleted();\n\t},\n\n\tgetData: function(o) {\n\t\to = o || {};\n\n\t\tvar isNull = unit => unit.dirty && !o.dirty ||\n\t\t                     unit.deleted && o.dirty ||\n\t\t                     unit.computed && !o.computed ||\n\t\t                     unit.placeholder;\n\n\t\tif (isNull(this)) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Check if any of the parent scopes doesn't return data\n\t\tthis.walkUp(scope => {\n\t\t\tif (isNull(scope)) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t});\n\t},\n\n\tlazy: {\n\t\tclosestCollection: function() {\n\t\t\tif (this.collection) {\n\t\t\t\treturn this.collection;\n\t\t\t}\n\n\t\t\treturn this.walkUp(scope => {\n\t\t\t\tif (scope.collection) {\n\t\t\t\t\treturn scope.collection;\n\t\t\t\t}\n\t\t\t}) || null;\n\t\t}\n\t},\n\n\tlive: {\n\t\tdeleted: function(value) {\n\t\t\tthis.element.classList.toggle(\"deleted\", value);\n\n\t\t\tif (value) {\n\t\t\t\t// Soft delete, store element contents in a fragment\n\t\t\t\t// and replace them with an undo prompt.\n\t\t\t\tthis.elementContents = document.createDocumentFragment();\n\t\t\t\t$$(this.element.childNodes).forEach(node => {\n\t\t\t\t\tthis.elementContents.appendChild(node);\n\t\t\t\t});\n\n\t\t\t\t$.contents(this.element, [\n\t\t\t\t\t\"Deleted \" + this.name,\n\t\t\t\t\t{\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttextContent: \"Undo\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": evt => this.deleted = false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]);\n\n\t\t\t\tthis.element.classList.remove(\"delete-hover\");\n\t\t\t}\n\t\t\telse if (this.deleted) {\n\t\t\t\t// Undelete\n\t\t\t\tthis.element.textContent = \"\";\n\t\t\t\tthis.element.appendChild(this.elementContents);\n\n\t\t\t\t// otherwise expressions won't update because this will still seem as deleted\n\t\t\t\t// Alternatively, we could fire datachange with a timeout.\n\t\t\t\tthis._deleted = false;\n\n\t\t\t\t$.fire(this.element, \"mavo:datachange\", {\n\t\t\t\t\tunit: this.collection,\n\t\t\t\t\tmavo: this.mavo,\n\t\t\t\t\taction: \"undelete\",\n\t\t\t\t\titem: this\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tunsavedChanges: function(value) {\n\t\t\tif (value && (this.placeholder || this.computed || !this.editing)) {\n\t\t\t\tvalue = false;\n\t\t\t}\n\n\t\t\tthis.element.classList.toggle(\"unsaved-changes\", value);\n\n\t\t\treturn value;\n\t\t},\n\n\t\tplaceholder: function(value) {\n\t\t\tthis.element.classList.toggle(\"placeholder\", value);\n\t\t}\n\t},\n\n\tstatic: {\n\t\tget: function(element, prioritizePrimitive) {\n\t\t\tvar scope = Mavo.Scope.all.get(element);\n\n\t\t\treturn (prioritizePrimitive || !scope)? Mavo.Primitive.all.get(element) : scope;\n\t\t},\n\n\t\tcreate: function(element, mavo, o = {}) {\n\t\t\tif (!element || !mavo) {\n\t\t\t\tthrow new TypeError(\"Mavo.Unit.create() requires an element argument and a mavo object\");\n\t\t\t}\n\n\t\t\treturn new Mavo[Mavo.is(\"scope\", element)? \"Scope\" : \"Primitive\"](element, mavo, o);\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Mavo.Expression = $.Class({\n\tconstructor: function(expression) {\n\t\tthis.expression = expression;\n\t},\n\n\teval: function(data) {\n\t\tthis.oldValue = this.value;\n\n\t\t// TODO convert to new Function() which is more optimizable by JS engines.\n\t\t// Also, cache the function, since only data changes across invocations.\n\t\tMavo.hooks.run(\"expression-eval-beforeeval\", this);\n\n\t\ttry {\n\t\t\tif (!this.function) {\n\t\t\t\tthis.function = this.createFunction();\n\t\t\t}\n\n\t\t\tthis.value = this.function(data);\n\t\t}\n\t\tcatch (exception) {\n\t\t\tMavo.hooks.run(\"expression-eval-error\", {context: this, exception});\n\n\t\t\tthis.value = _.ERROR;\n\t\t}\n\n\t\treturn this.value;\n\t},\n\n\ttoString() {\n\t\treturn `[${this.expression}]`;\n\t},\n\n\tcreateFunction: function() {\n\t\tvar code = this.expression;\n\n\t\tif (/^if\\([\\S\\s]+\\)$/i.test(code)) {\n\t\t\tcode = code.replace(/^if\\(/, \"iff(\");\n\t\t}\n\n\t\t// Transform simple operators to array-friendly math functions\n\t\tcode = code.replace(_.simpleOperation, (expr, operand1, operator, operand2) => {\n\t\t\tvar ret = `(${Mavo.Functions.operators[operator]}(${operand1}, ${operand2}))`;\n\t\t\treturn ret;\n\t\t});\n\n\t\t_.simpleOperation.lastIndex = 0;\n\n\t\treturn new Function(\"data\", `with(Mavo.Functions._Trap)\n\t\t\t\twith(data) {\n\t\t\t\t\treturn ${code};\n\t\t\t\t}`);\n\t},\n\n\tlive: {\n\t\texpression: function(value) {\n\t\t\tvar code = value = value.trim();\n\n\t\t\tthis.function = null;\n\t\t}\n\t},\n\n\tstatic: {\n\t\tERROR: \"N/A\",\n\n\t\tlazy: {\n\t\t\tsimpleOperation: function() {\n\t\t\t\tvar operator = Object.keys(Mavo.Functions.operators).map(o => o.replace(/[|*+]/g, \"\\\\$&\")).join(\"|\");\n\t\t\t\tvar operand = \"\\\\s*(\\\\b[\\\\w.]+\\\\b)\\\\s*\";\n\n\t\t\t\treturn RegExp(`(?:^|\\\\()${operand}(${operator})${operand}(?:$|\\\\))`, \"g\");\n\t\t\t}\n\t\t}\n\t}\n});\n\n(function() {\n\nvar _ = Mavo.Expression.Text = $.Class({\n\tconstructor: function(o) {\n\t\tthis.all = o.all; // the Mavo.Expressions object that this belongs to\n\t\tthis.node = o.node;\n\t\tthis.path = o.path;\n\n\t\tif (!this.node) {\n\t\t\t// No node provided, figure it out from path\n\t\t\tthis.node = this.path.reduce((node, index) => {\n\t\t\t\treturn node.childNodes[index];\n\t\t\t}, this.all.scope.element);\n\t\t}\n\n\t\tthis.element = this.node;\n\n\t\tthis.attribute = o.attribute || null;\n\n\t\tif (this.node.nodeType === 3) {\n\t\t\tthis.element = this.node.parentNode;\n\n\t\t\t// If no element siblings make this.node the element, which is more robust\n\t\t\t// Same if attribute, there are no attributes on a text node!\n\t\t\tif (!this.node.parentNode.children.length || this.attribute) {\n\t\t\t\tthis.node = this.element;\n\t\t\t\tthis.element.normalize();\n\t\t\t}\n\t\t}\n\n\t\tthis.expression = (this.attribute? this.node.getAttribute(this.attribute) : this.node.textContent).trim();\n\t\tthis.template = o.template? o.template.template : this.tokenize(this.expression);\n\n\t\t// Is this a computed property?\n\t\tvar primitive = Mavo.Unit.get(this.element);\n\t\tif (primitive && this.attribute === primitive.attribute) {\n\t\t\tthis.primitive = primitive;\n\t\t\tprimitive.computed = true; // Primitives containing an expression as their value are implicitly computed\n\t\t}\n\n\t\tMavo.hooks.run(\"expressiontext-init-end\", this);\n\n\t\t_.elements.set(this.element, [...(_.elements.get(this.element) || []), this]);\n\t},\n\n\tupdate: function(data) {\n\t\tthis.data = data;\n\n\t\tvar ret = {};\n\n\t\tret.value = this.value = this.template.map(expr => {\n\t\t\tif (expr instanceof Mavo.Expression) {\n\t\t\t\tvar env = {context: this, expr};\n\n\t\t\t\tMavo.hooks.run(\"expressiontext-update-beforeeval\", env);\n\n\t\t\t\tenv.value = env.expr.eval(data);\n\n\t\t\t\tMavo.hooks.run(\"expressiontext-update-aftereval\", env);\n\n\t\t\t\tif (env.value === undefined || env.value === null) {\n\t\t\t\t\t// Don’t print things like \"undefined\" or \"null\"\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\n\t\t\t\treturn env.value;\n\t\t\t}\n\n\t\t\treturn expr;\n\t\t});\n\n\t\tif (!this.attribute) {\n\t\t\t// Separate presentational & actual values only apply when content is variable\n\t\t\tret.presentational = this.value.map(value => {\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\treturn value.join(\", \");\n\t\t\t\t}\n\n\t\t\t\tif (typeof value == \"number\") {\n\t\t\t\t\treturn Mavo.Primitive.formatNumber(value);\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t});\n\n\t\t\tret.presentational = ret.presentational.length === 1? ret.presentational[0] : ret.presentational.join(\"\");\n\t\t}\n\n\t\tret.value = ret.value.length === 1? ret.value[0] : ret.value.join(\"\");\n\n\t\tif (this.primitive && this.template.length === 1) {\n\t\t\tif (typeof ret.value === \"number\") {\n\t\t\t\tthis.primitive.datatype = \"number\";\n\t\t\t}\n\t\t\telse if (typeof ret.value === \"boolean\") {\n\t\t\t\tthis.primitive.datatype = \"boolean\";\n\t\t\t}\n\t\t}\n\n\t\tif (ret.presentational === ret.value) {\n\t\t\tret = ret.value;\n\t\t}\n\n\t\tif (this.primitive) {\n\t\t\tthis.primitive.value = ret;\n\t\t}\n\t\telse {\n\t\t\tMavo.Primitive.setValue(this.node, ret, this.attribute, {presentational: ret.presentational});\n\t\t}\n\t},\n\n\ttokenize: function(template) {\n\t\tvar regex = this.expressionRegex;\n\t\tvar match, ret = [], lastIndex = 0;\n\n\t\tregex.lastIndex = 0;\n\n\t\twhile ((match = regex.exec(template)) !== null) {\n\t\t\t// Literal before the expression\n\t\t\tif (match.index > lastIndex) {\n\t\t\t\tret.push(template.substring(lastIndex, match.index));\n\t\t\t}\n\n\t\t\tlastIndex = regex.lastIndex = _.findEnd(template.slice(match.index)) + match.index + 1;\n\t\t\tvar expression = template.slice(match.index + 1, lastIndex - 1);\n\n\t\t\tret.push(new Mavo.Expression(expression));\n\t\t}\n\n\t\t// Literal at the end\n\t\tif (lastIndex < template.length) {\n\t\t\tret.push(template.substring(lastIndex));\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tproxy: {\n\t\tscope: \"all\",\n\t\texpressionRegex: \"all\"\n\t},\n\n\tstatic: {\n\t\telements: new WeakMap(),\n\n\t\t// Find where a ( or [ or { ends.\n\t\tfindEnd: function(expr) {\n\t\t\tvar stack = [];\n\t\t\tvar inside, insides = \"\\\"'`\";\n\t\t\tvar open = \"([{\", close = \")]}\";\n\t\t\tvar isEscape;\n\n\t\t\tfor (var i=0; expr[i]; i++) {\n\t\t\t\tvar char = expr[i];\n\n\t\t\t\tif (inside) {\n\t\t\t\t\tif (char === inside && !isEscape) {\n\t\t\t\t\t\tinside = \"\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (!isEscape && insides.indexOf(char) > -1) {\n\t\t\t\t\tinside = char;\n\t\t\t\t}\n\t\t\t\telse if (open.indexOf(char) > -1) {\n\t\t\t\t\tstack.push(char);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar peek = stack[stack.length - 1];\n\n\t\t\t\t\tif (char === close[open.indexOf(peek)]) {\n\t\t\t\t\t\tstack.pop();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (stack.length === 0) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tisEscape = char == \"\\\\\";\n\t\t\t}\n\n\t\t\treturn i;\n\t\t},\n\n\t\tlazy: {\n\t\t\trootFunctionRegExp: () => RegExp(\"^=\\\\s*(?:\" + Mavo.Expressions.rootFunctions.join(\"|\") + \")\\\\($\", \"i\")\n\t\t}\n\t}\n});\n\n})();\n\n(function() {\n\nvar _ = Mavo.Expressions = $.Class({\n\tconstructor: function(scope) {\n\t\tif (scope) {\n\t\t\tthis.scope = scope;\n\t\t\tthis.scope.expressions = this;\n\t\t}\n\n\t\tthis.all = []; // all Expression.Text objects in this scope\n\n\t\tMavo.hooks.run(\"expressions-init-start\", this);\n\n\t\tif (this.scope) {\n\t\t\tvar template = this.scope.template;\n\n\t\t\tif (template && template.expressions) {\n\t\t\t\t// We know which expressions we have, don't traverse again\n\t\t\t\ttemplate.expressions.all.forEach(et => {\n\t\t\t\t\tthis.all.push(new Mavo.Expression.Text({\n\t\t\t\t\t\tpath: et.path,\n\t\t\t\t\t\tattribute: et.attribute,\n\t\t\t\t\t\tall: this,\n\t\t\t\t\t\ttemplate: et\n\t\t\t\t\t}));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.traverse();\n\t\t\t}\n\t\t}\n\n\t\t// TODO less stupid name?\n\t\tthis.updateAlso = new Set();\n\n\t\tthis.active = true;\n\n\t\tif (this.all.length > 0) {\n\t\t\tthis.update();\n\n\t\t\t// Watch changes and update value\n\t\t\tthis.scope.element.addEventListener(\"mavo:datachange\", evt => this.update());\n\t\t}\n\t},\n\n\t/**\n\t * Update all expressions in this scope\n\t */\n\tupdate: function callee() {\n\t\tif (!this.active || this.scope.isDeleted()) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar env = { context: this, data: this.scope.getRelativeData() };\n\n\t\tMavo.hooks.run(\"expressions-update-start\", env);\n\n\t\t$$(this.all).forEach(ref => {\n\t\t\tref.update(env.data);\n\t\t});\n\n\t\tthis.updateAlso.forEach(exp => exp.update());\n\t},\n\n\textract: function(node, attribute, path) {\n\t\tthis.expressionRegex.lastIndex = 0;\n\n\t\tif (this.expressionRegex.test(attribute? attribute.value : node.textContent)) {\n\t\t\tthis.all.push(new Mavo.Expression.Text({\n\t\t\t\tnode,\n\t\t\t\tpath: (path || \"\").slice(1).split(\"/\").map(i => +i),\n\t\t\t\tattribute: attribute && attribute.name,\n\t\t\t\tall: this\n\t\t\t}));\n\t\t}\n\t},\n\n\t// Traverse an element, including attribute nodes, text nodes and all descendants\n\ttraverse: function(node, path) {\n\t\tnode = node || this.scope.element;\n\t\tpath = path || \"\";\n\n\t\tif (node.matches && node.matches(_.escape)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.nodeType === 3) { // Text node\n\t\t\t// Leaf node, extract references from content\n\t\t\tthis.extract(node, null, path);\n\t\t}\n\n\t\t// Traverse children and attributes as long as this is NOT the root of a child scope\n\t\t// (otherwise, it will be taken care of its own Expressions object)\n\t\tif (node == this.scope.element || !Mavo.is(\"scope\", node)) {\n\t\t\t$$(node.attributes).forEach(attribute => this.extract(node, attribute, path));\n\t\t\t$$(node.childNodes).forEach((child, i) => this.traverse(child, `${path}/${i}`));\n\t\t}\n\t},\n\n\tlazy: {\n\t\t// Regex that loosely matches all possible expressions\n\t\t// False positives are ok, but false negatives are not.\n\t\texpressionRegex: function() {\n\t\t\tvar properties = this.scope.mavo.propertyNames.concat(_.special);\n\t\t\tvar propertyRegex = \"(?:\" + properties.join(\"|\").replace(/\\$/g, \"\\\\$\") + \")\";\n\n\t\t\treturn RegExp(`\\\\[[\\\\S\\\\s]*?${propertyRegex}[\\\\S\\\\s]*?\\\\]`, \"gi\");\n\t\t}\n\t},\n\n\tstatic: {\n\t\tescape: \".ignore-expressions\",\n\n\t\t// Special property names\n\t\tspecial: [\"$index\"],\n\n\t\tlazy: {\n\t\t\trootFunctions: () => [\n\t\t\t\t...Object.keys(Mavo.Functions),\n\t\t\t\t...Object.getOwnPropertyNames(Math),\n\t\t\t\t\"if\", \"\"\n\t\t\t]\n\t\t}\n\t}\n});\n\n})();\n\nMavo.hooks.add(\"init-tree-after\", function() {\n\tthis.walk(obj => {\n\t\tif (obj instanceof Mavo.Scope) {\n\t\t\tnew Mavo.Expressions(obj);\n\t\t}\n\t});\n});\n\nMavo.hooks.add(\"scope-init-end\", function() {\n\trequestAnimationFrame(() => {\n\t\t// Tree expressions are processed synchronously, so by now if it doesn't have\n\t\t// an expressions object, we need to create it.\n\t\tif (!this.expressions) {\n\t\t\tnew Mavo.Expressions(this);\n\t\t}\n\n\t\tthis.expressions.update();\n\t});\n});\n\nMavo.hooks.add(\"scope-render-start\", function() {\n\tif (!this.expressions) {\n\t\t// ??? How can it not have expressions by now?!\n\t\tnew Mavo.Expressions(this);\n\t}\n\n\tthis.expressions.active = false;\n});\n\nMavo.hooks.add(\"scope-render-end\", function() {\n\trequestAnimationFrame(() => {\n\t\tthis.expressions.active = true;\n\t\tthis.expressions.update();\n\t});\n});\n\n})(Bliss, Bliss.$);\n\n/**\n * Functions available inside Mavo expressions\n */\n\n(function() {\n\nvar _ = Mavo.Functions = {\n\toperators: {},\n\n\t/**\n\t * Aggregate sum\n\t */\n\tsum: function(array) {\n\t\treturn numbers(array, arguments).reduce((prev, current) => {\n\t\t\treturn +prev + (+current || 0);\n\t\t}, 0);\n\t},\n\n\t/**\n\t * Average of an array of numbers\n\t */\n\taverage: function(array) {\n\t\tarray = numbers(array, arguments);\n\n\t\treturn array.length && _.sum(array) / array.length;\n\t},\n\n\t/**\n\t * Min of an array of numbers\n\t */\n\tmin: function(array) {\n\t\treturn Math.min(...numbers(array, arguments));\n\t},\n\n\t/**\n\t * Max of an array of numbers\n\t */\n\tmax: function(array) {\n\t\treturn Math.max(...numbers(array, arguments));\n\t},\n\n\tcount: function(array) {\n\t\treturn Mavo.toArray(array).filter(a => a !== null && a !== false).length;\n\t},\n\n\tround: function(num, decimals) {\n\t\tif (!num || !decimals || !isFinite(num)) {\n\t\t\treturn Math.round(num);\n\t\t}\n\n\t\treturn +num.toLocaleString(\"en-US\", {\n\t\t\tuseGrouping: false,\n\t\t\tmaximumFractionDigits: decimals\n\t\t});\n\t},\n\n\tiff: function(condition, iftrue, iffalse=\"\") {\n\t\treturn condition? iftrue : iffalse;\n\t}\n};\n\n/**\n * Addition for elements and scalars.\n * Addition between arrays happens element-wise.\n * Addition between scalars returns their scalar sum (same as +)\n * Addition between a scalar and an array will result in the scalar being added to every array element.\n * Ordered by precedence (higher to lower)\n */\noperator(\"not\", a => a => !a);\noperator(\"multiply\", (a, b) => a * b, {identity: 1, symbol: \"*\"});\noperator(\"divide\", (a, b) => a / b, {identity: 1, symbol: \"/\"});\noperator(\"add\", (a, b) => +a + +b, {symbol: \"+\"});\noperator(\"subtract\", (a, b) => a - b, {symbol: \"-\"});\noperator(\"lte\", (a, b) => a <= b, {symbol: \"<=\"});\noperator(\"lt\", (a, b) => a < b, {symbol: \"<\"});\noperator(\"gte\", (a, b) => a >= b, {symbol: \">=\"});\noperator(\"gt\", (a, b) => a > b, {symbol: \">\"});\noperator(\"eq\", (a, b) => a == b, {symbol: \"==\"});\noperator(\"and\", (a, b) => !!a && !!b, { identity: true, symbol: \"&&\" });\noperator(\"or\", (a, b) => !!a || !!b, { identity: false, symbol: \"||\" } );\n\nvar aliases = {\n\taverage: \"avg\",\n\tiff: \"iff IF\",\n\tsubtract: \"minus\",\n\tmultiply: \"mult product\",\n\tdivide: \"div\",\n\tlt: \"lessThan smaller\",\n\tgt: \"moreThan greater greaterThan bigger\",\n\teq: \"equal equality\"\n};\n\nfor (name in aliases) {\n\taliases[name].split(/\\s+/g).forEach(alias => _[alias] = _[name]);\n}\n\n// Make function names case insensitive\nMavo.Functions._Trap = self.Proxy? new Proxy(_, {\n\tget: (functions, property) => {\n\t\tif (property in functions) {\n\t\t\treturn functions[property];\n\t\t}\n\n\t\tvar propertyL = property.toLowerCase && property.toLowerCase();\n\n\t\tif (propertyL && functions.hasOwnProperty(propertyL)) {\n\t\t\treturn functions[propertyL];\n\t\t}\n\n\t\tif (property in Math || propertyL in Math) {\n\t\t\treturn Math[property] || Math[propertyL];\n\t\t}\n\n\t\tif (property in self) {\n\t\t\treturn self[property];\n\t\t}\n\n\t\t// Prevent undefined at all costs\n\t\treturn property;\n\t},\n\n\t// Super ugly hack, but otherwise data is not\n\t// the local variable it should be, but the string \"data\"\n\t// so all property lookups fail.\n\thas: (functions, property) => property != \"data\"\n}) : Mavo.Functions;\n\n/**\n * Private helper methods\n */\nfunction numbers(array, args) {\n\tarray = Array.isArray(array)? array : (args? $$(args) : [array]);\n\n\treturn array.filter(number => !isNaN(number)).map(n => +n);\n}\n\n/**\n * Extend a scalar operator to arrays, or arrays and scalars\n * The operation between arrays is applied element-wise.\n * The operation operation between a scalar and an array will result in\n * the operation being applied between the scalar and every array element.\n * @param op {Function} The operation between two scalars\n * @param identity The operation’s identity element. Defaults to 0.\n */\nfunction operator(name, op, o = {}) {\n\tif (op.length < 2) {\n\t\t// Unary operator\n\t\treturn operand => Array.isArray(operand)? operand.map(op) : op(operand);\n\t}\n\n\tif (o.symbol) {\n\t\t_.operators[o.symbol] = name;\n\t}\n\n\treturn _[name] = function(...operands) {\n\t\tif (operands.length === 1) {\n\t\t\toperands = [...operands, o.identity];\n\t\t}\n\n\t\treturn operands.reduce((a, b) => {\n\t\t\tif (Array.isArray(b)) {\n\t\t\t\tif (typeof o.identity == \"number\") {\n\t\t\t\t\tb = numbers(b);\n\t\t\t\t}\n\n\t\t\t\tif (Array.isArray(a)) {\n\t\t\t\t\treturn [\n\t\t\t\t\t\t...b.map((n, i) => op(a[i] === undefined? o.identity : a[i], n)),\n\t\t\t\t\t\t...a.slice(b.length)\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn b.map(n => op(a, n));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Operand is scalar\n\t\t\t\tif (typeof o.identity == \"number\") {\n\t\t\t\t\tb = +b;\n\t\t\t\t}\n\n\t\t\t\tif (Array.isArray(a)) {\n\t\t\t\t\treturn a.map(n => op(n, b));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn op(a, b);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n}\n\n})();\n\n(function($, $$) {\n\nvar _ = Mavo.Scope = $.Class({\n\textends: Mavo.Unit,\n\tconstructor: function (element, mavo, o) {\n\t\tthis.properties = {};\n\n\t\tthis.scope = this;\n\n\t\tMavo.hooks.run(\"scope-init-start\", this);\n\n\t\t// Should this element also create a primitive?\n\t\tif (Mavo.Primitive.getValueAttribute(this.element)) {\n\t\t\tvar obj = this.properties[this.property] = new Mavo.Primitive(this.element, this.mavo, {scope: this});\n\t\t}\n\n\t\t// Create Mavo objects for all properties in this scope (primitives or scopes),\n\t\t// but not properties in descendant scopes (they will be handled by their scope)\n\t\t$$(Mavo.selectors.property, this.element).forEach(element => {\n\t\t\tvar property = Mavo.Node.getProperty(element);\n\n\t\t\tif (this.contains(element)) {\n\t\t\t\tvar existing = this.properties[property];\n\t\t\t\tvar template = this.template? this.template.properties[property] : null;\n\t\t\t\tvar constructorOptions = {template, scope: this};\n\n\t\t\t\tif (existing) {\n\t\t\t\t\t// Two scopes with the same property, convert to static collection\n\t\t\t\t\tvar collection = existing;\n\n\t\t\t\t\tif (!(existing instanceof Mavo.Collection)) {\n\t\t\t\t\t\tcollection = new Mavo.Collection(existing.element, this.mavo, constructorOptions);\n\t\t\t\t\t\tthis.properties[property] = existing.collection = collection;\n\t\t\t\t\t\tcollection.add(existing);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!collection.mutable && Mavo.is(\"multiple\", element)) {\n\t\t\t\t\t\tcollection.mutable = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tcollection.add(element);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// No existing properties with this id, normal case\n\t\t\t\t\tvar obj = Mavo.Node.create(element, this.mavo, constructorOptions);\n\n\t\t\t\t\tthis.properties[property] = obj;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!this.template) {\n\t\t\tArray.prototype.push.apply(this.mavo.propertyNames, this.propertyNames);\n\t\t}\n\n\t\tMavo.hooks.run(\"scope-init-end\", this);\n\t},\n\n\tget propertyNames () {\n\t\treturn Object.keys(this.properties);\n\t},\n\n\tgetData: function(o) {\n\t\to = o || {};\n\n\t\tvar ret = this.super.getData.call(this, o);\n\n\t\tif (ret !== undefined) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = {};\n\n\t\tthis.propagate(obj => {\n\n\t\t\tif ((!obj.computed || o.computed) && !(obj.property in ret)) {\n\t\t\t\tvar data = obj.getData(o);\n\n\t\t\t\tif (data !== null || o.null) {\n\t\t\t\t\tret[obj.property] = data;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!o.dirty) {\n\t\t\t$.extend(ret, this.unhandled);\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\t/**\n\t * Search entire subtree for property, return relative value\n\t * @return {Mavo.Unit}\n\t */\n\tfind: function(property) {\n\t\tif (this.property == property) {\n\t\t\treturn this;\n\t\t}\n\n\t\tif (property in this.properties) {\n\t\t\treturn this.properties[property].find(property);\n\t\t}\n\n\t\tfor (var prop in this.properties) {\n\t\t\tvar ret = this.properties[prop].find(property);\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t},\n\n\tpropagate: function(callback) {\n\t\t$.each(this.properties, (property, obj) => {\n\t\t\tobj.call(...arguments);\n\t\t});\n\t},\n\n\tsave: function() {\n\t\tif (this.placeholder) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.unsavedChanges = false;\n\t},\n\n\tdone: function() {\n\t\t$.unbind(this.element, \".mavo:edit\");\n\t},\n\n\tpropagated: [\"save\", \"done\", \"import\", \"clear\"],\n\n\t// Inject data in this element\n\trender: function(data) {\n\t\tif (!data) {\n\t\t\tthis.clear();\n\t\t\treturn;\n\t\t}\n\n\t\tMavo.hooks.run(\"scope-render-start\", this);\n\n\t\t// TODO retain dropped elements\n\t\tdata = data.isArray? data[0] : data;\n\n\t\t// TODO what if it was a primitive and now it's a scope?\n\t\t// In that case, render the this.properties[this.property] with it\n\n\t\tthis.unhandled = $.extend({}, data, property => {\n\t\t\treturn !(property in this.properties);\n\t\t});\n\n\t\tthis.propagate(obj => {\n\t\t\tobj.render(data[obj.property]);\n\t\t});\n\n\t\tthis.save();\n\n\t\tMavo.hooks.run(\"scope-render-end\", this);\n\t},\n\n\t// Check if this scope contains a property\n\t// property can be either a Mavo.Unit or a Node\n\tcontains: function(property) {\n\t\tif (property instanceof Mavo.Unit) {\n\t\t\treturn property.parentScope === this;\n\t\t}\n\n\t\treturn property.parentNode && (this.element === property.parentNode.closest(Mavo.selectors.scope));\n\t},\n\n\tstatic: {\n\t\tall: new WeakMap(),\n\n\t\tnormalize: function(element) {\n\t\t\t// Get & normalize typeof name, if exists\n\t\t\tif (Mavo.is(\"scope\", element)) {\n\t\t\t\tvar type = element.getAttribute(\"typeof\") || element.getAttribute(\"itemtype\") || \"Item\";\n\n\t\t\t\telement.setAttribute(\"typeof\", type);\n\n\t\t\t\treturn type;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Mavo.Primitive = $.Class({\n\textends: Mavo.Unit,\n\tconstructor: function (element, mavo, o) {\n\t\tif (!this.fromTemplate([\n\t\t\t\"attribute\", \"datatype\", \"humanReadable\",\n\t\t\t\"computed\", \"templateValue\"\n\t\t])) {\n\t\t\t// Which attribute holds the data, if any?\n\t\t\t// \"null\" or null for none (i.e. data is in content).\n\t\t\tthis.attribute = _.getValueAttribute(this.element);\n\n\t\t\tif (this.attribute) {\n\t\t\t\tthis.humanReadable = this.attribute.humanReadable;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.element.normalize();\n\t\t\t}\n\n\t\t\tthis.datatype = _.getDatatype(this.element, this.attribute);\n\n\t\t\tthis.templateValue = this.getValue({raw: true});\n\t\t}\n\n\t\t/**\n\t\t * Set up input widget\n\t\t */\n\n\t\t// Exposed widgets (visible always)\n\t\tif (Mavo.is(\"formControl\", this.element)) {\n\t\t\tthis.editor = this.element;\n\n\t\t\tthis.edit();\n\t\t}\n\t\t// Nested widgets\n\t\telse if (!this.editor) {\n\t\t\tthis.editor = $$(this.element.children).filter(function (el) {\n\t\t\t    return el.matches(Mavo.selectors.formControl) && !el.matches(Mavo.selectors.property);\n\t\t\t})[0];\n\n\t\t\t$.remove(this.editor);\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tif (!this.exposed && !this.computed) {\n\t\t\t\tthis.mavo.needsEdit = true;\n\t\t\t}\n\t\t});\n\n\t\tthis.default = this.element.getAttribute(\"data-default\");\n\n\t\tif (this.computed || this.default === \"\") { // attribute exists, no value, default is template value\n\t\t\tthis.default = this.templateValue;\n\t\t}\n\t\telse if (this.default === null) { // attribute does not exist\n\t\t\tthis.default = this.editor? this.editorValue : this.emptyValue;\n\t\t}\n\n\t\tif (!this.computed) {\n\t\t\tthis.value = this.templateValue; // no need to run setter code\n\t\t}\n\n\t\tif (this.collection) {\n\t\t\t// Collection of primitives, deal with setting textContent etc without the UI interfering.\n\t\t\tvar swapUI = callback => {\n\t\t\t\tthis.unobserve();\n\t\t\t\tvar ui = $.remove($(Mavo.selectors.ui, this.element));\n\n\t\t\t\tvar ret = callback();\n\n\t\t\t\t$.inside(ui, this.element);\n\t\t\t\tthis.observe();\n\n\t\t\t\treturn ret;\n\t\t\t};\n\n\t\t\t// Intercept certain properties so that any Mavo UI inside this primitive will not be destroyed\n\t\t\t[\"textContent\", \"innerHTML\"].forEach(property => {\n\t\t\t\tvar descriptor = Object.getOwnPropertyDescriptor(Node.prototype, property);\n\n\t\t\t\tObject.defineProperty(this.element, property, {\n\t\t\t\t\tget: function() {\n\t\t\t\t\t\treturn swapUI(() => descriptor.get.call(this));\n\t\t\t\t\t},\n\n\t\t\t\t\tset: function(value) {\n\t\t\t\t\t\tswapUI(() => descriptor.set.call(this, value));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.value = this.template? this.default : this.getValue({raw: true});\n\n\t\t// Observe future mutations to this property, if possible\n\t\t// Properties like input.checked or input.value cannot be observed that way\n\t\t// so we cannot depend on mutation observers for everything :(\n\t\tthis.observe();\n\t},\n\n\tget editorValue() {\n\t\tif (this.editor) {\n\t\t\tif (this.editor.matches(Mavo.selectors.formControl)) {\n\t\t\t\treturn _.getValue(this.editor, undefined, this.datatype);\n\t\t\t}\n\n\t\t\t// if we're here, this.editor is an entire HTML structure\n\t\t\tvar output = $(Mavo.selectors.output + \", \" + Mavo.selectors.formControl, this.editor);\n\n\t\t\tif (output) {\n\t\t\t\treturn _.all.has(output)? _.all.get(output).value : _.getValue(output);\n\t\t\t}\n\t\t}\n\t},\n\n\tset editorValue(value) {\n\t\tif (this.editor) {\n\t\t\tif (this.editor.matches(Mavo.selectors.formControl)) {\n\t\t\t\t_.setValue(this.editor, value);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// if we're here, this.editor is an entire HTML structure\n\t\t\t\tvar output = $(Mavo.selectors.output + \", \" + Mavo.selectors.formControl, this.editor);\n\n\t\t\t\tif (output) {\n\t\t\t\t\tif (_.all.has(output)) {\n\t\t\t\t\t\t_.all.get(output).value = value;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t_.setValue(output, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tget exposed() {\n\t\treturn this.editor === this.element;\n\t},\n\n\tgetData: function(o) {\n\t\to = o || {};\n\n\t\tvar ret = this.super.getData.call(this, o);\n\n\t\tif (ret !== undefined) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tvar ret = !o.dirty && !this.exposed? this.savedValue : this.value;\n\n\t\tif (!o.dirty && ret === \"\") {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tsave: function() {\n\t\tif (this.placeholder) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.savedValue = this.value;\n\t\tthis.unsavedChanges = false;\n\t},\n\n\tdone: function () {\n\t\tthis.unobserve();\n\n\t\tif (this.popup) {\n\t\t\tthis.hidePopup();\n\t\t}\n\t\telse if (!this.attribute && !this.exposed && this.editing) {\n\t\t\t$.remove(this.editor);\n\t\t\tthis.element.textContent = this.editorValue;\n\t\t}\n\n\t\tif (!this.exposed) {\n\t\t\tthis.editing = false;\n\t\t}\n\n\t\t// Revert tabIndex\n\t\tif (this.element._.data.prevTabindex !== null) {\n\t\t\tthis.element.tabIndex = this.element._.data.prevTabindex;\n\t\t}\n\t\telse {\n\t\t\tthis.element.removeAttribute(\"tabindex\");\n\t\t}\n\n\t\tthis.element._.unbind(\".mavo:edit .mavo:preedit .mavo:showpopup\");\n\n\t\tthis.observe();\n\t},\n\n\trevert: function() {\n\t\tif (this.unsavedChanges && this.savedValue !== undefined) {\n\t\t\t// FIXME if we have a collection of properties (not scopes), this will cause\n\t\t\t// cancel to not remove new unsaved items\n\t\t\t// This should be fixed by handling this on the collection level.\n\t\t\tthis.value = this.savedValue;\n\t\t\tthis.unsavedChanges = false;\n\t\t}\n\t},\n\n\t// Prepare to be edited\n\t// Called when root edit button is pressed\n\tpreEdit: function () {\n\t\tif (this.computed) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Empty properties should become editable immediately\n\t\t// otherwise they could be invisible!\n\t\tif (this.empty && !this.attribute) {\n\t\t\tthis.edit();\n\t\t\treturn;\n\t\t}\n\n\t\tvar timer;\n\n\t\tthis.element._.events({\n\t\t\t// click is needed too because it works with the keyboard as well\n\t\t\t\"click.mavo:preedit\": e => this.edit(),\n\t\t\t\"focus.mavo:preedit\": e => {\n\t\t\t\tthis.edit();\n\n\t\t\t\tif (!this.popup) {\n\t\t\t\t\tthis.editor.focus();\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"click.mavo:edit\": evt => {\n\t\t\t\t// Prevent default actions while editing\n\t\t\t\t// e.g. following links etc\n\t\t\t\tif (!this.exposed) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!this.attribute) {\n\t\t\tthis.element._.events({\n\t\t\t\t\"mouseenter.mavo:preedit\": e => {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\ttimer = setTimeout(() => this.edit(), 150);\n\t\t\t\t},\n\t\t\t\t\"mouseleave.mavo:preedit\": e => {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Make element focusable, so it can actually receive focus\n\t\tthis.element._.data.prevTabindex = this.element.getAttribute(\"tabindex\");\n\t\tthis.element.tabIndex = 0;\n\t},\n\n\t// Called only the first time this primitive is edited\n\tinitEdit: function () {\n\t\t// Linked widgets\n\t\tif (this.element.hasAttribute(\"data-input\")) {\n\t\t\tvar selector = this.element.getAttribute(\"data-input\");\n\n\t\t\tif (selector) {\n\t\t\t\tthis.editor = $.clone($(selector));\n\n\t\t\t\tif (!Mavo.is(\"formControl\", this.editor)) {\n\t\t\t\t\tif ($(Mavo.selectors.output, this.editor)) { // has output element?\n\t\t\t\t\t\t// Process it as a mavo instance, so people can use references\n\t\t\t\t\t\tthis.editor.setAttribute(\"data-store\", \"none\");\n\t\t\t\t\t\tnew Mavo(this.editor);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.editor = null; // Cannot use this, sorry bro\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!this.editor) {\n\t\t\t// No editor provided, use default for element type\n\t\t\t// Find default editor for datatype\n\t\t\tvar editor = _.getMatch(this.element, _.editors);\n\n\t\t\tif (editor.create) {\n\t\t\t\t$.extend(this, editor, property => property != \"create\");\n\t\t\t}\n\n\t\t\tvar create = editor.create || editor;\n\t\t\tthis.editor = $.create($.type(create) === \"function\"? create.call(this) : create);\n\t\t\tthis.editorValue = this.value;\n\t\t}\n\n\t\tthis.editor._.events({\n\t\t\t\"input change\": evt => {\n\t\t\t\tvar unsavedChanges = this.mavo.unsavedChanges;\n\n\t\t\t\tthis.value = this.editorValue;\n\n\t\t\t\t// Editing exposed elements outside edit mode is instantly saved\n\t\t\t\tif (\n\t\t\t\t\tthis.exposed &&\n\t\t\t\t\t!this.mavo.editing && // must not be in edit mode\n\t\t\t\t    this.mavo.permissions.save // must be able to save\n\t\t\t\t) {\n\t\t\t\t\t// TODO what if change event never fires? What if user\n\t\t\t\t\tthis.unsavedChanges = false;\n\t\t\t\t\tthis.mavo.unsavedChanges = unsavedChanges;\n\n\t\t\t\t\t// Must not save too many times (e.g. not while dragging a slider)\n\t\t\t\t\tif (evt.type == \"change\") {\n\t\t\t\t\t\tthis.save(); // Save current element\n\n\t\t\t\t\t\t// Don’t call this.mavo.save() as it will save other fields too\n\t\t\t\t\t\t// We only want to save exposed controls, so save current status\n\t\t\t\t\t\tthis.mavo.storage.save();\n\n\t\t\t\t\t\t// Are there any unsaved changes from other properties?\n\t\t\t\t\t\tthis.mavo.unsavedChanges = this.mavo.calculateUnsavedChanges();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"focus\": evt => {\n\t\t\t\tthis.editor.select && this.editor.select();\n\t\t\t},\n\t\t\t\"keyup\": evt => {\n\t\t\t\tif (this.popup && evt.keyCode == 13 || evt.keyCode == 27) {\n\t\t\t\t\tif (this.popup.contains(document.activeElement)) {\n\t\t\t\t\t\tthis.element.focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\tthis.hidePopup();\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"mavo:datachange\": evt => {\n\t\t\t\tif (evt.property === \"output\") {\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\t$.fire(this.editor, \"input\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (\"placeholder\" in this.editor) {\n\t\t\tthis.editor.placeholder = \"(\" + this.label + \")\";\n\t\t}\n\n\t\tif (!this.exposed) {\n\t\t\t// Copy any data-input-* attributes from the element to the editor\n\t\t\tvar dataInput = /^data-input-/i;\n\t\t\t$$(this.element.attributes).forEach(function (attribute) {\n\t\t\t\tif (dataInput.test(attribute.name)) {\n\t\t\t\t\tthis.editor.setAttribute(attribute.name.replace(dataInput, \"\"), attribute.value);\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tif (this.attribute) {\n\t\t\t\t// Set up popup\n\t\t\t\tthis.element.classList.add(\"using-popup\");\n\n\t\t\t\tthis.popup = this.popup || $.create(\"div\", {\n\t\t\t\t\tclassName: \"mv-popup\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\tthis.label + \":\",\n\t\t\t\t\t\tthis.editor\n\t\t\t\t\t]\n\t\t\t\t});\n\n\t\t\t\t// No point in having a dropdown in a popup\n\t\t\t\tif (this.editor.matches(\"select\")) {\n\t\t\t\t\tthis.editor.size = Math.min(10, this.editor.children.length);\n\t\t\t\t}\n\n\t\t\t\t// Toggle popup events & methods\n\t\t\t\tvar hideCallback = evt => {\n\t\t\t\t\tif (!this.popup.contains(evt.target) && !this.element.contains(evt.target)) {\n\t\t\t\t\t\tthis.hidePopup();\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis.showPopup = function() {\n\t\t\t\t\t$.unbind([this.element, this.popup], \".mavo:showpopup\");\n\t\t\t\t\tthis.popup._.after(this.element);\n\n\t\t\t\t\tvar x = this.element.offsetLeft;\n\t\t\t\t\tvar y = this.element.offsetTop + this.element.offsetHeight;\n\n\t\t\t\t\t // TODO what if it doesn’t fit?\n\t\t\t\t\tthis.popup._.style({ top:  `${y}px`, left: `${x}px` });\n\n\t\t\t\t\tthis.popup._.removeAttribute(\"hidden\"); // trigger transition\n\n\t\t\t\t\t$.events(document, \"focus click\", hideCallback, true);\n\t\t\t\t};\n\n\t\t\t\tthis.hidePopup = function() {\n\t\t\t\t\t$.unbind(document, \"focus click\", hideCallback, true);\n\n\t\t\t\t\tthis.popup.setAttribute(\"hidden\", \"\"); // trigger transition\n\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t$.remove(this.popup);\n\t\t\t\t\t}, 400); // TODO transition-duration could override this\n\n\t\t\t\t\t$.events(this.element, \"focus.mavo:showpopup click.mavo:showpopup\", evt => {\n\t\t\t\t\t\tthis.showPopup();\n\t\t\t\t\t}, true);\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (!this.popup) {\n\t\t\tthis.editor.classList.add(\"mv-editor\");\n\t\t}\n\n\t\tthis.initEdit = null;\n\t},\n\n\tedit: function () {\n\t\tif (this.computed || this.editing) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.element._.unbind(\".mavo:preedit\");\n\n\t\tif (this.initEdit) {\n\t\t\tthis.initEdit();\n\t\t}\n\n\t\tif (this.popup) {\n\t\t\tthis.showPopup();\n\t\t}\n\n\t\tif (!this.attribute) {\n\t\t\tif (this.editor.parentNode != this.element && !this.exposed) {\n\t\t\t\tthis.editorValue = this.value;\n\t\t\t\tthis.element.textContent = \"\";\n\n\t\t\t\tif (!this.exposed) {\n\t\t\t\t\tthis.element.appendChild(this.editor);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.editing = true;\n\t}, // edit\n\n\tclear: function() {\n\t\tthis.value = this.emptyValue;\n\t},\n\n\trender: function(data) {\n\t\tif (Array.isArray(data)) {\n\t\t\tdata = data[0]; // TODO what is gonna happen to the rest? Lost?\n\t\t}\n\n\t\tif (typeof data === \"object\") {\n\t\t\tdata = data[this.property];\n\t\t}\n\n\t\tthis.value = data === undefined? this.default : data;\n\n\t\tthis.save();\n\t},\n\n\tfind: function(property) {\n\t\tif (this.property == property) {\n\t\t\treturn this;\n\t\t}\n\t},\n\n\tobserve: function() {\n\t\tif (!this.computed) {\n\t\t\tthis.observer = Mavo.observe(this.element, this.attribute, this.observer || (record => {\n\t\t\t\tif (this.attribute || !this.mavo.editing) {\n\t\t\t\t\tthis.value = this.getValue();\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t},\n\n\tunobserve: function () {\n\t\tthis.observer && this.observer.disconnect();\n\t},\n\n\t/**\n\t * Get value from the DOM\n\t */\n\tgetValue: function(o) {\n\t\treturn _.getValue(this.element, this.attribute, this.datatype, o);\n\t},\n\n\tlazy: {\n\t\tlabel: function() {\n\t\t\treturn Mavo.readable(this.property);\n\t\t},\n\n\t\temptyValue: function() {\n\t\t\tswitch (this.datatype) {\n\t\t\t\tcase \"boolean\":\n\t\t\t\t\treturn false;\n\t\t\t\tcase \"number\":\n\t\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn \"\";\n\t\t}\n\t},\n\n\tlive: {\n\t\tvalue: function (value) {\n\t\t\tthis.unobserve();\n\n\t\t\tif ($.type(value) == \"object\" && \"value\" in value) {\n\t\t\t\tvar presentational = value.presentational;\n\t\t\t\tvalue = value.value;\n\t\t\t}\n\n\t\t\tvalue = value || value === 0? value : \"\";\n\t\t\tvalue = _.safeCast(value, this.datatype);\n\n\t\t\tif (value == this._value) {\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tif (this.editor) {\n\t\t\t\tthis.editorValue = value;\n\t\t\t}\n\n\t\t\tif (this.humanReadable && this.attribute) {\n\t\t\t\tpresentational = this.humanReadable(value);\n\t\t\t}\n\n\t\t\tif (!this.editing || this.attribute) {\n\t\t\t\tif (this.editor && this.editor.matches(\"select\") && this.editor.selectedOptions[0]) {\n\t\t\t\t\tpresentational = this.editor.selectedOptions[0].textContent;\n\t\t\t\t}\n\n\t\t\t\t_.setValue(this.element, {value, presentational}, this.attribute, this.datatype);\n\t\t\t}\n\n\t\t\tthis.empty = value === \"\";\n\n\t\t\tthis._value = value;\n\n\t\t\tif (!this.computed) {\n\t\t\t\tthis.unsavedChanges = this.mavo.unsavedChanges = true;\n\t\t\t}\n\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\t$.fire(this.element, \"mavo:datachange\", {\n\t\t\t\t\tproperty: this.property,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\tmavo: this.mavo,\n\t\t\t\t\tnode: this,\n\t\t\t\t\tdirty: this.editing,\n\t\t\t\t\taction: \"propertychange\"\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.observe();\n\n\t\t\treturn value;\n\t\t},\n\n\t\tempty: function(value) {\n\t\t\tvar hide = value && !this.exposed && !(this.attribute && $(Mavo.selectors.property, this.element));\n\t\t\tthis.element.classList.toggle(\"empty\", hide);\n\t\t},\n\n\t\tediting: function (value) {\n\t\t\tthis.element.classList.toggle(\"editing\", value);\n\t\t},\n\n\t\tcomputed: function (value) {\n\t\t\tthis.element.classList.toggle(\"computed\", value);\n\t\t}\n\t},\n\n\tstatic: {\n\t\tall: new WeakMap(),\n\n\t\tgetMatch: function (element, all) {\n\t\t\t// TODO specificity\n\t\t\tvar ret = null;\n\n\t\t\tfor (var selector in all) {\n\t\t\t\tif (element.matches(selector)) {\n\t\t\t\t\tret = all[selector];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tgetValueAttribute: function (element) {\n\t\t\tvar ret = element.getAttribute(\"data-attribute\") || _.getMatch(element, _.attributes);\n\n\t\t\t// TODO refactor this\n\t\t\tif (ret && ret.value) {\n\t\t\t\tret = $.extend(new String(ret.value), ret);\n\t\t\t}\n\n\t\t\tif (!ret || ret === \"null\") {\n\t\t\t\tret = null;\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tgetDatatype: function (element, attribute) {\n\t\t\tvar ret = element.getAttribute(\"datatype\");\n\n\t\t\tif (!ret) {\n\t\t\t\tfor (var selector in _.datatypes) {\n\t\t\t\t\tif (element.matches(selector)) {\n\t\t\t\t\t\tret = _.datatypes[selector][attribute];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tret = ret || \"string\";\n\n\t\t\treturn ret;\n\t\t},\n\n\t\t/**\n\t\t * Only cast if conversion is lossless\n\t\t */\n\t\tsafeCast: function(value, datatype) {\n\t\t\tvar existingType = typeof value;\n\t\t\tvar cast = _.cast(value, datatype);\n\n\t\t\tif (value === null || value === undefined) {\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tif (datatype == \"boolean\") {\n\t\t\t\tif (value === \"false\" || value === 0 || value === \"\") {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (value === \"true\" || value > 0) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tif (datatype == \"number\") {\n\t\t\t\tif (/^[-+]?[0-9.e]+$/i.test(value + \"\")) {\n\t\t\t\t\treturn cast;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\treturn cast;\n\t\t},\n\n\t\t/**\n\t\t * Cast to a different primitive datatype\n\t\t */\n\t\tcast: function(value, datatype) {\n\t\t\tswitch (datatype) {\n\t\t\t\tcase \"number\": return +value;\n\t\t\t\tcase \"boolean\": return !!value;\n\t\t\t\tcase \"string\": return value + \"\";\n\t\t\t}\n\n\t\t\treturn value;\n\t\t},\n\n\t\tgetValue: function (element, attribute, datatype, o = {}) {\n\t\t\tattribute = attribute || attribute === null? attribute : _.getValueAttribute(element);\n\t\t\tdatatype = datatype || _.getDatatype(element, attribute);\n\n\t\t\tvar ret;\n\n\t\t\t// TODO Get rid of this horrible raw hack\n\t\t\tif (attribute in element && !o.raw && _.useProperty(element, attribute)) {\n\t\t\t\t// Returning properties (if they exist) instead of attributes\n\t\t\t\t// is needed for dynamic elements such as checkboxes, sliders etc\n\t\t\t\tret = element[attribute];\n\t\t\t}\n\t\t\telse if (attribute) {\n\t\t\t\tret = element.getAttribute(attribute);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tret = element.getAttribute(\"content\") || element.textContent || null;\n\t\t\t}\n\n\t\t\treturn _.safeCast(ret, datatype);\n\t\t},\n\n\t\tsetValue: function (element, value, attribute, datatype) {\n\t\t\tif ($.type(value) == \"object\" && \"value\" in value) {\n\t\t\t\tvar presentational = value.presentational;\n\t\t\t\tvalue = value.value;\n\t\t\t}\n\n\t\t\tif (attribute !== null) {\n\t\t\t\tattribute = attribute ||  _.getValueAttribute(element);\n\t\t\t}\n\n\t\t\tif (attribute in element && _.useProperty(element, attribute) && element[attribute] != value) {\n\t\t\t\t// Setting properties (if they exist) instead of attributes\n\t\t\t\t// is needed for dynamic elements such as checkboxes, sliders etc\n\t\t\t\ttry {\n\t\t\t\t\telement[attribute] = value;\n\t\t\t\t}\n\t\t\t\tcatch (e) {}\n\t\t\t}\n\n\t\t\t// Set attribute anyway, even if we set a property because when\n\t\t\t// they're not in sync it gets really fucking confusing.\n\t\t\tif (attribute) {\n\t\t\t\tif (element.getAttribute(attribute) != value) { // intentionally non-strict, e.g. \"3.\" !== 3\n\t\t\t\t\telement.setAttribute(attribute, value);\n\n\t\t\t\t\tif (presentational) {\n\t\t\t\t\t\telement.textContent = presentational;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (datatype === \"number\" && !presentational) {\n\t\t\t\t\tpresentational = _.formatNumber(value);\n\t\t\t\t}\n\n\t\t\t\telement.textContent = presentational || value;\n\n\t\t\t\tif (presentational && element.setAttribute) {\n\t\t\t\t\telement.setAttribute(\"content\", value);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t *  Set/get a property or an attribute?\n\t\t * @return {Boolean} true to use a property, false to use the attribute\n\t\t */\n\t\tuseProperty: function(element, attribute) {\n\t\t\tif ([\"href\", \"src\"].indexOf(attribute) > -1) {\n\t\t\t\t// URL properties resolve \"\" as location.href, fucking up emptiness checks\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.namespaceURI == \"http://www.w3.org/2000/svg\") {\n\t\t\t\t// SVG has a fucked up DOM, do not use these properties\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\tlazy: {\n\t\t\tformatNumber: () => {\n\t\t\t\tvar numberFormat = new Intl.NumberFormat(\"en-US\", {maximumFractionDigits:2});\n\n\t\t\t\treturn function(value) {\n\t\t\t\t\tif (value === Infinity || value === -Infinity) {\n\t\t\t\t\t\t// Pretty print infinity\n\t\t\t\t\t\treturn value < 0? \"-∞\" : \"∞\";\n\t\t\t\t\t}\n\n\t\t\t\t\treturn numberFormat.format(value);\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n});\n\n// Define default attributes\n_.attributes = {\n\t\"img, video, audio\": \"src\",\n\t\"a, link\": \"href\",\n\t\"select, input, textarea, meter, progress\": \"value\",\n\t\"input[type=checkbox]\": \"checked\",\n\t\"time\": {\n\t\tvalue: \"datetime\",\n\t\thumanReadable: function (value) {\n\t\t\tvar date = new Date(value);\n\n\t\t\tif (!value || isNaN(date)) {\n\t\t\t\treturn \"(No \" + this.label + \")\";\n\t\t\t}\n\n\t\t\t// TODO do this properly (account for other datetime datatypes and different formats)\n\t\t\tvar options = {\n\t\t\t\t\"date\": {day: \"numeric\", month: \"short\", year: \"numeric\"},\n\t\t\t\t\"month\": {month: \"long\"},\n\t\t\t\t\"time\": {hour: \"numeric\", minute: \"numeric\"},\n\t\t\t\t\"datetime-local\": {day: \"numeric\", month: \"short\", year: \"numeric\", hour: \"numeric\", minute: \"numeric\"}\n\t\t\t};\n\n\t\t\tvar format = options[this.editor && this.editor.type] || options.date;\n\t\t\tformat.timeZone = \"UTC\";\n\n\t\t\treturn date.toLocaleString(\"en-GB\", format);\n\t\t}\n\t},\n\t\"meta\": \"content\"\n};\n\n// Basic datatypes per attribute\n// Only number, boolean\n_.datatypes = {\n\t\"input[type=checkbox]\": {\n\t\t\"checked\": \"boolean\"\n\t},\n\t\"input[type=range], input[type=number], meter, progress\": {\n\t\t\"value\": \"number\"\n\t}\n};\n\n_.editors = {\n\t\"*\": {\"tag\": \"input\"},\n\n\t\".number\": {\n\t\t\"tag\": \"input\",\n\t\t\"type\": \"number\"\n\t},\n\n\t\".boolean\": {\n\t\t\"tag\": \"input\",\n\t\t\"type\": \"checkbox\"\n\t},\n\n\t\"a, img, video, audio, .url\": {\n\t\t\"tag\": \"input\",\n\t\t\"type\": \"url\",\n\t\t\"placeholder\": \"http://\"\n\t},\n\n\t// Block elements\n\t\"p, div, li, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address, .multiline\": {\n\t\tcreate: function() {\n\t\t\tvar display = getComputedStyle(this.element).display;\n\t\t\tvar tag = display.indexOf(\"inline\") === 0? \"input\" : \"textarea\";\n\t\t\tvar editor = $.create(tag);\n\n\t\t\tif (tag == \"textarea\") {\n\t\t\t\tvar width = this.element.offsetWidth;\n\n\t\t\t\tif (width) {\n\t\t\t\t\teditor.width = width;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn editor;\n\t\t},\n\n\t\tget editorValue () {\n\t\t\treturn this.editor && _.safeCast(this.editor.value, this.datatype);\n\t\t},\n\n\t\tset editorValue (value) {\n\t\t\tif (this.editor) {\n\t\t\t\tthis.editor.value = value ? value.replace(/\\r?\\n/g, \"\") : \"\";\n\t\t\t}\n\t\t}\n\t},\n\n\t\"meter, progress\": function() {\n\t\treturn $.create({\n\t\t\ttag: \"input\",\n\t\t\ttype: \"range\",\n\t\t\tmin: this.element.getAttribute(\"min\") || 0,\n\t\t\tmax: this.element.getAttribute(\"max\") || 100\n\t\t});\n\t},\n\n\t\"time, .date\": function() {\n\t\tvar types = {\n\t\t\t\"date\": /^[Y\\d]{4}-[M\\d]{2}-[D\\d]{2}$/i,\n\t\t\t\"month\": /^[Y\\d]{4}-[M\\d]{2}$/i,\n\t\t\t\"time\": /^[H\\d]{2}:[M\\d]{2}/i,\n\t\t\t\"week\": /[Y\\d]{4}-W[W\\d]{2}$/i,\n\t\t\t\"datetime-local\": /^[Y\\d]{4}-[M\\d]{2}-[D\\d]{2} [H\\d]{2}:[M\\d]{2}/i\n\t\t};\n\n\t\tvar datetime = this.element.getAttribute(\"datetime\") || \"YYYY-MM-DD\";\n\n\t\tfor (var type in types) {\n\t\t\tif (types[type].test(datetime)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn $.create(\"input\", {type: type});\n\t}\n};\n\n})(Bliss, Bliss.$);\n\n// Image upload widget via imgur\nMavo.Primitive.editors.img = {\n\tcreate: function() {\n\t\tvar root = $.create(\"div\", {\n\t\t\tclassName: \"image-popup\",\n\t\t\tevents: {\n\t\t\t\t\"dragenter dragover drop\": function(evt) {\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t},\n\n\t\t\t\tdrop: function(evt) {\n\t\t\t\t\tvar file = $.value(evt.dataTransfer, \"files\", 0);\n\n\t\t\t\t\t// Do upload stuff\n\t\t\t\t}\n\t\t\t},\n\t\t\tcontents: [\n\t\t\t{\n\t\t\t\ttag: \"input\",\n\t\t\t\ttype: \"url\",\n\t\t\t\tclassName: \"value\"\n\t\t\t}, {\n\t\t\t\ttag: \"label\",\n\t\t\t\tclassName: \"upload\",\n\t\t\t\tcontents: [\"Upload: \", {\n\t\t\t\t\ttag: \"input\",\n\t\t\t\t\ttype: \"file\",\n\t\t\t\t\taccept: \"image/*\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tchange: function (evt) {\n\t\t\t\t\t\t\tvar file = this.files[0];\n\n\t\t\t\t\t\t\tif (!file) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Show image locally\n\t\t\t\t\t\t\t$(\"img\", root).file = file;\n\n\t\t\t\t\t\t\t// Upload\n\n\t\t\t\t\t\t\t// Once uploaded, share and get public URL\n\n\t\t\t\t\t\t\t// Set public URL as the value of the URL input\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}, {\n\t\t\t\tclassName: \"image-preview\",\n\t\t\t\tcontents: [{\n\t\t\t\t\t\ttag: \"progress\",\n\t\t\t\t\t\tvalue: \"0\",\n\t\t\t\t\t\tmax: \"100\"\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttag: \"img\"\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}, {\n\t\t\t\tclassName: \"tip\",\n\t\t\t\tinnerHTML: \"<strong>Tip:</strong> You can also drag & drop or paste the image to be uploaded!\"\n\t\t\t}\n\t\t]});\n\n\t\treturn root;\n\t}\n};\n\n(function($, $$) {\n\nvar _ = Mavo.Collection = $.Class({\n\textends: Mavo.Node,\n\tconstructor: function (element, mavo, o) {\n\t\t/*\n\t\t * Create the template, remove it from the DOM and store it\n\t\t */\n\t\tthis.templateElement = this.element;\n\n\t\tthis.items = [];\n\n\t\t// ALL descendant property names as an array\n\t\tif (!this.fromTemplate([\"properties\", \"mutable\", \"templateElement\"])) {\n\t\t\tif (this.templateElement.matches(\"template\")) {\n\t\t\t\tvar div = document.createElement(this.templateElement.getAttribute(\"data-tag\") || \"mv-group\");\n\t\t\t\tdiv.classList.add(\"document-fragment\");\n\n\t\t\t\t$$(this.templateElement.attributes).forEach(attr => {\n\t\t\t\t\tdiv.setAttribute(attr.name, attr.value);\n\t\t\t\t});\n\n\t\t\t\tdiv.appendChild(document.importNode(this.templateElement.content, true));\n\t\t\t\tthis.templateElement.parentNode.replaceChild(div, this.templateElement);\n\t\t\t\tthis.element = this.templateElement = div;\n\t\t\t}\n\n\t\t\tthis.properties = $$(Mavo.selectors.property, this.templateElement).map(Mavo.Node.getProperty);\n\t\t\tthis.mutable = this.templateElement.matches(Mavo.selectors.multiple);\n\n\t\t\t// Must clone because otherwise once expressions are parsed on the template element\n\t\t\t// we will not be able to pick them up from subsequent items\n\t\t\tthis.templateElement = this.templateElement.cloneNode(true);\n\t\t}\n\n\t\tif (this.mutable) {\n\t\t\tvar item = this.createItem(this.element);\n\t\t\tthis.add(item);\n\t\t\tthis.itemTemplate = item.template || item;\n\t\t}\n\n\t\tMavo.hooks.run(\"collection-init-end\", this);\n\t},\n\n\tget length() {\n\t\treturn this.items.length;\n\t},\n\n\t// Collection still contains its template as data\n\tget containsTemplate() {\n\t\treturn this.items.length && this.items[0].element === this.element;\n\t},\n\n\tgetData: function(o) {\n\t\to = o || {};\n\n\t\tvar data = [];\n\n\t\tthis.items.forEach(item => {\n\t\t\tif (!item.deleted) {\n\t\t\t\tvar itemData = item.getData(o);\n\n\t\t\t\tif (itemData) {\n\t\t\t\t\tdata.push(itemData);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!o.dirty && this.unhandled) {\n\t\t\tdata = this.unhandled.before.concat(data, this.unhandled.after);\n\t\t}\n\n\t\treturn data;\n\t},\n\n\t// Create item but don't insert it anywhere\n\t// Mostly used internally\n\tcreateItem: function (element) {\n\t\tif (!element) {\n\t\t\telement = this.templateElement.cloneNode(true);\n\t\t}\n\n\t\tvar item = Mavo.Unit.create(element, this.mavo, {\n\t\t\tcollection: this,\n\t\t\ttemplate: this.itemTemplate || (this.template? this.template.itemTemplate : null),\n\t\t\tproperty: this.property,\n\t\t\ttype: this.type,\n\t\t\tdirty: true\n\t\t});\n\n\t\t// If container is a fake \"fragment\", strip element naked\n\t\tif (Mavo.is(\"documentFragment\", item.element)) {\n\t\t\titem.element = new Mavo.Fragment(item.element);\n\t\t}\n\t\t// Add delete & add buttons\n\t\telse if (this.mutable) {\n\t\t\t$.create({\n\t\t\t\tclassName: \"mv-item-controls mv-ui\",\n\t\t\t\tcontents: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttitle: \"Delete this \" + this.name,\n\t\t\t\t\t\tclassName: \"delete\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": evt => this.delete(item)\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttitle: \"Add new \" + this.name.replace(/s$/i, \"\"),\n\t\t\t\t\t\tclassName: \"add\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": evt => this.add(null, this.items.indexOf(item)).edit()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tinside: element\n\t\t\t});\n\t\t}\n\n\t\treturn item;\n\t},\n\n\t/**\n\t * Add a new item to this collection\n\t * @param item {Node|Mavo.Unit} Optional. Element or Mavo object for the new item\n\t * @param index {Number} Optional. Index of existing item, will be added opposite to list direction\n\t * @param silent {Boolean} Optional. Throw a datachange event? Mainly used internally.\n\t */\n\tadd: function(item, index, o = {}) {\n\t\tif (item instanceof Node) {\n\t\t\titem = Mavo.Unit.get(item) || this.createItem(item);\n\t\t}\n\t\telse {\n\t\t\titem = item || this.createItem();\n\t\t}\n\n\t\tif (index in this.items) {\n\t\t\tif (this.bottomUp) {\n\t\t\t\tindex++;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tindex = this.bottomUp? 0 : this.length;\n\t\t}\n\n\t\tif (!item.element.parentNode) {\n\t\t\t// Add it to the DOM, if not already in\n\t\t\tvar nextItem = this.items[index];\n\n\t\t\titem.element._.before(nextItem && nextItem.element || this.marker);\n\t\t}\n\n\t\t// Update internal data model\n\t\tthis.items.splice(index, 0, item);\n\n\t\tfor (let i = index - 1; i < this.length; i++) {\n\t\t\tlet item = this.items[i];\n\n\t\t\tif (item) {\n\t\t\t\titem.index = i;\n\n\t\t\t\tif (!o.silent) {\n\t\t\t\t\titem.element._.fire(\"mavo:datachange\", {\n\t\t\t\t\t\tnode: this,\n\t\t\t\t\t\tmavo: this.mavo,\n\t\t\t\t\t\taction: \"add\",\n\t\t\t\t\t\titem\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!o.silent) {\n\t\t\titem.unsavedChanges = this.mavo.unsavedChanges = true;\n\t\t}\n\n\t\treturn item;\n\t},\n\n\tpropagate: function() {\n\t\tthis.items.forEach(item => item.call.apply(item, arguments));\n\t},\n\n\tdelete: function(item, hard) {\n\t\tif (hard) {\n\t\t\t// Hard delete\n\t\t\t$.remove(item.element);\n\t\t\tthis.items.splice(this.items.indexOf(item), 1);\n\t\t\treturn;\n\t\t}\n\n\t\treturn $.transition(item.element, {opacity: 0}).then(() => {\n\t\t\titem.deleted = true; // schedule for deletion\n\t\t\titem.element.style.opacity = \"\";\n\n\t\t\titem.element._.fire(\"mavo:datachange\", {\n\t\t\t\tnode: this,\n\t\t\t\tmavo: this.mavo,\n\t\t\t\taction: \"delete\",\n\t\t\t\titem: item\n\t\t\t});\n\n\t\t\titem.unsavedChanges = this.mavo.unsavedChanges = true;\n\t\t});\n\t},\n\n\tedit: function() {\n\t\tif (this.length === 0 && this.required) {\n\t\t\t// Nested collection with no items, add one\n\t\t\tvar item = this.add(null, null, true);\n\n\t\t\titem.placeholder = true;\n\t\t\titem.walk(obj => obj.unsavedChanges = false);\n\n\t\t\t$.once(item.element, \"mavo:datachange\", evt => {\n\t\t\t\titem.unsavedChanges = true;\n\t\t\t\titem.placeholder = false;\n\t\t\t});\n\t\t}\n\n\t\tthis.propagate(obj => obj[obj.preEdit? \"preEdit\" : \"edit\"]());\n\t},\n\n\t/**\n\t * Delete all items in the collection.\n\t */\n\tclear: function() {\n\t\tif (this.mutable) {\n\t\t\tthis.propagate(item => {\n\t\t\t\tif (item.element.remove) {\n\t\t\t\t\titem.element.remove();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Document fragment, remove all children\n\t\t\t\t\t$$(item.element.childNodes).forEach(node => node.remove());\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.items = [];\n\n\t\t\tthis.marker._.fire(\"mavo:datachange\", {\n\t\t\t\tnode: this,\n\t\t\t\tmavo: this.mavo,\n\t\t\t\taction: \"clear\"\n\t\t\t});\n\t\t}\n\t},\n\n\tsave: function() {\n\t\tthis.items.forEach(item => {\n\t\t\tif (item.deleted) {\n\t\t\t\tthis.delete(item, true);\n\t\t\t}\n\t\t\telse {\n\t\t\t\titem.unsavedChanges = item.dirty = false;\n\t\t\t}\n\t\t});\n\t},\n\n\tdone: function() {\n\t\tthis.items.forEach(item => {\n\t\t\tif (item.placeholder) {\n\t\t\t\tthis.delete(item, true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t});\n\t},\n\n\tpropagated: [\"save\", \"done\"],\n\n\trevert: function() {\n\t\tthis.items.forEach((item, i) => {\n\t\t\t// Delete added items\n\t\t\tif (item.unsavedChanges && !item.placeholder) {\n\t\t\t\tthis.delete(item, true);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Bring back deleted items\n\t\t\t\tif (item.deleted) {\n\t\t\t\t\titem.deleted = false;\n\t\t\t\t}\n\n\t\t\t\t// Revert all properties\n\t\t\t\titem.revert();\n\t\t\t}\n\t\t});\n\t},\n\n\trender: function(data) {\n\t\tthis.unhandled = {before: [], after: []};\n\n\t\tif (!data) {\n\t\t\treturn;\n\t\t}\n\n\t\tdata = Mavo.toArray(data);\n\n\t\tif (!this.mutable) {\n\t\t\tthis.items.forEach((item, i) => item.render(data && data[i]));\n\n\t\t\tif (data) {\n\t\t\t\tthis.unhandled.after = data.slice(this.items.length);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.clear();\n\n\t\t\t// Using document fragments improved rendering performance by 60%\n\t\t\tvar fragment = document.createDocumentFragment();\n\n\t\t\tdata.forEach((datum, i) => {\n\t\t\t\tvar item = this.createItem();\n\n\t\t\t\titem.render(datum);\n\n\t\t\t\tthis.items.push(item);\n\t\t\t\titem.index = i;\n\n\t\t\t\tfragment.appendChild(item.element);\n\t\t\t});\n\n\t\t\tthis.marker.parentNode.insertBefore(fragment, this.marker);\n\t\t}\n\n\t\tthis.save();\n\t},\n\n\tfind: function(property) {\n\t\tvar items = this.items.filter(item => !item.deleted);\n\n\t\tif (this.property == property) {\n\t\t\treturn items;\n\t\t}\n\n\t\tif (this.properties.indexOf(property) > -1) {\n\t\t\tvar ret = items.map(item => item.find(property));\n\n\t\t\treturn Mavo.flatten(ret);\n\t\t}\n\t},\n\n\tlive: {\n\t\tmutable: function(value) {\n\t\t\tif (value && value !== this.mutable) {\n\t\t\t\t// Why is all this code here? Because we want it executed\n\t\t\t\t// every time mutable changes, not just in the constructor\n\t\t\t\t// (think multiple elements with the same property name, where only one has data-multiple)\n\t\t\t\tthis._mutable = value;\n\n\t\t\t\tthis.mavo.needsEdit = true;\n\n\t\t\t\tthis.required = this.templateElement.matches(Mavo.selectors.required);\n\n\t\t\t\t// Keep position of the template in the DOM, since we might remove it\n\t\t\t\tthis.marker = $.create(\"div\", {\n\t\t\t\t\thidden: true,\n\t\t\t\t\tclassName: \"mv-marker\",\n\t\t\t\t\tafter: this.templateElement\n\t\t\t\t});\n\n\t\t\t\tthis.templateElement.classList.add(\"mv-item\");\n\n\t\t\t\t// Insert the add button if it's not already in the DOM\n\t\t\t\tif (!this.addButton.parentNode) {\n\t\t\t\t\tif (this.bottomUp) {\n\t\t\t\t\t\tthis.addButton._.before($.value(this.items[0], \"element\") || this.marker);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar tag = this.element.tagName.toLowerCase();\n\t\t\t\t\t\tvar containerSelector = Mavo.selectors.container[tag];\n\n\t\t\t\t\t\tif (containerSelector) {\n\t\t\t\t\t\t\tvar after = this.marker.closest(containerSelector);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.addButton._.after(after && after.parentNode? after : this.marker);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tlazy: {\n\t\tbottomUp: function() {\n\t\t\t/*\n\t\t\t * Add new items at the top or bottom?\n\t\t\t */\n\n\t\t\tif (!this.mutable) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar order = this.templateElement.getAttribute(\"data-order\");\n\t\t\tif (order !== null) {\n\t\t\t\t// Attribute has the highest priority and overrides any heuristics\n\t\t\t\treturn /^desc\\b/i.test(order);\n\t\t\t}\n\n\t\t\tif (!this.addButton.parentNode) {\n\t\t\t\t// If add button not in DOM, do the default\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// If add button is already in the DOM and *before* our template, then we default to prepending\n\t\t\treturn !!(this.addButton.compareDocumentPosition(this.templateElement) & Node.DOCUMENT_POSITION_FOLLOWING);\n\t\t},\n\n\t\tclosestCollection: function() {\n\t\t\tvar parent = this.marker? this.marker.parentNode : this.templateElement.parentNode;\n\n\t\t\treturn parent.closest(Mavo.selectors.item);\n\t\t},\n\n\t\taddButton: function() {\n\t\t\t// Find add button if provided, or generate one\n\t\t\tvar selector = `button.add-${this.property}`;\n\t\t\tvar scope = this.closestCollection || this.marker.closest(Mavo.selectors.scope);\n\n\t\t\tif (scope) {\n\t\t\t\tvar button = $$(selector, scope).filter(button => {\n\t\t\t\t\treturn !this.templateElement.contains(button);\n\t\t\t\t})[0];\n\t\t\t}\n\n\t\t\tif (!button) {\n\t\t\t\tbutton = $.create(\"button\", {\n\t\t\t\t\tclassName: \"add\",\n\t\t\t\t\ttextContent: \"Add \" + this.name\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tbutton.classList.add(\"mv-ui\", \"mv-add\");\n\n\t\t\tif (this.property) {\n\t\t\t\tbutton.classList.add(`add-${this.property}`);\n\t\t\t}\n\n\t\t\tbutton.addEventListener(\"click\", evt => {\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tthis.add().edit();\n\t\t\t});\n\n\t\t\treturn button;\n\t\t}\n\t}\n});\n\n// TODO\nMavo.Fragment = $.Class({\n\tconstructor: function(element) {\n\t\tthis.childNodes = [];\n\n\t\t$$(element.childNodes).forEach(node => this.appendChild(node));\n\t},\n\n\tappendChild: function(node) {\n\t\tthis.childNodes.push(node);\n\t},\n\n\tclassList: {toggle: () => {}, add: () => {}, remove: () => {}, contains: () => {}}\n});\n\n})(Bliss, Bliss.$);\n\n/*\nCopyright (c) 2009 James Padolsey.  All rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions\nare met:\n\n   1. Redistributions of source code must retain the above copyright\n\t  notice, this list of conditions and the following disclaimer.\n\n   2. Redistributions in binary form must reproduce the above copyright\n\t  notice, this list of conditions and the following disclaimer in the\n\t  documentation and/or other materials provided with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY James Padolsey ``AS IS\"\" AND\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\nARE DISCLAIMED. IN NO EVENT SHALL James Padolsey OR CONTRIBUTORS BE LIABLE\nFOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\nDAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\nSERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\nCAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT\nLIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY\nOUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\nSUCH DAMAGE.\n\nThe views and conclusions contained in the software and documentation are\nthose of the authors and should not be interpreted as representing official\npolicies, either expressed or implied, of James Padolsey.\n\n AUTHOR James Padolsey (http://james.padolsey.com)\n VERSION 1.03.0\n UPDATED 29-10-2011\n CONTRIBUTORS\n\tDavid Waller\n    Benjamin Drucker\n\n*/\n\nvar prettyPrint = (function() {\n\n\t/* These \"util\" functions are not part of the core\n\t   functionality but are  all necessary - mostly DOM helpers */\n\n\tvar util = {\n\n\t\ttxt: function(t) {\n\t\t\t/* Create text node */\n\t\t\tt = t + \"\";\n\t\t\treturn document.createTextNode(t);\n\t\t},\n\n\t\trow: function(cells, type, cellType) {\n\n\t\t\t/* Creates new <tr> */\n\t\t\tcellType = cellType || \"td\";\n\n\t\t\t/* colSpan is calculated by length of null items in array */\n\t\t\tvar colSpan = util.count(cells, null) + 1,\n\t\t\t\ttr = $.create(\"tr\"), td,\n\t\t\t\tattrs = {\n\t\t\t\t\tcolSpan: colSpan\n\t\t\t\t};\n\n\t\t\t$$(cells).forEach(function(cell) {\n\t\t\t\tif (cell === null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t/* Default cell type is <td> */\n\t\t\t\ttd = $.create(cellType, attrs);\n\n\t\t\t\tif (cell.nodeType) {\n\t\t\t\t\t/* IsDomElement */\n\t\t\t\t\ttd.appendChild(cell);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t/* IsString */\n\t\t\t\t\ttd.innerHTML = util.shorten(cell.toString());\n\t\t\t\t}\n\n\t\t\t\ttr.appendChild(td);\n\t\t\t});\n\n\t\t\treturn tr;\n\t\t},\n\n\t\thRow: function(cells, type) {\n\t\t\t/* Return new <th> */\n\t\t\treturn util.row(cells, type, \"th\");\n\t\t},\n\n\t\ttable: function(headings, type) {\n\n\t\t\theadings = headings || [];\n\n\t\t\t/* Creates new table: */\n\t\t\tvar tbl = $.create(\"table\");\n\t\t\tvar thead = $.create(\"thead\");\n\t\t\tvar tbody = $.create(\"tbody\");\n\n\t\t\ttbl.classList.add(type);\n\n\t\t\tif (headings.length) {\n\t\t\t\ttbl.appendChild(thead);\n\t\t\t\tthead.appendChild( util.hRow(headings, type) );\n\t\t\t}\n\n\t\t\ttbl.appendChild(tbody);\n\n\t\t\treturn {\n\t\t\t\t/* Facade for dealing with table/tbody\n\t\t\t\t   Actual table node is this.node: */\n\t\t\t\tnode: tbl,\n\t\t\t\ttbody: tbody,\n\t\t\t\tthead: thead,\n\t\t\t\tappendChild: function(node) {\n\t\t\t\t\tthis.tbody.appendChild(node);\n\t\t\t\t},\n\t\t\t\taddRow: function(cells, _type, cellType) {\n\t\t\t\t\tthis.appendChild(util.row(cells, (_type || type), cellType));\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\tshorten: function(str) {\n\t\t\tvar max = 40;\n\t\t\tstr = str.replace(/^\\s\\s*|\\s\\s*$|\\n/g, \"\");\n\t\t\treturn str.length > max ? (str.substring(0, max-1) + \"...\") : str;\n\t\t},\n\n\t\thtmlentities: function(str) {\n\t\t\treturn str.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n\t\t},\n\n\t\tcount: function(arr, item) {\n\t\t\tvar count = 0;\n\t\t\tfor (var i = 0, l = arr.length; i< l; i++) {\n\t\t\t\tif (arr[i] === item) {\n\t\t\t\t\tcount++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn count;\n\t\t},\n\n\t\tthead: function(tbl) {\n\t\t\treturn tbl.getElementsByTagName(\"thead\")[0];\n\t\t},\n\n\t\twithin: function(ref) {\n\t\t\t/* Check existence of a val within an object\n\t\t\t   RETURNS KEY */\n\t\t\treturn {\n\t\t\t\tis: function(o) {\n\t\t\t\t\tfor (var i in ref) {\n\t\t\t\t\t\tif (ref[i] === o) {\n\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\tcommon: {\n\t\t\tcircRef: function(obj, key, settings) {\n\t\t\t\treturn util.expander(\n\t\t\t\t\t\"[POINTS BACK TO <strong>\" + (key) + \"</strong>]\",\n\t\t\t\t\t\"Click to show this item anyway\",\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tthis.parentNode.appendChild(prettyPrintThis(obj, {maxDepth:1}));\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tdepthReached: function(obj, settings) {\n\t\t\t\treturn util.expander(\n\t\t\t\t\t\"[DEPTH REACHED]\",\n\t\t\t\t\t\"Click to show this item anyway\",\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.parentNode.appendChild( prettyPrintThis(obj, {maxDepth:1}) );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\t\tthis.parentNode.appendChild(\n\t\t\t\t\t\t\t\tutil.table([\"ERROR OCCURED DURING OBJECT RETRIEVAL\"], \"error\").addRow([e.message]).node\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\n\t\texpander: function(text, title, clickFn) {\n\t\t\treturn $.create(\"a\", {\n\t\t\t\tinnerHTML:  util.shorten(text) + ' <b style=\"visibility:hidden;\">[+]</b>',\n\t\t\t\ttitle: title,\n\t\t\t\tonmouseover: function() {\n\t\t\t\t\tthis.getElementsByTagName(\"b\")[0].style.visibility = \"visible\";\n\t\t\t\t},\n\t\t\t\tonmouseout: function() {\n\t\t\t\t\tthis.getElementsByTagName(\"b\")[0].style.visibility = \"hidden\";\n\t\t\t\t},\n\t\t\t\tonclick: function() {\n\t\t\t\t\tthis.style.display = \"none\";\n\t\t\t\t\tclickFn.call(this);\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tstyle: {\n\t\t\t\t\tcursor: \"pointer\"\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t// Main..\n\tvar prettyPrintThis = function(obj, options) {\n\n\t\t /*\n\t\t *\t  obj :: Object to be printed\n\t\t *  options :: Options (merged with config)\n\t\t */\n\n\t\toptions = options || {};\n\n\t\tvar settings = $.extend( {}, prettyPrintThis.config, options ),\n\t\t\tcontainer = $.create(\"div\"),\n\t\t\tconfig = prettyPrintThis.config,\n\t\t\tcurrentDepth = 0,\n\t\t\tstack = {},\n\t\t\thasRunOnce = false;\n\n\t\t/* Expose per-call settings.\n\t\t   Note: \"config\" is overwritten (where necessary) by options/\"settings\"\n\t\t   So, if you need to access/change *DEFAULT* settings then go via \".config\" */\n\t\tprettyPrintThis.settings = settings;\n\n\t\tvar typeDealer = {\n\t\t\tstring : function(item) {\n\t\t\t\treturn util.txt('\"' + util.shorten(item.replace(/\"/g, '\\\\\"')) + '\"');\n\t\t\t},\n\n\t\t\tobject : function(obj, depth, key) {\n\n\t\t\t\t/* Checking depth + circular refs */\n\t\t\t\t/* Note, check for circular refs before depth; just makes more sense */\n\t\t\t\tvar stackKey = util.within(stack).is(obj);\n\n\t\t\t\tif ( stackKey ) {\n\t\t\t\t\treturn util.common.circRef(obj, stackKey, settings);\n\t\t\t\t}\n\n\t\t\t\tstack[key||\"TOP\"] = obj;\n\n\t\t\t\tif (depth === settings.maxDepth) {\n\t\t\t\t\treturn util.common.depthReached(obj, settings);\n\t\t\t\t}\n\n\t\t\t\tvar table = util.table([\"Group\", null], \"object\"),\n\t\t\t\t\tisEmpty = true;\n\n\t\t\t\tfor (var i in obj) {\n\t\t\t\t\tif (!obj.hasOwnProperty || obj.hasOwnProperty(i)) {\n\t\t\t\t\t\tvar item = obj[i],\n\t\t\t\t\t\t\ttype = $.type(item);\n\t\t\t\t\t\tisEmpty = false;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\ttable.addRow([i, typeDealer[ type ](item, depth+1, i)], type);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\t\t/* Security errors are thrown on certain Window/DOM properties */\n\t\t\t\t\t\t\tif (window.console && window.console.log) {\n\t\t\t\t\t\t\t\tconsole.log(e.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar ret = (settings.expanded || hasRunOnce) ? table.node : util.expander(\n\t\t\t\t\tJSON.stringify(obj),\n\t\t\t\t\t\"Click to show more\",\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tthis.parentNode.appendChild(table.node);\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\thasRunOnce = true;\n\n\t\t\t\treturn ret;\n\n\t\t\t},\n\n\t\t\tarray : function(arr, depth, key, jquery) {\n\n\t\t\t\t/* Checking depth + circular refs */\n\t\t\t\t/* Note, check for circular refs before depth; just makes more sense */\n\t\t\t\tvar stackKey = util.within(stack).is(arr);\n\n\t\t\t\tif ( stackKey ) {\n\t\t\t\t\treturn util.common.circRef(arr, stackKey);\n\t\t\t\t}\n\n\t\t\t\tstack[key||\"TOP\"] = arr;\n\n\t\t\t\tif (depth === settings.maxDepth) {\n\t\t\t\t\treturn util.common.depthReached(arr);\n\t\t\t\t}\n\n\t\t\t\t/* Accepts a table and modifies it */\n\t\t\t\tvar table = util.table([\"List (\" + arr.length + \" items)\", null], \"list\");\n\t\t\t\tvar isEmpty = true;\n                var count = 0;\n\n\t\t\t\t$$(arr).forEach(function (item, i) {\n                    if (settings.maxArray >= 0 && ++count > settings.maxArray) {\n                        table.addRow([\n                            i + \"..\" + (arr.length-1),\n                            typeDealer[ $.type(item) ](\"...\", depth+1, i)\n                        ]);\n                        return false;\n                    }\n\t\t\t\t\tisEmpty = false;\n\t\t\t\t\ttable.addRow([i, typeDealer[ $.type(item) ](item, depth+1, i)]);\n\t\t\t\t});\n\n\t\t\t\treturn settings.expanded ? table.node : util.expander(\n\t\t\t\t\tJSON.stringify(arr),\n\t\t\t\t\t\"Click to show more\",\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tthis.parentNode.appendChild(table.node);\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t},\n\n\t\t\t\"date\" : function(date) {\n\n\t\t\t\tvar miniTable = util.table([\"Date\", null], \"date\"),\n\t\t\t\t\tsDate = date.toString().split(/\\s/);\n\n\t\t\t\t/* TODO: Make this work well in IE! */\n\t\t\t\tminiTable\n\t\t\t\t\t.addRow([\"Time\", sDate[4]])\n\t\t\t\t\t.addRow([\"Date\", sDate.slice(0, 4).join(\"-\")]);\n\n\t\t\t\treturn settings.expanded ? miniTable.node : util.expander(\n\t\t\t\t\t\"Date (timestamp): \" + (+date),\n\t\t\t\t\t\"Click to see a little more info about this date\",\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tthis.parentNode.appendChild(miniTable.node);\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t}\n\t\t};\n\n\t\ttypeDealer.number =\n\t\ttypeDealer.boolean =\n\t\ttypeDealer.undefined =\n\t\ttypeDealer.null =\n\t\ttypeDealer.default = function(value) {\n\t\t\treturn util.txt(value);\n\t\t},\n\n\t\tcontainer.appendChild(typeDealer[$.type(obj)](obj, currentDepth));\n\n\t\treturn container;\n\n\t};\n\n\t/* Configuration */\n\n\t/* All items can be overwridden by passing an\n\t   \"options\" object when calling prettyPrint */\n\tprettyPrintThis.config = {\n\t\t/* Try setting this to false to save space */\n\t\texpanded: true,\n\n\t\tmaxDepth: 10,\n\t\tmaxArray: -1  // default is unlimited\n\t};\n\n\treturn prettyPrintThis;\n\n})();\n\n(function($, $$) {\n\nvar _ = Mavo.Debug = {\n\tfriendlyError: (e, expr) => {\n\t\tvar type = e.constructor.name.replace(/Error$/, \"\").toLowerCase();\n\t\tvar message = e.message;\n\n\t\t// Friendlify common errors\n\n\t\t// Non-developers don't know wtf a token is.\n\t\tmessage = message.replace(/\\s+token\\s+/g, \" \");\n\n\t\tif (message == \"Unexpected }\" && !/[{}]/.test(expr)) {\n\t\t\tmessage = \"Missing a )\";\n\t\t}\n\t\telse if (message === \"Unexpected )\") {\n\t\t\tmessage = \"Missing a (\";\n\t\t}\n\t\telse if (message === \"Invalid left-hand side in assignment\") {\n\t\t\tmessage = \"Invalid assignment. Maybe you typed = instead of == ?\";\n\t\t}\n\t\telse if (message == \"Unexpected ILLEGAL\") {\n\t\t\tmessage = \"There is an invalid character somewhere.\";\n\t\t}\n\n\t\treturn `<span class=\"type\">Oh noes, a ${type} error!</span> ${message}`;\n\t},\n\n\telementLabel: function(element, attribute) {\n\t\tvar ret = element.nodeName.toLowerCase();\n\n\t\tif (element.hasAttribute(\"property\")) {\n\t\t\tret += `[property=${element.getAttribute(\"property\")}]`;\n\t\t}\n\t\telse if (element.id) {\n\t\t\tret += `#${element.id}`;\n\t\t}\n\t\telse if (element.classList.length) {\n\t\t\tret += $$(element.classList).map(c => `.${c}`).join(\"\");\n\t\t}\n\n\t\tif (attribute) {\n\t\t\tret += `@${attribute}`;\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tprintValue: function(obj) {\n\t\tvar ret;\n\n\t\tif (typeof obj !== \"object\" || obj === null) {\n\t\t\treturn typeof obj == \"string\"? `\"${obj}\"` : obj + \"\";\n\t\t}\n\n\t\tif (Array.isArray(obj)) {\n\t\t\tif (obj.length > 0) {\n\t\t\t\tif (typeof obj[0] === \"object\") {\n\t\t\t\t\treturn `List: ${obj.length} group(s)`;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn \"List: \" + obj.map(_.printValue).join(\", \");\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn \"List: (Empty)\";\n\t\t\t}\n\t\t}\n\n\t\tif (obj.constructor === Object) {\n\t\t\treturn `Group with ${Object.keys(obj).length} properties`;\n\t\t}\n\n\t\tif (obj instanceof Mavo.Primitive) {\n\t\t\treturn _.printValue(obj.value);\n\t\t}\n\t\telse if (obj instanceof Mavo.Collection) {\n\t\t\tif (obj.items.length > 0) {\n\t\t\t\tif (obj.items[0] instanceof Mavo.Scope) {\n\t\t\t\t\treturn `List: ${obj.items.length} group(s)`;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn \"List: \" + obj.items.map(_.printValue).join(\", \");\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn _.printValue([]);\n\t\t\t}\n\t\t}\n\t\telse if (obj instanceof Mavo.Scope) {\n\t\t\t// Group\n\t\t\treturn `Group with ${obj.propertyNames.length} properties`;\n\t\t}\n\t},\n\n\ttimed: function(id, callback) {\n\t\treturn function() {\n\t\t\tconsole.time(id);\n\t\t\tcallback.apply(this, arguments);\n\t\t\tconsole.timeEnd(id);\n\t\t};\n\t},\n\n\ttime: function callee(objName, name) {\n\t\tvar obj = eval(objName);\n\t\tvar callback = obj[name];\n\n\t\tobj[name] = function callee() {\n\t\t\tvar before = performance.now();\n\t\t\tvar ret = callback.apply(this, arguments);\n\t\t\tcallee.timeTaken += performance.now() - before;\n\t\t\tobj[name].calls++;\n\t\t\treturn ret;\n\t\t};\n\n\t\tobj[name].timeTaken = obj[name].calls = 0;\n\n\t\tcallee.all = callee.all || [];\n\t\tcallee.all.push({obj, objName, name});\n\n\t\treturn obj[name];\n\t},\n\n\ttimes: function() {\n\t\tif (!_.time.all) {\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.table(_.time.all.map(o => {\n\t\t\treturn {\n\t\t\t\t\"Function\": `${o.objName}.${o.name}`,\n\t\t\t\t\"Time (ms)\": o.obj[o.name].timeTaken,\n\t\t\t\t\"Calls\": o.obj[o.name].calls\n\t\t\t};\n\t\t}));\n\t},\n\n\treservedWords: \"as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield\".split(\"|\")\n};\n\nMavo.prototype.render = _.timed(\"render\", Mavo.prototype.render);\n\nMavo.selectors.debug = \".debug\";\n\nvar selector = \", .mv-debuginfo\";\nMavo.Expressions.escape += selector;\nStretchy.selectors.filter += selector;\n\n// Add element to show saved data\nMavo.hooks.add(\"init-tree-after\", function() {\n\tif (this.root.debug) {\n\t\tthis.wrapper.classList.add(\"debug-saving\");\n\t}\n\n\tif (this.store && this.wrapper.classList.contains(\"debug-saving\")) {\n\t\tvar element;\n\n\t\tvar details = $.create(\"details\", {\n\t\t\tclassName: \"mv-debug-storage\",\n\t\t\tcontents: [\n\t\t\t\t{tag: \"Summary\", textContent: \"Saved data\"},\n\t\t\t\telement = $.create(\"pre\", {id: this.id + \"-debug-storage\"})\n\t\t\t],\n\t\t\tafter: this.wrapper\n\t\t});\n\n\t\tthis.wrapper.addEventListener(\"mavo:save\", evt => {\n\t\t\telement.innerHTML = \"\";\n\n\t\t\telement.appendChild(prettyPrint(evt.data));\n\t\t});\n\t}\n});\n\nMavo.hooks.add(\"render-start\", function({data}) {\n\tif (this.storage && this.wrapper.classList.contains(\"debug-saving\")) {\n\t\tvar element = $(`#${this.id}-debug-storage`);\n\n\t\tif (element) {\n\t\t\telement.innerHTML = \"\";\n\n\t\t\tif (data) {\n\t\t\t\telement.appendChild(prettyPrint(data));\n\t\t\t}\n\t\t}\n\t}\n});\n\nMavo.hooks.add(\"scope-init-start\", function() {\n\tthis.debug = this.debug || this.walkUp(scope => {\n\t\tif (scope.debug) {\n\t\t\treturn true;\n\t\t}\n\t}) || Mavo.urlParam(\"debug\") !== null;\n\n\tif (!this.debug && this.element.closest(Mavo.selectors.debug)) {\n\t\tthis.debug = true;\n\t}\n\n\tif (this.debug) {\n\t\tthis.debug = $.create(\"tbody\", {\n\t\t\tinside: $.create(\"table\", {\n\t\t\t\tinnerHTML: `<thead><tr>\n\t\t\t\t\t<th></th>\n\t\t\t\t\t<th>Expression</th>\n\t\t\t\t\t<th>Value</th>\n\t\t\t\t\t<th>Element</th>\n\t\t\t\t</tr></thead>`,\n\t\t\t\tstyle: {\n\t\t\t\t\tdisplay: \"none\"\n\t\t\t\t},\n\t\t\t\tinside: $.create(\"details\", {\n\t\t\t\t\tclassName: \"mv-ui mv-debuginfo\",\n\t\t\t\t\tinside: this.element,\n\t\t\t\t\tcontents: $.create(\"summary\", {\n\t\t\t\t\t\ttextContent: \"Debug\"\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\t}\n}, true);\n\nMavo.hooks.add(\"unit-init-end\", function() {\n\tif (this.collection) {\n\t\tthis.debug = this.collection.debug;\n\t}\n});\n\nMavo.hooks.add(\"expressions-init-start\", function() {\n\tthis.debug = this.scope.debug;\n});\n\nMavo.hooks.add(\"expression-eval-beforeeval\", function() {\n\tif (this.debug) {\n\t\tthis.debug.classList.remove(\"error\");\n\t}\n});\n\nMavo.hooks.add(\"expression-eval-error\", function(env) {\n\tif (this.debug) {\n\t\tthis.debug.innerHTML = _.friendlyError(env.exception, env.expression);\n\t\tthis.debug.classList.add(\"error\");\n\t}\n});\n\nMavo.Scope.prototype.debugRow = function({element, attribute = null, tds = []}) {\n\tif (!this.debug) {\n\t\treturn;\n\t}\n\n\tthis.debug.parentNode.style.display = \"\";\n\n\tvar type = tds[0];\n\n\ttds[0] = $.create(\"td\", {\n\t\ttitle: type\n\t});\n\n\tif (!tds[3]) {\n\t\tvar elementLabel = _.elementLabel(element, attribute);\n\n\t\ttds[3] = $.create(\"td\", {\n\t\t\ttextContent: elementLabel,\n\t\t\ttitle: elementLabel,\n\t\t\tevents: {\n\t\t\t\t\"mouseenter mouseleave\": evt => {\n\t\t\t\t\telement.classList.toggle(\"mv-highlight\", evt.type === \"mouseenter\");\n\t\t\t\t},\n\t\t\t\t\"click\": evt => {\n\t\t\t\t\telement.scrollIntoView({behavior: \"smooth\"});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\ttds = tds.map(td => {\n\t\tif (!(td instanceof Node)) {\n\t\t\treturn $.create(\"td\", typeof td == \"object\"? td : { textContent: td });\n\t\t}\n\n\t\treturn td;\n\t});\n\n\tif (type == \"Warning\") {\n\t\ttds[1].setAttribute(\"colspan\", 2);\n\t}\n\n\tvar tr = $.create(\"tr\", {\n\t\tclassName: \"debug-\" + type.toLowerCase(),\n\t\tcontents: tds,\n\t\tinside: this.debug\n\t});\n};\n\nMavo.hooks.add(\"expressiontext-init-end\", function() {\n\tif (this.scope.debug) {\n\t\tthis.debug = {};\n\n\t\tthis.template.forEach(expr => {\n\t\t\tif (expr instanceof Mavo.Expression) {\n\t\t\t\tthis.scope.debugRow({\n\t\t\t\t\telement: this.element,\n\t\t\t\t\tattribute: this.attribute,\n\t\t\t\t\ttds: [\"Expression\", {\n\t\t\t\t\t\t\ttag: \"td\",\n\t\t\t\t\t\t\tcontents: {\n\t\t\t\t\t\t\t\ttag: \"textarea\",\n\t\t\t\t\t\t\t\tvalue: expr.expression,\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tinput: evt => {\n\t\t\t\t\t\t\t\t\t\texpr.expression = evt.target.value;\n\t\t\t\t\t\t\t\t\t\tthis.update(this.data);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonce: {\n\t\t\t\t\t\t\t\t\tfocus: evt => Stretchy.resize(evt.target)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\texpr.debug = $.create(\"td\")\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n\nMavo.hooks.add(\"scope-init-end\", function() {\n\t// TODO make properties update, collapse duplicate expressions\n\tif (this.debug instanceof Node) {\n\t\t// We have a debug table, add stuff to it\n\n\t\tvar selector = Mavo.selectors.andNot(Mavo.selectors.multiple, Mavo.selectors.property);\n\t\t$$(selector, this.element).forEach(element => {\n\t\t\tthis.debugRow({\n\t\t\t\telement,\n\t\t\t\ttds: [\"Warning\", \"data-multiple without a property attribute\"]\n\t\t\t});\n\t\t});\n\n\t\tthis.propagate(obj => {\n\t\t\tvar value = _.printValue(obj);\n\n\t\t\tthis.debugRow({\n\t\t\t\telement: obj.element,\n\t\t\t\ttds: [\"Property\", obj.property, obj.value]\n\t\t\t});\n\n\t\t\tif (_.reservedWords.indexOf(obj.property) > -1) {\n\t\t\t\tthis.debugRow({\n\t\t\t\t\telement: obj.element,\n\t\t\t\t\ttds: [\"Warning\", `You can’t use \"${obj.property}\" as a property name, it’s a reserved word.`]\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (/^\\d|[\\W$]/.test(obj.property)) {\n\t\t\t\tthis.debugRow({\n\t\t\t\t\telement: obj.element,\n\t\t\t\t\ttds: [\"Warning\", {\n\t\t\t\t\t\ttextContent: `You can’t use \"${obj.property}\" as a property name.`,\n\t\t\t\t\t\ttitle: \"Property names can only contain letters, numbers and underscores and cannot start with a number.\"\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.scope.element.addEventListener(\"mavo:datachange\", evt => {\n\t\t\t$$(\"tr.debug-property\", this.debug).forEach(tr => {\n\t\t\t\tvar property = tr.cells[1].textContent;\n\t\t\t\tvar value = _.printValue(this.properties[property]);\n\n\t\t\t\tif (tr.cells[2]) {\n\t\t\t\t\tvar td = tr.cells[2];\n\t\t\t\t\ttd.textContent = td.title = value;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n\nMavo.hooks.add(\"expressiontext-update-beforeeval\", function(env) {\n\tif (this.debug) {\n\t\tenv.td = env.expr.debug;\n\n\t\tif (env.td) {\n\t\t\tenv.td.classList.remove(\"error\");\n\t\t}\n\t}\n});\n\nMavo.hooks.add(\"expressiontext-update-aftereval\", function(env) {\n\tif (env.td && !env.td.classList.contains(\"error\")) {\n\t\tvar value = _.printValue(env.value);\n\t\tenv.td.textContent = env.td.title = value;\n\t}\n});\n\n// Mavo.Debug.time(\"Mavo.Expressions.prototype\", \"update\");\n\n})(Bliss, Bliss.$);\n\n(function($) {\n\nif (!self.Mavo) {\n\treturn;\n}\n\nvar dropboxURL = \"//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js\";\n\nMavo.Storage.Backend.register($.Class({\n\textends: Mavo.Storage.Backend,\n\tid: \"Dropbox\",\n\tconstructor: function() {\n\t\t// Transform the dropbox shared URL into something raw and CORS-enabled\n\t\tthis.url = new URL(this.url, location);\n\n\t\tif (this.url.protocol != \"dropbox:\") {\n\t\t\tthis.url.hostname = \"dl.dropboxusercontent.com\";\n\t\t\tthis.url.search = this.url.search.replace(/\\bdl=0|^$/, \"raw=1\");\n\t\t\tthis.permissions.on(\"read\"); // TODO check if file actually is publicly readable\n\t\t}\n\n\t\tthis.permissions.on(\"login\");\n\n\t\tthis.ready = $.include(self.Dropbox, dropboxURL).then((() => {\n\t\t\tvar referrer = new URL(document.referrer, location);\n\n\t\t\tif (referrer.hostname === \"www.dropbox.com\" && location.hash.indexOf(\"#access_token=\") === 0) {\n\t\t\t\t// We’re in an OAuth response popup, do what you need then close this\n\t\t\t\tDropbox.AuthDriver.Popup.oauthReceiver();\n\t\t\t\t$.fire(window, \"load\"); // hack because dropbox.js didn't foresee use cases like ours :/\n\t\t\t\tclose();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Internal filename (to be used for saving)\n\t\t\tthis.filename = (this.storage.param(\"path\") || \"\") + (new URL(this.url)).pathname.match(/[^/]*$/)[0];\n\n\t\t\tthis.key = this.storage.param(\"key\") || \"fle6gsc61w5v79j\";\n\n\t\t\tthis.client = new Dropbox.Client({ key: this.key });\n\t\t})).then(() => {\n\t\t\tthis.login(true);\n\t\t});\n\t},\n\n\t/**\n\t * Saves a file to the backend.\n\t * @param {Object} file - An object with name & data keys\n\t * @return {Promise} A promise that resolves when the file is saved.\n\t */\n\tput: function(file = this.getFile()) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.client.writeFile(file.name, file.dataString, function(error, stat) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn reject(Error(error));\n\t\t\t\t}\n\n\t\t\t\tconsole.log(\"File saved as revision \" + stat.versionTag);\n\t\t\t\tresolve(file);\n\t\t\t});\n\t\t});\n\t},\n\n\tlogin: function(passive) {\n\t\treturn this.ready.then(() => {\n\t\t\treturn this.client.isAuthenticated()? Promise.resolve() : new Promise((resolve, reject) => {\n\t\t\t\tthis.client.authDriver(new Dropbox.AuthDriver.Popup({\n\t\t\t\t    receiverUrl: new URL(location) + \"\"\n\t\t\t\t}));\n\n\t\t\t\tthis.client.authenticate({interactive: !passive}, (error, client) => {\n\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\treject(Error(error));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.client.isAuthenticated()) {\n\t\t\t\t\t\t// TODO check if can actually edit the file\n\t\t\t\t\t\tthis.permissions.on([\"logout\", \"edit\"]);\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.permissions.off([\"logout\", \"edit\", \"add\", \"delete\"]);\n\n\t\t\t\t\t\treject();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}).then(() => {\n\t\t\t// Not returning a promise here, since processes depending on login don't need to wait for this\n\t\t\tthis.client.getAccountInfo((error, accountInfo) => {\n\t\t\t\tif (!error) {\n\t\t\t\t\t$.fire(this.mavo.wrapper, \"mavo:login\", $.extend({backend: this}, accountInfo));\n\t\t\t\t}\n\t\t\t});\n\t\t}).catch(() => {});\n\t},\n\n\tlogout: function() {\n\t\treturn !this.client.isAuthenticated()? Promise.resolve() : new Promise((resolve, reject) => {\n\t\t\tthis.client.signOut(null, () => {\n\t\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\"]).on(\"login\");\n\n\t\t\t\tthis.mavo.wrapper._.fire(\"mavo:logout\", {backend: this});\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\n\t},\n\n\tstatic: {\n\t\ttest: function(url) {\n\t\t\turl = new URL(url, location);\n\t\t\treturn /dropbox.com/.test(url.host) || url.protocol === \"dropbox:\";\n\t\t}\n\t}\n}));\n\n})(Bliss);\n\n(function($) {\n\nif (!self.Mavo) {\n\treturn;\n}\n\nvar _ = Mavo.Storage.Backend.register($.Class({\n\textends: Mavo.Storage.Backend,\n\tid: \"Github\",\n\tconstructor: function() {\n\t\tthis.permissions.on(\"login\");\n\n\t\tthis.key = this.storage.param(\"key\") || \"7e08e016048000bc594e\";\n\n\t\t// Extract info for username, repo, branch, filename, filepath from URL\n\t\tthis.url = new URL(this.url, location);\n\t\t$.extend(this, _.parseURL(this.url));\n\t\tthis.repo = this.repo || \"mv-data\";\n\t\tthis.branch = this.branch || \"master\";\n\t\tthis.path = this.path || `${this.mavo.id}.json`;\n\t\tthis.filename = this.filename || this.path.match(/[^/]*$/)[0];\n\n\t\t// Transform the Github URL into something raw and CORS-enabled\n\t\tthis.url = new URL(`https://raw.githubusercontent.com/${this.username}/${this.repo}/${this.branch}/${this.path}?ts=${Date.now()}`);\n\t\tthis.permissions.on(\"read\"); // TODO check if file actually is publicly readable\n\n\t\tthis.login(true);\n\t},\n\n\tget authenticated () {\n\t\treturn !!this.accessToken;\n\t},\n\n\treq: function(call, data, method = \"GET\", o = {method: method}) {\n\t\tif (data) {\n\t\t\to.data =  JSON.stringify(data);\n\t\t}\n\n\t\treturn $.fetch(\"https://api.github.com/\" + call, $.extend(o, {\n\t\t\tresponseType: \"json\",\n\t\t\theaders: {\n\t\t\t\t\"Authorization\": `token ${this.accessToken}`\n\t\t\t}\n\t\t}))\n\t\t.catch(err => {\n\t\t\tif (err && err.xhr) {\n\t\t\t\treturn Promise.reject(err.xhr);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconsole.error(err);\n\t\t\t\tconsole.log(err.stack);\n\t\t\t}\n\t\t})\n\t\t.then(xhr => Promise.resolve(xhr.response));\n\t},\n\n\tget: Mavo.Storage.Backend.Remote.prototype.get,\n\n\t/**\n\t * Saves a file to the backend.\n\t * @param {Object} file - An object with name & data keys\n\t * @return {Promise} A promise that resolves when the file is saved.\n\t */\n\tput: function(file = this.getFile()) {\n\t\tvar fileCall = `repos/${this.username}/${this.repo}/contents/${file.path}`;\n\n\t\treturn Promise.resolve(this.repoInfo || this.req(\"user/repos\", {\n\t\t\tname: this.repo\n\t\t}, \"POST\"))\n\t\t.then(repoInfo => {\n\t\t\tthis.repoInfo = repoInfo;\n\n\t\t\treturn this.req(fileCall, {\n\t\t\t\tref: this.branch\n\t\t\t});\n\t\t})\n\t\t.then(fileInfo => {\n\t\t\treturn this.req(fileCall, {\n\t\t\t\tmessage: `Updated ${file.name || \"file\"}`,\n\t\t\t\tcontent: _.btoa(file.dataString),\n\t\t\t\tbranch: this.branch,\n\t\t\t\tsha: fileInfo.sha\n\t\t\t}, \"PUT\");\n\t\t}, xhr => {\n\t\t\tif (xhr.status == 404) {\n\t\t\t\t// File does not exist, create it\n\t\t\t\treturn this.req(fileCall, {\n\t\t\t\t\tmessage: \"Created file\",\n\t\t\t\t\tcontent: _.btoa(file.dataString),\n\t\t\t\t\tbranch: this.branch\n\t\t\t\t}, \"PUT\");\n\t\t\t}\n\t\t}).then(data => {\n\t\t\tconsole.log(\"success\");\n\t\t\treturn file;\n\t\t});\n\t},\n\n\tlogin: function(passive) {\n\t\treturn this.ready.then(() => {\n\t\t\tif (this.authenticated) {\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\treturn (new Promise((resolve, reject) => {\n\t\t\t\tif (passive) {\n\t\t\t\t\tthis.accessToken = localStorage[\"mavo:githubtoken\"];\n\n\t\t\t\t\tif (this.accessToken) {\n\t\t\t\t\t\tresolve(this.accessToken);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Show window\n\t\t\t\t\tthis.authPopup = open(`https://github.com/login/oauth/authorize?client_id=${this.key}&scope=repo,gist&state=${location.href}`,\n\t\t\t\t\t\t\"popup\", \"width=900,height=500\");\n\n\t\t\t\t\taddEventListener(\"message\", evt => {\n\t\t\t\t\t\tif (evt.source === this.authPopup) {\n\t\t\t\t\t\t\tthis.accessToken = localStorage[\"mavo:githubtoken\"] = evt.data;\n\n\t\t\t\t\t\t\tif (!this.accessToken) {\n\t\t\t\t\t\t\t\treject(Error(\"Authentication error\"));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(this.accessToken);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}))\n\t\t\t.then(() => this.getUser())\n\t\t\t.then(u => {\n\t\t\t\tthis.permissions.on(\"logout\");\n\n\t\t\t\treturn this.req(`repos/${this.username}/${this.repo}`);\n\t\t\t})\n\t\t\t.then(repoInfo => {\n\t\t\t\tthis.repoInfo = repoInfo;\n\n\t\t\t\tif (repoInfo.permissions.push) {\n\t\t\t\t\tthis.permissions.on([\"edit\", \"save\"]);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(xhr => {\n\t\t\t\tif (xhr.status == 404) {\n\t\t\t\t\t// Repo does not exist so we can't check permissions\n\t\t\t\t\t// Just check if authenticated user is the same as our URL username\n\t\t\t\t\tif (this.user.login == this.username) {\n\t\t\t\t\t\tthis.permissions.on(\"edit\", \"save\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tlogout: function() {\n\t\tif (this.authenticated) {\n\t\t\tlocalStorage.removeItem(\"mavo:githubtoken\");\n\t\t\tdelete this.accessToken;\n\n\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\", \"save\"]).on(\"login\");\n\n\t\t\tthis.mavo.wrapper._.fire(\"mavo:logout\", {backend: this});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t},\n\n\tgetUser: function() {\n\t\treturn this.req(\"user\").then(accountInfo => {\n\t\t\tthis.user = accountInfo;\n\n\t\t\tvar name = accountInfo.name || accountInfo.login;\n\t\t\t$.fire(this.mavo.wrapper, \"mavo:login\", {\n\t\t\t\tbackend: this,\n\t\t\t\tname: `<a href=\"https://github.com/${accountInfo.login}\" target=\"_blank\">\n\t\t\t\t\t\t\t<img class=\"avatar\" src=\"${accountInfo.avatar_url}\" /> ${name}\n\t\t\t\t\t\t</a>`\n\t\t\t});\n\t\t});\n\t},\n\n\tstatic: {\n\t\ttest: function(url) {\n\t\t\turl = new URL(url, location);\n\t\t\treturn /\\bgithub.(com|io)|raw.githubusercontent.com/.test(url.host);\n\t\t},\n\n\t\t/**\n\t\t * Parse Github URLs, return username, repo, branch, path\n\t\t */\n\t\tparseURL: function(url) {\n\t\t\tvar ret = {};\n\n\t\t\turl = new URL(url, location);\n\n\t\t\tvar path = url.pathname.slice(1).split(\"/\");\n\n\t\t\tif (/github.io$/.test(url.host)) {\n\t\t\t\tret.username = url.host.match(/([\\w-]+)\\.github\\.io$/)[1];\n\t\t\t\tret.branch = \"gh-pages\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\tret.username = path.shift();\n\t\t\t}\n\n\t\t\tret.repo = path.shift();\n\n\t\t\tif (/raw.githubusercontent.com$/.test(url.host)) {\n\t\t\t\tret.branch = path.shift();\n\t\t\t}\n\t\t\telse if (/github.com$/.test(url.host) && path[0] == \"blob\") {\n\t\t\t\tpath.shift();\n\t\t\t\tret.branch = path.shift();\n\t\t\t}\n\n\t\t\tret.filename = path[path.length - 1];\n\n\t\t\tret.path = path.join(\"/\");\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tbtoa: str => btoa(unescape(encodeURIComponent(str)))\n\t}\n}));\n\n})(Bliss);\n\n//# sourceMappingURL=mavo.js.map\n"],"sourceRoot":"/source/"}