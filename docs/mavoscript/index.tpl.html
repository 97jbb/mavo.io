@@include('_head-docs.html', {
	"title": "MavoScript"
})
<body class="language-markup">

@@include('_header.html')

<h2>MavoScript</h2>

<section>
	<p>
		<em>MavoScript</em> is Mavo's simple expression language, used in <a href="/docs/expressions">Mavo expressions</a>.
	</p>
</section>

<section>
	<h1>Special properties</h1>

	<p>Special properties are available on every Mavo and start with a dollar ($) sign. Some of them have more information that you can access with a dot.</p>

	<table mv-app>
		<thead>
			<tr>
				<th>Property</th>
				<th>Description</th>
				<th>Current value(s)</th>
			</tr>
		</thead>
		<tr>
			<td><code>$now</code></td>
			<td>Current date and time as number of milliseconds since January 1st, 1970. Mostly useful with <a href="#date-and-time-functions">date and time functions</a> or the <code>mod</code> operator. Updated every 100ms.</td>
			<td>[$now]</td>
		</tr>
		<tr>
			<td><code>$startup</code></td>
			<td>The value of <code>$now</code> when the page loaded.</td>
			<td>[$startup]</td>
		</tr>
		<tr>
			<td><code>$today</code></td>
			<td>Current date.</td>
			<td>[$today]</td>
		</tr>
		<tr>
			<td><code>$hash</code></td>
			<td>The URL hash (without the <code>#</code> sign)</td>
			<td>[$hash]</td>
		</tr>
		<tr>
			<td><code>$mouse</code></td>
			<td>Mouse coordinates relative to the viewport. Use <code>$mouse.x</code> and <code>$mouse.y</code> to get them.</td>
			<td>[$mouse.x], [$mouse.y]</td>
		</tr>

		<tr>
			<td><code>$index</code></td>
			<td colspan="2">If inside a collection, the closest item’s position in its collection, starting from 0.</td>
		</tr>
		<tr>
			<td><code>$previous</code></td>
			<td colspan="2">If inside a collection, the closest item’s previous item.</td>
		</tr>
		<tr>
			<td><code>$next</code></td>
			<td colspan="2">If inside a collection, the closest item’s next item.</td>
		</tr>
	</table>
</section>

<section id="list-functions">
	<h1>List Functions</h1>
	<p>The following functions are useful with properties that have multiple values, i.e. are on or inside a <code>mv-multiple</code> element.</p>

	<table>
		<thead>
			<tr>
				<th>Function</th>
				<th>What it does</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td><code>count(property)</code></td>
				<td>Count how many items in a list actually have a value.</td>
			</tr>
			<tr>
				<td><code>sum(property)</code></td>
				<td>Sum all numbers in the list.</td>
			</tr>
			<tr>
				<td><code>average(property)</code></td>
				<td>Calculate the average of all numbers in the list.</td>
			</tr>
			<tr>
				<td><code>min(property)</code></td>
				<td>Calculate the minimum of all numbers in the list.</td>
			</tr>
			<tr>
				<td><code>max(property)</code></td>
				<td>Calculate the maximum of all numbers in the list.</td>
			</tr>
			<tr>
				<td><code>last(property)</code></td>
				<td>Get the last item</td>
			</tr>
		</tbody>
	</table>
</section>

<section id="math-functions">
	<h1>Math and logical Functions</h1>

	<section>
		<h1>Functions with operators</h1>

		<p>Usually, you don't need to use a function for the following, you can just use the syntax in the first column.
			However, functions may still be useful for applying the operation between all values from a collection. E.g. <code>add(age)</code>
			where "age" is a property inside a collection will add all ages together (basically the same as <code>sum(age)</code>).
		</p>

		<table>
			<thead>
				<tr>
					<th>Math</th>
					<th>Function</th>
					<th>What it does</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><code>a + b</code></td>
					<td><code>add(a, b)</code></td>
					<td>Addition</td>
				</tr>
				<tr>
					<td><code>a - b</code></td>
					<td><code>subtract(a, b)</code></td>
					<td>Subtraction</td>
				</tr>
				<tr>
					<td><code>a * b</code></td>
					<td><code>multiply(a, b)</code></td>
					<td>Multiplication</td>
				</tr>
				<tr>
					<td><code>a / b</code></td>
					<td><code>div(a, b)</code></td>
					<td>Division. Note that division by 0 will show up as ±∞ or <code>NaN</code> if it’s 0/0.</td>
				</tr>
				<tr>
					<td><code>a mod b</code></td>
					<td><code>mod(a, b)</code></td>
					<td>Remainder of a / b.</td>
				</tr>
				<tr>
					<td><code>a and b</code></td>
					<td><code>and(a, b)</code></td>
					<td>Check that both a and b have a value</td>
				</tr>
				<tr>
					<td><code>a or b</code></td>
					<td><code>or(a, b)</code></td>
					<td>Check that at least a or b have a value</td>
				</tr>
				<tr>
					<td><code>!a</code></td>
					<td><code>not(a)</code></td>
					<td>Check if a doesn’t have a value</td>
				</tr>
				<tr>
					<td><code>a < b</code></td>
					<td><code>lt(a, b)</code></td>
					<td>Check if a is less than b</td>
				</tr>
				<tr>
					<td><code>a <= b</code></td>
					<td><code>lte(a, b)</code></td>
					<td>Check if a is less than, or equal to b</td>
				</tr>
				<tr>
					<td><code>a > b</code></td>
					<td><code>gt(a, b)</code></td>
					<td>Check if a is greater than b</td>
				</tr>
				<tr>
					<td><code>a >= b</code></td>
					<td><code>gte(a, b)</code></td>
					<td>Check if a is greater than, or equal to b</td>
				</tr>
				<tr>
					<td><code>a = b</code></td>
					<td><code>eq(a, b)</code></td>
					<td>Check if a is equal to b</td>
				</tr>
			</tbody>
		</table>

		<p class="tip">If you have more operands you don’t need to nest these functions, just provide more parameters.
			E.g. you don’t need to do <code>add(a, add(b, c))</code>, <code>add(a, b, c)</code> will just work.
		</p>
	</section>

	<section>
		<h1>Advanced Math functions</h1>

		<p>All <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math">JavaScript Math functions</a> can be used in Mavo without having to type <code>Math.</code> before them.
		For example, to calculate the square root of 4, you don’t need to type <code>Math.sqrt(4)</code>, you can just type <code>sqrt(4)</code>.</p>
	</section>
</section>

<section>
	<h1>Text Functions</h1>

	<table>
		<thead>
			<th style="width: 10em">Example</th>
			<th style="width: 15%">Result</th>
			<th style="width: 60%">What? / Why?</th>
		</thead>
		<tr>
			<td><code>len('foo')</code></td>
			<td>3</td>
			<td>"foo" is 3 characters long</td>
		</tr>
		<tr>
			<td><code>search('abcd', 'cd')</code></td>
			<td>2</td>
			<td>"cd" is in after the 2nd character in "abcd"</td>
		</tr>
		<tr>
			<td><code>starts("abcd", "b")</code></td>
			<td>false</td>
			<td>"abcd" does not start with "b"</td>
		</tr>
		<tr>
			<td><code>ends("abcd", "d")</code></td>
			<td>true</td>
			<td>"abcd" does end with "d"</td>
		</tr>
		<tr>
			<td><code>replace("abbbc", "b", "d")</code></td>
			<td>"adddc"</td>
			<td>Replaced every "b" with "d"</td>
		</tr>
		<tr>
			<td><code>replace("abbbbbbc", "bb", "b", 3)</code></td>
			<td>"abc"</td>
			<td>Replaced every "bb" with "b", then did it again on the result, then again (3 times total).</td>
		</tr>
		<tr>
			<td><code>idify("Foo Bar? Baz!")</code></td>
			<td>"foo-bar-baz"</td>
			<td>Converted "Foo Bar? Baz!" to something more appropriate for use in an id or class attribute.</td>
		</tr>
		<tr>
			<td><code>readable("fooBar-baz")</code></td>
			<td>"Foo bar baz"</td>
			<td>Opposite of <code>idify()</code>: converts something id-like to something more human readable.</td>
		</tr>
		<tr>
			<td><code>uppercase("Foo")</code></td>
			<td>"FOO"</td>
			<td>Converts all letters to uppercase.</td>
		</tr>
		<tr>
			<td><code>lowercase("Foo")</code></td>
			<td>"foo"</td>
			<td>Converts all letters to lowercase.</td>
		</tr>
		<tr>
			<td><code>from("foo.bar", ".")</code></td>
			<td>"bar"</td>
			<td>Only get the text after the first "."</td>
		</tr>
		<tr>
			<td><code>to("foo.bar", ".")</code></td>
			<td>"foo"</td>
			<td>Only get the text before the first "."</td>
		</tr>
		<tr>
			<td><code>between("foo@gmail.com", "@", ".")</code></td>
			<td>"gmail"</td>
			<td>Get the text between "@" and "."</td>
		</tr>
		<tr>
			<td><code>filename("http://mavo.io/demos/homepage/
images/photo.jpg?foo=bar#baz")</code></td>
			<td>"photo.jpg"</td>
			<td>Get the filename part of a URL</td>
		</tr>
		<tr>
			<td><code>join(multiple, ", ")</code></td>
			<td></td>
			<td>Display multiple values as text, comma-separated</td>
		</tr>
		<tr>
			<td><code>json(property)</code></td>
			<td></td>
			<td>Get the value of a property (or any custom data) as JSON</td>
		</tr>
	</table>
</section>

<section>
	<h1>Date and Time Functions</h1>

	<p>The following examples assume you have defined a <code>&lt;time property="date"></code> property in your Mavo whose current value is June 13th, 1986 at 8:30:05pm.</p>

	<table>
		<thead>
			<tr>
				<th style="width: 40%">Example</th>
				<th style="width: 12%">Result</th>
				<th>What it does</th>
			</tr>
		</thead>
		<tr>
			<td><code>year(date)</code></td>
			<td>1986</td>
			<td>Returns the year of a date as a 4 digit number.</td>
		</tr>
		<tr>
			<td><code>month(date)</code></td>
			<td>6</td>
			<td>Returns the month of a date, as a 1-2 digit number from 1 to 12.</td>
		</tr>
		<tr>
			<td><code>weekday(date)</code></td>
			<td>5</td>
			<td>Returns the day of the week, as a number from 1 to 7. 1 is Monday, 7 is Sunday.</td>
		</tr>
		<tr>
			<td><code>day(date)</code></td>
			<td>13</td>
			<td>Returns the day of the month, as a 1-2 digit number from 1 to 31.</td>
		</tr>
		<tr>
			<td><code>hour(date)</code></td>
			<td>20</td>
			<td>Returns the hour part of the date, as a number in a 24-hour format.</td>
		</tr>
		<tr>
			<td><code>minute(date)</code></td>
			<td>30</td>
			<td>Returns the minute part of the date, as a 1-2 digit number.</td>
		</tr>
		<tr>
			<td><code>second(date)</code></td>
			<td>5</td>
			<td>Returns the second part of the date, as a 1-2 digit number.</td>
		</tr>
		<tr>
			<td><code>date(date)</code></td>
			<td>1986-06-13</td>
			<td>Returns the date part only (without any time information), in ISO format.</td>
		</tr>
		<tr>
			<td><code>time(date)</code></td>
			<td>20:30:05</td>
			<td>Returns the time part of the date only, in ISO format.</td>
		</tr>
		<tr>
			<td><code>minutes('1986-06-13 21:40:45' - date)</code></td>
			<td>71</td>
			<td>Converts a number of seconds to a number of minutes, rounded to the lowest integer.
				In this example, it gives us the number of minutes between the two dates, because subtracting two dates gives us the number of seconds between them.</td>
		</tr>
		<tr>
			<td><code>hours('1986-06-13 21:40:45' - date)</code></td>
			<td>1</td>
			<td>Converts a number of seconds to a number of hours, rounded to the lowest integer.
				In this example, it gives us the number of hours between the two dates, because subtracting two dates gives us the number of seconds between them.</td>
		</tr>
		<tr>
			<td><code>days('1986-06-10 21:40:45' - date)</code></td>
			<td>2</td>
			<td>Converts a number of seconds to a number of days, rounded to the lowest integer.
				In this example, it gives us the number of days between the two dates, because subtracting two dates gives us the number of seconds between them.</td>
		</tr>
		<tr>
			<td><code>weeks('1986-06-01 21:40:45' - date)</code></td>
			<td>1</td>
			<td>Converts a number of seconds to a number of weeks, rounded to the lowest integer.
				In this example, it gives us the number of weeks between the two dates, because subtracting two dates gives us the number of seconds between them.</td>
		</tr>
		<tr>
			<td><code>months('1986-01-01' - date)</code></td>
			<td>5</td>
			<td>Converts a number of seconds to a number of months, rounded to the lowest integer.
				In this example, it gives us the number of months between the two dates, because subtracting two dates gives us the number of seconds between them.</td>
		</tr>
		<tr>
			<td><code>years('1980-06-14' - date)</code></td>
			<td>5</td>
			<td>Converts a number of seconds to a number of years, rounded to the lowest integer.
				In this example, it gives us the number of years between the two dates, because subtracting two dates gives us the number of seconds between them.</td>
		</tr>
	</table>

	<p>Most of the functions for extracting date components (month, weekday, etc) also support alternative forms, which you can access by using the dot notation: <code>name</code>, <code>shortname</code>, and <code>twodigit</code>.
		Some of these depend on the document language, declared via the <code>lang</code> attribute (the following examples assume <code>lang="en-GB"</code>).

	<table>
		<thead>
			<tr>
				<th style="width: 40%">Example</th>
				<th style="width: 12%">Result</th>
				<th>What it does</th>
			</tr>
		</thead>
		<tr>
			<td><code>weekday(date).name</code></td>
			<td>Friday</td>
			<td>Returns the day of the week of a date, with its full name.</td>
		</tr>
		<tr>
			<td><code>weekday(date).shortname</code></td>
			<td>Fri</td>
			<td>Returns the day of the week of a date, as its shortened full name.</td>
		</tr>
		<tr>
			<td><code>month(date).twodigit</code></td>
			<td>06</td>
			<td>Returns the month of a date, as a two digit number.</td>
		</tr>
		<tr>
			<td><code>month(date).name</code></td>
			<td>June</td>
			<td>Returns the month of a date, as its full name.</td>
		</tr>
		<tr>
			<td><code>year(date).twodigit</code></td>
			<td>86</td>
			<td>Returns the year of a date, as a two digit number.</td>
		</tr>
	</table>

	<p>These are just a few examples, most date component functions support multiple formats.</p>
</section>

<section>
	<h1>Other Functions</h1>

	<table>
		<thead>
			<tr>
				<th>Function</th>
				<th>What it does</th>
				<th>Example</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td><code>url(param)</code></td>
				<td>Print out the value of the <code>foo</code> parameter from the current page URL. This matches both parameters like <code>example.com/index.html?foo=bar</code> and <code>example.com/index.html/foo/bar</code> with the former having priority over the latter.</td>
				<td><code>url("foo")</code></td>
			</tr>
			<tr>
				<td><code>url()</code></td>
				<td>Print out the URL of the current page.</td>
				<td><code>url()</code></td>
			</tr>
			<tr>
				<td><code>if(test, ifyes)</code></td>
				<td>Print out <code>ifyes</code> if <code>test</code> is non-empty, otherwise nothing.</td>
				<td><code>if(rating > 3, good)</code></td>
			</tr>
			<tr>
				<td><code>if(test, ifyes, ifno)</code></td>
				<td>Print out <code>ifyes</code> if <code>test</code> is non-empty, otherwise <code>ifno</code>.</td>
				<td><code>if(rating > 3, good, bad)</code></td>
			</tr>
		</tbody>
	</table>
</section>

<section>
	<h1>MavoScript vs JavaScript</h1>

	<p>
		MavoScript is based on a subset of JavaScript, with a few simplifications to make it easy to use even by people with no JavaScript knowledge.
		If a Mavo expression is more advanced than MavoScript, it is automatically parsed as JavaScript, allowing experienced web developers to do more with Mavo expressions.
	</p>

	<p>For those who know JavaScript, these are a few key differences:</p>

	<table>
		<thead>
			<tr>
				<th>JavaScript</th>
				<th>MavoScript</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>Math and logical operations with arrays produce nonsensical results</td>
				<td>Array math & logical operations works element-wise. Operations between an array and a scalar are performed on every array element.
				This is why things like <code>count(rating > 3)</code> work in MavoScript, but wouldn't in JS.</td>
			</tr>
			<tr>
				<td>All strings have to be quoted</td>
				<td>Strings that only consist of letters, numbers, and underscores don't need quotes.</td>
			</tr>
			<tr>
				<td><code>==</code> operator for equality</td>
				<td><code>=</code> operator for equality</td>
			</tr>
			<tr>
				<td><code>&&</code> operator for logical and</td>
				<td><code>and</code> operator for logical and</td>
			</tr>
			<tr>
				<td><code>||</code> operator for logical or</td>
				<td><code>or</code> operator for logical or</td>
			</tr>
			<tr>
				<td><code>%</code> operator for remainder</td>
				<td><code>mod</code> operator for remainder</td>
			</tr>
			<tr>
				<td><code>if</code> is a control structure</td>
				<td><code>if()</code> is a function</td>
			</tr>
			<tr>
				<td><code>a + b</code> might be addition or concatenation depending on types</td>
				<td><code>a + b</code> is always addition, <code>a & b</code> is concatenation</td>
			</tr>
			<tr>
				<td>Things like <code>3 > 2 > 1</code> return unexpected results (<code>false in this case</code>)</td>
				<td>Every operator can have multiple operands, including <code>></code>, so <code>3 > 2 > 1</code> has the same result as in math (<code>true</code>)</td>
			</tr>
			<tr>
				<td><code>foo.bar.baz</code> will throw an error if either <code>foo</code> or <code>foo.bar</code> don’t exist.</td>
				<td>If either <code>foo</code> or <code>foo.bar</code> don’t exist, <code>foo.bar.baz</code> will just return <code>""</code>.</td>
			</tr>
		</tbody>
	</table>

	<p class="tip">Since MavoScript does not support comments, an easy way to force JS mode is a <code>/* js */</code> comment in the start or end of the expression.</p>
</section>

@@include('_footer-docs.html')

</body>
</html>
