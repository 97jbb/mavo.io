@@include('_head-docs.html', {
	"title": "Writing Plugins"
})
<body class="language-javascript">

@@include('_header.html')

<h2>Writing Plugins</h2>

<section>
	<p>
		If you know JavaScript, you can make <a href="http://plugins.mavo.io">plugins</a> that extend Mavoâ€™s functionality and change how it works.
	</p>
</section>

<section>
	<h1>Overview</h1>

	<p>Mavo was designed for extensibility from the beginning.
		There are both high level extensibility points for things that are most commonly extended (such as adding a new backend, or registering a new element type),
		but there are also <em>hooks</em> in strategic places, as low-level extensibility points that allow you to <strong>add your own code to Mavoâ€™s internals</strong>.</p>
</section>

<section>
	<h1>Declaring a plugin</h1>

	<p>You need to call <code>Mavo.Plugins.register(<em>PLUGIN_ID</em>)</code>, where <em>PLUGIN_ID</em> is an alphanumeric unique name for your plugin (e.g. <code>"clear"</code> or <code>"locale-el"</code>).
		People will be using this id in the <code>mv-plugins</code> attribute, so pick a good one!
	</p>

	<p>Name your file <code>mavo-<em>PLUGIN_ID</em>.js</code> so that <code>mv-plugins</code> knows where to find it.</p>

	<p>This is the minium required, but <code>Mavo.Plugins.register()</code> also provides other conveniences which you can read about in the <a href="/docs/api/#Mavo.Plugins">API Documentation</a>.</p>

	<p>Once your plugin is ready, donâ€™t forget to add it to the <a href="https://plugins.mavo.io">Plugin Directory</a> and help others too!</p>
</section>

<section>
	<h1>High-level extension points</h1>

	<p>If your plugin is about one of the following things, you donâ€™t need to become fully accustomed with Mavoâ€™s internals, you just call the corresponding method and/or create the required class.</p>


	<ul>
		<li><a href="/docs/storage/#creating-your-own-storage-backend">Adding a new type of storage backend</a></li>
		<li><a href="/docs/formats/#creating-your-own-formats">Adding a new data format</a></li>
		<li><strong>Adding a new element type:</strong> <code>Mavo.Elements.register()</code>, details coming soon</li>
		<li><strong>Adding a new toolbar button:</strong> Add a new property on <code>Mavo.UI.Bar.controls</code>, details coming soon</li>
		<li><strong>Adding a new MavoScript function:</strong> Add a new function on <code>Mavo.Functions</code></li>
	</ul>
</section>

<section>
	<h1>Hooks</h1>

	<p>Hooks are used as ways to execute custom code during various points of Mavo's execution.
		The name of the hook gives a summary of where the hook will be executed and usually follows the scheme <code>"<em>CLASS_NAME</em>-<em>METHOD_NAME</em>-<em>LOCATION</em>"</code>.

	<p>Some examples:</p>

	<table>
		<thead>
			<th>Hook name</th>
			<th>Executes</th>
			<th>Definition</th>
		</thead>
		<tr>
			<td><code>init-start</code></td>
			<td>At the start of the <code>Mavo</code> constructor, after a few properties have been initialized.</td>
			<td><a href="https://github.com/mavoweb/mavo/blob/master/src/mavo.js#L58">mavo.js</a></td>
		</tr>
		<tr>
			<td><code>node-init-start</code></td>
			<td>At the start of the <code>Mavo.Node</code> constructor, after a few properties have been initialized.</td>
			<td><a href="https://github.com/mavoweb/mavo/blob/master/src/node.js#L45">node.js</a></td>
		</tr>
		<tr>
			<td><code>group-init-start</code></td>
			<td>At the start of the <code>Mavo.Group</code> constructor, after its parent constructor (<code>Mavo.Node</code>) has been called.</td>
			<td><a href="https://github.com/mavoweb/mavo/blob/master/src/group.js#L11">group.js</a></td>
		</tr>

		<tr>
			<td><code>node-getdata-end</code></td>
			<td>Called right before <code>getData()</code> returns its value, to give plugins a chance to intercept and manipulate it.
			Note that a hook can be called multiple times in different places.</td>
			<td>
				<a href="https://github.com/mavoweb/mavo/blob/master/src/collection.js#L80">collection.js</a>
				<a href="https://github.com/mavoweb/mavo/blob/master/src/group.js#L125">group.js</a>
				<a href="https://github.com/mavoweb/mavo/blob/master/src/primitive.js#L236">primitive.js</a>
			</td>
		</tr>
	</table>

	<p class="note">Links to the source code might not link to the exact hook definition as the code changes. Look a few lines above or below, it should be close.</p>

	<section>
		<h1>Adding code to a hook</h1>
		<p>You can add a hook by calling <code>Mavo.hooks.add("hook-name", callback)</code>. If you have multiple hooks, you can also pass an object, like so:</p>

		<pre><code>
			Mavo.hooks.add({
				"hook1-name": function(env) {
					// hook 1 callback
				},
				"hook2-name": function(env) {
					// hook 2 callback
				}
			});
		</code></pre>

		<p>You could also add code to hooks as one of the options in <code>Mavo.Plugins.register()</code>:</p>

		<pre><code>
			Mavo.plugins.register("myplugin", {
				hooks: {
					"hook1-name": function(env) {
						// hook 1 callback
					},
					"hook2-name": function(env) {
						// hook 2 callback
					}
				}
			});
		</code></pre>

		<p>The <code>env</code> object differs depending on the hook.
			For hooks run in instance methods of classes, <code>env</code> is an object that contains references to all important local variables so you can modify them in your plugin.
			If there are none, it just refers to the current instance.
			The context of the function (the <code>this</code> variable) is the current instance.
			This means that you could use a custom build of Mavo to experiment, then copy over your code to hooks without having to make changes to it.
		</p>
	</section>

	<section>
		<h1>Available hooks</h1>

		<p>Mavo calls <code>Mavo.hooks.run("hook-name", data)</code> to run the code added at a hook.
			Therefore, you can <a href="https://github.com/mavoweb/mavo/search?utf8=%E2%9C%93&q=Mavo.hooks.run%28&type=">search Mavoâ€™s code for <code>Mavo.hooks.run(</code></a> and you will find all available hooks as well as where in the code they are executed.</p>

		<p>You never need to run <code>Mavo.hooks.run()</code> yourself, unless you want to create hooks for your own plugin, i.e. allow other people to create plugins of your plugin ("metaplugins"? "pluginception"? ðŸ˜œ).
		In that case please prefix the hook names with your plugin id, to prevent collisions with other plugins.</p>
	</section>

	<section>
		<h1>Limitations</h1>

		<p>Hooks cannot change the return value of a function, unless the calling code has enabled that via a property on <code>env</code>.
			For example, in the <code>node-getdata-end</code> hook described above, all you need to do to change the return value is modify <code>env.data</code>.

		<p>In the future this may become possible, so avoid returning non-undefined values from your callbacks to make sure your plugin doesnâ€™t break when this is enabled.</p>
	</section>

	<section>
		<h1>Need a hook that doesnâ€™t exist yet?</h1>

		<p><a href="https://github.com/mavoweb/mavo/issues/new">Let us know</a> and chances are weâ€™ll add it pretty soon.
		Make sure to describe what youâ€™re trying to do!</p>
	</section>
</section>

@@include('_footer-docs.html')

</body>
</html>
