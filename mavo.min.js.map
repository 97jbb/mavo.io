{"version":3,"sources":["mavo.es5.js"],"names":["_toConsumableArray","arr","Array","isArray","i","arr2","length","from","_typeof","Symbol","iterator","obj","constructor","$$","expr","con","Node","Window","slice","call","document","querySelectorAll","self","Element","prototype","matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","_","Stretchy","selectors","base","split","join","filter","script","currentScript","pop","resize","element","resizes","cs","getComputedStyle","offset","value","placeholder","empty","type","nodeName","toLowerCase","style","height","boxSizing","offsetHeight","clientHeight","scrollHeight","width","offsetWidth","clientWidth","scrollLeft","Math","max","scrollWidth","selectedIndex","option","createElement","textContent","options","parentNode","insertBefore","nextSibling","appearance","property","test","removeChild","resizeAll","elements","forEach","active","init","getAttribute","body","readyState","addEventListener","listener","evt","target","documentElement","MutationObserver","mutations","mutation","addedNodes","observe","childList","subtree","overload","callback","start","end","undefined","arguments","$","apply","this","ret","key","args","splice","extend","to","whitelist","hasOwnProperty","indexOf","descriptor","Object","getOwnPropertyDescriptor","writable","configurable","enumerable","get","set","defineProperty","Bliss","context","querySelector","sources","noop","toString","match","isNaN","defined","create","tag","o","each","ready","Promise","resolve","reject","Class","special","concat","keys","classProps","__abstract","Error","specialFilter","lazy","getter","live","v","include","url","loaded","async","onload","remove","onerror","src","inside","head","fetch","TypeError","env","URL","location","data","method","headers","xhr","XMLHttpRequest","toUpperCase","hooks","run","search","setAttribute","open","href","user","password","e","console","error","setRequestHeader","header","removeAttribute","status","statusText","ontimeout","send","hasRoot","reduce","Hooks","add","name","first","subject","bliss","setProps","transition","props","duration","previous","transitionDuration","transitionProperty","once","clearTimeout","setTimeout","bind","fire","properties","createEvent","initEvent","dispatchEvent","unbind","events","className","listeners","ltype","l","removeEventListener","capture","val","attributes","attribute","me","onevent","event","delegate","selector","closest","contents","child","createTextNode","appendChild","before","after","firstChild","around","content","all","on","noOverwrite","array","map","shift","Type","dummy","HTMLElement","shy","clone","cloneNode","descendants","EventTarget","equal","notEqual","push","Mavo","_this","index","id","getProperty","store","urlParam","source","autoEdit","has","is","rootScope","classList","scope","hasAttribute","wrapper","keyCode","superKey","preventDefault","save","primitive","isScope","Primitive","getValueAttribute","ui","bar","propertyNames","needsEdit","root","sort","a","b","setUnsavedChanges","permissions","Permissions","p","floating","editing","login","edit","unsavedChanges","toggle","onchange","_ref","action","can","onclick","done","requestAnimationFrame","click","mouseenter focus","mouseleave blur","revert","disabled","clear","cannot","storage","Storage","load","off","getData","toJSON","render","confirm","item","parent","walk","static","navigator","platform","container","s","specificProperty","multiple","required","formControl","computed","li","tr","dt","dd","documentFragment","not","or","selector1","selector2","and","s1","s2","andNot","output","autoMultiple","window","Intl","err","then","JSON","stringify","readable","identifier","replace","$0","$1","$2","queryJSON","path","observer","oldValue","attributeFilter","attributeOldValue","characterData","characterDataOldValue","toArray","flatten","prev","c","thing","searchParams","_len","names","_key","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","next","_name","RegExp","proxy","propagated","proto","existing","propagate","el","triggers","actions","_this2","_this3","when","_this4","able","_this5","current","changed","_this6","trigger","_this7","register","setter","logout","mavo","_this8","backend","Backend","sourceBackend","authControls","loginHash","hash","history","replaceState","title","innerHTML","_this9","inProgress","response","parse","log","stack","_this10","put","file","dataString","param","params","isHash","origin","pathname","getFile","filename","types","Remote","extends","responseType","localStorage","abstract","template","fromTemplate","Scope","normalize","parentScope","isRoot","getRelativeData","_this11","dirty","null","Proxy","walkUp","expressions","updateAlso","find","walker","_len2","_key2","preEdit","_this12","_Mavo$Unit","collection","Collection","Unit","isDeleted","deleted","isNull","unit","closestCollection","_this13","elementContents","createDocumentFragment","childNodes","node","_deleted","prioritizePrimitive","Expression","expression","eval","createFunction","exception","ERROR","code","simpleOperation","operand1","operator","operand2","Functions","operators","lastIndex","Function","trim","operand","Text","nodeType","children","tokenize","update","_this14","presentational","formatNumber","datatype","setValue","regex","expressionRegex","exec","substring","findEnd","WeakMap","isEscape","insides","close","char","peek","rootFunctionRegExp","Expressions","rootFunctions","_this15","et","traverse","Set","ref","exp","extract","_this16","escape","propertyRegex","getOwnPropertyNames","_this17","_this18","numbers","number","n","op","symbol","_len3","operands","_key3","identity","sum","average","min","_Math","_Math2","count","round","num","decimals","isFinite","toLocaleString","useGrouping","maximumFractionDigits","iff","condition","iftrue","iffalse","aliases","subtract","multiply","divide","lt","gt","eq","alias","_Trap","functions","propertyL","_this19","contains","constructorOptions","mutable","unhandled","prop","_arguments","_this20","_this21","humanReadable","getDatatype","templateValue","getValue","raw","editor","exposed","editorValue","emptyValue","swapUI","unobserve","_this22","_this23","savedValue","popup","hidePopup","prevTabindex","tabIndex","_this24","timer","click.mavo:preedit","focus.mavo:preedit","focus","click.mavo:edit","mouseenter.mavo:preedit","mouseleave.mavo:preedit","initEdit","_this25","getMatch","editors","input change","calculateUnsavedChanges","select","keyup","activeElement","stopPropagation","mavo:datachange","label","dataInput","hidden","size","hideCallback","showPopup","x","offsetLeft","y","offsetTop","top","left","_this26","_this27","record","disconnect","_value","_this28","safeCast","selectedOptions","hide","String","datatypes","cast","useProperty","namespaceURI","numberFormat","NumberFormat","Infinity","format","img, video, audio","a, link","select, input, textarea, meter, progress","input[type=checkbox]","time","date","Date","day","month","year","hour","minute","datetime-local","timeZone","meta","checked","input[type=range], input[type=number], meter, progress","*",".number",".boolean","a, img, video, audio, .url","p, div, li, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address, .multiline","display","meter, progress","time, .date","week","datetime","img","dragenter dragover drop","drop","dataTransfer","accept","change","files","templateElement","items","div","attr","importNode","replaceChild","createItem","itemTemplate","containsTemplate","itemData","_this29","Fragment","bottomUp","nextItem","marker","_item","silent","_arguments2","delete","hard","_this30","opacity","_this31","_this32","_this33","_this34","fragment","datum","_mutable","addButton","tagName","containerSelector","order","compareDocumentPosition","DOCUMENT_POSITION_FOLLOWING","_this35","button","_this36","prettyPrint","util","txt","t","row","cells","cellType","td","colSpan","attrs","cell","shorten","hRow","table","headings","tbl","thead","tbody","addRow","_type","str","htmlentities","getElementsByTagName","within","common","circRef","settings","expander","prettyPrintThis","maxDepth","depthReached","message","text","clickFn","onmouseover","visibility","onmouseout","cursor","config","currentDepth","hasRunOnce","typeDealer","string","object","depth","stackKey","isEmpty","expanded","jquery","maxArray","_date","miniTable","sDate","Debug","friendlyError","elementLabel","printValue","timed","timeEnd","callee","objName","performance","now","timeTaken","calls","times","Time (ms)","Calls","reservedWords","debug","_ref2","debugRow","_ref3","_ref3$attribute","_ref3$tds","tds","mouseenter mouseleave","scrollIntoView","behavior","_this37","input","_this38","dropboxURL","_this39","protocol","hostname","Dropbox","referrer","AuthDriver","Popup","oauthReceiver","client","Client","_this40","writeFile","stat","versionTag","passive","_this41","isAuthenticated","authDriver","receiverUrl","authenticate","interactive","getAccountInfo","accountInfo","_this42","signOut","host","parseURL","repo","branch","username","authenticated","accessToken","req","Authorization","_this43","fileCall","repoInfo","fileInfo","btoa","sha","_this44","authPopup","getUser","u","removeItem","_this45","avatar_url","_btoa","_x17","unescape","encodeURIComponent"],"mappings":"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","file":"mavo.min.js","sourcesContent":["\"use strict\";\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\n/*\n * Stretchy: Form element autosizing, the way it should be.\n * by Lea Verou http://lea.verou.me\n * MIT license\n */\n(function () {\n\n\tif (!self.Element) {\n\t\treturn; // super old browser\n\t}\n\n\tif (!Element.prototype.matches) {\n\t\tElement.prototype.matches = Element.prototype.webkitMatchesSelector || Element.prototype.mozMatchesSelector || Element.prototype.msMatchesSelector || Element.prototype.oMatchesSelector || null;\n\t}\n\n\tif (!Element.prototype.matches) {\n\t\treturn;\n\t}\n\n\tfunction $$(expr, con) {\n\t\treturn expr instanceof Node || expr instanceof Window ? [expr] : [].slice.call(typeof expr == \"string\" ? (con || document).querySelectorAll(expr) : expr || []);\n\t}\n\n\tvar _ = self.Stretchy = {\n\t\tselectors: {\n\t\t\tbase: 'textarea, select:not([size]), input:not([type]), input[type=\"' + \"text url email tel\".split(\" \").join('\"], input[type=\"') + '\"]',\n\t\t\tfilter: \"*\"\n\t\t},\n\n\t\t// Script element this was included with, if any\n\t\tscript: document.currentScript || $$(\"script\").pop(),\n\n\t\t// Autosize one element. The core of Stretchy.\n\t\tresize: function resize(element) {\n\t\t\tif (!_.resizes(element)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar cs = getComputedStyle(element);\n\t\t\tvar offset = 0;\n\n\t\t\tif (!element.value && element.placeholder) {\n\t\t\t\tvar empty = true;\n\t\t\t\telement.value = element.placeholder;\n\t\t\t}\n\n\t\t\tvar type = element.nodeName.toLowerCase();\n\n\t\t\tif (type == \"textarea\") {\n\t\t\t\telement.style.height = \"0\";\n\n\t\t\t\tif (cs.boxSizing == \"border-box\") {\n\t\t\t\t\toffset = element.offsetHeight;\n\t\t\t\t} else if (cs.boxSizing == \"content-box\") {\n\t\t\t\t\toffset = -element.clientHeight;\n\t\t\t\t}\n\n\t\t\t\telement.style.height = element.scrollHeight + offset + \"px\";\n\t\t\t} else if (type == \"input\") {\n\t\t\t\telement.style.width = \"0\";\n\n\t\t\t\tif (cs.boxSizing == \"border-box\") {\n\t\t\t\t\toffset = element.offsetWidth;\n\t\t\t\t} else if (cs.boxSizing == \"padding-box\") {\n\t\t\t\t\toffset = element.clientWidth;\n\t\t\t\t}\n\n\t\t\t\t// Safari misreports scrollWidth, so we will instead set scrollLeft to a\n\t\t\t\t// huge number, and read that back to see what it was clipped to\n\t\t\t\telement.scrollLeft = 1e+10;\n\n\t\t\t\tvar width = Math.max(element.scrollLeft + offset, element.scrollWidth - element.clientWidth);\n\n\t\t\t\telement.style.width = width + \"px\";\n\t\t\t} else if (type == \"select\") {\n\t\t\t\tvar selectedIndex = element.selectedIndex > 0 ? element.selectedIndex : 0;\n\n\t\t\t\t// Need to use dummy element to measure :(\n\t\t\t\tvar option = document.createElement(\"_\");\n\t\t\t\toption.textContent = element.options[selectedIndex].textContent;\n\t\t\t\telement.parentNode.insertBefore(option, element.nextSibling);\n\n\t\t\t\t// The name of the appearance property, as it might be prefixed\n\t\t\t\tvar appearance;\n\n\t\t\t\tfor (var property in cs) {\n\t\t\t\t\tvar value = cs[property];\n\t\t\t\t\tif (!/^(width|webkitLogicalWidth|length)$/.test(property) && typeof value == \"string\") {\n\t\t\t\t\t\t//console.log(property, option.offsetWidth, cs[property]);\n\t\t\t\t\t\toption.style[property] = value;\n\n\t\t\t\t\t\tif (/appearance$/i.test(property)) {\n\t\t\t\t\t\t\tappearance = property;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\toption.style.width = \"\";\n\n\t\t\t\tif (option.offsetWidth > 0) {\n\t\t\t\t\telement.style.width = option.offsetWidth + \"px\";\n\n\t\t\t\t\tif (!cs[appearance] || cs[appearance] !== \"none\") {\n\t\t\t\t\t\t// Account for arrow\n\t\t\t\t\t\telement.style.width = \"calc(\" + element.style.width + \" + 2em)\";\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\toption.parentNode.removeChild(option);\n\t\t\t\toption = null;\n\t\t\t}\n\n\t\t\tif (empty) {\n\t\t\t\telement.value = \"\";\n\t\t\t}\n\t\t},\n\n\t\t// Autosize multiple elements\n\t\tresizeAll: function resizeAll(elements) {\n\t\t\t$$(elements || _.selectors.base).forEach(function (element) {\n\t\t\t\t_.resize(element);\n\t\t\t});\n\t\t},\n\n\t\tactive: true,\n\n\t\t// Will stretchy do anything for this element?\n\t\tresizes: function resizes(element) {\n\t\t\treturn element && element.parentNode && element.matches && element.matches(_.selectors.base) && element.matches(_.selectors.filter);\n\t\t},\n\n\t\tinit: function init() {\n\t\t\t_.selectors.filter = _.script.getAttribute(\"data-filter\") || ($$(\"[data-stretchy-filter]\").pop() || document.body).getAttribute(\"data-stretchy-filter\") || Stretchy.selectors.filter || \"*\";\n\n\t\t\t_.resizeAll();\n\t\t},\n\n\t\t$$: $$\n\t};\n\n\t// Autosize all elements once the DOM is loaded\n\n\t// DOM already loaded?\n\tif (document.readyState !== \"loading\") {\n\t\t_.init();\n\t} else {\n\t\t// Wait for it\n\t\tdocument.addEventListener(\"DOMContentLoaded\", _.init);\n\t}\n\n\t// Listen for changes\n\tvar listener = function listener(evt) {\n\t\tif (_.active) {\n\t\t\t_.resize(evt.target);\n\t\t}\n\t};\n\n\tdocument.documentElement.addEventListener(\"input\", listener);\n\n\t// Firefox fires a change event instead of an input event\n\tdocument.documentElement.addEventListener(\"change\", listener);\n\n\t// Listen for new elements\n\tif (self.MutationObserver) {\n\t\tnew MutationObserver(function (mutations) {\n\t\t\tif (_.active) {\n\t\t\t\tmutations.forEach(function (mutation) {\n\t\t\t\t\tif (mutation.type == \"childList\") {\n\t\t\t\t\t\tStretchy.resizeAll(mutation.addedNodes);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}).observe(document.documentElement, {\n\t\t\tchildList: true,\n\t\t\tsubtree: true\n\t\t});\n\t}\n})();\n\n(function () {\n\t\"use strict\";\n\n\tfunction overload(callback, start, end) {\n\t\tstart = start === undefined ? 1 : start;\n\t\tend = end || start + 1;\n\n\t\tif (end - start <= 1) {\n\t\t\treturn function () {\n\t\t\t\tif (arguments.length <= start || $.type(arguments[start]) === \"string\") {\n\t\t\t\t\treturn callback.apply(this, arguments);\n\t\t\t\t}\n\n\t\t\t\tvar obj = arguments[start],\n\t\t\t\t    ret;\n\n\t\t\t\tfor (var key in obj) {\n\t\t\t\t\tvar args = Array.from(arguments);\n\t\t\t\t\targs.splice(start, 1, key, obj[key]);\n\t\t\t\t\tret = callback.apply(this, args);\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t};\n\t\t}\n\n\t\treturn overload(overload(callback, start + 1, end), start, end - 1);\n\t}\n\n\t// Copy properties from one object to another. Overwrites allowed.\n\tfunction extend(to, from, whitelist) {\n\t\tfor (var property in from) {\n\t\t\tif (whitelist) {\n\t\t\t\tvar type = $.type(whitelist);\n\n\t\t\t\tif (whitelist === \"own\" && !from.hasOwnProperty(property) || type === \"array\" && whitelist.indexOf(property) === -1 || type === \"regexp\" && !whitelist.test(property) || type === \"function\" && !whitelist.call(from, property)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// To copy gettters/setters, preserve flags etc\n\t\t\tvar descriptor = Object.getOwnPropertyDescriptor(from, property);\n\n\t\t\tif (descriptor && (!descriptor.writable || !descriptor.configurable || !descriptor.enumerable || descriptor.get || descriptor.set)) {\n\t\t\t\tdelete to[property];\n\t\t\t\tObject.defineProperty(to, property, descriptor);\n\t\t\t} else {\n\t\t\t\tto[property] = from[property];\n\t\t\t}\n\t\t}\n\n\t\treturn to;\n\t}\n\n\tvar $ = self.Bliss = extend(function (expr, context) {\n\t\treturn $.type(expr) === \"string\" ? (context || document).querySelector(expr) : expr || null;\n\t}, self.Bliss);\n\n\textend($, {\n\t\textend: extend,\n\n\t\toverload: overload,\n\n\t\tproperty: $.property || \"_\",\n\n\t\tsources: {},\n\n\t\tnoop: function noop() {},\n\n\t\t$: function $(expr, context) {\n\t\t\tif (expr instanceof Node || expr instanceof Window) {\n\t\t\t\treturn [expr];\n\t\t\t}\n\n\t\t\treturn Array.from(typeof expr == \"string\" ? (context || document).querySelectorAll(expr) : expr || []);\n\t\t},\n\n\t\t/**\n   * Returns the [[Class]] of an object in lowercase (eg. array, date, regexp, string etc)\n   */\n\t\ttype: function type(obj) {\n\t\t\tif (obj === null) {\n\t\t\t\treturn \"null\";\n\t\t\t}\n\n\t\t\tif (obj === undefined) {\n\t\t\t\treturn \"undefined\";\n\t\t\t}\n\n\t\t\tvar ret = (Object.prototype.toString.call(obj).match(/^\\[object\\s+(.*?)\\]$/)[1] || \"\").toLowerCase();\n\n\t\t\tif (ret == \"number\" && isNaN(obj)) {\n\t\t\t\treturn \"nan\";\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\t/*\n   * Return first non-undefined value. Mainly used internally.\n   */\n\t\tdefined: function defined() {\n\t\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\t\tif (arguments[i] !== undefined) {\n\t\t\t\t\treturn arguments[i];\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tcreate: function create(tag, o) {\n\t\t\tif (tag instanceof Node) {\n\t\t\t\treturn $.set(tag, o);\n\t\t\t}\n\n\t\t\t// 4 signatures: (tag, o), (tag), (o), ()\n\t\t\tif (arguments.length === 1) {\n\t\t\t\tif ($.type(tag) === \"string\") {\n\t\t\t\t\to = {};\n\t\t\t\t} else {\n\t\t\t\t\to = tag;\n\t\t\t\t\ttag = o.tag;\n\t\t\t\t\to = $.extend({}, o, function (property) {\n\t\t\t\t\t\treturn property !== \"tag\";\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn $.set(document.createElement(tag || \"div\"), o);\n\t\t},\n\n\t\teach: function each(obj, callback, ret) {\n\t\t\tret = ret || {};\n\n\t\t\tfor (var property in obj) {\n\t\t\t\tret[property] = callback.call(obj, property, obj[property]);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tready: function ready(context) {\n\t\t\tcontext = context || document;\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tif (context.readyState !== \"loading\") {\n\t\t\t\t\tresolve();\n\t\t\t\t} else {\n\t\t\t\t\tcontext.addEventListener(\"DOMContentLoaded\", function () {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t// Helper for defining OOP-like “classes”\n\t\tClass: function Class(o) {\n\t\t\tvar special = [\"constructor\", \"extends\", \"abstract\", \"static\"].concat(Object.keys($.classProps));\n\t\t\tvar init = o.hasOwnProperty(\"constructor\") ? o.constructor : $.noop;\n\n\t\t\tvar Class = function Class() {\n\t\t\t\tif (this.constructor.__abstract && this.constructor === Class) {\n\t\t\t\t\tthrow new Error(\"Abstract classes cannot be directly instantiated.\");\n\t\t\t\t}\n\n\t\t\t\tClass.super && Class.super.apply(this, arguments);\n\n\t\t\t\tinit.apply(this, arguments);\n\t\t\t};\n\n\t\t\tClass.super = o.extends || null;\n\n\t\t\tClass.prototype = $.extend(Object.create(Class.super ? Class.super.prototype : Object), {\n\t\t\t\tconstructor: Class\n\t\t\t});\n\n\t\t\tvar specialFilter = function specialFilter(property) {\n\t\t\t\treturn this.hasOwnProperty(property) && special.indexOf(property) === -1;\n\t\t\t};\n\n\t\t\t// Static methods\n\t\t\tif (o.static) {\n\t\t\t\t$.extend(Class, o.static, specialFilter);\n\n\t\t\t\tfor (var property in $.classProps) {\n\t\t\t\t\tif (property in o.static) {\n\t\t\t\t\t\t$.classProps[property](Class, o.static[property]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Instance methods\n\t\t\t$.extend(Class.prototype, o, specialFilter);\n\n\t\t\tfor (var property in $.classProps) {\n\t\t\t\tif (property in o) {\n\t\t\t\t\t$.classProps[property](Class.prototype, o[property]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// For easier calling of super methods\n\t\t\t// This doesn't save us from having to use .call(this) though\n\t\t\tClass.prototype.super = Class.super ? Class.super.prototype : null;\n\n\t\t\tClass.__abstract = !!o.abstract;\n\n\t\t\treturn Class;\n\t\t},\n\n\t\t// Properties with special handling in classes\n\t\tclassProps: {\n\t\t\t// Lazily evaluated properties\n\t\t\tlazy: overload(function (obj, property, getter) {\n\t\t\t\tObject.defineProperty(obj, property, {\n\t\t\t\t\tget: function get() {\n\t\t\t\t\t\tvar value = getter.call(this);\n\n\t\t\t\t\t\tObject.defineProperty(this, property, {\n\t\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\t\twritable: true\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t},\n\t\t\t\t\tset: function set(value) {\n\t\t\t\t\t\t// Blind write: skip running the getter\n\t\t\t\t\t\tObject.defineProperty(this, property, {\n\t\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\t\twritable: true\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t\tenumerable: true\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t}),\n\n\t\t\t// Properties that behave like normal properties but also execute code upon getting/setting\n\t\t\tlive: overload(function (obj, property, descriptor) {\n\t\t\t\tif ($.type(descriptor) === \"function\") {\n\t\t\t\t\tdescriptor = { set: descriptor };\n\t\t\t\t}\n\n\t\t\t\tObject.defineProperty(obj, property, {\n\t\t\t\t\tget: function get() {\n\t\t\t\t\t\tvar value = this[\"_\" + property];\n\t\t\t\t\t\tvar ret = descriptor.get && descriptor.get.call(this, value);\n\t\t\t\t\t\treturn ret !== undefined ? ret : value;\n\t\t\t\t\t},\n\t\t\t\t\tset: function set(v) {\n\t\t\t\t\t\tvar value = this[\"_\" + property];\n\t\t\t\t\t\tvar ret = descriptor.set && descriptor.set.call(this, v, value);\n\t\t\t\t\t\tthis[\"_\" + property] = ret !== undefined ? ret : v;\n\t\t\t\t\t},\n\t\t\t\t\tconfigurable: descriptor.configurable,\n\t\t\t\t\tenumerable: descriptor.enumerable\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t})\n\n\t\t},\n\n\t\t// Includes a script, returns a promise\n\t\tinclude: function include() {\n\t\t\tvar url = arguments[arguments.length - 1];\n\t\t\tvar loaded = arguments.length === 2 ? arguments[0] : false;\n\n\t\t\tvar script = document.createElement(\"script\");\n\n\t\t\treturn loaded ? Promise.resolve() : new Promise(function (resolve, reject) {\n\t\t\t\t$.set(script, {\n\t\t\t\t\tasync: true,\n\t\t\t\t\tonload: function onload() {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t$.remove(script);\n\t\t\t\t\t},\n\t\t\t\t\tonerror: function onerror() {\n\t\t\t\t\t\treject();\n\t\t\t\t\t},\n\t\t\t\t\tsrc: url,\n\t\t\t\t\tinside: document.head\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t/*\n   * Fetch API inspired XHR wrapper. Returns promise.\n   */\n\t\tfetch: function fetch(url, o) {\n\t\t\tif (!url) {\n\t\t\t\tthrow new TypeError(\"URL parameter is mandatory and cannot be \" + url);\n\t\t\t}\n\n\t\t\t// Set defaults & fixup arguments\n\t\t\tvar env = extend({\n\t\t\t\turl: new URL(url, location),\n\t\t\t\tdata: \"\",\n\t\t\t\tmethod: \"GET\",\n\t\t\t\theaders: {},\n\t\t\t\txhr: new XMLHttpRequest()\n\t\t\t}, o);\n\n\t\t\tenv.method = env.method.toUpperCase();\n\n\t\t\t$.hooks.run(\"fetch-args\", env);\n\n\t\t\t// Start sending the request\n\n\t\t\tif (env.method === \"GET\" && env.data) {\n\t\t\t\tenv.url.search += env.data;\n\t\t\t}\n\n\t\t\tdocument.body.setAttribute(\"data-loading\", env.url);\n\n\t\t\tenv.xhr.open(env.method, env.url.href, env.async !== false, env.user, env.password);\n\n\t\t\tfor (var property in o) {\n\t\t\t\tif (property in env.xhr) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tenv.xhr[property] = o[property];\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tself.console && console.error(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (env.method !== \"GET\" && !env.headers[\"Content-type\"] && !env.headers[\"Content-Type\"]) {\n\t\t\t\tenv.xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\t\t\t}\n\n\t\t\tfor (var header in env.headers) {\n\t\t\t\tenv.xhr.setRequestHeader(header, env.headers[header]);\n\t\t\t}\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tenv.xhr.onload = function () {\n\t\t\t\t\tdocument.body.removeAttribute(\"data-loading\");\n\n\t\t\t\t\tif (env.xhr.status === 0 || env.xhr.status >= 200 && env.xhr.status < 300 || env.xhr.status === 304) {\n\t\t\t\t\t\t// Success!\n\t\t\t\t\t\tresolve(env.xhr);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject($.extend(Error(env.xhr.statusText), {\n\t\t\t\t\t\t\txhr: env.xhr,\n\t\t\t\t\t\t\tget status() {\n\t\t\t\t\t\t\t\treturn this.xhr.status;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tenv.xhr.onerror = function () {\n\t\t\t\t\tdocument.body.removeAttribute(\"data-loading\");\n\t\t\t\t\treject($.extend(Error(\"Network Error\"), { xhr: env.xhr }));\n\t\t\t\t};\n\n\t\t\t\tenv.xhr.ontimeout = function () {\n\t\t\t\t\tdocument.body.removeAttribute(\"data-loading\");\n\t\t\t\t\treject($.extend(Error(\"Network Timeout\"), { xhr: env.xhr }));\n\t\t\t\t};\n\n\t\t\t\tenv.xhr.send(env.method === \"GET\" ? null : env.data);\n\t\t\t});\n\t\t},\n\n\t\tvalue: function value(obj) {\n\t\t\tvar hasRoot = $.type(obj) !== \"string\";\n\n\t\t\treturn $.$(arguments).slice(+hasRoot).reduce(function (obj, property) {\n\t\t\t\treturn obj && obj[property];\n\t\t\t}, hasRoot ? obj : self);\n\t\t}\n\t});\n\n\t$.Hooks = new $.Class({\n\t\tadd: function add(name, callback, first) {\n\t\t\t(Array.isArray(name) ? name : [name]).forEach(function (name) {\n\t\t\t\tthis[name] = this[name] || [];\n\t\t\t\tthis[name][first ? \"unshift\" : \"push\"](callback);\n\t\t\t}, this);\n\t\t},\n\n\t\trun: function run(name, env) {\n\t\t\tthis[name] = this[name] || [];\n\t\t\tthis[name].forEach(function (callback) {\n\t\t\t\tcallback.call(env && env.context ? env.context : env, env);\n\t\t\t});\n\t\t}\n\t});\n\n\t$.hooks = new $.Hooks();\n\n\tvar _ = $.property;\n\n\t$.Element = function (subject) {\n\t\tthis.subject = subject;\n\n\t\t// Author-defined element-related data\n\t\tthis.data = {};\n\n\t\t// Internal Bliss element-related data\n\t\tthis.bliss = {};\n\t};\n\n\t$.Element.prototype = {\n\t\tset: overload(function (property, value) {\n\n\t\t\tif (property in $.setProps) {\n\t\t\t\t$.setProps[property].call(this, value);\n\t\t\t} else if (property in this) {\n\t\t\t\tthis[property] = value;\n\t\t\t} else {\n\t\t\t\tthis.setAttribute(property, value);\n\t\t\t}\n\t\t}, 0),\n\n\t\t// Run a CSS transition, return promise\n\t\ttransition: function transition(props, duration) {\n\t\t\tduration = +duration || 400;\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tif (\"transition\" in this.style) {\n\t\t\t\t\t// Get existing style\n\t\t\t\t\tvar previous = $.extend({}, this.style, /^transition(Duration|Property)$/);\n\n\t\t\t\t\t$.style(this, {\n\t\t\t\t\t\ttransitionDuration: (duration || 400) + \"ms\",\n\t\t\t\t\t\ttransitionProperty: Object.keys(props).join(\", \")\n\t\t\t\t\t});\n\n\t\t\t\t\t$.once(this, \"transitionend\", function () {\n\t\t\t\t\t\tclearTimeout(i);\n\t\t\t\t\t\t$.style(this, previous);\n\t\t\t\t\t\tresolve(this);\n\t\t\t\t\t});\n\n\t\t\t\t\t// Failsafe, in case transitionend doesn’t fire\n\t\t\t\t\tvar i = setTimeout(resolve, duration + 50, this);\n\n\t\t\t\t\t$.style(this, props);\n\t\t\t\t} else {\n\t\t\t\t\t$.style(this, props);\n\t\t\t\t\tresolve(this);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t},\n\n\t\t// Fire a synthesized event on the element\n\t\tfire: function fire(type, properties) {\n\t\t\tvar evt = document.createEvent(\"HTMLEvents\");\n\n\t\t\tevt.initEvent(type, true, true);\n\n\t\t\t// Return the result of dispatching the event, so we\n\t\t\t// can know if `e.preventDefault` was called inside it\n\t\t\treturn this.dispatchEvent($.extend(evt, properties));\n\t\t},\n\n\t\tunbind: overload(function (events, callback) {\n\t\t\t(events || \"\").split(/\\s+/).forEach(function (type) {\n\t\t\t\tif (_ in this && (type.indexOf(\".\") > -1 || !callback)) {\n\t\t\t\t\t// Mass unbinding, need to go through listeners\n\t\t\t\t\ttype = (type || \"\").split(\".\");\n\t\t\t\t\tvar className = type[1];\n\t\t\t\t\ttype = type[0];\n\t\t\t\t\t// man, can’t wait to be able to do [type, className] = type.split(\".\");\n\n\t\t\t\t\tvar listeners = this[_].bliss.listeners = this[_].bliss.listeners || {};\n\n\t\t\t\t\tfor (var ltype in listeners) {\n\t\t\t\t\t\tif (!type || ltype === type) {\n\t\t\t\t\t\t\t// No forEach, because we’re mutating the array\n\t\t\t\t\t\t\tfor (var i = 0, l; l = listeners[ltype][i]; i++) {\n\t\t\t\t\t\t\t\tif ((!className || className === l.className) && (!callback || callback === l.callback)) {\n\t\t\t\t\t\t\t\t\t// TODO what about capture?\n\t\t\t\t\t\t\t\t\tthis.removeEventListener(ltype, l.callback, l.capture);\n\t\t\t\t\t\t\t\t\ti--;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Normal event unbinding, defer to native JS\n\t\t\t\t\tthis.removeEventListener(type, callback);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}, 0)\n\t};\n\n\t/*\n  * Properties with custom handling in $.set()\n  * Also available as functions directly on element._ and on $\n  */\n\t$.setProps = {\n\t\t// Set a bunch of inline CSS styles\n\t\tstyle: function style(val) {\n\t\t\t$.extend(this.style, val);\n\t\t},\n\n\t\t// Set a bunch of attributes\n\t\tattributes: function attributes(o) {\n\t\t\tfor (var attribute in o) {\n\t\t\t\tthis.setAttribute(attribute, o[attribute]);\n\t\t\t}\n\t\t},\n\n\t\t// Set a bunch of properties on the element\n\t\tproperties: function properties(val) {\n\t\t\t$.extend(this, val);\n\t\t},\n\n\t\t// Bind one or more events to the element\n\t\tevents: function events(val) {\n\t\t\tif (val && val.addEventListener) {\n\t\t\t\t// Copy events from other element (requires Bliss Full)\n\t\t\t\tvar me = this;\n\n\t\t\t\t// Copy listeners\n\t\t\t\tif (val[_] && val[_].bliss) {\n\t\t\t\t\tvar listeners = val[_].bliss.listeners;\n\n\t\t\t\t\tfor (var type in listeners) {\n\t\t\t\t\t\tlisteners[type].forEach(function (l) {\n\t\t\t\t\t\t\tme.addEventListener(type, l.callback, l.capture);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Copy inline events\n\t\t\t\tfor (var onevent in val) {\n\t\t\t\t\tif (onevent.indexOf(\"on\") === 0) {\n\t\t\t\t\t\tthis[onevent] = val[onevent];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (arguments.length > 1 && $.type(val) === \"string\") {\n\t\t\t\tvar callback = arguments[1],\n\t\t\t\t    capture = arguments[2];\n\n\t\t\t\tval.split(/\\s+/).forEach(function (event) {\n\t\t\t\t\tthis.addEventListener(event, callback, capture);\n\t\t\t\t}, this);\n\t\t\t} else {\n\t\t\t\tfor (var events in val) {\n\t\t\t\t\t$.events(this, events, val[events]);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tonce: overload(function (events, callback) {\n\t\t\tevents = events.split(/\\s+/);\n\t\t\tvar me = this;\n\t\t\tvar once = function once() {\n\t\t\t\tevents.forEach(function (event) {\n\t\t\t\t\tme.removeEventListener(event, once);\n\t\t\t\t});\n\n\t\t\t\treturn callback.apply(me, arguments);\n\t\t\t};\n\n\t\t\tevents.forEach(function (event) {\n\t\t\t\tme.addEventListener(event, once);\n\t\t\t});\n\t\t}, 0),\n\n\t\t// Event delegation\n\t\tdelegate: overload(function (type, selector, callback) {\n\t\t\tthis.addEventListener(type, function (evt) {\n\t\t\t\tif (evt.target.closest(selector)) {\n\t\t\t\t\tcallback.call(this, evt);\n\t\t\t\t}\n\t\t\t});\n\t\t}, 0, 2),\n\n\t\t// Set the contents as a string, an element, an object to create an element or an array of these\n\t\tcontents: function contents(val) {\n\t\t\tif (val || val === 0) {\n\t\t\t\t(Array.isArray(val) ? val : [val]).forEach(function (child) {\n\t\t\t\t\tvar type = $.type(child);\n\n\t\t\t\t\tif (/^(string|number)$/.test(type)) {\n\t\t\t\t\t\tchild = document.createTextNode(child + \"\");\n\t\t\t\t\t} else if (type === \"object\") {\n\t\t\t\t\t\tchild = $.create(child);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (child instanceof Node) {\n\t\t\t\t\t\tthis.appendChild(child);\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\t\t\t}\n\t\t},\n\n\t\t// Append the element inside another element\n\t\tinside: function inside(element) {\n\t\t\telement.appendChild(this);\n\t\t},\n\n\t\t// Insert the element before another element\n\t\tbefore: function before(element) {\n\t\t\telement.parentNode.insertBefore(this, element);\n\t\t},\n\n\t\t// Insert the element after another element\n\t\tafter: function after(element) {\n\t\t\telement.parentNode.insertBefore(this, element.nextSibling);\n\t\t},\n\n\t\t// Insert the element before another element's contents\n\t\tstart: function start(element) {\n\t\t\telement.insertBefore(this, element.firstChild);\n\t\t},\n\n\t\t// Wrap the element around another element\n\t\taround: function around(element) {\n\t\t\tif (element.parentNode) {\n\t\t\t\t$.before(this, element);\n\t\t\t}\n\n\t\t\t(/^template$/i.test(this.nodeName) ? this.content || this : this).appendChild(element);\n\t\t}\n\t};\n\n\t$.Array = function (subject) {\n\t\tthis.subject = subject;\n\t};\n\n\t$.Array.prototype = {\n\t\tall: function all(method) {\n\t\t\tvar args = $$(arguments).slice(1);\n\n\t\t\treturn this[method].apply(this, args);\n\t\t}\n\t};\n\n\t// Extends Bliss with more methods\n\t$.add = overload(function (method, callback, on, noOverwrite) {\n\t\ton = $.extend({ $: true, element: true, array: true }, on);\n\n\t\tif ($.type(callback) == \"function\") {\n\t\t\tif (on.element && (!(method in $.Element.prototype) || !noOverwrite)) {\n\t\t\t\t$.Element.prototype[method] = function () {\n\t\t\t\t\treturn this.subject && $.defined(callback.apply(this.subject, arguments), this.subject);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (on.array && (!(method in $.Array.prototype) || !noOverwrite)) {\n\t\t\t\t$.Array.prototype[method] = function () {\n\t\t\t\t\tvar args = arguments;\n\t\t\t\t\treturn this.subject.map(function (element) {\n\t\t\t\t\t\treturn element && $.defined(callback.apply(element, args), element);\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (on.$) {\n\t\t\t\t$.sources[method] = $[method] = callback;\n\n\t\t\t\tif (on.array || on.element) {\n\t\t\t\t\t$[method] = function () {\n\t\t\t\t\t\tvar args = [].slice.apply(arguments);\n\t\t\t\t\t\tvar subject = args.shift();\n\t\t\t\t\t\tvar Type = on.array && Array.isArray(subject) ? \"Array\" : \"Element\";\n\n\t\t\t\t\t\treturn $[Type].prototype[method].apply({ subject: subject }, args);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}, 0);\n\n\t$.add($.Array.prototype, { element: false });\n\t$.add($.Element.prototype);\n\t$.add($.setProps);\n\t$.add($.classProps, { element: false, array: false });\n\n\t// Add native methods on $ and _\n\tvar dummy = document.createElement(\"_\");\n\t$.add($.extend({}, HTMLElement.prototype, function (method) {\n\t\treturn $.type(dummy[method]) === \"function\";\n\t}), null, true);\n})();\n\n(function ($) {\n\t\"use strict\";\n\n\tif (!Bliss || Bliss.shy) {\n\t\treturn;\n\t}\n\n\tvar _ = Bliss.property;\n\n\t// Methods requiring Bliss Full\n\t$.add({\n\t\t// Clone elements, with events and data\n\t\tclone: function clone() {\n\t\t\tvar clone = this.cloneNode(true);\n\t\t\tvar descendants = $.$(\"*\", clone).concat(clone);\n\n\t\t\t$.$(\"*\", this).concat(this).forEach(function (element, i, arr) {\n\t\t\t\t$.events(descendants[i], element);\n\t\t\t\tdescendants[i]._.data = $.extend({}, element._.data);\n\t\t\t});\n\n\t\t\treturn clone;\n\t\t}\n\t}, { array: false });\n\n\t// Define the _ property on arrays and elements\n\n\tObject.defineProperty(Node.prototype, _, {\n\t\t// Written for IE compatability (see #49)\n\t\tget: function getter() {\n\t\t\tObject.defineProperty(Node.prototype, _, {\n\t\t\t\tget: undefined\n\t\t\t});\n\t\t\tObject.defineProperty(this, _, {\n\t\t\t\tvalue: new $.Element(this)\n\t\t\t});\n\t\t\tObject.defineProperty(Node.prototype, _, {\n\t\t\t\tget: getter\n\t\t\t});\n\t\t\treturn this[_];\n\t\t},\n\t\tconfigurable: true\n\t});\n\n\tObject.defineProperty(Array.prototype, _, {\n\t\tget: function get() {\n\t\t\tObject.defineProperty(this, _, {\n\t\t\t\tvalue: new $.Array(this)\n\t\t\t});\n\n\t\t\treturn this[_];\n\t\t},\n\t\tconfigurable: true\n\t});\n\n\t// Hijack addEventListener and removeEventListener to store callbacks\n\n\tif (self.EventTarget && \"addEventListener\" in EventTarget.prototype) {\n\t\tvar addEventListener = EventTarget.prototype.addEventListener,\n\t\t    removeEventListener = EventTarget.prototype.removeEventListener,\n\t\t    equal = function equal(callback, capture, l) {\n\t\t\treturn l.callback === callback && l.capture == capture;\n\t\t},\n\t\t    notEqual = function notEqual() {\n\t\t\treturn !equal.apply(this, arguments);\n\t\t};\n\n\t\tEventTarget.prototype.addEventListener = function (type, callback, capture) {\n\t\t\tif (this && this[_] && this[_].bliss && callback) {\n\t\t\t\tvar listeners = this[_].bliss.listeners = this[_].bliss.listeners || {};\n\n\t\t\t\tif (type.indexOf(\".\") > -1) {\n\t\t\t\t\ttype = type.split(\".\");\n\t\t\t\t\tvar className = type[1];\n\t\t\t\t\ttype = type[0];\n\t\t\t\t}\n\n\t\t\t\tlisteners[type] = listeners[type] || [];\n\n\t\t\t\tif (listeners[type].filter(equal.bind(null, callback, capture)).length === 0) {\n\t\t\t\t\tlisteners[type].push({ callback: callback, capture: capture, className: className });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn addEventListener.call(this, type, callback, capture);\n\t\t};\n\n\t\tEventTarget.prototype.removeEventListener = function (type, callback, capture) {\n\t\t\tif (this && this[_] && this[_].bliss && callback) {\n\t\t\t\tvar listeners = this[_].bliss.listeners = this[_].bliss.listeners || {};\n\n\t\t\t\tif (listeners[type]) {\n\t\t\t\t\tlisteners[type] = listeners[type].filter(notEqual.bind(null, callback, capture));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn removeEventListener.call(this, type, callback, capture);\n\t\t};\n\t}\n\n\t// Set $ and $$ convenience methods, if not taken\n\tself.$ = self.$ || $;\n\tself.$$ = self.$$ || $.$;\n})(Bliss);\n\n(function ($, $$) {\n\n\t\"use strict\";\n\n\tvar _ = self.Mavo = $.Class({\n\t\tconstructor: function constructor(element) {\n\t\t\tvar _this = this;\n\n\t\t\t// Index among other mavos in the page, 1 is first\n\t\t\tthis.index = _.all.push(this);\n\n\t\t\t// Assign a unique (for the page) id to this mavo instance\n\t\t\tthis.id = element.getAttribute(\"data-mavo\") || Mavo.Node.getProperty(element) || element.id || \"mavo\" + this.index;\n\n\t\t\tif (this.index == 1) {\n\t\t\t\tthis.store = _.urlParam(\"store\");\n\t\t\t\tthis.source = _.urlParam(\"source\");\n\t\t\t}\n\n\t\t\tthis.store = this.store || _.urlParam(this.id + \"_store\") || element.getAttribute(\"data-store\") || null;\n\t\t\tthis.source = this.source || _.urlParam(this.id + \"_source\") || element.getAttribute(\"data-source\") || null;\n\n\t\t\tthis.autoEdit = _.has(\"autoedit\", element);\n\n\t\t\tthis.element = _.is(\"scope\", element) ? element : $(_.selectors.rootScope, element);\n\n\t\t\tif (!this.element) {\n\t\t\t\telement.setAttribute(\"typeof\", element.getAttribute(\"property\") || \"\");\n\t\t\t\telement.removeAttribute(\"property\");\n\t\t\t\tthis.element = element;\n\t\t\t}\n\n\t\t\tthis.element.classList.add(\"mv-root\");\n\n\t\t\t// Apply heuristic for collections\n\t\t\t$$(_.selectors.property + \", \" + _.selectors.scope).concat([this.element]).forEach(function (element) {\n\t\t\t\tif (_.is(\"autoMultiple\", element) && !element.hasAttribute(\"data-multiple\")) {\n\t\t\t\t\telement.setAttribute(\"data-multiple\", \"\");\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.wrapper = element.closest(\".mv-wrapper\") || element;\n\n\t\t\t// Ctrl + S or Cmd + S to save\n\t\t\tthis.wrapper.addEventListener(\"keydown\", function (evt) {\n\t\t\t\tif (evt.keyCode == 83 && evt[_.superKey]) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t_this.save();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Apply heuristic for scopes\n\t\t\t$$(_.selectors.primitive).forEach(function (element) {\n\t\t\t\tvar isScope = $(Mavo.selectors.property, element) && ( // Contains other properties and...\n\t\t\t\tMavo.is(\"multiple\", element) || // is a collection...\n\t\t\t\tMavo.Primitive.getValueAttribute(element) === null // ...or its content is not in an attribute\n\t\t\t\t) || element.matches(\"template\");\n\n\t\t\t\tif (isScope) {\n\t\t\t\t\telement.setAttribute(\"typeof\", \"\");\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.wrapper === this.element && _.is(\"multiple\", element)) {\n\t\t\t\t// Need to create a wrapper\n\t\t\t\tvar around = this.element;\n\n\t\t\t\t// Avoid producing invalid HTML\n\t\t\t\tif (this.element.matches(\"li, option\")) {\n\t\t\t\t\taround = around.parentNode;\n\t\t\t\t} else if (this.element.matches(\"td, tr, tbody, thead, tfoot\")) {\n\t\t\t\t\taround = around.closest(\"table\");\n\t\t\t\t}\n\n\t\t\t\tthis.wrapper = $.create({ around: around });\n\t\t\t}\n\n\t\t\tthis.wrapper.classList.add(\"mv-wrapper\");\n\n\t\t\tthis.ui = {\n\t\t\t\tbar: $(\".mv-bar\", this.wrapper) || $.create({\n\t\t\t\t\tclassName: \"mv-bar mv-ui\",\n\t\t\t\t\tstart: this.wrapper\n\t\t\t\t})\n\t\t\t};\n\n\t\t\tthis.ui.status = $(\".status\", this.ui.bar) || $.create(\"span\", {\n\t\t\t\tclassName: \"status\",\n\t\t\t\tinside: this.ui.bar\n\t\t\t});\n\n\t\t\t// Normalize property names\n\t\t\tthis.propertyNames = [];\n\n\t\t\t// Is there any control that requires an edit button?\n\t\t\tthis.needsEdit = false;\n\n\t\t\t// Build mavo objects\n\t\t\tMavo.hooks.run(\"init-tree-before\", this);\n\n\t\t\tthis.root = Mavo.Node.create(this.element, this);\n\t\t\tthis.propertyNames = this.propertyNames.sort(function (a, b) {\n\t\t\t\treturn b.length - a.length;\n\t\t\t});\n\n\t\t\tMavo.hooks.run(\"init-tree-after\", this);\n\n\t\t\tthis.setUnsavedChanges(false);\n\n\t\t\tthis.permissions = new Mavo.Permissions(null, this);\n\n\t\t\t_.observe(this.wrapper, \"class\", function () {\n\t\t\t\tvar p = _this.permissions;\n\t\t\t\tvar floating = !_this.editing && (p.login || p.edit && !p.login && !(p.save && _this.unsavedChanges));\n\t\t\t\t_this.ui.bar.classList.toggle(\"floating\", floating);\n\t\t\t});\n\n\t\t\tthis.permissions.onchange(function (_ref) {\n\t\t\t\tvar action = _ref.action;\n\t\t\t\tvar value = _ref.value;\n\n\t\t\t\t_this.wrapper.classList.toggle(\"can-\" + action, value);\n\t\t\t});\n\n\t\t\tthis.permissions.can([\"edit\", \"add\", \"delete\"], function () {\n\t\t\t\t_this.ui.edit = $.create(\"button\", {\n\t\t\t\t\tclassName: \"edit\",\n\t\t\t\t\ttextContent: \"Edit\",\n\t\t\t\t\tonclick: function onclick(e) {\n\t\t\t\t\t\treturn _this.editing ? _this.done() : _this.edit();\n\t\t\t\t\t},\n\t\t\t\t\tinside: _this.ui.bar\n\t\t\t\t});\n\n\t\t\t\tif (_this.autoEdit) {\n\t\t\t\t\trequestAnimationFrame(function () {\n\t\t\t\t\t\treturn _this.ui.edit.click();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, function () {\n\t\t\t\t// cannot\n\t\t\t\t$.remove(_this.ui.edit);\n\n\t\t\t\tif (_this.editing) {\n\t\t\t\t\t_this.done();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.needsEdit) {\n\t\t\t\tthis.permissions.can(\"save\", function () {\n\t\t\t\t\t_this.ui.save = $.create(\"button\", {\n\t\t\t\t\t\tclassName: \"save\",\n\t\t\t\t\t\ttextContent: \"Save\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: function click(e) {\n\t\t\t\t\t\t\t\treturn _this.save();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"mouseenter focus\": function mouseenterFocus(e) {\n\t\t\t\t\t\t\t\t_this.wrapper.classList.add(\"save-hovered\");\n\t\t\t\t\t\t\t\t_this.setUnsavedChanges();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"mouseleave blur\": function mouseleaveBlur(e) {\n\t\t\t\t\t\t\t\treturn _this.wrapper.classList.remove(\"save-hovered\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinside: _this.ui.bar\n\t\t\t\t\t});\n\n\t\t\t\t\t_this.ui.revert = $.create(\"button\", {\n\t\t\t\t\t\tclassName: \"revert\",\n\t\t\t\t\t\ttextContent: \"Revert\",\n\t\t\t\t\t\tdisabled: true,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: function click(e) {\n\t\t\t\t\t\t\t\treturn _this.revert();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"mouseenter focus\": function mouseenterFocus(e) {\n\t\t\t\t\t\t\t\tif (!_this.unsavedChanges) {\n\t\t\t\t\t\t\t\t\t_this.wrapper.classList.add(\"revert-hovered\");\n\t\t\t\t\t\t\t\t\t_this.setUnsavedChanges();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"mouseleave blur\": function mouseleaveBlur(e) {\n\t\t\t\t\t\t\t\treturn _this.wrapper.classList.remove(\"revert-hovered\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinside: _this.ui.bar\n\t\t\t\t\t});\n\t\t\t\t}, function () {\n\t\t\t\t\t$.remove([_this.ui.save, _this.ui.revert]);\n\t\t\t\t\t_this.ui.save = _this.ui.revert = null;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.permissions.can(\"delete\", function () {\n\t\t\t\t_this.ui.clear = $.create(\"button\", {\n\t\t\t\t\tclassName: \"clear\",\n\t\t\t\t\ttextContent: \"Clear\",\n\t\t\t\t\tonclick: function onclick(e) {\n\t\t\t\t\t\treturn _this.clear();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t_this.ui.bar.appendChild(_this.ui.clear);\n\t\t\t});\n\n\t\t\tthis.permissions.cannot([\"delete\", \"edit\"], function () {\n\t\t\t\t$.remove(_this.ui.clear);\n\t\t\t});\n\n\t\t\tif (this.store || this.source) {\n\t\t\t\t// Fetch existing data\n\t\t\t\tthis.storage = new _.Storage(this);\n\n\t\t\t\tthis.permissions.can(\"read\", function () {\n\t\t\t\t\treturn _this.storage.load();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// No storage\n\t\t\t\tthis.permissions.on([\"read\", \"edit\"]);\n\n\t\t\t\t$.fire(this.wrapper, \"mavo:load\");\n\t\t\t}\n\n\t\t\tif (!this.needsEdit) {\n\t\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\"]);\n\t\t\t}\n\n\t\t\tMavo.hooks.run(\"init-end\", this);\n\t\t},\n\n\t\tget data() {\n\t\t\treturn this.getData();\n\t\t},\n\n\t\tgetData: function getData(o) {\n\t\t\treturn this.root.getData(o);\n\t\t},\n\n\t\ttoJSON: function toJSON() {\n\t\t\tvar data = arguments.length <= 0 || arguments[0] === undefined ? this.data : arguments[0];\n\n\t\t\treturn _.toJSON(data);\n\t\t},\n\n\t\trender: function render(data) {\n\t\t\t_.hooks.run(\"render-start\", { context: this, data: data });\n\n\t\t\tif (data) {\n\t\t\t\tthis.root.render(data);\n\t\t\t}\n\n\t\t\tthis.unsavedChanges = false;\n\t\t},\n\n\t\tclear: function clear() {\n\t\t\tif (confirm(\"This will delete all your data. Are you sure?\")) {\n\t\t\t\tthis.storage && this.storage.clear();\n\t\t\t\tthis.root.clear();\n\t\t\t}\n\t\t},\n\n\t\tedit: function edit() {\n\t\t\tthis.editing = true;\n\n\t\t\tthis.root.edit();\n\n\t\t\t$.events(this.wrapper, \"mouseenter.mavo:edit mouseleave.mavo:edit\", function (evt) {\n\t\t\t\tif (evt.target.matches(\".mv-item-controls .delete\")) {\n\t\t\t\t\tvar item = evt.target.closest(_.selectors.item);\n\t\t\t\t\titem.classList.toggle(\"delete-hover\", evt.type == \"mouseenter\");\n\t\t\t\t}\n\n\t\t\t\tif (evt.target.matches(_.selectors.item)) {\n\t\t\t\t\tevt.target.classList.remove(\"has-hovered-item\");\n\n\t\t\t\t\tvar parent = evt.target.parentNode.closest(_.selectors.item);\n\n\t\t\t\t\tif (parent) {\n\t\t\t\t\t\tparent.classList.toggle(\"has-hovered-item\", evt.type == \"mouseenter\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, true);\n\n\t\t\tthis.setUnsavedChanges();\n\t\t},\n\n\t\tsetUnsavedChanges: function setUnsavedChanges(value) {\n\t\t\tvar unsavedChanges = !!value;\n\n\t\t\tif (!value) {\n\t\t\t\tthis.walk(function (obj) {\n\t\t\t\t\tif (obj.unsavedChanges) {\n\t\t\t\t\t\tunsavedChanges = true;\n\n\t\t\t\t\t\tif (value === false) {\n\t\t\t\t\t\t\tobj.unsavedChanges = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.unsavedChanges = unsavedChanges;\n\t\t},\n\n\t\t// Conclude editing\n\t\tdone: function done() {\n\t\t\tthis.root.done();\n\t\t\t$.unbind(this.wrapper, \".mavo:edit\");\n\t\t\tthis.editing = false;\n\t\t\tthis.unsavedChanges = false;\n\t\t},\n\n\t\tsave: function save() {\n\t\t\tthis.root.save();\n\n\t\t\tif (this.storage) {\n\t\t\t\tthis.storage.save();\n\t\t\t}\n\n\t\t\tthis.unsavedChanges = false;\n\t\t},\n\n\t\trevert: function revert() {\n\t\t\tthis.root.revert();\n\t\t},\n\n\t\twalk: function walk(callback) {\n\t\t\tthis.root.walk(callback);\n\t\t},\n\n\t\tlive: {\n\t\t\tediting: {\n\t\t\t\tset: function set(value) {\n\t\t\t\t\tthis.wrapper.classList.toggle(\"editing\", value);\n\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tthis.wrapper.setAttribute(\"data-editing\", \"\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.wrapper.removeAttribute(\"data-editing\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tunsavedChanges: function unsavedChanges(value) {\n\t\t\t\tthis.wrapper.classList.toggle(\"unsaved-changes\", value);\n\n\t\t\t\tif (this.ui && this.ui.save) {\n\t\t\t\t\tthis.ui.save.disabled = !value;\n\t\t\t\t\tthis.ui.revert.disabled = !value;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tneedsEdit: function needsEdit(value) {\n\t\t\t\tthis.ui.bar[(value ? \"remove\" : \"set\") + \"Attribute\"](\"hidden\", \"\");\n\t\t\t}\n\t\t},\n\n\t\tstatic: {\n\t\t\tall: [],\n\n\t\t\tsuperKey: navigator.platform.indexOf(\"Mac\") === 0 ? \"metaKey\" : \"ctrlKey\",\n\n\t\t\tinit: function init(container) {\n\t\t\t\treturn $$(_.selectors.init, container).map(function (element) {\n\t\t\t\t\treturn new _(element);\n\t\t\t\t});\n\t\t\t},\n\n\t\t\thooks: new $.Hooks()\n\t\t}\n\t});\n\n\t{\n\t\t(function () {\n\n\t\t\tvar s = _.selectors = {\n\t\t\t\tinit: \".mavo, [mavo], [data-mavo], [data-store]\",\n\t\t\t\tproperty: \"[property], [itemprop]\",\n\t\t\t\tspecificProperty: function specificProperty(name) {\n\t\t\t\t\treturn \"[property=\" + name + \"], [itemprop=\" + name + \"]\";\n\t\t\t\t},\n\t\t\t\tscope: \"[typeof], [itemscope], [itemtype], .mv-group\",\n\t\t\t\tmultiple: \"[multiple], [data-multiple], .multiple\",\n\t\t\t\trequired: \"[required], [data-required], .required\",\n\t\t\t\tformControl: \"input, select, textarea\",\n\t\t\t\tcomputed: \".computed\", // Properties or scopes with computed properties, will not be saved\n\t\t\t\titem: \".mv-item\",\n\t\t\t\tui: \".mv-ui\",\n\t\t\t\toption: function option(name) {\n\t\t\t\t\treturn \"[\" + name + \"], [data-\" + name + \"], [data-mv-options~='\" + name + \"'], .\" + name;\n\t\t\t\t},\n\t\t\t\tcontainer: {\n\t\t\t\t\t\"li\": \"ul, ol\",\n\t\t\t\t\t\"tr\": \"table\",\n\t\t\t\t\t\"option\": \"select\",\n\t\t\t\t\t\"dt\": \"dl\",\n\t\t\t\t\t\"dd\": \"dl\"\n\t\t\t\t},\n\t\t\t\tdocumentFragment: \".document-fragment\"\n\t\t\t};\n\n\t\t\tvar arr = s.arr = function (selector) {\n\t\t\t\treturn selector.split(/\\s*,\\s*/g);\n\t\t\t};\n\t\t\tvar not = s.not = function (selector) {\n\t\t\t\treturn arr(selector).map(function (s) {\n\t\t\t\t\treturn \":not(\" + s + \")\";\n\t\t\t\t}).join(\"\");\n\t\t\t};\n\t\t\tvar or = s.or = function (selector1, selector2) {\n\t\t\t\treturn selector1 + \", \" + selector2;\n\t\t\t};\n\t\t\tvar and = s.and = function (selector1, selector2) {\n\t\t\t\tvar ret = [],\n\t\t\t\t    arr2 = arr(selector2);\n\n\t\t\t\tarr(selector1).forEach(function (s1) {\n\t\t\t\t\treturn ret.push.apply(ret, _toConsumableArray(arr2.map(function (s2) {\n\t\t\t\t\t\treturn s1 + s2;\n\t\t\t\t\t})));\n\t\t\t\t});\n\n\t\t\t\treturn ret.join(\", \");\n\t\t\t};\n\t\t\tvar andNot = s.andNot = function (selector1, selector2) {\n\t\t\t\treturn and(selector1, not(selector2));\n\t\t\t};\n\n\t\t\t$.extend(_.selectors, {\n\t\t\t\tprimitive: andNot(s.property, s.scope),\n\t\t\t\trootScope: andNot(s.scope, s.property),\n\t\t\t\toutput: or(s.specificProperty(\"output\"), \".output, .value\"),\n\t\t\t\tautoMultiple: and(\"li, tr, option\", \":only-of-type\")\n\t\t\t});\n\t\t})();\n\t}\n\n\t// Init mavo\n\tPromise.all([$.ready(), $.include(Array.from && window.Intl && document.documentElement.closest, \"https://cdn.polyfill.io/v2/polyfill.min.js?features=blissfuljs,Intl.~locale.en\")]).catch(function (err) {\n\t\treturn console.error(err);\n\t}).then(function () {\n\t\treturn Mavo.init();\n\t});\n\n\tStretchy.selectors.filter = \".mv-editor:not([property])\";\n})(Bliss, Bliss.$);\n\n(function ($, $$) {\n\n\tvar _ = $.extend(Mavo, {\n\t\ttoJSON: function toJSON(data) {\n\t\t\tif (data === null) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\n\t\t\tif (typeof data === \"string\") {\n\t\t\t\t// Do not stringify twice!\n\t\t\t\treturn data;\n\t\t\t}\n\n\t\t\treturn JSON.stringify(data, null, \"\\t\");\n\t\t},\n\n\t\t// Convert an identifier to readable text that can be used as a label\n\t\treadable: function readable(identifier) {\n\t\t\t// Is it camelCase?\n\t\t\treturn identifier && identifier.replace(/([a-z])([A-Z])(?=[a-z])/g, function ($0, $1, $2) {\n\t\t\t\treturn $1 + \" \" + $2.toLowerCase();\n\t\t\t}) // camelCase?\n\t\t\t.replace(/([a-z])[_\\/-](?=[a-z])/g, \"$1 \") // Hyphen-separated / Underscore_separated?\n\t\t\t.replace(/^[a-z]/, function ($0) {\n\t\t\t\treturn $0.toUpperCase();\n\t\t\t}); // Capitalize\n\t\t},\n\n\t\t// Inverse of _.readable(): Take a readable string and turn it into an identifier\n\t\tidentifier: function identifier(readable) {\n\t\t\treadable = readable + \"\";\n\t\t\treturn readable && readable.replace(/\\s+/g, \"-\") // Convert whitespace to hyphens\n\t\t\t.replace(/[^\\w-]/g, \"\") // Remove weird characters\n\t\t\t.toLowerCase();\n\t\t},\n\n\t\tqueryJSON: function queryJSON(data, path) {\n\t\t\tif (!path || !data) {\n\t\t\t\treturn data;\n\t\t\t}\n\n\t\t\treturn $.value.apply($, [data].concat(path.split(\"/\")));\n\t\t},\n\n\t\tobserve: function observe(element, attribute, observer, oldValue) {\n\t\t\tif (!(observer instanceof MutationObserver)) {\n\t\t\t\tobserver = new MutationObserver(observer);\n\t\t\t}\n\n\t\t\tvar options = attribute ? {\n\t\t\t\tattributes: true,\n\t\t\t\tattributeFilter: [attribute],\n\t\t\t\tattributeOldValue: !!oldValue\n\t\t\t} : {\n\t\t\t\tcharacterData: true,\n\t\t\t\tchildList: true,\n\t\t\t\tsubtree: true,\n\t\t\t\tcharacterDataOldValue: !!oldValue\n\t\t\t};\n\n\t\t\tobserver.observe(element, options);\n\n\t\t\treturn observer;\n\t\t},\n\n\t\t// If the passed value is not an array, convert to an array\n\t\ttoArray: function toArray(arr) {\n\t\t\treturn Array.isArray(arr) ? arr : [arr];\n\t\t},\n\n\t\t// Recursively flatten a multi-dimensional array\n\t\tflatten: function flatten(arr) {\n\t\t\tif (!Array.isArray(arr)) {\n\t\t\t\treturn [arr];\n\t\t\t}\n\n\t\t\treturn arr.reduce(function (prev, c) {\n\t\t\t\treturn _.toArray(prev).concat(_.flatten(c));\n\t\t\t}, []);\n\t\t},\n\n\t\tis: function is(thing, element) {\n\t\t\treturn element.matches && element.matches(_.selectors[thing]);\n\t\t},\n\n\t\thas: function has(option, element) {\n\t\t\treturn element.matches && element.matches(_.selectors.option(option));\n\t\t},\n\n\t\turlParam: function urlParam() {\n\t\t\tvar searchParams = \"searchParams\" in URL.prototype ? new URL(location).searchParams : null;\n\t\t\tvar value = null;\n\n\t\t\tfor (var _len = arguments.length, names = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\tnames[_key] = arguments[_key];\n\t\t\t}\n\n\t\t\tvar _iteratorNormalCompletion = true;\n\t\t\tvar _didIteratorError = false;\n\t\t\tvar _iteratorError = undefined;\n\n\t\t\ttry {\n\t\t\t\tfor (var _iterator = names[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\t\t\tvar _name = _step.value;\n\n\t\t\t\t\tif (searchParams) {\n\t\t\t\t\t\tvalue = searchParams.get(_name);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar match = location.search.match(RegExp(\"[?&]\" + _name + \"(?:=([^&]+))?(?=&|$)\", \"i\"));\n\t\t\t\t\t\tvalue = match && (match[1] || \"\");\n\t\t\t\t\t}\n\n\t\t\t\t\tif (value !== null) {\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t_didIteratorError = true;\n\t\t\t\t_iteratorError = err;\n\t\t\t} finally {\n\t\t\t\ttry {\n\t\t\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t\t\t_iterator.return();\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tif (_didIteratorError) {\n\t\t\t\t\t\tthrow _iteratorError;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\t});\n\n\t// Bliss plugins\n\n\t// Provide shortcuts to long property chains\n\t$.proxy = $.classProps.proxy = $.overload(function (obj, property, proxy) {\n\t\tObject.defineProperty(obj, property, {\n\t\t\tget: function get() {\n\t\t\t\treturn this[proxy][property];\n\t\t\t},\n\t\t\tset: function set(value) {\n\t\t\t\tthis[proxy][property] = value;\n\t\t\t},\n\t\t\tconfigurable: true,\n\t\t\tenumerable: true\n\t\t});\n\n\t\treturn obj;\n\t});\n\n\t$.classProps.propagated = function (proto, names) {\n\t\tMavo.toArray(names).forEach(function (name) {\n\t\t\tvar existing = proto[name];\n\n\t\t\tproto[name] = function () {\n\t\t\t\tvar ret = existing && existing.apply(this, arguments);\n\n\t\t\t\tif (this.propagate && ret !== false) {\n\t\t\t\t\tthis.propagate(name);\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t};\n\n\t// :focus-within shim\n\tdocument.addEventListener(\"focus\", function (evt) {\n\t\t$$(\".focus-within\").forEach(function (el) {\n\t\t\treturn el.classList.remove(\"focus-within\");\n\t\t});\n\n\t\tvar element = evt.target;\n\n\t\twhile (element = element.parentNode) {\n\t\t\tif (element.classList) {\n\t\t\t\telement.classList.add(\"focus-within\");\n\t\t\t}\n\t\t}\n\t}, true);\n})(Bliss, Bliss.$);\n\n(function ($) {\n\n\tvar _ = Mavo.Permissions = $.Class({\n\t\tconstructor: function constructor(o) {\n\t\t\tthis.triggers = [];\n\n\t\t\tthis.set(o);\n\n\t\t\tthis.hooks = new $.Hooks();\n\t\t},\n\n\t\t// Set multiple permissions at once\n\t\tset: function set(o) {\n\t\t\tfor (var action in o) {\n\t\t\t\tthis[action] = o[action];\n\t\t\t}\n\t\t},\n\n\t\t// Set a bunch of permissions to true. Chainable.\n\t\ton: function on(actions) {\n\t\t\tvar _this2 = this;\n\n\t\t\tMavo.toArray(actions).forEach(function (action) {\n\t\t\t\treturn _this2[action] = true;\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\n\t\t// Set a bunch of permissions to false. Chainable.\n\t\toff: function off(actions) {\n\t\t\tvar _this3 = this;\n\n\t\t\tactions = Array.isArray(actions) ? actions : [actions];\n\n\t\t\tactions.forEach(function (action) {\n\t\t\t\treturn _this3[action] = false;\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\n\t\t// Fired once at least one of the actions passed can be performed\n\t\t// Kind of like a Promise that can be resolved multiple times.\n\t\tcan: function can(actions, callback, cannot) {\n\t\t\tthis.observe(actions, true, callback);\n\n\t\t\tif (cannot) {\n\t\t\t\t// Fired once the action cannot be done anymore, even though it could be done before\n\t\t\t\tthis.cannot(actions, cannot);\n\t\t\t}\n\t\t},\n\n\t\t// Fired once NONE of the actions can be performed\n\t\tcannot: function cannot(actions, callback) {\n\t\t\tthis.observe(actions, false, callback);\n\t\t},\n\n\t\t// Like this.can(), but returns a promise\n\t\t// Useful for things that you want to do only once\n\t\twhen: function when(actions) {\n\t\t\tvar _this4 = this;\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t_this4.can(actions, resolve, reject);\n\t\t\t});\n\t\t},\n\n\t\t// Schedule a callback for when a set of permissions changes value\n\t\tobserve: function observe(actions, value, callback) {\n\t\t\tactions = Mavo.toArray(actions);\n\n\t\t\tif (this.is(actions, value)) {\n\t\t\t\t// Should be fired immediately\n\t\t\t\tcallback();\n\t\t\t}\n\n\t\t\t// For future transitions\n\t\t\tthis.triggers.push({ actions: actions, value: value, callback: callback, active: true });\n\t\t},\n\n\t\t// Compare a set of permissions with true or false\n\t\t// If comparing with true, we want at least one to be true, i.e. OR\n\t\t// If comparing with false, we want ALL to be false, i.e. NOR\n\t\tis: function is(actions, able) {\n\t\t\tvar _this5 = this;\n\n\t\t\tvar or = actions.map(function (action) {\n\t\t\t\treturn !!_this5[action];\n\t\t\t}).reduce(function (prev, current) {\n\t\t\t\treturn prev || current;\n\t\t\t});\n\n\t\t\treturn able ? or : !or;\n\t\t},\n\n\t\t// Monitor all changes\n\t\tonchange: function onchange(callback) {\n\t\t\tthis.hooks.add(\"change\", callback);\n\t\t},\n\n\t\t// A single permission changed value\n\t\tchanged: function changed(action, value, from) {\n\t\t\tvar _this6 = this;\n\n\t\t\tfrom = !!from;\n\t\t\tvalue = !!value;\n\n\t\t\tif (value == from) {\n\t\t\t\t// Nothing changed\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// $.live() calls the setter before the actual property is set so we\n\t\t\t// need to set it manually, otherwise it still has its previous value\n\t\t\tthis[\"_\" + action] = value;\n\n\t\t\t// TODO add classes to wrapper\n\t\t\tthis.triggers.forEach(function (trigger) {\n\t\t\t\tvar match = _this6.is(trigger.actions, trigger.value);\n\n\t\t\t\tif (trigger.active && trigger.actions.indexOf(action) > -1 && match) {\n\n\t\t\t\t\ttrigger.active = false;\n\t\t\t\t\ttrigger.callback();\n\t\t\t\t} else if (!match) {\n\t\t\t\t\t// This is so that triggers can only be executed in an actual transition\n\t\t\t\t\t// And that if there is a trigger for [a,b] it won't be executed twice\n\t\t\t\t\t// if a and b are set to true one after the other\n\t\t\t\t\ttrigger.active = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.hooks.run(\"change\", { action: action, value: value, permissions: this });\n\t\t},\n\n\t\tor: function or(permissions) {\n\t\t\tvar _this7 = this;\n\n\t\t\t_.actions.forEach(function (action) {\n\t\t\t\t_this7[action] = _this7[action] || permissions[action];\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\n\t\tstatic: {\n\t\t\tactions: [],\n\n\t\t\t// Register a new permission type\n\t\t\tregister: function register(action, setter) {\n\t\t\t\tif (Array.isArray(action)) {\n\t\t\t\t\taction.forEach(function (action) {\n\t\t\t\t\t\treturn _.register(action, setter);\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$.live(_.prototype, action, function (able, previous) {\n\t\t\t\t\tif (setter) {\n\t\t\t\t\t\tsetter.call(this, able, previous);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.changed(action, able, previous);\n\t\t\t\t});\n\n\t\t\t\t_.actions.push(action);\n\t\t\t}\n\t\t}\n\t});\n\n\t_.register([\"read\", \"save\"]);\n\n\t_.register(\"login\", function (can) {\n\t\tif (can && this.logout) {\n\t\t\tthis.logout = false;\n\t\t}\n\t});\n\n\t_.register(\"logout\", function (can) {\n\t\tif (can && this.login) {\n\t\t\tthis.login = false;\n\t\t}\n\t});\n\n\t_.register(\"edit\", function (can) {\n\t\tif (can) {\n\t\t\tthis.add = this.delete = true;\n\t\t}\n\t});\n\n\t_.register([\"add\", \"delete\"], function (can) {\n\t\tif (!can) {\n\t\t\tthis.edit = false;\n\t\t}\n\t});\n})(Bliss);\n\n(function ($) {\n\n\tvar _ = Mavo.Storage = $.Class({\n\t\tconstructor: function constructor(mavo) {\n\t\t\tvar _this8 = this;\n\n\t\t\tthis.mavo = mavo;\n\n\t\t\tthis.backend = _.Backend.create(this.mavo.store, this);\n\t\t\tthis.sourceBackend = _.Backend.create(this.mavo.source, this);\n\n\t\t\tif (this.backend) {\n\t\t\t\t// Permissions of first backend become the permissions of the app\n\t\t\t\t// TODO just use global permissions\n\t\t\t\tthis.backend.permissions = this.permissions.or(this.backend.permissions);\n\t\t\t} else {\n\t\t\t\tthis.permissions.on(\"read\");\n\t\t\t}\n\n\t\t\tthis.loaded = new Promise(function (resolve, reject) {\n\t\t\t\t_this8.mavo.wrapper.addEventListener(\"mavo:load\", resolve);\n\t\t\t});\n\n\t\t\tthis.authControls = {};\n\n\t\t\tthis.permissions.can(\"login\", function () {\n\t\t\t\t// #login authenticates if only 1 mavo on the page, or if the first.\n\t\t\t\t// Otherwise, we have to generate a slightly more complex hash\n\t\t\t\t_this8.loginHash = \"#login\" + (Mavo.all[0] === _this8.mavo ? \"\" : \"-\" + _this8.mavo.id);\n\n\t\t\t\t_this8.authControls.login = $.create({\n\t\t\t\t\ttag: \"a\",\n\t\t\t\t\thref: _this8.loginHash,\n\t\t\t\t\ttextContent: \"Login\",\n\t\t\t\t\tclassName: \"login button\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: function click(evt) {\n\t\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\t\t_this8.login();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tafter: $(\".status\", _this8.mavo.ui.bar)\n\t\t\t\t});\n\n\t\t\t\t// We also support a hash to trigger login, in case the user doesn't want visible login UI\n\t\t\t\tvar login;\n\t\t\t\t(login = function login() {\n\t\t\t\t\tif (location.hash === _this8.loginHash) {\n\t\t\t\t\t\t// This just does location.hash = \"\" without getting a pointless # at the end of the URL\n\t\t\t\t\t\thistory.replaceState(null, document.title, new URL(\"\", location) + \"\");\n\t\t\t\t\t\t_this8.login();\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t\twindow.addEventListener(\"hashchange.mavo\", login);\n\t\t\t}, function () {\n\t\t\t\t$.remove(_this8.authControls.login);\n\t\t\t\t_this8.mavo.wrapper._.unbind(\"hashchange.mavo\");\n\t\t\t});\n\n\t\t\t// Update login status\n\t\t\tthis.mavo.wrapper.addEventListener(\"mavo:login.mavo\", function (evt) {\n\t\t\t\tif (evt.backend == _this8.backend) {\n\t\t\t\t\t// ignore logins from source backend\n\t\t\t\t\tvar status = $(\".status\", _this8.mavo.ui.bar);\n\t\t\t\t\tstatus.innerHTML = \"\";\n\t\t\t\t\tstatus._.contents([\"Logged in to \" + evt.backend.id + \" as \", { tag: \"strong\", innerHTML: evt.name }, {\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttextContent: \"Logout\",\n\t\t\t\t\t\tclassName: \"logout\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: function click(e) {\n\t\t\t\t\t\t\t\treturn evt.backend.logout();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.mavo.wrapper.addEventListener(\"mavo:logout.mavo\", function (evt) {\n\t\t\t\t$(\".status\", _this8.mavo.ui.bar).textContent = \"\";\n\t\t\t});\n\t\t},\n\n\t\tproxy: {\n\t\t\tpermissions: \"mavo\"\n\t\t},\n\n\t\t/**\n   * load - Fetch data from source and render it.\n   *\n   * @return {Promise}  A promise that resolves when the data is loaded.\n   */\n\t\tload: function load() {\n\t\t\tvar _this9 = this;\n\n\t\t\tthis.inProgress = \"Loading\";\n\n\t\t\tvar backend = this.backend || this.sourceBackend;\n\n\t\t\treturn backend.ready.then(function () {\n\t\t\t\treturn backend.get();\n\t\t\t}).catch(function (err) {\n\t\t\t\t// Try again with source\n\t\t\t\tif (_this9.sourceBackend && backend !== _this9.sourceBackend) {\n\t\t\t\t\treturn _this9.sourceBackend.ready.then(function () {\n\t\t\t\t\t\treturn _this9.sourceBackend.get();\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Promise.reject(err);\n\t\t\t}).then(function (response) {\n\t\t\t\tif (response && $.type(response) == \"string\") {\n\t\t\t\t\tresponse = JSON.parse(response);\n\t\t\t\t}\n\n\t\t\t\t_this9.mavo.render(response);\n\t\t\t}).catch(function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\tif (err.xhr && err.xhr.status == 404) {\n\t\t\t\t\t\t_this9.mavo.render(\"\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// TODO display error to user\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t\tconsole.log(err.stack);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).then(function () {\n\t\t\t\t_this9.inProgress = false;\n\t\t\t\t$.fire(_this9.mavo.wrapper, \"mavo:load\");\n\t\t\t});\n\t\t},\n\n\t\tsave: function save() {\n\t\t\tvar _this10 = this;\n\n\t\t\tthis.inProgress = \"Saving\";\n\n\t\t\tthis.backend.login().then(function () {\n\t\t\t\treturn _this10.backend.put();\n\t\t\t}).then(function (file) {\n\t\t\t\t$.fire(_this10.mavo.wrapper, \"mavo:save\", {\n\t\t\t\t\tdata: file.data,\n\t\t\t\t\tdataString: file.dataString\n\t\t\t\t});\n\t\t\t}).catch(function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t\tconsole.log(err.stack);\n\t\t\t\t}\n\t\t\t}).then(function () {\n\t\t\t\t_this10.inProgress = false;\n\t\t\t});\n\t\t},\n\n\t\tlogin: function login() {\n\t\t\treturn this.backend.login();\n\t\t},\n\n\t\tlogout: function logout() {\n\t\t\treturn this.backend.logout();\n\t\t},\n\n\t\tclear: function clear() {\n\t\t\tthis.save(null);\n\t\t},\n\n\t\t// Get storage parameters from the main element and cache them. Used for API keys and the like.\n\t\tparam: function param(id) {\n\t\t\t// TODO traverse all properties and cache params in constructor, to avoid\n\t\t\t// collection items carrying all of these\n\t\t\tthis.params = this.params || {};\n\n\t\t\tif (!(id in this.params)) {\n\t\t\t\tvar attribute = \"data-store-\" + id;\n\n\t\t\t\tthis.params[id] = this.mavo.wrapper.getAttribute(attribute) || this.mavo.element.getAttribute(attribute);\n\n\t\t\t\tthis.mavo.wrapper.removeAttribute(attribute);\n\t\t\t\tthis.mavo.element.removeAttribute(attribute);\n\t\t\t}\n\n\t\t\treturn this.params[id];\n\t\t},\n\n\t\tlive: {\n\t\t\tinProgress: function inProgress(value) {\n\t\t\t\tif (value) {\n\t\t\t\t\tvar p = $.create(\"div\", {\n\t\t\t\t\t\ttextContent: value + \"…\",\n\t\t\t\t\t\tclassName: \"progress\",\n\t\t\t\t\t\tinside: this.mavo.wrapper\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t$.remove($(\".progress\", this.mavo.wrapper));\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tstatic: {\n\t\t\tisHash: function isHash(url) {\n\t\t\t\treturn url.origin === location.origin && url.pathname === location.pathname && !!url.hash;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Base class for all backends\n\t_.Backend = $.Class({\n\t\tconstructor: function constructor(url, storage) {\n\t\t\tthis.url = url;\n\t\t\tthis.storage = storage;\n\n\t\t\t// Permissions of this particular backend.\n\t\t\tthis.permissions = new Mavo.Permissions();\n\t\t},\n\n\t\t// To be be overriden by subclasses\n\t\tready: Promise.resolve(),\n\t\tlogin: function login() {\n\t\t\treturn Promise.resolve();\n\t\t},\n\t\tlogout: function logout() {\n\t\t\treturn Promise.resolve();\n\t\t},\n\n\t\tgetFile: function getFile() {\n\t\t\tvar data = this.mavo.data;\n\n\t\t\treturn {\n\t\t\t\tdata: data,\n\t\t\t\tdataString: Mavo.toJSON(data),\n\t\t\t\tfilename: this.filename,\n\t\t\t\tpath: this.path || \"\"\n\t\t\t};\n\t\t},\n\n\t\ttoString: function toString() {\n\t\t\treturn this.id + \" (\" + this.url + \")\";\n\t\t},\n\n\t\tproxy: {\n\t\t\tmavo: \"storage\"\n\t\t},\n\n\t\tstatic: {\n\t\t\t// Return the appropriate backend(s) for this url\n\t\t\tcreate: function create(url, storage) {\n\t\t\t\tif (url) {\n\t\t\t\t\tvar Backend = _.Backend.types.filter(function (Backend) {\n\t\t\t\t\t\treturn Backend.test(url);\n\t\t\t\t\t})[0] || _.Backend.Remote;\n\n\t\t\t\t\treturn new Backend(url, storage);\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t},\n\n\t\t\ttypes: [],\n\n\t\t\tregister: function register(Class) {\n\t\t\t\t_.Backend[Class.prototype.id] = Class;\n\t\t\t\t_.Backend.types.push(Class);\n\t\t\t\treturn Class;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Save in an element\n\t_.Backend.register($.Class({\n\t\tid: \"Element\",\n\t\textends: _.Backend,\n\t\tconstructor: function constructor() {\n\t\t\tthis.permissions.on([\"read\", \"edit\", \"save\"]);\n\n\t\t\tthis.element = $(this.url) || $.create(\"script\", {\n\t\t\t\ttype: \"application/json\",\n\t\t\t\tid: this.url.slice(1),\n\t\t\t\tinside: document.body\n\t\t\t});\n\t\t},\n\n\t\tget: function get() {\n\t\t\treturn Promise.resolve(this.element.textContent);\n\t\t},\n\n\t\tput: function put() {\n\t\t\tvar file = arguments.length <= 0 || arguments[0] === undefined ? this.getFile() : arguments[0];\n\n\t\t\tthis.element.textContent = file.dataString;\n\t\t\treturn Promise.resolve(file);\n\t\t},\n\n\t\tstatic: {\n\t\t\ttest: function test(url) {\n\t\t\t\treturn url.indexOf(\"#\") === 0;\n\t\t\t}\n\t\t}\n\t}));\n\n\t// Load from a remote URL, no save\n\t_.Backend.register($.Class({\n\t\tid: \"Remote\",\n\t\textends: _.Backend,\n\t\tconstructor: function constructor() {\n\t\t\tthis.permissions.on(\"read\");\n\t\t\tthis.url = new URL(this.url, location);\n\t\t},\n\n\t\tget: function get() {\n\t\t\treturn $.fetch(this.url.href, {\n\t\t\t\tresponseType: \"json\"\n\t\t\t}).then(function (xhr) {\n\t\t\t\treturn Promise.resolve(xhr.response);\n\t\t\t}, function () {\n\t\t\t\treturn Promise.resolve(null);\n\t\t\t});\n\t\t},\n\n\t\tstatic: {\n\t\t\ttest: function test(url) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}));\n\n\t// Save in localStorage\n\t_.Backend.register($.Class({\n\t\textends: _.Backend,\n\t\tid: \"Local\",\n\t\tconstructor: function constructor() {\n\t\t\tthis.permissions.on([\"read\", \"edit\", \"save\"]);\n\t\t\tthis.key = this.mavo.id;\n\t\t},\n\n\t\tget: function get() {\n\t\t\treturn Promise[this.key in localStorage ? \"resolve\" : \"reject\"](localStorage[this.key]);\n\t\t},\n\n\t\tput: function put() {\n\t\t\tvar file = arguments.length <= 0 || arguments[0] === undefined ? this.getFile() : arguments[0];\n\n\t\t\tif (file.data === null) {\n\t\t\t\tdelete localStorage[this.key];\n\t\t\t} else {\n\t\t\t\tlocalStorage[this.key] = file.dataString;\n\t\t\t}\n\n\t\t\treturn Promise.resolve(file);\n\t\t},\n\n\t\tstatic: {\n\t\t\ttest: function test(value) {\n\t\t\t\treturn value == \"local\";\n\t\t\t}\n\t\t}\n\t}));\n})(Bliss);\n\n(function ($, $$) {\n\n\tvar _ = Mavo.Node = $.Class({\n\t\tabstract: true,\n\t\tconstructor: function constructor(element, mavo) {\n\t\t\tvar o = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n\t\t\tif (!element || !mavo) {\n\t\t\t\tthrow new Error(\"Mavo.Node constructor requires an element argument and a mavo object\");\n\t\t\t}\n\n\t\t\tthis.element = element;\n\t\t\tthis.template = o.template;\n\n\t\t\tthis.mavo = mavo;\n\n\t\t\tif (!this.fromTemplate([\"property\", \"type\"])) {\n\t\t\t\tthis.property = _.getProperty(element);\n\t\t\t\tthis.type = Mavo.Scope.normalize(element);\n\t\t\t}\n\n\t\t\tthis.scope = this.parentScope = o.scope;\n\n\t\t\tMavo.hooks.run(\"node-init-end\", this);\n\t\t},\n\n\t\tget isRoot() {\n\t\t\treturn !this.property;\n\t\t},\n\n\t\tget name() {\n\t\t\treturn Mavo.readable(this.property || this.type).toLowerCase();\n\t\t},\n\n\t\tget data() {\n\t\t\treturn this.getData();\n\t\t},\n\n\t\tgetRelativeData: function getRelativeData() {\n\t\t\tvar _this11 = this;\n\n\t\t\tvar o = arguments.length <= 0 || arguments[0] === undefined ? { dirty: true, computed: true, null: true } : arguments[0];\n\n\t\t\tvar ret = this.getData(o);\n\n\t\t\tif (self.Proxy && ret && (typeof ret === \"undefined\" ? \"undefined\" : _typeof(ret)) === \"object\") {\n\t\t\t\tret = new Proxy(ret, {\n\t\t\t\t\tget: function get(data, property) {\n\t\t\t\t\t\tif (property in data) {\n\t\t\t\t\t\t\treturn data[property];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (property == \"$index\") {\n\t\t\t\t\t\t\treturn _this11.index + 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Look in ancestors\n\t\t\t\t\t\tvar ret = _this11.walkUp(function (scope) {\n\t\t\t\t\t\t\tif (property in scope.properties) {\n\t\t\t\t\t\t\t\t// TODO decouple\n\t\t\t\t\t\t\t\tscope.expressions.updateAlso.add(_this11.expressions);\n\n\t\t\t\t\t\t\t\treturn scope.properties[property].getRelativeData(o);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t\t\treturn ret;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\thas: function has(data, property) {\n\t\t\t\t\t\tif (property in data) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Property does not exist, look for it elsewhere\n\t\t\t\t\t\tif (property == \"$index\") {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// First look in ancestors\n\t\t\t\t\t\tvar ret = _this11.walkUp(function (scope) {\n\t\t\t\t\t\t\tif (property in scope.properties) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t\t\treturn ret;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Still not found, look in descendants\n\t\t\t\t\t\tret = _this11.find(property);\n\n\t\t\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t\t\tif (Array.isArray(ret)) {\n\t\t\t\t\t\t\t\tret = ret.map(function (item) {\n\t\t\t\t\t\t\t\t\treturn item.getData(o);\n\t\t\t\t\t\t\t\t}).filter(function (item) {\n\t\t\t\t\t\t\t\t\treturn item !== null;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tret = ret.getData(o);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdata[property] = ret;\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tset: function set(data, property, value) {\n\t\t\t\t\t\tthrow Error(\"You can’t set data via expressions.\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\twalk: function walk(callback) {\n\t\t\tvar walker = function walker(obj) {\n\t\t\t\tvar ret = callback(obj);\n\n\t\t\t\tif (ret !== false) {\n\t\t\t\t\tobj.propagate && obj.propagate(walker);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\twalker(this);\n\t\t},\n\n\t\twalkUp: function walkUp(callback) {\n\t\t\tvar scope = this;\n\n\t\t\twhile (scope = scope.parentScope) {\n\t\t\t\tvar ret = callback(scope);\n\n\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tcall: function call(callback) {\n\t\t\tfor (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n\t\t\t\targs[_key2 - 1] = arguments[_key2];\n\t\t\t}\n\n\t\t\targs = args || [];\n\n\t\t\tif (typeof callback === \"string\") {\n\t\t\t\treturn this[callback].apply(this, _toConsumableArray(args));\n\t\t\t} else {\n\t\t\t\treturn callback.apply(this, [this].concat(_toConsumableArray(args)));\n\t\t\t}\n\t\t},\n\n\t\tedit: function edit() {\n\t\t\tthis.propagate(function (obj) {\n\t\t\t\treturn obj[obj.preEdit ? \"preEdit\" : \"edit\"]();\n\t\t\t});\n\t\t},\n\n\t\tpropagated: [\"save\", \"revert\", \"done\", \"import\"],\n\n\t\ttoJSON: Mavo.prototype.toJSON,\n\n\t\tfromTemplate: function fromTemplate(properties) {\n\t\t\tvar _this12 = this;\n\n\t\t\tif (this.template) {\n\t\t\t\tproperties.forEach(function (property) {\n\t\t\t\t\t_this12[property] = _this12.template[property];\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn !!this.template;\n\t\t},\n\n\t\tstatic: {\n\t\t\tcreate: function create(element, mavo) {\n\t\t\t\tvar _Mavo$Unit;\n\n\t\t\t\tvar o = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n\t\t\t\tif (Mavo.is(\"multiple\", element) && !o.collection) {\n\t\t\t\t\treturn new Mavo.Collection(element, mavo, o);\n\t\t\t\t}\n\n\t\t\t\treturn (_Mavo$Unit = Mavo.Unit).create.apply(_Mavo$Unit, arguments);\n\t\t\t},\n\n\t\t\t/**\n    * Get & normalize property name, if exists\n    */\n\t\t\tgetProperty: function getProperty(element) {\n\t\t\t\tvar property = element.getAttribute(\"property\") || element.getAttribute(\"itemprop\");\n\n\t\t\t\tif (!property && element.hasAttribute(\"property\")) {\n\t\t\t\t\tproperty = element.name || element.id || element.classList[0];\n\t\t\t\t}\n\n\t\t\t\tif (property) {\n\t\t\t\t\telement.setAttribute(\"property\", property);\n\t\t\t\t}\n\n\t\t\t\treturn property;\n\t\t\t}\n\t\t}\n\t});\n})(Bliss, Bliss.$);\n\n/*\n * Mavo Unit: Super class that Scope and Primitive inherit from\n */\n(function ($, $$) {\n\n\tvar _ = Mavo.Unit = $.Class({\n\t\tabstract: true,\n\t\textends: Mavo.Node,\n\t\tconstructor: function constructor(element, mavo) {\n\t\t\tvar o = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n\t\t\tthis.constructor.all.set(this.element, this);\n\n\t\t\tthis.collection = o.collection;\n\t\t\tthis.dirty = o.dirty;\n\n\t\t\tif (this.collection) {\n\t\t\t\t// This is a collection item\n\t\t\t\tthis.scope = this.parentScope = this.collection.parentScope;\n\t\t\t}\n\n\t\t\tif (!this.fromTemplate([\"computed\", \"required\"])) {\n\t\t\t\tthis.computed = Mavo.is(\"computed\", this.element);\n\t\t\t\tthis.required = Mavo.is(\"required\", this.element);\n\t\t\t}\n\n\t\t\tMavo.hooks.run(\"unit-init-end\", this);\n\t\t},\n\n\t\t/**\n   * Check if this unit is either deleted or inside a deleted scope\n   */\n\t\tisDeleted: function isDeleted() {\n\t\t\tvar ret = this.deleted;\n\n\t\t\tif (this.deleted) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn !!this.parentScope && this.parentScope.isDeleted();\n\t\t},\n\n\t\tgetData: function getData(o) {\n\t\t\to = o || {};\n\n\t\t\tvar isNull = function isNull(unit) {\n\t\t\t\treturn unit.dirty && !o.dirty || unit.deleted && o.dirty || unit.computed && !o.computed || unit.placeholder;\n\t\t\t};\n\n\t\t\tif (isNull(this)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Check if any of the parent scopes doesn't return data\n\t\t\tthis.walkUp(function (scope) {\n\t\t\t\tif (isNull(scope)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tlazy: {\n\t\t\tclosestCollection: function closestCollection() {\n\t\t\t\tif (this.collection) {\n\t\t\t\t\treturn this.collection;\n\t\t\t\t}\n\n\t\t\t\treturn this.walkUp(function (scope) {\n\t\t\t\t\tif (scope.collection) {\n\t\t\t\t\t\treturn scope.collection;\n\t\t\t\t\t}\n\t\t\t\t}) || null;\n\t\t\t}\n\t\t},\n\n\t\tlive: {\n\t\t\tdeleted: function deleted(value) {\n\t\t\t\tvar _this13 = this;\n\n\t\t\t\tthis.element.classList.toggle(\"deleted\", value);\n\n\t\t\t\tif (value) {\n\t\t\t\t\t// Soft delete, store element contents in a fragment\n\t\t\t\t\t// and replace them with an undo prompt.\n\t\t\t\t\tthis.elementContents = document.createDocumentFragment();\n\t\t\t\t\t$$(this.element.childNodes).forEach(function (node) {\n\t\t\t\t\t\t_this13.elementContents.appendChild(node);\n\t\t\t\t\t});\n\n\t\t\t\t\t$.contents(this.element, [\"Deleted \" + this.name, {\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttextContent: \"Undo\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": function click(evt) {\n\t\t\t\t\t\t\t\treturn _this13.deleted = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}]);\n\n\t\t\t\t\tthis.element.classList.remove(\"delete-hover\");\n\t\t\t\t} else if (this.deleted) {\n\t\t\t\t\t// Undelete\n\t\t\t\t\tthis.element.textContent = \"\";\n\t\t\t\t\tthis.element.appendChild(this.elementContents);\n\n\t\t\t\t\t// otherwise expressions won't update because this will still seem as deleted\n\t\t\t\t\t// Alternatively, we could fire datachange with a timeout.\n\t\t\t\t\tthis._deleted = false;\n\n\t\t\t\t\t$.fire(this.element, \"mavo:datachange\", {\n\t\t\t\t\t\tunit: this.collection,\n\t\t\t\t\t\tmavo: this.mavo,\n\t\t\t\t\t\taction: \"undelete\",\n\t\t\t\t\t\titem: this\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tunsavedChanges: function unsavedChanges(value) {\n\t\t\t\tif (value && (this.placeholder || this.computed || !this.editing)) {\n\t\t\t\t\tvalue = false;\n\t\t\t\t}\n\n\t\t\t\tthis.element.classList.toggle(\"unsaved-changes\", value);\n\n\t\t\t\treturn value;\n\t\t\t},\n\n\t\t\tplaceholder: function placeholder(value) {\n\t\t\t\tthis.element.classList.toggle(\"placeholder\", value);\n\t\t\t}\n\t\t},\n\n\t\tstatic: {\n\t\t\tget: function get(element, prioritizePrimitive) {\n\t\t\t\tvar scope = Mavo.Scope.all.get(element);\n\n\t\t\t\treturn prioritizePrimitive || !scope ? Mavo.Primitive.all.get(element) : scope;\n\t\t\t},\n\n\t\t\tcreate: function create(element, mavo) {\n\t\t\t\tvar o = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n\t\t\t\tif (!element || !mavo) {\n\t\t\t\t\tthrow new TypeError(\"Mavo.Unit.create() requires an element argument and a mavo object\");\n\t\t\t\t}\n\n\t\t\t\treturn new Mavo[Mavo.is(\"scope\", element) ? \"Scope\" : \"Primitive\"](element, mavo, o);\n\t\t\t}\n\t\t}\n\t});\n})(Bliss, Bliss.$);\n\n(function ($, $$) {\n\n\tvar _ = Mavo.Expression = $.Class({\n\t\tconstructor: function constructor(expression) {\n\t\t\tthis.expression = expression;\n\t\t},\n\n\t\teval: function _eval(data) {\n\t\t\tthis.oldValue = this.value;\n\n\t\t\t// TODO convert to new Function() which is more optimizable by JS engines.\n\t\t\t// Also, cache the function, since only data changes across invocations.\n\t\t\tMavo.hooks.run(\"expression-eval-beforeeval\", this);\n\n\t\t\ttry {\n\t\t\t\tif (!this.function) {\n\t\t\t\t\tthis.function = this.createFunction();\n\t\t\t\t}\n\n\t\t\t\tthis.value = this.function(data);\n\t\t\t} catch (exception) {\n\t\t\t\tMavo.hooks.run(\"expression-eval-error\", { context: this, exception: exception });\n\n\t\t\t\tthis.value = _.ERROR;\n\t\t\t}\n\n\t\t\treturn this.value;\n\t\t},\n\n\t\ttoString: function toString() {\n\t\t\treturn \"[\" + this.expression + \"]\";\n\t\t},\n\n\n\t\tcreateFunction: function createFunction() {\n\t\t\tvar code = this.expression;\n\n\t\t\tif (/^if\\([\\S\\s]+\\)$/i.test(code)) {\n\t\t\t\tcode = code.replace(/^if\\(/, \"iff(\");\n\t\t\t}\n\n\t\t\t// Transform simple operators to array-friendly math functions\n\t\t\tcode = code.replace(_.simpleOperation, function (expr, operand1, operator, operand2) {\n\t\t\t\tvar ret = \"(\" + Mavo.Functions.operators[operator] + \"(\" + operand1 + \", \" + operand2 + \"))\";\n\t\t\t\treturn ret;\n\t\t\t});\n\n\t\t\t_.simpleOperation.lastIndex = 0;\n\n\t\t\treturn new Function(\"data\", \"with(Mavo.Functions._Trap)\\n\\t\\t\\t\\twith(data) {\\n\\t\\t\\t\\t\\treturn \" + code + \";\\n\\t\\t\\t\\t}\");\n\t\t},\n\n\t\tlive: {\n\t\t\texpression: function expression(value) {\n\t\t\t\tvar code = value = value.trim();\n\n\t\t\t\tthis.function = null;\n\t\t\t}\n\t\t},\n\n\t\tstatic: {\n\t\t\tERROR: \"N/A\",\n\n\t\t\tlazy: {\n\t\t\t\tsimpleOperation: function simpleOperation() {\n\t\t\t\t\tvar operator = Object.keys(Mavo.Functions.operators).map(function (o) {\n\t\t\t\t\t\treturn o.replace(/[|*+]/g, \"\\\\$&\");\n\t\t\t\t\t}).join(\"|\");\n\t\t\t\t\tvar operand = \"\\\\s*(\\\\b[\\\\w.]+\\\\b)\\\\s*\";\n\n\t\t\t\t\treturn RegExp(\"(?:^|\\\\()\" + operand + \"(\" + operator + \")\" + operand + \"(?:$|\\\\))\", \"g\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\t(function () {\n\n\t\tvar _ = Mavo.Expression.Text = $.Class({\n\t\t\tconstructor: function constructor(o) {\n\t\t\t\tthis.all = o.all; // the Mavo.Expressions object that this belongs to\n\t\t\t\tthis.node = o.node;\n\t\t\t\tthis.path = o.path;\n\n\t\t\t\tif (!this.node) {\n\t\t\t\t\t// No node provided, figure it out from path\n\t\t\t\t\tthis.node = this.path.reduce(function (node, index) {\n\t\t\t\t\t\treturn node.childNodes[index];\n\t\t\t\t\t}, this.all.scope.element);\n\t\t\t\t}\n\n\t\t\t\tthis.element = this.node;\n\n\t\t\t\tthis.attribute = o.attribute || null;\n\n\t\t\t\tif (this.node.nodeType === 3) {\n\t\t\t\t\tthis.element = this.node.parentNode;\n\n\t\t\t\t\t// If no element siblings make this.node the element, which is more robust\n\t\t\t\t\t// Same if attribute, there are no attributes on a text node!\n\t\t\t\t\tif (!this.node.parentNode.children.length || this.attribute) {\n\t\t\t\t\t\tthis.node = this.element;\n\t\t\t\t\t\tthis.element.normalize();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.expression = (this.attribute ? this.node.getAttribute(this.attribute) : this.node.textContent).trim();\n\t\t\t\tthis.template = o.template ? o.template.template : this.tokenize(this.expression);\n\n\t\t\t\t// Is this a computed property?\n\t\t\t\tvar primitive = Mavo.Unit.get(this.element);\n\t\t\t\tif (primitive && this.attribute === primitive.attribute) {\n\t\t\t\t\tthis.primitive = primitive;\n\t\t\t\t\tprimitive.computed = true; // Primitives containing an expression as their value are implicitly computed\n\t\t\t\t}\n\n\t\t\t\tMavo.hooks.run(\"expressiontext-init-end\", this);\n\n\t\t\t\t_.elements.set(this.element, [].concat(_toConsumableArray(_.elements.get(this.element) || []), [this]));\n\t\t\t},\n\n\t\t\tupdate: function update(data) {\n\t\t\t\tvar _this14 = this;\n\n\t\t\t\tthis.data = data;\n\n\t\t\t\tvar ret = {};\n\n\t\t\t\tret.value = this.value = this.template.map(function (expr) {\n\t\t\t\t\tif (expr instanceof Mavo.Expression) {\n\t\t\t\t\t\tvar env = { context: _this14, expr: expr };\n\n\t\t\t\t\t\tMavo.hooks.run(\"expressiontext-update-beforeeval\", env);\n\n\t\t\t\t\t\tenv.value = env.expr.eval(data);\n\n\t\t\t\t\t\tMavo.hooks.run(\"expressiontext-update-aftereval\", env);\n\n\t\t\t\t\t\tif (env.value === undefined || env.value === null) {\n\t\t\t\t\t\t\t// Don’t print things like \"undefined\" or \"null\"\n\t\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn env.value;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn expr;\n\t\t\t\t});\n\n\t\t\t\tif (!this.attribute) {\n\t\t\t\t\t// Separate presentational & actual values only apply when content is variable\n\t\t\t\t\tret.presentational = this.value.map(function (value) {\n\t\t\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\t\t\treturn value.join(\", \");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof value == \"number\") {\n\t\t\t\t\t\t\treturn Mavo.Primitive.formatNumber(value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t});\n\n\t\t\t\t\tret.presentational = ret.presentational.length === 1 ? ret.presentational[0] : ret.presentational.join(\"\");\n\t\t\t\t}\n\n\t\t\t\tret.value = ret.value.length === 1 ? ret.value[0] : ret.value.join(\"\");\n\n\t\t\t\tif (this.primitive && this.template.length === 1) {\n\t\t\t\t\tif (typeof ret.value === \"number\") {\n\t\t\t\t\t\tthis.primitive.datatype = \"number\";\n\t\t\t\t\t} else if (typeof ret.value === \"boolean\") {\n\t\t\t\t\t\tthis.primitive.datatype = \"boolean\";\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (ret.presentational === ret.value) {\n\t\t\t\t\tret = ret.value;\n\t\t\t\t}\n\n\t\t\t\tif (this.primitive) {\n\t\t\t\t\tthis.primitive.value = ret;\n\t\t\t\t} else {\n\t\t\t\t\tMavo.Primitive.setValue(this.node, ret, this.attribute, { presentational: ret.presentational });\n\t\t\t\t}\n\t\t\t},\n\n\t\t\ttokenize: function tokenize(template) {\n\t\t\t\tvar regex = this.expressionRegex;\n\t\t\t\tvar match,\n\t\t\t\t    ret = [],\n\t\t\t\t    lastIndex = 0;\n\n\t\t\t\tregex.lastIndex = 0;\n\n\t\t\t\twhile ((match = regex.exec(template)) !== null) {\n\t\t\t\t\t// Literal before the expression\n\t\t\t\t\tif (match.index > lastIndex) {\n\t\t\t\t\t\tret.push(template.substring(lastIndex, match.index));\n\t\t\t\t\t}\n\n\t\t\t\t\tlastIndex = regex.lastIndex = _.findEnd(template.slice(match.index)) + match.index + 1;\n\t\t\t\t\tvar expression = template.slice(match.index + 1, lastIndex - 1);\n\n\t\t\t\t\tret.push(new Mavo.Expression(expression));\n\t\t\t\t}\n\n\t\t\t\t// Literal at the end\n\t\t\t\tif (lastIndex < template.length) {\n\t\t\t\t\tret.push(template.substring(lastIndex));\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\tproxy: {\n\t\t\t\tscope: \"all\",\n\t\t\t\texpressionRegex: \"all\"\n\t\t\t},\n\n\t\t\tstatic: {\n\t\t\t\telements: new WeakMap(),\n\n\t\t\t\t// Find where a ( or [ or { ends.\n\t\t\t\tfindEnd: function findEnd(expr) {\n\t\t\t\t\tvar stack = [];\n\t\t\t\t\tvar inside,\n\t\t\t\t\t    insides = \"\\\"'`\";\n\t\t\t\t\tvar open = \"([{\",\n\t\t\t\t\t    close = \")]}\";\n\t\t\t\t\tvar isEscape;\n\n\t\t\t\t\tfor (var i = 0; expr[i]; i++) {\n\t\t\t\t\t\tvar char = expr[i];\n\n\t\t\t\t\t\tif (inside) {\n\t\t\t\t\t\t\tif (char === inside && !isEscape) {\n\t\t\t\t\t\t\t\tinside = \"\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (!isEscape && insides.indexOf(char) > -1) {\n\t\t\t\t\t\t\tinside = char;\n\t\t\t\t\t\t} else if (open.indexOf(char) > -1) {\n\t\t\t\t\t\t\tstack.push(char);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar peek = stack[stack.length - 1];\n\n\t\t\t\t\t\t\tif (char === close[open.indexOf(peek)]) {\n\t\t\t\t\t\t\t\tstack.pop();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (stack.length === 0) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tisEscape = char == \"\\\\\";\n\t\t\t\t\t}\n\n\t\t\t\t\treturn i;\n\t\t\t\t},\n\n\t\t\t\tlazy: {\n\t\t\t\t\trootFunctionRegExp: function rootFunctionRegExp() {\n\t\t\t\t\t\treturn RegExp(\"^=\\\\s*(?:\" + Mavo.Expressions.rootFunctions.join(\"|\") + \")\\\\($\", \"i\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t})();\n\n\t(function () {\n\n\t\tvar _ = Mavo.Expressions = $.Class({\n\t\t\tconstructor: function constructor(scope) {\n\t\t\t\tvar _this15 = this;\n\n\t\t\t\tif (scope) {\n\t\t\t\t\tthis.scope = scope;\n\t\t\t\t\tthis.scope.expressions = this;\n\t\t\t\t}\n\n\t\t\t\tthis.all = []; // all Expression.Text objects in this scope\n\n\t\t\t\tMavo.hooks.run(\"expressions-init-start\", this);\n\n\t\t\t\tif (this.scope) {\n\t\t\t\t\tvar template = this.scope.template;\n\n\t\t\t\t\tif (template && template.expressions) {\n\t\t\t\t\t\t// We know which expressions we have, don't traverse again\n\t\t\t\t\t\ttemplate.expressions.all.forEach(function (et) {\n\t\t\t\t\t\t\t_this15.all.push(new Mavo.Expression.Text({\n\t\t\t\t\t\t\t\tpath: et.path,\n\t\t\t\t\t\t\t\tattribute: et.attribute,\n\t\t\t\t\t\t\t\tall: _this15,\n\t\t\t\t\t\t\t\ttemplate: et\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.traverse();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// TODO less stupid name?\n\t\t\t\tthis.updateAlso = new Set();\n\n\t\t\t\tthis.active = true;\n\n\t\t\t\tif (this.all.length > 0) {\n\t\t\t\t\tthis.update();\n\n\t\t\t\t\t// Watch changes and update value\n\t\t\t\t\tthis.scope.element.addEventListener(\"mavo:datachange\", function (evt) {\n\t\t\t\t\t\treturn _this15.update();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Update all expressions in this scope\n    */\n\t\t\tupdate: function callee() {\n\t\t\t\tif (!this.active || this.scope.isDeleted()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar env = { context: this, data: this.scope.getRelativeData() };\n\n\t\t\t\tMavo.hooks.run(\"expressions-update-start\", env);\n\n\t\t\t\t$$(this.all).forEach(function (ref) {\n\t\t\t\t\tref.update(env.data);\n\t\t\t\t});\n\n\t\t\t\tthis.updateAlso.forEach(function (exp) {\n\t\t\t\t\treturn exp.update();\n\t\t\t\t});\n\t\t\t},\n\n\t\t\textract: function extract(node, attribute, path) {\n\t\t\t\tthis.expressionRegex.lastIndex = 0;\n\n\t\t\t\tif (this.expressionRegex.test(attribute ? attribute.value : node.textContent)) {\n\t\t\t\t\tthis.all.push(new Mavo.Expression.Text({\n\t\t\t\t\t\tnode: node,\n\t\t\t\t\t\tpath: (path || \"\").slice(1).split(\"/\").map(function (i) {\n\t\t\t\t\t\t\treturn +i;\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tattribute: attribute && attribute.name,\n\t\t\t\t\t\tall: this\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Traverse an element, including attribute nodes, text nodes and all descendants\n\t\t\ttraverse: function traverse(node, path) {\n\t\t\t\tvar _this16 = this;\n\n\t\t\t\tnode = node || this.scope.element;\n\t\t\t\tpath = path || \"\";\n\n\t\t\t\tif (node.matches && node.matches(_.escape)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t// Text node\n\t\t\t\t\t// Leaf node, extract references from content\n\t\t\t\t\tthis.extract(node, null, path);\n\t\t\t\t}\n\n\t\t\t\t// Traverse children and attributes as long as this is NOT the root of a child scope\n\t\t\t\t// (otherwise, it will be taken care of its own Expressions object)\n\t\t\t\tif (node == this.scope.element || !Mavo.is(\"scope\", node)) {\n\t\t\t\t\t$$(node.attributes).forEach(function (attribute) {\n\t\t\t\t\t\treturn _this16.extract(node, attribute, path);\n\t\t\t\t\t});\n\t\t\t\t\t$$(node.childNodes).forEach(function (child, i) {\n\t\t\t\t\t\treturn _this16.traverse(child, path + \"/\" + i);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tlazy: {\n\t\t\t\t// Regex that loosely matches all possible expressions\n\t\t\t\t// False positives are ok, but false negatives are not.\n\t\t\t\texpressionRegex: function expressionRegex() {\n\t\t\t\t\tvar properties = this.scope.mavo.propertyNames.concat(_.special);\n\t\t\t\t\tvar propertyRegex = \"(?:\" + properties.join(\"|\").replace(/\\$/g, \"\\\\$\") + \")\";\n\n\t\t\t\t\treturn RegExp(\"\\\\[[\\\\S\\\\s]*?\" + propertyRegex + \"[\\\\S\\\\s]*?\\\\]\", \"gi\");\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tstatic: {\n\t\t\t\tescape: \".ignore-expressions\",\n\n\t\t\t\t// Special property names\n\t\t\t\tspecial: [\"$index\"],\n\n\t\t\t\tlazy: {\n\t\t\t\t\trootFunctions: function rootFunctions() {\n\t\t\t\t\t\treturn [].concat(_toConsumableArray(Object.keys(Mavo.Functions)), _toConsumableArray(Object.getOwnPropertyNames(Math)), [\"if\", \"\"]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t})();\n\n\tMavo.hooks.add(\"init-tree-after\", function () {\n\t\tthis.walk(function (obj) {\n\t\t\tif (obj instanceof Mavo.Scope) {\n\t\t\t\tnew Mavo.Expressions(obj);\n\t\t\t}\n\t\t});\n\t});\n\n\tMavo.hooks.add(\"scope-init-end\", function () {\n\t\tvar _this17 = this;\n\n\t\trequestAnimationFrame(function () {\n\t\t\t// Tree expressions are processed synchronously, so by now if it doesn't have\n\t\t\t// an expressions object, we need to create it.\n\t\t\tif (!_this17.expressions) {\n\t\t\t\tnew Mavo.Expressions(_this17);\n\t\t\t}\n\n\t\t\t_this17.expressions.update();\n\t\t});\n\t});\n\n\tMavo.hooks.add(\"scope-render-start\", function () {\n\t\tif (!this.expressions) {\n\t\t\t// ??? How can it not have expressions by now?!\n\t\t\tnew Mavo.Expressions(this);\n\t\t}\n\n\t\tthis.expressions.active = false;\n\t});\n\n\tMavo.hooks.add(\"scope-render-end\", function () {\n\t\tvar _this18 = this;\n\n\t\trequestAnimationFrame(function () {\n\t\t\t_this18.expressions.active = true;\n\t\t\t_this18.expressions.update();\n\t\t});\n\t});\n})(Bliss, Bliss.$);\n\n/**\n * Functions available inside Mavo expressions\n */\n\n(function () {\n\n\tvar _ = Mavo.Functions = {\n\t\toperators: {},\n\n\t\t/**\n   * Aggregate sum\n   */\n\t\tsum: function sum(array) {\n\t\t\treturn numbers(array, arguments).reduce(function (prev, current) {\n\t\t\t\treturn +prev + (+current || 0);\n\t\t\t}, 0);\n\t\t},\n\n\t\t/**\n   * Average of an array of numbers\n   */\n\t\taverage: function average(array) {\n\t\t\tarray = numbers(array, arguments);\n\n\t\t\treturn array.length && _.sum(array) / array.length;\n\t\t},\n\n\t\t/**\n   * Min of an array of numbers\n   */\n\t\tmin: function min(array) {\n\t\t\tvar _Math;\n\n\t\t\treturn (_Math = Math).min.apply(_Math, _toConsumableArray(numbers(array, arguments)));\n\t\t},\n\n\t\t/**\n   * Max of an array of numbers\n   */\n\t\tmax: function max(array) {\n\t\t\tvar _Math2;\n\n\t\t\treturn (_Math2 = Math).max.apply(_Math2, _toConsumableArray(numbers(array, arguments)));\n\t\t},\n\n\t\tcount: function count(array) {\n\t\t\treturn Mavo.toArray(array).filter(function (a) {\n\t\t\t\treturn a !== null && a !== false;\n\t\t\t}).length;\n\t\t},\n\n\t\tround: function round(num, decimals) {\n\t\t\tif (!num || !decimals || !isFinite(num)) {\n\t\t\t\treturn Math.round(num);\n\t\t\t}\n\n\t\t\treturn +num.toLocaleString(\"en-US\", {\n\t\t\t\tuseGrouping: false,\n\t\t\t\tmaximumFractionDigits: decimals\n\t\t\t});\n\t\t},\n\n\t\tiff: function iff(condition, iftrue) {\n\t\t\tvar iffalse = arguments.length <= 2 || arguments[2] === undefined ? \"\" : arguments[2];\n\n\t\t\treturn condition ? iftrue : iffalse;\n\t\t}\n\t};\n\n\t/**\n  * Addition for elements and scalars.\n  * Addition between arrays happens element-wise.\n  * Addition between scalars returns their scalar sum (same as +)\n  * Addition between a scalar and an array will result in the scalar being added to every array element.\n  * Ordered by precedence (higher to lower)\n  */\n\toperator(\"not\", function (a) {\n\t\treturn function (a) {\n\t\t\treturn !a;\n\t\t};\n\t});\n\toperator(\"multiply\", function (a, b) {\n\t\treturn a * b;\n\t}, { identity: 1, symbol: \"*\" });\n\toperator(\"divide\", function (a, b) {\n\t\treturn a / b;\n\t}, { identity: 1, symbol: \"/\" });\n\toperator(\"add\", function (a, b) {\n\t\treturn +a + +b;\n\t}, { symbol: \"+\" });\n\toperator(\"subtract\", function (a, b) {\n\t\treturn a - b;\n\t}, { symbol: \"-\" });\n\toperator(\"lte\", function (a, b) {\n\t\treturn a <= b;\n\t}, { symbol: \"<=\" });\n\toperator(\"lt\", function (a, b) {\n\t\treturn a < b;\n\t}, { symbol: \"<\" });\n\toperator(\"gte\", function (a, b) {\n\t\treturn a >= b;\n\t}, { symbol: \">=\" });\n\toperator(\"gt\", function (a, b) {\n\t\treturn a > b;\n\t}, { symbol: \">\" });\n\toperator(\"eq\", function (a, b) {\n\t\treturn a == b;\n\t}, { symbol: \"==\" });\n\toperator(\"and\", function (a, b) {\n\t\treturn !!a && !!b;\n\t}, { identity: true, symbol: \"&&\" });\n\toperator(\"or\", function (a, b) {\n\t\treturn !!a || !!b;\n\t}, { identity: false, symbol: \"||\" });\n\n\tvar aliases = {\n\t\taverage: \"avg\",\n\t\tiff: \"iff IF\",\n\t\tsubtract: \"minus\",\n\t\tmultiply: \"mult product\",\n\t\tdivide: \"div\",\n\t\tlt: \"lessThan smaller\",\n\t\tgt: \"moreThan greater greaterThan bigger\",\n\t\teq: \"equal equality\"\n\t};\n\n\tfor (name in aliases) {\n\t\taliases[name].split(/\\s+/g).forEach(function (alias) {\n\t\t\treturn _[alias] = _[name];\n\t\t});\n\t}\n\n\t// Make function names case insensitive\n\tMavo.Functions._Trap = self.Proxy ? new Proxy(_, {\n\t\tget: function get(functions, property) {\n\t\t\tif (property in functions) {\n\t\t\t\treturn functions[property];\n\t\t\t}\n\n\t\t\tvar propertyL = property.toLowerCase && property.toLowerCase();\n\n\t\t\tif (propertyL && functions.hasOwnProperty(propertyL)) {\n\t\t\t\treturn functions[propertyL];\n\t\t\t}\n\n\t\t\tif (property in Math || propertyL in Math) {\n\t\t\t\treturn Math[property] || Math[propertyL];\n\t\t\t}\n\n\t\t\tif (property in self) {\n\t\t\t\treturn self[property];\n\t\t\t}\n\n\t\t\t// Prevent undefined at all costs\n\t\t\treturn property;\n\t\t},\n\n\t\t// Super ugly hack, but otherwise data is not\n\t\t// the local variable it should be, but the string \"data\"\n\t\t// so all property lookups fail.\n\t\thas: function has(functions, property) {\n\t\t\treturn property != \"data\";\n\t\t}\n\t}) : Mavo.Functions;\n\n\t/**\n  * Private helper methods\n  */\n\tfunction numbers(array, args) {\n\t\tarray = Array.isArray(array) ? array : args ? $$(args) : [array];\n\n\t\treturn array.filter(function (number) {\n\t\t\treturn !isNaN(number);\n\t\t}).map(function (n) {\n\t\t\treturn +n;\n\t\t});\n\t}\n\n\t/**\n  * Extend a scalar operator to arrays, or arrays and scalars\n  * The operation between arrays is applied element-wise.\n  * The operation operation between a scalar and an array will result in\n  * the operation being applied between the scalar and every array element.\n  * @param op {Function} The operation between two scalars\n  * @param identity The operation’s identity element. Defaults to 0.\n  */\n\tfunction operator(name, op) {\n\t\tvar o = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n\t\tif (op.length < 2) {\n\t\t\t// Unary operator\n\t\t\treturn function (operand) {\n\t\t\t\treturn Array.isArray(operand) ? operand.map(op) : op(operand);\n\t\t\t};\n\t\t}\n\n\t\tif (o.symbol) {\n\t\t\t_.operators[o.symbol] = name;\n\t\t}\n\n\t\treturn _[name] = function () {\n\t\t\tfor (var _len3 = arguments.length, operands = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n\t\t\t\toperands[_key3] = arguments[_key3];\n\t\t\t}\n\n\t\t\tif (operands.length === 1) {\n\t\t\t\toperands = [].concat(_toConsumableArray(operands), [o.identity]);\n\t\t\t}\n\n\t\t\treturn operands.reduce(function (a, b) {\n\t\t\t\tif (Array.isArray(b)) {\n\t\t\t\t\tif (typeof o.identity == \"number\") {\n\t\t\t\t\t\tb = numbers(b);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Array.isArray(a)) {\n\t\t\t\t\t\treturn [].concat(_toConsumableArray(b.map(function (n, i) {\n\t\t\t\t\t\t\treturn op(a[i] === undefined ? o.identity : a[i], n);\n\t\t\t\t\t\t})), _toConsumableArray(a.slice(b.length)));\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn b.map(function (n) {\n\t\t\t\t\t\t\treturn op(a, n);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Operand is scalar\n\t\t\t\t\tif (typeof o.identity == \"number\") {\n\t\t\t\t\t\tb = +b;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Array.isArray(a)) {\n\t\t\t\t\t\treturn a.map(function (n) {\n\t\t\t\t\t\t\treturn op(n, b);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn op(a, b);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t}\n})();\n\n(function ($, $$) {\n\n\tvar _ = Mavo.Scope = $.Class({\n\t\textends: Mavo.Unit,\n\t\tconstructor: function constructor(element, mavo, o) {\n\t\t\tvar _this19 = this;\n\n\t\t\tthis.properties = {};\n\n\t\t\tthis.scope = this;\n\n\t\t\tMavo.hooks.run(\"scope-init-start\", this);\n\n\t\t\t// Should this element also create a primitive?\n\t\t\tif (Mavo.Primitive.getValueAttribute(this.element)) {\n\t\t\t\tvar obj = this.properties[this.property] = new Mavo.Primitive(this.element, this.mavo, { scope: this });\n\t\t\t}\n\n\t\t\t// Create Mavo objects for all properties in this scope (primitives or scopes),\n\t\t\t// but not properties in descendant scopes (they will be handled by their scope)\n\t\t\t$$(Mavo.selectors.property, this.element).forEach(function (element) {\n\t\t\t\tvar property = Mavo.Node.getProperty(element);\n\n\t\t\t\tif (_this19.contains(element)) {\n\t\t\t\t\tvar existing = _this19.properties[property];\n\t\t\t\t\tvar template = _this19.template ? _this19.template.properties[property] : null;\n\t\t\t\t\tvar constructorOptions = { template: template, scope: _this19 };\n\n\t\t\t\t\tif (existing) {\n\t\t\t\t\t\t// Two scopes with the same property, convert to static collection\n\t\t\t\t\t\tvar collection = existing;\n\n\t\t\t\t\t\tif (!(existing instanceof Mavo.Collection)) {\n\t\t\t\t\t\t\tcollection = new Mavo.Collection(existing.element, _this19.mavo, constructorOptions);\n\t\t\t\t\t\t\t_this19.properties[property] = existing.collection = collection;\n\t\t\t\t\t\t\tcollection.add(existing);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!collection.mutable && Mavo.is(\"multiple\", element)) {\n\t\t\t\t\t\t\tcollection.mutable = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcollection.add(element);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// No existing properties with this id, normal case\n\t\t\t\t\t\tvar obj = Mavo.Node.create(element, _this19.mavo, constructorOptions);\n\n\t\t\t\t\t\t_this19.properties[property] = obj;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!this.template) {\n\t\t\t\tArray.prototype.push.apply(this.mavo.propertyNames, this.propertyNames);\n\t\t\t}\n\n\t\t\tMavo.hooks.run(\"scope-init-end\", this);\n\t\t},\n\n\t\tget propertyNames() {\n\t\t\treturn Object.keys(this.properties);\n\t\t},\n\n\t\tgetData: function getData(o) {\n\t\t\to = o || {};\n\n\t\t\tvar ret = this.super.getData.call(this, o);\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tret = {};\n\n\t\t\tthis.propagate(function (obj) {\n\n\t\t\t\tif ((!obj.computed || o.computed) && !(obj.property in ret)) {\n\t\t\t\t\tvar data = obj.getData(o);\n\n\t\t\t\t\tif (data !== null || o.null) {\n\t\t\t\t\t\tret[obj.property] = data;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!o.dirty) {\n\t\t\t\t$.extend(ret, this.unhandled);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\t/**\n   * Search entire subtree for property, return relative value\n   * @return {Mavo.Unit}\n   */\n\t\tfind: function find(property) {\n\t\t\tif (this.property == property) {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tif (property in this.properties) {\n\t\t\t\treturn this.properties[property].find(property);\n\t\t\t}\n\n\t\t\tfor (var prop in this.properties) {\n\t\t\t\tvar ret = this.properties[prop].find(property);\n\n\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tpropagate: function propagate(callback) {\n\t\t\tvar _arguments = arguments;\n\n\t\t\t$.each(this.properties, function (property, obj) {\n\t\t\t\tobj.call.apply(obj, _arguments);\n\t\t\t});\n\t\t},\n\n\t\tsave: function save() {\n\t\t\tif (this.placeholder) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.unsavedChanges = false;\n\t\t},\n\n\t\tdone: function done() {\n\t\t\t$.unbind(this.element, \".mavo:edit\");\n\t\t},\n\n\t\tpropagated: [\"save\", \"done\", \"import\", \"clear\"],\n\n\t\t// Inject data in this element\n\t\trender: function render(data) {\n\t\t\tvar _this20 = this;\n\n\t\t\tif (!data) {\n\t\t\t\tthis.clear();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tMavo.hooks.run(\"scope-render-start\", this);\n\n\t\t\t// TODO retain dropped elements\n\t\t\tdata = data.isArray ? data[0] : data;\n\n\t\t\t// TODO what if it was a primitive and now it's a scope?\n\t\t\t// In that case, render the this.properties[this.property] with it\n\n\t\t\tthis.unhandled = $.extend({}, data, function (property) {\n\t\t\t\treturn !(property in _this20.properties);\n\t\t\t});\n\n\t\t\tthis.propagate(function (obj) {\n\t\t\t\tobj.render(data[obj.property]);\n\t\t\t});\n\n\t\t\tthis.save();\n\n\t\t\tMavo.hooks.run(\"scope-render-end\", this);\n\t\t},\n\n\t\t// Check if this scope contains a property\n\t\t// property can be either a Mavo.Unit or a Node\n\t\tcontains: function contains(property) {\n\t\t\tif (property instanceof Mavo.Unit) {\n\t\t\t\treturn property.parentScope === this;\n\t\t\t}\n\n\t\t\treturn property.parentNode && this.element === property.parentNode.closest(Mavo.selectors.scope);\n\t\t},\n\n\t\tstatic: {\n\t\t\tall: new WeakMap(),\n\n\t\t\tnormalize: function normalize(element) {\n\t\t\t\t// Get & normalize typeof name, if exists\n\t\t\t\tif (Mavo.is(\"scope\", element)) {\n\t\t\t\t\tvar type = element.getAttribute(\"typeof\") || element.getAttribute(\"itemtype\") || \"Item\";\n\n\t\t\t\t\telement.setAttribute(\"typeof\", type);\n\n\t\t\t\t\treturn type;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t});\n})(Bliss, Bliss.$);\n\n(function ($, $$) {\n\n\tvar _ = Mavo.Primitive = $.Class({\n\t\textends: Mavo.Unit,\n\t\tconstructor: function constructor(element, mavo, o) {\n\t\t\tvar _this21 = this;\n\n\t\t\tif (!this.fromTemplate([\"attribute\", \"datatype\", \"humanReadable\", \"computed\", \"templateValue\"])) {\n\t\t\t\t// Which attribute holds the data, if any?\n\t\t\t\t// \"null\" or null for none (i.e. data is in content).\n\t\t\t\tthis.attribute = _.getValueAttribute(this.element);\n\n\t\t\t\tif (this.attribute) {\n\t\t\t\t\tthis.humanReadable = this.attribute.humanReadable;\n\t\t\t\t} else {\n\t\t\t\t\tthis.element.normalize();\n\t\t\t\t}\n\n\t\t\t\tthis.datatype = _.getDatatype(this.element, this.attribute);\n\n\t\t\t\tthis.templateValue = this.getValue({ raw: true });\n\t\t\t}\n\n\t\t\t/**\n    * Set up input widget\n    */\n\n\t\t\t// Exposed widgets (visible always)\n\t\t\tif (Mavo.is(\"formControl\", this.element)) {\n\t\t\t\tthis.editor = this.element;\n\n\t\t\t\tthis.edit();\n\t\t\t}\n\t\t\t// Nested widgets\n\t\t\telse if (!this.editor) {\n\t\t\t\t\tthis.editor = $$(this.element.children).filter(function (el) {\n\t\t\t\t\t\treturn el.matches(Mavo.selectors.formControl) && !el.matches(Mavo.selectors.property);\n\t\t\t\t\t})[0];\n\n\t\t\t\t\t$.remove(this.editor);\n\t\t\t\t}\n\n\t\t\trequestAnimationFrame(function () {\n\t\t\t\tif (!_this21.exposed && !_this21.computed) {\n\t\t\t\t\t_this21.mavo.needsEdit = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.default = this.element.getAttribute(\"data-default\");\n\n\t\t\tif (this.computed || this.default === \"\") {\n\t\t\t\t// attribute exists, no value, default is template value\n\t\t\t\tthis.default = this.templateValue;\n\t\t\t} else if (this.default === null) {\n\t\t\t\t// attribute does not exist\n\t\t\t\tthis.default = this.editor ? this.editorValue : this.emptyValue;\n\t\t\t}\n\n\t\t\tif (!this.computed) {\n\t\t\t\tthis.value = this.templateValue; // no need to run setter code\n\t\t\t}\n\n\t\t\tif (this.collection) {\n\t\t\t\t// Collection of primitives, deal with setting textContent etc without the UI interfering.\n\t\t\t\tvar swapUI = function swapUI(callback) {\n\t\t\t\t\t_this21.unobserve();\n\t\t\t\t\tvar ui = $.remove($(Mavo.selectors.ui, _this21.element));\n\n\t\t\t\t\tvar ret = callback();\n\n\t\t\t\t\t$.inside(ui, _this21.element);\n\t\t\t\t\t_this21.observe();\n\n\t\t\t\t\treturn ret;\n\t\t\t\t};\n\n\t\t\t\t// Intercept certain properties so that any Mavo UI inside this primitive will not be destroyed\n\t\t\t\t[\"textContent\", \"innerHTML\"].forEach(function (property) {\n\t\t\t\t\tvar descriptor = Object.getOwnPropertyDescriptor(Node.prototype, property);\n\n\t\t\t\t\tObject.defineProperty(_this21.element, property, {\n\t\t\t\t\t\tget: function get() {\n\t\t\t\t\t\t\tvar _this22 = this;\n\n\t\t\t\t\t\t\treturn swapUI(function () {\n\t\t\t\t\t\t\t\treturn descriptor.get.call(_this22);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\tset: function set(value) {\n\t\t\t\t\t\t\tvar _this23 = this;\n\n\t\t\t\t\t\t\tswapUI(function () {\n\t\t\t\t\t\t\t\treturn descriptor.set.call(_this23, value);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.value = this.template ? this.default : this.getValue({ raw: true });\n\n\t\t\t// Observe future mutations to this property, if possible\n\t\t\t// Properties like input.checked or input.value cannot be observed that way\n\t\t\t// so we cannot depend on mutation observers for everything :(\n\t\t\tthis.observe();\n\t\t},\n\n\t\tget editorValue() {\n\t\t\tif (this.editor) {\n\t\t\t\tif (this.editor.matches(Mavo.selectors.formControl)) {\n\t\t\t\t\treturn _.getValue(this.editor, undefined, this.datatype);\n\t\t\t\t}\n\n\t\t\t\t// if we're here, this.editor is an entire HTML structure\n\t\t\t\tvar output = $(Mavo.selectors.output + \", \" + Mavo.selectors.formControl, this.editor);\n\n\t\t\t\tif (output) {\n\t\t\t\t\treturn _.all.has(output) ? _.all.get(output).value : _.getValue(output);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tset editorValue(value) {\n\t\t\tif (this.editor) {\n\t\t\t\tif (this.editor.matches(Mavo.selectors.formControl)) {\n\t\t\t\t\t_.setValue(this.editor, value);\n\t\t\t\t} else {\n\t\t\t\t\t// if we're here, this.editor is an entire HTML structure\n\t\t\t\t\tvar output = $(Mavo.selectors.output + \", \" + Mavo.selectors.formControl, this.editor);\n\n\t\t\t\t\tif (output) {\n\t\t\t\t\t\tif (_.all.has(output)) {\n\t\t\t\t\t\t\t_.all.get(output).value = value;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_.setValue(output, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tget exposed() {\n\t\t\treturn this.editor === this.element;\n\t\t},\n\n\t\tgetData: function getData(o) {\n\t\t\to = o || {};\n\n\t\t\tvar ret = this.super.getData.call(this, o);\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tvar ret = !o.dirty && !this.exposed ? this.savedValue : this.value;\n\n\t\t\tif (!o.dirty && ret === \"\") {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tsave: function save() {\n\t\t\tif (this.placeholder) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.savedValue = this.value;\n\t\t\tthis.unsavedChanges = false;\n\t\t},\n\n\t\tdone: function done() {\n\t\t\tthis.unobserve();\n\n\t\t\tif (this.popup) {\n\t\t\t\tthis.hidePopup();\n\t\t\t} else if (!this.attribute && !this.exposed && this.editing) {\n\t\t\t\t$.remove(this.editor);\n\t\t\t\tthis.element.textContent = this.editorValue;\n\t\t\t}\n\n\t\t\tif (!this.exposed) {\n\t\t\t\tthis.editing = false;\n\t\t\t}\n\n\t\t\t// Revert tabIndex\n\t\t\tif (this.element._.data.prevTabindex !== null) {\n\t\t\t\tthis.element.tabIndex = this.element._.data.prevTabindex;\n\t\t\t} else {\n\t\t\t\tthis.element.removeAttribute(\"tabindex\");\n\t\t\t}\n\n\t\t\tthis.element._.unbind(\".mavo:edit .mavo:preedit .mavo:showpopup\");\n\n\t\t\tthis.observe();\n\t\t},\n\n\t\trevert: function revert() {\n\t\t\tif (this.unsavedChanges && this.savedValue !== undefined) {\n\t\t\t\t// FIXME if we have a collection of properties (not scopes), this will cause\n\t\t\t\t// cancel to not remove new unsaved items\n\t\t\t\t// This should be fixed by handling this on the collection level.\n\t\t\t\tthis.value = this.savedValue;\n\t\t\t\tthis.unsavedChanges = false;\n\t\t\t}\n\t\t},\n\n\t\t// Prepare to be edited\n\t\t// Called when root edit button is pressed\n\t\tpreEdit: function preEdit() {\n\t\t\tvar _this24 = this;\n\n\t\t\tif (this.computed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Empty properties should become editable immediately\n\t\t\t// otherwise they could be invisible!\n\t\t\tif (this.empty && !this.attribute) {\n\t\t\t\tthis.edit();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar timer;\n\n\t\t\tthis.element._.events({\n\t\t\t\t// click is needed too because it works with the keyboard as well\n\t\t\t\t\"click.mavo:preedit\": function clickMavoPreedit(e) {\n\t\t\t\t\treturn _this24.edit();\n\t\t\t\t},\n\t\t\t\t\"focus.mavo:preedit\": function focusMavoPreedit(e) {\n\t\t\t\t\t_this24.edit();\n\n\t\t\t\t\tif (!_this24.popup) {\n\t\t\t\t\t\t_this24.editor.focus();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"click.mavo:edit\": function clickMavoEdit(evt) {\n\t\t\t\t\t// Prevent default actions while editing\n\t\t\t\t\t// e.g. following links etc\n\t\t\t\t\tif (!_this24.exposed) {\n\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!this.attribute) {\n\t\t\t\tthis.element._.events({\n\t\t\t\t\t\"mouseenter.mavo:preedit\": function mouseenterMavoPreedit(e) {\n\t\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\t\ttimer = setTimeout(function () {\n\t\t\t\t\t\t\treturn _this24.edit();\n\t\t\t\t\t\t}, 150);\n\t\t\t\t\t},\n\t\t\t\t\t\"mouseleave.mavo:preedit\": function mouseleaveMavoPreedit(e) {\n\t\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Make element focusable, so it can actually receive focus\n\t\t\tthis.element._.data.prevTabindex = this.element.getAttribute(\"tabindex\");\n\t\t\tthis.element.tabIndex = 0;\n\t\t},\n\n\t\t// Called only the first time this primitive is edited\n\t\tinitEdit: function initEdit() {\n\t\t\tvar _this25 = this;\n\n\t\t\t// Linked widgets\n\t\t\tif (this.element.hasAttribute(\"data-input\")) {\n\t\t\t\tvar selector = this.element.getAttribute(\"data-input\");\n\n\t\t\t\tif (selector) {\n\t\t\t\t\tthis.editor = $.clone($(selector));\n\n\t\t\t\t\tif (!Mavo.is(\"formControl\", this.editor)) {\n\t\t\t\t\t\tif ($(Mavo.selectors.output, this.editor)) {\n\t\t\t\t\t\t\t// has output element?\n\t\t\t\t\t\t\t// Process it as a mavo instance, so people can use references\n\t\t\t\t\t\t\tthis.editor.setAttribute(\"data-store\", \"none\");\n\t\t\t\t\t\t\tnew Mavo(this.editor);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.editor = null; // Cannot use this, sorry bro\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.editor) {\n\t\t\t\t// No editor provided, use default for element type\n\t\t\t\t// Find default editor for datatype\n\t\t\t\tvar editor = _.getMatch(this.element, _.editors);\n\n\t\t\t\tif (editor.create) {\n\t\t\t\t\t$.extend(this, editor, function (property) {\n\t\t\t\t\t\treturn property != \"create\";\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tvar create = editor.create || editor;\n\t\t\t\tthis.editor = $.create($.type(create) === \"function\" ? create.call(this) : create);\n\t\t\t\tthis.editorValue = this.value;\n\t\t\t}\n\n\t\t\tthis.editor._.events({\n\t\t\t\t\"input change\": function inputChange(evt) {\n\t\t\t\t\tvar unsavedChanges = _this25.mavo.unsavedChanges;\n\n\t\t\t\t\t_this25.value = _this25.editorValue;\n\n\t\t\t\t\t// Editing exposed elements outside edit mode is instantly saved\n\t\t\t\t\tif (_this25.exposed && !_this25.mavo.editing && // must not be in edit mode\n\t\t\t\t\t_this25.mavo.permissions.save // must be able to save\n\t\t\t\t\t) {\n\t\t\t\t\t\t\t// TODO what if change event never fires? What if user\n\t\t\t\t\t\t\t_this25.unsavedChanges = false;\n\t\t\t\t\t\t\t_this25.mavo.unsavedChanges = unsavedChanges;\n\n\t\t\t\t\t\t\t// Must not save too many times (e.g. not while dragging a slider)\n\t\t\t\t\t\t\tif (evt.type == \"change\") {\n\t\t\t\t\t\t\t\t_this25.save(); // Save current element\n\n\t\t\t\t\t\t\t\t// Don’t call this.mavo.save() as it will save other fields too\n\t\t\t\t\t\t\t\t// We only want to save exposed controls, so save current status\n\t\t\t\t\t\t\t\t_this25.mavo.storage.save();\n\n\t\t\t\t\t\t\t\t// Are there any unsaved changes from other properties?\n\t\t\t\t\t\t\t\t_this25.mavo.unsavedChanges = _this25.mavo.calculateUnsavedChanges();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"focus\": function focus(evt) {\n\t\t\t\t\t_this25.editor.select && _this25.editor.select();\n\t\t\t\t},\n\t\t\t\t\"keyup\": function keyup(evt) {\n\t\t\t\t\tif (_this25.popup && evt.keyCode == 13 || evt.keyCode == 27) {\n\t\t\t\t\t\tif (_this25.popup.contains(document.activeElement)) {\n\t\t\t\t\t\t\t_this25.element.focus();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\t\t_this25.hidePopup();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"mavo:datachange\": function mavoDatachange(evt) {\n\t\t\t\t\tif (evt.property === \"output\") {\n\t\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\t\t$.fire(_this25.editor, \"input\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (\"placeholder\" in this.editor) {\n\t\t\t\tthis.editor.placeholder = \"(\" + this.label + \")\";\n\t\t\t}\n\n\t\t\tif (!this.exposed) {\n\t\t\t\t// Copy any data-input-* attributes from the element to the editor\n\t\t\t\tvar dataInput = /^data-input-/i;\n\t\t\t\t$$(this.element.attributes).forEach(function (attribute) {\n\t\t\t\t\tif (dataInput.test(attribute.name)) {\n\t\t\t\t\t\tthis.editor.setAttribute(attribute.name.replace(dataInput, \"\"), attribute.value);\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\n\t\t\t\tif (this.attribute) {\n\t\t\t\t\t// Set up popup\n\t\t\t\t\tthis.element.classList.add(\"using-popup\");\n\n\t\t\t\t\tthis.popup = this.popup || $.create(\"div\", {\n\t\t\t\t\t\tclassName: \"mv-popup\",\n\t\t\t\t\t\thidden: true,\n\t\t\t\t\t\tcontents: [this.label + \":\", this.editor]\n\t\t\t\t\t});\n\n\t\t\t\t\t// No point in having a dropdown in a popup\n\t\t\t\t\tif (this.editor.matches(\"select\")) {\n\t\t\t\t\t\tthis.editor.size = Math.min(10, this.editor.children.length);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Toggle popup events & methods\n\t\t\t\t\tvar hideCallback = function hideCallback(evt) {\n\t\t\t\t\t\tif (!_this25.popup.contains(evt.target) && !_this25.element.contains(evt.target)) {\n\t\t\t\t\t\t\t_this25.hidePopup();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.showPopup = function () {\n\t\t\t\t\t\t$.unbind([this.element, this.popup], \".mavo:showpopup\");\n\t\t\t\t\t\tthis.popup._.after(this.element);\n\n\t\t\t\t\t\tvar x = this.element.offsetLeft;\n\t\t\t\t\t\tvar y = this.element.offsetTop + this.element.offsetHeight;\n\n\t\t\t\t\t\t// TODO what if it doesn’t fit?\n\t\t\t\t\t\tthis.popup._.style({ top: y + \"px\", left: x + \"px\" });\n\n\t\t\t\t\t\tthis.popup._.removeAttribute(\"hidden\"); // trigger transition\n\n\t\t\t\t\t\t$.events(document, \"focus click\", hideCallback, true);\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.hidePopup = function () {\n\t\t\t\t\t\tvar _this26 = this;\n\n\t\t\t\t\t\t$.unbind(document, \"focus click\", hideCallback, true);\n\n\t\t\t\t\t\tthis.popup.setAttribute(\"hidden\", \"\"); // trigger transition\n\n\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t$.remove(_this26.popup);\n\t\t\t\t\t\t}, 400); // TODO transition-duration could override this\n\n\t\t\t\t\t\t$.events(this.element, \"focus.mavo:showpopup click.mavo:showpopup\", function (evt) {\n\t\t\t\t\t\t\t_this26.showPopup();\n\t\t\t\t\t\t}, true);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.popup) {\n\t\t\t\tthis.editor.classList.add(\"mv-editor\");\n\t\t\t}\n\n\t\t\tthis.initEdit = null;\n\t\t},\n\n\t\tedit: function edit() {\n\t\t\tif (this.computed || this.editing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.element._.unbind(\".mavo:preedit\");\n\n\t\t\tif (this.initEdit) {\n\t\t\t\tthis.initEdit();\n\t\t\t}\n\n\t\t\tif (this.popup) {\n\t\t\t\tthis.showPopup();\n\t\t\t}\n\n\t\t\tif (!this.attribute) {\n\t\t\t\tif (this.editor.parentNode != this.element && !this.exposed) {\n\t\t\t\t\tthis.editorValue = this.value;\n\t\t\t\t\tthis.element.textContent = \"\";\n\n\t\t\t\t\tif (!this.exposed) {\n\t\t\t\t\t\tthis.element.appendChild(this.editor);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.editing = true;\n\t\t}, // edit\n\n\t\tclear: function clear() {\n\t\t\tthis.value = this.emptyValue;\n\t\t},\n\n\t\trender: function render(data) {\n\t\t\tif (Array.isArray(data)) {\n\t\t\t\tdata = data[0]; // TODO what is gonna happen to the rest? Lost?\n\t\t\t}\n\n\t\t\tif ((typeof data === \"undefined\" ? \"undefined\" : _typeof(data)) === \"object\") {\n\t\t\t\tdata = data[this.property];\n\t\t\t}\n\n\t\t\tthis.value = data === undefined ? this.default : data;\n\n\t\t\tthis.save();\n\t\t},\n\n\t\tfind: function find(property) {\n\t\t\tif (this.property == property) {\n\t\t\t\treturn this;\n\t\t\t}\n\t\t},\n\n\t\tobserve: function observe() {\n\t\t\tvar _this27 = this;\n\n\t\t\tif (!this.computed) {\n\t\t\t\tthis.observer = Mavo.observe(this.element, this.attribute, this.observer || function (record) {\n\t\t\t\t\tif (_this27.attribute || !_this27.mavo.editing) {\n\t\t\t\t\t\t_this27.value = _this27.getValue();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tunobserve: function unobserve() {\n\t\t\tthis.observer && this.observer.disconnect();\n\t\t},\n\n\t\t/**\n   * Get value from the DOM\n   */\n\t\tgetValue: function getValue(o) {\n\t\t\treturn _.getValue(this.element, this.attribute, this.datatype, o);\n\t\t},\n\n\t\tlazy: {\n\t\t\tlabel: function label() {\n\t\t\t\treturn Mavo.readable(this.property);\n\t\t\t},\n\n\t\t\temptyValue: function emptyValue() {\n\t\t\t\tswitch (this.datatype) {\n\t\t\t\t\tcase \"boolean\":\n\t\t\t\t\t\treturn false;\n\t\t\t\t\tcase \"number\":\n\t\t\t\t\t\treturn 0;\n\t\t\t\t}\n\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t},\n\n\t\tlive: {\n\t\t\tvalue: function value(_value) {\n\t\t\t\tvar _this28 = this;\n\n\t\t\t\tthis.unobserve();\n\n\t\t\t\tif ($.type(_value) == \"object\" && \"value\" in _value) {\n\t\t\t\t\tvar presentational = _value.presentational;\n\t\t\t\t\t_value = _value.value;\n\t\t\t\t}\n\n\t\t\t\t_value = _value || _value === 0 ? _value : \"\";\n\t\t\t\t_value = _.safeCast(_value, this.datatype);\n\n\t\t\t\tif (_value == this._value) {\n\t\t\t\t\treturn _value;\n\t\t\t\t}\n\n\t\t\t\tif (this.editor) {\n\t\t\t\t\tthis.editorValue = _value;\n\t\t\t\t}\n\n\t\t\t\tif (this.humanReadable && this.attribute) {\n\t\t\t\t\tpresentational = this.humanReadable(_value);\n\t\t\t\t}\n\n\t\t\t\tif (!this.editing || this.attribute) {\n\t\t\t\t\tif (this.editor && this.editor.matches(\"select\") && this.editor.selectedOptions[0]) {\n\t\t\t\t\t\tpresentational = this.editor.selectedOptions[0].textContent;\n\t\t\t\t\t}\n\n\t\t\t\t\t_.setValue(this.element, { value: _value, presentational: presentational }, this.attribute, this.datatype);\n\t\t\t\t}\n\n\t\t\t\tthis.empty = _value === \"\";\n\n\t\t\t\tthis._value = _value;\n\n\t\t\t\tif (!this.computed) {\n\t\t\t\t\tthis.unsavedChanges = this.mavo.unsavedChanges = true;\n\t\t\t\t}\n\n\t\t\t\trequestAnimationFrame(function () {\n\t\t\t\t\t$.fire(_this28.element, \"mavo:datachange\", {\n\t\t\t\t\t\tproperty: _this28.property,\n\t\t\t\t\t\tvalue: _value,\n\t\t\t\t\t\tmavo: _this28.mavo,\n\t\t\t\t\t\tnode: _this28,\n\t\t\t\t\t\tdirty: _this28.editing,\n\t\t\t\t\t\taction: \"propertychange\"\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthis.observe();\n\n\t\t\t\treturn _value;\n\t\t\t},\n\n\t\t\tempty: function empty(value) {\n\t\t\t\tvar hide = value && !this.exposed && !(this.attribute && $(Mavo.selectors.property, this.element));\n\t\t\t\tthis.element.classList.toggle(\"empty\", hide);\n\t\t\t},\n\n\t\t\tediting: function editing(value) {\n\t\t\t\tthis.element.classList.toggle(\"editing\", value);\n\t\t\t},\n\n\t\t\tcomputed: function computed(value) {\n\t\t\t\tthis.element.classList.toggle(\"computed\", value);\n\t\t\t}\n\t\t},\n\n\t\tstatic: {\n\t\t\tall: new WeakMap(),\n\n\t\t\tgetMatch: function getMatch(element, all) {\n\t\t\t\t// TODO specificity\n\t\t\t\tvar ret = null;\n\n\t\t\t\tfor (var selector in all) {\n\t\t\t\t\tif (element.matches(selector)) {\n\t\t\t\t\t\tret = all[selector];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\tgetValueAttribute: function getValueAttribute(element) {\n\t\t\t\tvar ret = element.getAttribute(\"data-attribute\") || _.getMatch(element, _.attributes);\n\n\t\t\t\t// TODO refactor this\n\t\t\t\tif (ret && ret.value) {\n\t\t\t\t\tret = $.extend(new String(ret.value), ret);\n\t\t\t\t}\n\n\t\t\t\tif (!ret || ret === \"null\") {\n\t\t\t\t\tret = null;\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\tgetDatatype: function getDatatype(element, attribute) {\n\t\t\t\tvar ret = element.getAttribute(\"datatype\");\n\n\t\t\t\tif (!ret) {\n\t\t\t\t\tfor (var selector in _.datatypes) {\n\t\t\t\t\t\tif (element.matches(selector)) {\n\t\t\t\t\t\t\tret = _.datatypes[selector][attribute];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tret = ret || \"string\";\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\t/**\n    * Only cast if conversion is lossless\n    */\n\t\t\tsafeCast: function safeCast(value, datatype) {\n\t\t\t\tvar existingType = typeof value === \"undefined\" ? \"undefined\" : _typeof(value);\n\t\t\t\tvar cast = _.cast(value, datatype);\n\n\t\t\t\tif (value === null || value === undefined) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\n\t\t\t\tif (datatype == \"boolean\") {\n\t\t\t\t\tif (value === \"false\" || value === 0 || value === \"\") {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (value === \"true\" || value > 0) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\n\t\t\t\tif (datatype == \"number\") {\n\t\t\t\t\tif (/^[-+]?[0-9.e]+$/i.test(value + \"\")) {\n\t\t\t\t\t\treturn cast;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\n\t\t\t\treturn cast;\n\t\t\t},\n\n\t\t\t/**\n    * Cast to a different primitive datatype\n    */\n\t\t\tcast: function cast(value, datatype) {\n\t\t\t\tswitch (datatype) {\n\t\t\t\t\tcase \"number\":\n\t\t\t\t\t\treturn +value;\n\t\t\t\t\tcase \"boolean\":\n\t\t\t\t\t\treturn !!value;\n\t\t\t\t\tcase \"string\":\n\t\t\t\t\t\treturn value + \"\";\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t},\n\n\t\t\tgetValue: function getValue(element, attribute, datatype) {\n\t\t\t\tvar o = arguments.length <= 3 || arguments[3] === undefined ? {} : arguments[3];\n\n\t\t\t\tattribute = attribute || attribute === null ? attribute : _.getValueAttribute(element);\n\t\t\t\tdatatype = datatype || _.getDatatype(element, attribute);\n\n\t\t\t\tvar ret;\n\n\t\t\t\t// TODO Get rid of this horrible raw hack\n\t\t\t\tif (attribute in element && !o.raw && _.useProperty(element, attribute)) {\n\t\t\t\t\t// Returning properties (if they exist) instead of attributes\n\t\t\t\t\t// is needed for dynamic elements such as checkboxes, sliders etc\n\t\t\t\t\tret = element[attribute];\n\t\t\t\t} else if (attribute) {\n\t\t\t\t\tret = element.getAttribute(attribute);\n\t\t\t\t} else {\n\t\t\t\t\tret = element.getAttribute(\"content\") || element.textContent || null;\n\t\t\t\t}\n\n\t\t\t\treturn _.safeCast(ret, datatype);\n\t\t\t},\n\n\t\t\tsetValue: function setValue(element, value, attribute, datatype) {\n\t\t\t\tif ($.type(value) == \"object\" && \"value\" in value) {\n\t\t\t\t\tvar presentational = value.presentational;\n\t\t\t\t\tvalue = value.value;\n\t\t\t\t}\n\n\t\t\t\tif (attribute !== null) {\n\t\t\t\t\tattribute = attribute || _.getValueAttribute(element);\n\t\t\t\t}\n\n\t\t\t\tif (attribute in element && _.useProperty(element, attribute) && element[attribute] != value) {\n\t\t\t\t\t// Setting properties (if they exist) instead of attributes\n\t\t\t\t\t// is needed for dynamic elements such as checkboxes, sliders etc\n\t\t\t\t\ttry {\n\t\t\t\t\t\telement[attribute] = value;\n\t\t\t\t\t} catch (e) {}\n\t\t\t\t}\n\n\t\t\t\t// Set attribute anyway, even if we set a property because when\n\t\t\t\t// they're not in sync it gets really fucking confusing.\n\t\t\t\tif (attribute) {\n\t\t\t\t\tif (element.getAttribute(attribute) != value) {\n\t\t\t\t\t\t// intentionally non-strict, e.g. \"3.\" !== 3\n\t\t\t\t\t\telement.setAttribute(attribute, value);\n\n\t\t\t\t\t\tif (presentational) {\n\t\t\t\t\t\t\telement.textContent = presentational;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (datatype === \"number\" && !presentational) {\n\t\t\t\t\t\tpresentational = _.formatNumber(value);\n\t\t\t\t\t}\n\n\t\t\t\t\telement.textContent = presentational || value;\n\n\t\t\t\t\tif (presentational && element.setAttribute) {\n\t\t\t\t\t\telement.setAttribute(\"content\", value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    *  Set/get a property or an attribute?\n    * @return {Boolean} true to use a property, false to use the attribute\n    */\n\t\t\tuseProperty: function useProperty(element, attribute) {\n\t\t\t\tif ([\"href\", \"src\"].indexOf(attribute) > -1) {\n\t\t\t\t\t// URL properties resolve \"\" as location.href, fucking up emptiness checks\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (element.namespaceURI == \"http://www.w3.org/2000/svg\") {\n\t\t\t\t\t// SVG has a fucked up DOM, do not use these properties\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\n\t\t\tlazy: {\n\t\t\t\tformatNumber: function formatNumber() {\n\t\t\t\t\tvar numberFormat = new Intl.NumberFormat(\"en-US\", { maximumFractionDigits: 2 });\n\n\t\t\t\t\treturn function (value) {\n\t\t\t\t\t\tif (value === Infinity || value === -Infinity) {\n\t\t\t\t\t\t\t// Pretty print infinity\n\t\t\t\t\t\t\treturn value < 0 ? \"-∞\" : \"∞\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn numberFormat.format(value);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\t// Define default attributes\n\t_.attributes = {\n\t\t\"img, video, audio\": \"src\",\n\t\t\"a, link\": \"href\",\n\t\t\"select, input, textarea, meter, progress\": \"value\",\n\t\t\"input[type=checkbox]\": \"checked\",\n\t\t\"time\": {\n\t\t\tvalue: \"datetime\",\n\t\t\thumanReadable: function humanReadable(value) {\n\t\t\t\tvar date = new Date(value);\n\n\t\t\t\tif (!value || isNaN(date)) {\n\t\t\t\t\treturn \"(No \" + this.label + \")\";\n\t\t\t\t}\n\n\t\t\t\t// TODO do this properly (account for other datetime datatypes and different formats)\n\t\t\t\tvar options = {\n\t\t\t\t\t\"date\": { day: \"numeric\", month: \"short\", year: \"numeric\" },\n\t\t\t\t\t\"month\": { month: \"long\" },\n\t\t\t\t\t\"time\": { hour: \"numeric\", minute: \"numeric\" },\n\t\t\t\t\t\"datetime-local\": { day: \"numeric\", month: \"short\", year: \"numeric\", hour: \"numeric\", minute: \"numeric\" }\n\t\t\t\t};\n\n\t\t\t\tvar format = options[this.editor && this.editor.type] || options.date;\n\t\t\t\tformat.timeZone = \"UTC\";\n\n\t\t\t\treturn date.toLocaleString(\"en-GB\", format);\n\t\t\t}\n\t\t},\n\t\t\"meta\": \"content\"\n\t};\n\n\t// Basic datatypes per attribute\n\t// Only number, boolean\n\t_.datatypes = {\n\t\t\"input[type=checkbox]\": {\n\t\t\t\"checked\": \"boolean\"\n\t\t},\n\t\t\"input[type=range], input[type=number], meter, progress\": {\n\t\t\t\"value\": \"number\"\n\t\t}\n\t};\n\n\t_.editors = {\n\t\t\"*\": { \"tag\": \"input\" },\n\n\t\t\".number\": {\n\t\t\t\"tag\": \"input\",\n\t\t\t\"type\": \"number\"\n\t\t},\n\n\t\t\".boolean\": {\n\t\t\t\"tag\": \"input\",\n\t\t\t\"type\": \"checkbox\"\n\t\t},\n\n\t\t\"a, img, video, audio, .url\": {\n\t\t\t\"tag\": \"input\",\n\t\t\t\"type\": \"url\",\n\t\t\t\"placeholder\": \"http://\"\n\t\t},\n\n\t\t// Block elements\n\t\t\"p, div, li, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address, .multiline\": {\n\t\t\tcreate: function create() {\n\t\t\t\tvar display = getComputedStyle(this.element).display;\n\t\t\t\tvar tag = display.indexOf(\"inline\") === 0 ? \"input\" : \"textarea\";\n\t\t\t\tvar editor = $.create(tag);\n\n\t\t\t\tif (tag == \"textarea\") {\n\t\t\t\t\tvar width = this.element.offsetWidth;\n\n\t\t\t\t\tif (width) {\n\t\t\t\t\t\teditor.width = width;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn editor;\n\t\t\t},\n\n\t\t\tget editorValue() {\n\t\t\t\treturn this.editor && _.safeCast(this.editor.value, this.datatype);\n\t\t\t},\n\n\t\t\tset editorValue(value) {\n\t\t\t\tif (this.editor) {\n\t\t\t\t\tthis.editor.value = value ? value.replace(/\\r?\\n/g, \"\") : \"\";\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"meter, progress\": function meterProgress() {\n\t\t\treturn $.create({\n\t\t\t\ttag: \"input\",\n\t\t\t\ttype: \"range\",\n\t\t\t\tmin: this.element.getAttribute(\"min\") || 0,\n\t\t\t\tmax: this.element.getAttribute(\"max\") || 100\n\t\t\t});\n\t\t},\n\n\t\t\"time, .date\": function timeDate() {\n\t\t\tvar types = {\n\t\t\t\t\"date\": /^[Y\\d]{4}-[M\\d]{2}-[D\\d]{2}$/i,\n\t\t\t\t\"month\": /^[Y\\d]{4}-[M\\d]{2}$/i,\n\t\t\t\t\"time\": /^[H\\d]{2}:[M\\d]{2}/i,\n\t\t\t\t\"week\": /[Y\\d]{4}-W[W\\d]{2}$/i,\n\t\t\t\t\"datetime-local\": /^[Y\\d]{4}-[M\\d]{2}-[D\\d]{2} [H\\d]{2}:[M\\d]{2}/i\n\t\t\t};\n\n\t\t\tvar datetime = this.element.getAttribute(\"datetime\") || \"YYYY-MM-DD\";\n\n\t\t\tfor (var type in types) {\n\t\t\t\tif (types[type].test(datetime)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn $.create(\"input\", { type: type });\n\t\t}\n\t};\n})(Bliss, Bliss.$);\n\n// Image upload widget via imgur\nMavo.Primitive.editors.img = {\n\tcreate: function create() {\n\t\tvar root = $.create(\"div\", {\n\t\t\tclassName: \"image-popup\",\n\t\t\tevents: {\n\t\t\t\t\"dragenter dragover drop\": function dragenterDragoverDrop(evt) {\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t},\n\n\t\t\t\tdrop: function drop(evt) {\n\t\t\t\t\tvar file = $.value(evt.dataTransfer, \"files\", 0);\n\n\t\t\t\t\t// Do upload stuff\n\t\t\t\t}\n\t\t\t},\n\t\t\tcontents: [{\n\t\t\t\ttag: \"input\",\n\t\t\t\ttype: \"url\",\n\t\t\t\tclassName: \"value\"\n\t\t\t}, {\n\t\t\t\ttag: \"label\",\n\t\t\t\tclassName: \"upload\",\n\t\t\t\tcontents: [\"Upload: \", {\n\t\t\t\t\ttag: \"input\",\n\t\t\t\t\ttype: \"file\",\n\t\t\t\t\taccept: \"image/*\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tchange: function change(evt) {\n\t\t\t\t\t\t\tvar file = this.files[0];\n\n\t\t\t\t\t\t\tif (!file) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Show image locally\n\t\t\t\t\t\t\t$(\"img\", root).file = file;\n\n\t\t\t\t\t\t\t// Upload\n\n\t\t\t\t\t\t\t// Once uploaded, share and get public URL\n\n\t\t\t\t\t\t\t// Set public URL as the value of the URL input\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}, {\n\t\t\t\tclassName: \"image-preview\",\n\t\t\t\tcontents: [{\n\t\t\t\t\ttag: \"progress\",\n\t\t\t\t\tvalue: \"0\",\n\t\t\t\t\tmax: \"100\"\n\t\t\t\t}, {\n\t\t\t\t\ttag: \"img\"\n\t\t\t\t}]\n\t\t\t}, {\n\t\t\t\tclassName: \"tip\",\n\t\t\t\tinnerHTML: \"<strong>Tip:</strong> You can also drag & drop or paste the image to be uploaded!\"\n\t\t\t}] });\n\n\t\treturn root;\n\t}\n};\n\n(function ($, $$) {\n\n\tvar _ = Mavo.Collection = $.Class({\n\t\textends: Mavo.Node,\n\t\tconstructor: function constructor(element, mavo, o) {\n\t\t\t/*\n    * Create the template, remove it from the DOM and store it\n    */\n\t\t\tthis.templateElement = this.element;\n\n\t\t\tthis.items = [];\n\n\t\t\t// ALL descendant property names as an array\n\t\t\tif (!this.fromTemplate([\"properties\", \"mutable\", \"templateElement\"])) {\n\t\t\t\tif (this.templateElement.matches(\"template\")) {\n\t\t\t\t\tvar div = document.createElement(this.templateElement.getAttribute(\"data-tag\") || \"mv-group\");\n\t\t\t\t\tdiv.classList.add(\"document-fragment\");\n\n\t\t\t\t\t$$(this.templateElement.attributes).forEach(function (attr) {\n\t\t\t\t\t\tdiv.setAttribute(attr.name, attr.value);\n\t\t\t\t\t});\n\n\t\t\t\t\tdiv.appendChild(document.importNode(this.templateElement.content, true));\n\t\t\t\t\tthis.templateElement.parentNode.replaceChild(div, this.templateElement);\n\t\t\t\t\tthis.element = this.templateElement = div;\n\t\t\t\t}\n\n\t\t\t\tthis.properties = $$(Mavo.selectors.property, this.templateElement).map(Mavo.Node.getProperty);\n\t\t\t\tthis.mutable = this.templateElement.matches(Mavo.selectors.multiple);\n\n\t\t\t\t// Must clone because otherwise once expressions are parsed on the template element\n\t\t\t\t// we will not be able to pick them up from subsequent items\n\t\t\t\tthis.templateElement = this.templateElement.cloneNode(true);\n\t\t\t}\n\n\t\t\tif (this.mutable) {\n\t\t\t\tvar item = this.createItem(this.element);\n\t\t\t\tthis.add(item);\n\t\t\t\tthis.itemTemplate = item.template || item;\n\t\t\t}\n\n\t\t\tMavo.hooks.run(\"collection-init-end\", this);\n\t\t},\n\n\t\tget length() {\n\t\t\treturn this.items.length;\n\t\t},\n\n\t\t// Collection still contains its template as data\n\t\tget containsTemplate() {\n\t\t\treturn this.items.length && this.items[0].element === this.element;\n\t\t},\n\n\t\tgetData: function getData(o) {\n\t\t\to = o || {};\n\n\t\t\tvar data = [];\n\n\t\t\tthis.items.forEach(function (item) {\n\t\t\t\tif (!item.deleted) {\n\t\t\t\t\tvar itemData = item.getData(o);\n\n\t\t\t\t\tif (itemData) {\n\t\t\t\t\t\tdata.push(itemData);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!o.dirty && this.unhandled) {\n\t\t\t\tdata = this.unhandled.before.concat(data, this.unhandled.after);\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\n\t\t// Create item but don't insert it anywhere\n\t\t// Mostly used internally\n\t\tcreateItem: function createItem(element) {\n\t\t\tvar _this29 = this;\n\n\t\t\tif (!element) {\n\t\t\t\telement = this.templateElement.cloneNode(true);\n\t\t\t}\n\n\t\t\tvar item = Mavo.Unit.create(element, this.mavo, {\n\t\t\t\tcollection: this,\n\t\t\t\ttemplate: this.itemTemplate || (this.template ? this.template.itemTemplate : null),\n\t\t\t\tproperty: this.property,\n\t\t\t\ttype: this.type,\n\t\t\t\tdirty: true\n\t\t\t});\n\n\t\t\t// If container is a fake \"fragment\", strip element naked\n\t\t\tif (Mavo.is(\"documentFragment\", item.element)) {\n\t\t\t\titem.element = new Mavo.Fragment(item.element);\n\t\t\t}\n\t\t\t// Add delete & add buttons\n\t\t\telse if (this.mutable) {\n\t\t\t\t\t$.create({\n\t\t\t\t\t\tclassName: \"mv-item-controls mv-ui\",\n\t\t\t\t\t\tcontents: [{\n\t\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\t\ttitle: \"Delete this \" + this.name,\n\t\t\t\t\t\t\tclassName: \"delete\",\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\"click\": function click(evt) {\n\t\t\t\t\t\t\t\t\treturn _this29.delete(item);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\t\ttitle: \"Add new \" + this.name.replace(/s$/i, \"\"),\n\t\t\t\t\t\t\tclassName: \"add\",\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\"click\": function click(evt) {\n\t\t\t\t\t\t\t\t\treturn _this29.add(null, _this29.items.indexOf(item)).edit();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}],\n\t\t\t\t\t\tinside: element\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\treturn item;\n\t\t},\n\n\t\t/**\n   * Add a new item to this collection\n   * @param item {Node|Mavo.Unit} Optional. Element or Mavo object for the new item\n   * @param index {Number} Optional. Index of existing item, will be added opposite to list direction\n   * @param silent {Boolean} Optional. Throw a datachange event? Mainly used internally.\n   */\n\t\tadd: function add(item, index) {\n\t\t\tvar o = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n\t\t\tif (item instanceof Node) {\n\t\t\t\titem = Mavo.Unit.get(item) || this.createItem(item);\n\t\t\t} else {\n\t\t\t\titem = item || this.createItem();\n\t\t\t}\n\n\t\t\tif (index in this.items) {\n\t\t\t\tif (this.bottomUp) {\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tindex = this.bottomUp ? 0 : this.length;\n\t\t\t}\n\n\t\t\tif (!item.element.parentNode) {\n\t\t\t\t// Add it to the DOM, if not already in\n\t\t\t\tvar nextItem = this.items[index];\n\n\t\t\t\titem.element._.before(nextItem && nextItem.element || this.marker);\n\t\t\t}\n\n\t\t\t// Update internal data model\n\t\t\tthis.items.splice(index, 0, item);\n\n\t\t\tfor (var i = index - 1; i < this.length; i++) {\n\t\t\t\tvar _item = this.items[i];\n\n\t\t\t\tif (_item) {\n\t\t\t\t\t_item.index = i;\n\n\t\t\t\t\tif (!o.silent) {\n\t\t\t\t\t\t_item.element._.fire(\"mavo:datachange\", {\n\t\t\t\t\t\t\tnode: this,\n\t\t\t\t\t\t\tmavo: this.mavo,\n\t\t\t\t\t\t\taction: \"add\",\n\t\t\t\t\t\t\titem: _item\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!o.silent) {\n\t\t\t\titem.unsavedChanges = this.mavo.unsavedChanges = true;\n\t\t\t}\n\n\t\t\treturn item;\n\t\t},\n\n\t\tpropagate: function propagate() {\n\t\t\tvar _arguments2 = arguments;\n\n\t\t\tthis.items.forEach(function (item) {\n\t\t\t\treturn item.call.apply(item, _arguments2);\n\t\t\t});\n\t\t},\n\n\t\tdelete: function _delete(item, hard) {\n\t\t\tvar _this30 = this;\n\n\t\t\tif (hard) {\n\t\t\t\t// Hard delete\n\t\t\t\t$.remove(item.element);\n\t\t\t\tthis.items.splice(this.items.indexOf(item), 1);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn $.transition(item.element, { opacity: 0 }).then(function () {\n\t\t\t\titem.deleted = true; // schedule for deletion\n\t\t\t\titem.element.style.opacity = \"\";\n\n\t\t\t\titem.element._.fire(\"mavo:datachange\", {\n\t\t\t\t\tnode: _this30,\n\t\t\t\t\tmavo: _this30.mavo,\n\t\t\t\t\taction: \"delete\",\n\t\t\t\t\titem: item\n\t\t\t\t});\n\n\t\t\t\titem.unsavedChanges = _this30.mavo.unsavedChanges = true;\n\t\t\t});\n\t\t},\n\n\t\tedit: function edit() {\n\t\t\tif (this.length === 0 && this.required) {\n\t\t\t\t// Nested collection with no items, add one\n\t\t\t\tvar item = this.add(null, null, true);\n\n\t\t\t\titem.placeholder = true;\n\t\t\t\titem.walk(function (obj) {\n\t\t\t\t\treturn obj.unsavedChanges = false;\n\t\t\t\t});\n\n\t\t\t\t$.once(item.element, \"mavo:datachange\", function (evt) {\n\t\t\t\t\titem.unsavedChanges = true;\n\t\t\t\t\titem.placeholder = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.propagate(function (obj) {\n\t\t\t\treturn obj[obj.preEdit ? \"preEdit\" : \"edit\"]();\n\t\t\t});\n\t\t},\n\n\t\t/**\n   * Delete all items in the collection.\n   */\n\t\tclear: function clear() {\n\t\t\tif (this.mutable) {\n\t\t\t\tthis.propagate(function (item) {\n\t\t\t\t\tif (item.element.remove) {\n\t\t\t\t\t\titem.element.remove();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Document fragment, remove all children\n\t\t\t\t\t\t$$(item.element.childNodes).forEach(function (node) {\n\t\t\t\t\t\t\treturn node.remove();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.items = [];\n\n\t\t\t\tthis.marker._.fire(\"mavo:datachange\", {\n\t\t\t\t\tnode: this,\n\t\t\t\t\tmavo: this.mavo,\n\t\t\t\t\taction: \"clear\"\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tsave: function save() {\n\t\t\tvar _this31 = this;\n\n\t\t\tthis.items.forEach(function (item) {\n\t\t\t\tif (item.deleted) {\n\t\t\t\t\t_this31.delete(item, true);\n\t\t\t\t} else {\n\t\t\t\t\titem.unsavedChanges = item.dirty = false;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tdone: function done() {\n\t\t\tvar _this32 = this;\n\n\t\t\tthis.items.forEach(function (item) {\n\t\t\t\tif (item.placeholder) {\n\t\t\t\t\t_this32.delete(item, true);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tpropagated: [\"save\", \"done\"],\n\n\t\trevert: function revert() {\n\t\t\tvar _this33 = this;\n\n\t\t\tthis.items.forEach(function (item, i) {\n\t\t\t\t// Delete added items\n\t\t\t\tif (item.unsavedChanges && !item.placeholder) {\n\t\t\t\t\t_this33.delete(item, true);\n\t\t\t\t} else {\n\t\t\t\t\t// Bring back deleted items\n\t\t\t\t\tif (item.deleted) {\n\t\t\t\t\t\titem.deleted = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Revert all properties\n\t\t\t\t\titem.revert();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\trender: function render(data) {\n\t\t\tvar _this34 = this;\n\n\t\t\tthis.unhandled = { before: [], after: [] };\n\n\t\t\tif (!data) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdata = Mavo.toArray(data);\n\n\t\t\tif (!this.mutable) {\n\t\t\t\tthis.items.forEach(function (item, i) {\n\t\t\t\t\treturn item.render(data && data[i]);\n\t\t\t\t});\n\n\t\t\t\tif (data) {\n\t\t\t\t\tthis.unhandled.after = data.slice(this.items.length);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.clear();\n\n\t\t\t\t// Using document fragments improved rendering performance by 60%\n\t\t\t\tvar fragment = document.createDocumentFragment();\n\n\t\t\t\tdata.forEach(function (datum, i) {\n\t\t\t\t\tvar item = _this34.createItem();\n\n\t\t\t\t\titem.render(datum);\n\n\t\t\t\t\t_this34.items.push(item);\n\t\t\t\t\titem.index = i;\n\n\t\t\t\t\tfragment.appendChild(item.element);\n\t\t\t\t});\n\n\t\t\t\tthis.marker.parentNode.insertBefore(fragment, this.marker);\n\t\t\t}\n\n\t\t\tthis.save();\n\t\t},\n\n\t\tfind: function find(property) {\n\t\t\tvar items = this.items.filter(function (item) {\n\t\t\t\treturn !item.deleted;\n\t\t\t});\n\n\t\t\tif (this.property == property) {\n\t\t\t\treturn items;\n\t\t\t}\n\n\t\t\tif (this.properties.indexOf(property) > -1) {\n\t\t\t\tvar ret = items.map(function (item) {\n\t\t\t\t\treturn item.find(property);\n\t\t\t\t});\n\n\t\t\t\treturn Mavo.flatten(ret);\n\t\t\t}\n\t\t},\n\n\t\tlive: {\n\t\t\tmutable: function mutable(value) {\n\t\t\t\tif (value && value !== this.mutable) {\n\t\t\t\t\t// Why is all this code here? Because we want it executed\n\t\t\t\t\t// every time mutable changes, not just in the constructor\n\t\t\t\t\t// (think multiple elements with the same property name, where only one has data-multiple)\n\t\t\t\t\tthis._mutable = value;\n\n\t\t\t\t\tthis.mavo.needsEdit = true;\n\n\t\t\t\t\tthis.required = this.templateElement.matches(Mavo.selectors.required);\n\n\t\t\t\t\t// Keep position of the template in the DOM, since we might remove it\n\t\t\t\t\tthis.marker = $.create(\"div\", {\n\t\t\t\t\t\thidden: true,\n\t\t\t\t\t\tclassName: \"mv-marker\",\n\t\t\t\t\t\tafter: this.templateElement\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.templateElement.classList.add(\"mv-item\");\n\n\t\t\t\t\t// Insert the add button if it's not already in the DOM\n\t\t\t\t\tif (!this.addButton.parentNode) {\n\t\t\t\t\t\tif (this.bottomUp) {\n\t\t\t\t\t\t\tthis.addButton._.before($.value(this.items[0], \"element\") || this.marker);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar tag = this.element.tagName.toLowerCase();\n\t\t\t\t\t\t\tvar containerSelector = Mavo.selectors.container[tag];\n\n\t\t\t\t\t\t\tif (containerSelector) {\n\t\t\t\t\t\t\t\tvar after = this.marker.closest(containerSelector);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.addButton._.after(after && after.parentNode ? after : this.marker);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tlazy: {\n\t\t\tbottomUp: function bottomUp() {\n\t\t\t\t/*\n     * Add new items at the top or bottom?\n     */\n\n\t\t\t\tif (!this.mutable) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar order = this.templateElement.getAttribute(\"data-order\");\n\t\t\t\tif (order !== null) {\n\t\t\t\t\t// Attribute has the highest priority and overrides any heuristics\n\t\t\t\t\treturn (/^desc\\b/i.test(order)\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (!this.addButton.parentNode) {\n\t\t\t\t\t// If add button not in DOM, do the default\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// If add button is already in the DOM and *before* our template, then we default to prepending\n\t\t\t\treturn !!(this.addButton.compareDocumentPosition(this.templateElement) & Node.DOCUMENT_POSITION_FOLLOWING);\n\t\t\t},\n\n\t\t\tclosestCollection: function closestCollection() {\n\t\t\t\tvar parent = this.marker ? this.marker.parentNode : this.templateElement.parentNode;\n\n\t\t\t\treturn parent.closest(Mavo.selectors.item);\n\t\t\t},\n\n\t\t\taddButton: function addButton() {\n\t\t\t\tvar _this35 = this;\n\n\t\t\t\t// Find add button if provided, or generate one\n\t\t\t\tvar selector = \"button.add-\" + this.property;\n\t\t\t\tvar scope = this.closestCollection || this.marker.closest(Mavo.selectors.scope);\n\n\t\t\t\tif (scope) {\n\t\t\t\t\tvar button = $$(selector, scope).filter(function (button) {\n\t\t\t\t\t\treturn !_this35.templateElement.contains(button);\n\t\t\t\t\t})[0];\n\t\t\t\t}\n\n\t\t\t\tif (!button) {\n\t\t\t\t\tbutton = $.create(\"button\", {\n\t\t\t\t\t\tclassName: \"add\",\n\t\t\t\t\t\ttextContent: \"Add \" + this.name\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tbutton.classList.add(\"mv-ui\", \"mv-add\");\n\n\t\t\t\tif (this.property) {\n\t\t\t\t\tbutton.classList.add(\"add-\" + this.property);\n\t\t\t\t}\n\n\t\t\t\tbutton.addEventListener(\"click\", function (evt) {\n\t\t\t\t\tevt.preventDefault();\n\n\t\t\t\t\t_this35.add().edit();\n\t\t\t\t});\n\n\t\t\t\treturn button;\n\t\t\t}\n\t\t}\n\t});\n\n\t// TODO\n\tMavo.Fragment = $.Class({\n\t\tconstructor: function constructor(element) {\n\t\t\tvar _this36 = this;\n\n\t\t\tthis.childNodes = [];\n\n\t\t\t$$(element.childNodes).forEach(function (node) {\n\t\t\t\treturn _this36.appendChild(node);\n\t\t\t});\n\t\t},\n\n\t\tappendChild: function appendChild(node) {\n\t\t\tthis.childNodes.push(node);\n\t\t},\n\n\t\tclassList: { toggle: function toggle() {}, add: function add() {}, remove: function remove() {}, contains: function contains() {} }\n\t});\n})(Bliss, Bliss.$);\n\n/*\nCopyright (c) 2009 James Padolsey.  All rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions\nare met:\n\n   1. Redistributions of source code must retain the above copyright\n\t  notice, this list of conditions and the following disclaimer.\n\n   2. Redistributions in binary form must reproduce the above copyright\n\t  notice, this list of conditions and the following disclaimer in the\n\t  documentation and/or other materials provided with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY James Padolsey ``AS IS\"\" AND\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\nARE DISCLAIMED. IN NO EVENT SHALL James Padolsey OR CONTRIBUTORS BE LIABLE\nFOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\nDAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\nSERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\nCAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT\nLIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY\nOUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\nSUCH DAMAGE.\n\nThe views and conclusions contained in the software and documentation are\nthose of the authors and should not be interpreted as representing official\npolicies, either expressed or implied, of James Padolsey.\n\n AUTHOR James Padolsey (http://james.padolsey.com)\n VERSION 1.03.0\n UPDATED 29-10-2011\n CONTRIBUTORS\n\tDavid Waller\n    Benjamin Drucker\n\n*/\n\nvar prettyPrint = function () {\n\n\t/* These \"util\" functions are not part of the core\n    functionality but are  all necessary - mostly DOM helpers */\n\n\tvar util = {\n\n\t\ttxt: function txt(t) {\n\t\t\t/* Create text node */\n\t\t\tt = t + \"\";\n\t\t\treturn document.createTextNode(t);\n\t\t},\n\n\t\trow: function row(cells, type, cellType) {\n\n\t\t\t/* Creates new <tr> */\n\t\t\tcellType = cellType || \"td\";\n\n\t\t\t/* colSpan is calculated by length of null items in array */\n\t\t\tvar colSpan = util.count(cells, null) + 1,\n\t\t\t    tr = $.create(\"tr\"),\n\t\t\t    td,\n\t\t\t    attrs = {\n\t\t\t\tcolSpan: colSpan\n\t\t\t};\n\n\t\t\t$$(cells).forEach(function (cell) {\n\t\t\t\tif (cell === null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t/* Default cell type is <td> */\n\t\t\t\ttd = $.create(cellType, attrs);\n\n\t\t\t\tif (cell.nodeType) {\n\t\t\t\t\t/* IsDomElement */\n\t\t\t\t\ttd.appendChild(cell);\n\t\t\t\t} else {\n\t\t\t\t\t/* IsString */\n\t\t\t\t\ttd.innerHTML = util.shorten(cell.toString());\n\t\t\t\t}\n\n\t\t\t\ttr.appendChild(td);\n\t\t\t});\n\n\t\t\treturn tr;\n\t\t},\n\n\t\thRow: function hRow(cells, type) {\n\t\t\t/* Return new <th> */\n\t\t\treturn util.row(cells, type, \"th\");\n\t\t},\n\n\t\ttable: function table(headings, type) {\n\n\t\t\theadings = headings || [];\n\n\t\t\t/* Creates new table: */\n\t\t\tvar tbl = $.create(\"table\");\n\t\t\tvar thead = $.create(\"thead\");\n\t\t\tvar tbody = $.create(\"tbody\");\n\n\t\t\ttbl.classList.add(type);\n\n\t\t\tif (headings.length) {\n\t\t\t\ttbl.appendChild(thead);\n\t\t\t\tthead.appendChild(util.hRow(headings, type));\n\t\t\t}\n\n\t\t\ttbl.appendChild(tbody);\n\n\t\t\treturn {\n\t\t\t\t/* Facade for dealing with table/tbody\n       Actual table node is this.node: */\n\t\t\t\tnode: tbl,\n\t\t\t\ttbody: tbody,\n\t\t\t\tthead: thead,\n\t\t\t\tappendChild: function appendChild(node) {\n\t\t\t\t\tthis.tbody.appendChild(node);\n\t\t\t\t},\n\t\t\t\taddRow: function addRow(cells, _type, cellType) {\n\t\t\t\t\tthis.appendChild(util.row(cells, _type || type, cellType));\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\tshorten: function shorten(str) {\n\t\t\tvar max = 40;\n\t\t\tstr = str.replace(/^\\s\\s*|\\s\\s*$|\\n/g, \"\");\n\t\t\treturn str.length > max ? str.substring(0, max - 1) + \"...\" : str;\n\t\t},\n\n\t\thtmlentities: function htmlentities(str) {\n\t\t\treturn str.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n\t\t},\n\n\t\tcount: function count(arr, item) {\n\t\t\tvar count = 0;\n\t\t\tfor (var i = 0, l = arr.length; i < l; i++) {\n\t\t\t\tif (arr[i] === item) {\n\t\t\t\t\tcount++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn count;\n\t\t},\n\n\t\tthead: function thead(tbl) {\n\t\t\treturn tbl.getElementsByTagName(\"thead\")[0];\n\t\t},\n\n\t\twithin: function within(ref) {\n\t\t\t/* Check existence of a val within an object\n      RETURNS KEY */\n\t\t\treturn {\n\t\t\t\tis: function is(o) {\n\t\t\t\t\tfor (var i in ref) {\n\t\t\t\t\t\tif (ref[i] === o) {\n\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\tcommon: {\n\t\t\tcircRef: function circRef(obj, key, settings) {\n\t\t\t\treturn util.expander(\"[POINTS BACK TO <strong>\" + key + \"</strong>]\", \"Click to show this item anyway\", function () {\n\t\t\t\t\tthis.parentNode.appendChild(prettyPrintThis(obj, { maxDepth: 1 }));\n\t\t\t\t});\n\t\t\t},\n\t\t\tdepthReached: function depthReached(obj, settings) {\n\t\t\t\treturn util.expander(\"[DEPTH REACHED]\", \"Click to show this item anyway\", function () {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.parentNode.appendChild(prettyPrintThis(obj, { maxDepth: 1 }));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthis.parentNode.appendChild(util.table([\"ERROR OCCURED DURING OBJECT RETRIEVAL\"], \"error\").addRow([e.message]).node);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\texpander: function expander(text, title, clickFn) {\n\t\t\treturn $.create(\"a\", {\n\t\t\t\tinnerHTML: util.shorten(text) + ' <b style=\"visibility:hidden;\">[+]</b>',\n\t\t\t\ttitle: title,\n\t\t\t\tonmouseover: function onmouseover() {\n\t\t\t\t\tthis.getElementsByTagName(\"b\")[0].style.visibility = \"visible\";\n\t\t\t\t},\n\t\t\t\tonmouseout: function onmouseout() {\n\t\t\t\t\tthis.getElementsByTagName(\"b\")[0].style.visibility = \"hidden\";\n\t\t\t\t},\n\t\t\t\tonclick: function onclick() {\n\t\t\t\t\tthis.style.display = \"none\";\n\t\t\t\t\tclickFn.call(this);\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tstyle: {\n\t\t\t\t\tcursor: \"pointer\"\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t// Main..\n\tvar prettyPrintThis = function prettyPrintThis(obj, options) {\n\n\t\t/*\n  *\t  obj :: Object to be printed\n  *  options :: Options (merged with config)\n  */\n\n\t\toptions = options || {};\n\n\t\tvar settings = $.extend({}, prettyPrintThis.config, options),\n\t\t    container = $.create(\"div\"),\n\t\t    config = prettyPrintThis.config,\n\t\t    currentDepth = 0,\n\t\t    stack = {},\n\t\t    hasRunOnce = false;\n\n\t\t/* Expose per-call settings.\n     Note: \"config\" is overwritten (where necessary) by options/\"settings\"\n     So, if you need to access/change *DEFAULT* settings then go via \".config\" */\n\t\tprettyPrintThis.settings = settings;\n\n\t\tvar typeDealer = {\n\t\t\tstring: function string(item) {\n\t\t\t\treturn util.txt('\"' + util.shorten(item.replace(/\"/g, '\\\\\"')) + '\"');\n\t\t\t},\n\n\t\t\tobject: function object(obj, depth, key) {\n\n\t\t\t\t/* Checking depth + circular refs */\n\t\t\t\t/* Note, check for circular refs before depth; just makes more sense */\n\t\t\t\tvar stackKey = util.within(stack).is(obj);\n\n\t\t\t\tif (stackKey) {\n\t\t\t\t\treturn util.common.circRef(obj, stackKey, settings);\n\t\t\t\t}\n\n\t\t\t\tstack[key || \"TOP\"] = obj;\n\n\t\t\t\tif (depth === settings.maxDepth) {\n\t\t\t\t\treturn util.common.depthReached(obj, settings);\n\t\t\t\t}\n\n\t\t\t\tvar table = util.table([\"Group\", null], \"object\"),\n\t\t\t\t    isEmpty = true;\n\n\t\t\t\tfor (var i in obj) {\n\t\t\t\t\tif (!obj.hasOwnProperty || obj.hasOwnProperty(i)) {\n\t\t\t\t\t\tvar item = obj[i],\n\t\t\t\t\t\t    type = $.type(item);\n\t\t\t\t\t\tisEmpty = false;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\ttable.addRow([i, typeDealer[type](item, depth + 1, i)], type);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t/* Security errors are thrown on certain Window/DOM properties */\n\t\t\t\t\t\t\tif (window.console && window.console.log) {\n\t\t\t\t\t\t\t\tconsole.log(e.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar ret = settings.expanded || hasRunOnce ? table.node : util.expander(JSON.stringify(obj), \"Click to show more\", function () {\n\t\t\t\t\tthis.parentNode.appendChild(table.node);\n\t\t\t\t});\n\n\t\t\t\thasRunOnce = true;\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\tarray: function array(arr, depth, key, jquery) {\n\n\t\t\t\t/* Checking depth + circular refs */\n\t\t\t\t/* Note, check for circular refs before depth; just makes more sense */\n\t\t\t\tvar stackKey = util.within(stack).is(arr);\n\n\t\t\t\tif (stackKey) {\n\t\t\t\t\treturn util.common.circRef(arr, stackKey);\n\t\t\t\t}\n\n\t\t\t\tstack[key || \"TOP\"] = arr;\n\n\t\t\t\tif (depth === settings.maxDepth) {\n\t\t\t\t\treturn util.common.depthReached(arr);\n\t\t\t\t}\n\n\t\t\t\t/* Accepts a table and modifies it */\n\t\t\t\tvar table = util.table([\"List (\" + arr.length + \" items)\", null], \"list\");\n\t\t\t\tvar isEmpty = true;\n\t\t\t\tvar count = 0;\n\n\t\t\t\t$$(arr).forEach(function (item, i) {\n\t\t\t\t\tif (settings.maxArray >= 0 && ++count > settings.maxArray) {\n\t\t\t\t\t\ttable.addRow([i + \"..\" + (arr.length - 1), typeDealer[$.type(item)](\"...\", depth + 1, i)]);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tisEmpty = false;\n\t\t\t\t\ttable.addRow([i, typeDealer[$.type(item)](item, depth + 1, i)]);\n\t\t\t\t});\n\n\t\t\t\treturn settings.expanded ? table.node : util.expander(JSON.stringify(arr), \"Click to show more\", function () {\n\t\t\t\t\tthis.parentNode.appendChild(table.node);\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t\"date\": function date(_date) {\n\n\t\t\t\tvar miniTable = util.table([\"Date\", null], \"date\"),\n\t\t\t\t    sDate = _date.toString().split(/\\s/);\n\n\t\t\t\t/* TODO: Make this work well in IE! */\n\t\t\t\tminiTable.addRow([\"Time\", sDate[4]]).addRow([\"Date\", sDate.slice(0, 4).join(\"-\")]);\n\n\t\t\t\treturn settings.expanded ? miniTable.node : util.expander(\"Date (timestamp): \" + +_date, \"Click to see a little more info about this date\", function () {\n\t\t\t\t\tthis.parentNode.appendChild(miniTable.node);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\ttypeDealer.number = typeDealer.boolean = typeDealer.undefined = typeDealer.null = typeDealer.default = function (value) {\n\t\t\treturn util.txt(value);\n\t\t}, container.appendChild(typeDealer[$.type(obj)](obj, currentDepth));\n\n\t\treturn container;\n\t};\n\n\t/* Configuration */\n\n\t/* All items can be overwridden by passing an\n    \"options\" object when calling prettyPrint */\n\tprettyPrintThis.config = {\n\t\t/* Try setting this to false to save space */\n\t\texpanded: true,\n\n\t\tmaxDepth: 10,\n\t\tmaxArray: -1 // default is unlimited\n\t};\n\n\treturn prettyPrintThis;\n}();\n\n(function ($, $$) {\n\n\tvar _ = Mavo.Debug = {\n\t\tfriendlyError: function friendlyError(e, expr) {\n\t\t\tvar type = e.constructor.name.replace(/Error$/, \"\").toLowerCase();\n\t\t\tvar message = e.message;\n\n\t\t\t// Friendlify common errors\n\n\t\t\t// Non-developers don't know wtf a token is.\n\t\t\tmessage = message.replace(/\\s+token\\s+/g, \" \");\n\n\t\t\tif (message == \"Unexpected }\" && !/[{}]/.test(expr)) {\n\t\t\t\tmessage = \"Missing a )\";\n\t\t\t} else if (message === \"Unexpected )\") {\n\t\t\t\tmessage = \"Missing a (\";\n\t\t\t} else if (message === \"Invalid left-hand side in assignment\") {\n\t\t\t\tmessage = \"Invalid assignment. Maybe you typed = instead of == ?\";\n\t\t\t} else if (message == \"Unexpected ILLEGAL\") {\n\t\t\t\tmessage = \"There is an invalid character somewhere.\";\n\t\t\t}\n\n\t\t\treturn \"<span class=\\\"type\\\">Oh noes, a \" + type + \" error!</span> \" + message;\n\t\t},\n\n\t\telementLabel: function elementLabel(element, attribute) {\n\t\t\tvar ret = element.nodeName.toLowerCase();\n\n\t\t\tif (element.hasAttribute(\"property\")) {\n\t\t\t\tret += \"[property=\" + element.getAttribute(\"property\") + \"]\";\n\t\t\t} else if (element.id) {\n\t\t\t\tret += \"#\" + element.id;\n\t\t\t} else if (element.classList.length) {\n\t\t\t\tret += $$(element.classList).map(function (c) {\n\t\t\t\t\treturn \".\" + c;\n\t\t\t\t}).join(\"\");\n\t\t\t}\n\n\t\t\tif (attribute) {\n\t\t\t\tret += \"@\" + attribute;\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tprintValue: function printValue(obj) {\n\t\t\tvar ret;\n\n\t\t\tif ((typeof obj === \"undefined\" ? \"undefined\" : _typeof(obj)) !== \"object\" || obj === null) {\n\t\t\t\treturn typeof obj == \"string\" ? \"\\\"\" + obj + \"\\\"\" : obj + \"\";\n\t\t\t}\n\n\t\t\tif (Array.isArray(obj)) {\n\t\t\t\tif (obj.length > 0) {\n\t\t\t\t\tif (_typeof(obj[0]) === \"object\") {\n\t\t\t\t\t\treturn \"List: \" + obj.length + \" group(s)\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn \"List: \" + obj.map(_.printValue).join(\", \");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn \"List: (Empty)\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (obj.constructor === Object) {\n\t\t\t\treturn \"Group with \" + Object.keys(obj).length + \" properties\";\n\t\t\t}\n\n\t\t\tif (obj instanceof Mavo.Primitive) {\n\t\t\t\treturn _.printValue(obj.value);\n\t\t\t} else if (obj instanceof Mavo.Collection) {\n\t\t\t\tif (obj.items.length > 0) {\n\t\t\t\t\tif (obj.items[0] instanceof Mavo.Scope) {\n\t\t\t\t\t\treturn \"List: \" + obj.items.length + \" group(s)\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn \"List: \" + obj.items.map(_.printValue).join(\", \");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn _.printValue([]);\n\t\t\t\t}\n\t\t\t} else if (obj instanceof Mavo.Scope) {\n\t\t\t\t// Group\n\t\t\t\treturn \"Group with \" + obj.propertyNames.length + \" properties\";\n\t\t\t}\n\t\t},\n\n\t\ttimed: function timed(id, callback) {\n\t\t\treturn function () {\n\t\t\t\tconsole.time(id);\n\t\t\t\tcallback.apply(this, arguments);\n\t\t\t\tconsole.timeEnd(id);\n\t\t\t};\n\t\t},\n\n\t\ttime: function callee(objName, name) {\n\t\t\tvar obj = eval(objName);\n\t\t\tvar callback = obj[name];\n\n\t\t\tobj[name] = function callee() {\n\t\t\t\tvar before = performance.now();\n\t\t\t\tvar ret = callback.apply(this, arguments);\n\t\t\t\tcallee.timeTaken += performance.now() - before;\n\t\t\t\tobj[name].calls++;\n\t\t\t\treturn ret;\n\t\t\t};\n\n\t\t\tobj[name].timeTaken = obj[name].calls = 0;\n\n\t\t\tcallee.all = callee.all || [];\n\t\t\tcallee.all.push({ obj: obj, objName: objName, name: name });\n\n\t\t\treturn obj[name];\n\t\t},\n\n\t\ttimes: function times() {\n\t\t\tif (!_.time.all) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconsole.table(_.time.all.map(function (o) {\n\t\t\t\treturn {\n\t\t\t\t\t\"Function\": o.objName + \".\" + o.name,\n\t\t\t\t\t\"Time (ms)\": o.obj[o.name].timeTaken,\n\t\t\t\t\t\"Calls\": o.obj[o.name].calls\n\t\t\t\t};\n\t\t\t}));\n\t\t},\n\n\t\treservedWords: \"as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield\".split(\"|\")\n\t};\n\n\tMavo.prototype.render = _.timed(\"render\", Mavo.prototype.render);\n\n\tMavo.selectors.debug = \".debug\";\n\n\tvar selector = \", .mv-debuginfo\";\n\tMavo.Expressions.escape += selector;\n\tStretchy.selectors.filter += selector;\n\n\t// Add element to show saved data\n\tMavo.hooks.add(\"init-tree-after\", function () {\n\t\tif (this.root.debug) {\n\t\t\tthis.wrapper.classList.add(\"debug-saving\");\n\t\t}\n\n\t\tif (this.store && this.wrapper.classList.contains(\"debug-saving\")) {\n\t\t\tvar element;\n\n\t\t\tvar details = $.create(\"details\", {\n\t\t\t\tclassName: \"mv-debug-storage\",\n\t\t\t\tcontents: [{ tag: \"Summary\", textContent: \"Saved data\" }, element = $.create(\"pre\", { id: this.id + \"-debug-storage\" })],\n\t\t\t\tafter: this.wrapper\n\t\t\t});\n\n\t\t\tthis.wrapper.addEventListener(\"mavo:save\", function (evt) {\n\t\t\t\telement.innerHTML = \"\";\n\n\t\t\t\telement.appendChild(prettyPrint(evt.data));\n\t\t\t});\n\t\t}\n\t});\n\n\tMavo.hooks.add(\"render-start\", function (_ref2) {\n\t\tvar data = _ref2.data;\n\n\t\tif (this.storage && this.wrapper.classList.contains(\"debug-saving\")) {\n\t\t\tvar element = $(\"#\" + this.id + \"-debug-storage\");\n\n\t\t\tif (element) {\n\t\t\t\telement.innerHTML = \"\";\n\n\t\t\t\tif (data) {\n\t\t\t\t\telement.appendChild(prettyPrint(data));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tMavo.hooks.add(\"scope-init-start\", function () {\n\t\tthis.debug = this.debug || this.walkUp(function (scope) {\n\t\t\tif (scope.debug) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}) || Mavo.urlParam(\"debug\") !== null;\n\n\t\tif (!this.debug && this.element.closest(Mavo.selectors.debug)) {\n\t\t\tthis.debug = true;\n\t\t}\n\n\t\tif (this.debug) {\n\t\t\tthis.debug = $.create(\"tbody\", {\n\t\t\t\tinside: $.create(\"table\", {\n\t\t\t\t\tinnerHTML: \"<thead><tr>\\n\\t\\t\\t\\t\\t<th></th>\\n\\t\\t\\t\\t\\t<th>Expression</th>\\n\\t\\t\\t\\t\\t<th>Value</th>\\n\\t\\t\\t\\t\\t<th>Element</th>\\n\\t\\t\\t\\t</tr></thead>\",\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tdisplay: \"none\"\n\t\t\t\t\t},\n\t\t\t\t\tinside: $.create(\"details\", {\n\t\t\t\t\t\tclassName: \"mv-ui mv-debuginfo\",\n\t\t\t\t\t\tinside: this.element,\n\t\t\t\t\t\tcontents: $.create(\"summary\", {\n\t\t\t\t\t\t\ttextContent: \"Debug\"\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\t}, true);\n\n\tMavo.hooks.add(\"unit-init-end\", function () {\n\t\tif (this.collection) {\n\t\t\tthis.debug = this.collection.debug;\n\t\t}\n\t});\n\n\tMavo.hooks.add(\"expressions-init-start\", function () {\n\t\tthis.debug = this.scope.debug;\n\t});\n\n\tMavo.hooks.add(\"expression-eval-beforeeval\", function () {\n\t\tif (this.debug) {\n\t\t\tthis.debug.classList.remove(\"error\");\n\t\t}\n\t});\n\n\tMavo.hooks.add(\"expression-eval-error\", function (env) {\n\t\tif (this.debug) {\n\t\t\tthis.debug.innerHTML = _.friendlyError(env.exception, env.expression);\n\t\t\tthis.debug.classList.add(\"error\");\n\t\t}\n\t});\n\n\tMavo.Scope.prototype.debugRow = function (_ref3) {\n\t\tvar element = _ref3.element;\n\t\tvar _ref3$attribute = _ref3.attribute;\n\t\tvar attribute = _ref3$attribute === undefined ? null : _ref3$attribute;\n\t\tvar _ref3$tds = _ref3.tds;\n\t\tvar tds = _ref3$tds === undefined ? [] : _ref3$tds;\n\n\t\tif (!this.debug) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.debug.parentNode.style.display = \"\";\n\n\t\tvar type = tds[0];\n\n\t\ttds[0] = $.create(\"td\", {\n\t\t\ttitle: type\n\t\t});\n\n\t\tif (!tds[3]) {\n\t\t\tvar elementLabel = _.elementLabel(element, attribute);\n\n\t\t\ttds[3] = $.create(\"td\", {\n\t\t\t\ttextContent: elementLabel,\n\t\t\t\ttitle: elementLabel,\n\t\t\t\tevents: {\n\t\t\t\t\t\"mouseenter mouseleave\": function mouseenterMouseleave(evt) {\n\t\t\t\t\t\telement.classList.toggle(\"mv-highlight\", evt.type === \"mouseenter\");\n\t\t\t\t\t},\n\t\t\t\t\t\"click\": function click(evt) {\n\t\t\t\t\t\telement.scrollIntoView({ behavior: \"smooth\" });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\ttds = tds.map(function (td) {\n\t\t\tif (!(td instanceof Node)) {\n\t\t\t\treturn $.create(\"td\", (typeof td === \"undefined\" ? \"undefined\" : _typeof(td)) == \"object\" ? td : { textContent: td });\n\t\t\t}\n\n\t\t\treturn td;\n\t\t});\n\n\t\tif (type == \"Warning\") {\n\t\t\ttds[1].setAttribute(\"colspan\", 2);\n\t\t}\n\n\t\tvar tr = $.create(\"tr\", {\n\t\t\tclassName: \"debug-\" + type.toLowerCase(),\n\t\t\tcontents: tds,\n\t\t\tinside: this.debug\n\t\t});\n\t};\n\n\tMavo.hooks.add(\"expressiontext-init-end\", function () {\n\t\tvar _this37 = this;\n\n\t\tif (this.scope.debug) {\n\t\t\tthis.debug = {};\n\n\t\t\tthis.template.forEach(function (expr) {\n\t\t\t\tif (expr instanceof Mavo.Expression) {\n\t\t\t\t\t_this37.scope.debugRow({\n\t\t\t\t\t\telement: _this37.element,\n\t\t\t\t\t\tattribute: _this37.attribute,\n\t\t\t\t\t\ttds: [\"Expression\", {\n\t\t\t\t\t\t\ttag: \"td\",\n\t\t\t\t\t\t\tcontents: {\n\t\t\t\t\t\t\t\ttag: \"textarea\",\n\t\t\t\t\t\t\t\tvalue: expr.expression,\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tinput: function input(evt) {\n\t\t\t\t\t\t\t\t\t\texpr.expression = evt.target.value;\n\t\t\t\t\t\t\t\t\t\t_this37.update(_this37.data);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonce: {\n\t\t\t\t\t\t\t\t\tfocus: function focus(evt) {\n\t\t\t\t\t\t\t\t\t\treturn Stretchy.resize(evt.target);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, expr.debug = $.create(\"td\")]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tMavo.hooks.add(\"scope-init-end\", function () {\n\t\tvar _this38 = this;\n\n\t\t// TODO make properties update, collapse duplicate expressions\n\t\tif (this.debug instanceof Node) {\n\t\t\t// We have a debug table, add stuff to it\n\n\t\t\tvar selector = Mavo.selectors.andNot(Mavo.selectors.multiple, Mavo.selectors.property);\n\t\t\t$$(selector, this.element).forEach(function (element) {\n\t\t\t\t_this38.debugRow({\n\t\t\t\t\telement: element,\n\t\t\t\t\ttds: [\"Warning\", \"data-multiple without a property attribute\"]\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.propagate(function (obj) {\n\t\t\t\tvar value = _.printValue(obj);\n\n\t\t\t\t_this38.debugRow({\n\t\t\t\t\telement: obj.element,\n\t\t\t\t\ttds: [\"Property\", obj.property, obj.value]\n\t\t\t\t});\n\n\t\t\t\tif (_.reservedWords.indexOf(obj.property) > -1) {\n\t\t\t\t\t_this38.debugRow({\n\t\t\t\t\t\telement: obj.element,\n\t\t\t\t\t\ttds: [\"Warning\", \"You can’t use \\\"\" + obj.property + \"\\\" as a property name, it’s a reserved word.\"]\n\t\t\t\t\t});\n\t\t\t\t} else if (/^\\d|[\\W$]/.test(obj.property)) {\n\t\t\t\t\t_this38.debugRow({\n\t\t\t\t\t\telement: obj.element,\n\t\t\t\t\t\ttds: [\"Warning\", {\n\t\t\t\t\t\t\ttextContent: \"You can’t use \\\"\" + obj.property + \"\\\" as a property name.\",\n\t\t\t\t\t\t\ttitle: \"Property names can only contain letters, numbers and underscores and cannot start with a number.\"\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.scope.element.addEventListener(\"mavo:datachange\", function (evt) {\n\t\t\t\t$$(\"tr.debug-property\", _this38.debug).forEach(function (tr) {\n\t\t\t\t\tvar property = tr.cells[1].textContent;\n\t\t\t\t\tvar value = _.printValue(_this38.properties[property]);\n\n\t\t\t\t\tif (tr.cells[2]) {\n\t\t\t\t\t\tvar td = tr.cells[2];\n\t\t\t\t\t\ttd.textContent = td.title = value;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n\n\tMavo.hooks.add(\"expressiontext-update-beforeeval\", function (env) {\n\t\tif (this.debug) {\n\t\t\tenv.td = env.expr.debug;\n\n\t\t\tif (env.td) {\n\t\t\t\tenv.td.classList.remove(\"error\");\n\t\t\t}\n\t\t}\n\t});\n\n\tMavo.hooks.add(\"expressiontext-update-aftereval\", function (env) {\n\t\tif (env.td && !env.td.classList.contains(\"error\")) {\n\t\t\tvar value = _.printValue(env.value);\n\t\t\tenv.td.textContent = env.td.title = value;\n\t\t}\n\t});\n\n\t// Mavo.Debug.time(\"Mavo.Expressions.prototype\", \"update\");\n})(Bliss, Bliss.$);\n\n(function ($) {\n\n\tif (!self.Mavo) {\n\t\treturn;\n\t}\n\n\tvar dropboxURL = \"//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js\";\n\n\tMavo.Storage.Backend.register($.Class({\n\t\textends: Mavo.Storage.Backend,\n\t\tid: \"Dropbox\",\n\t\tconstructor: function constructor() {\n\t\t\tvar _this39 = this;\n\n\t\t\t// Transform the dropbox shared URL into something raw and CORS-enabled\n\t\t\tthis.url = new URL(this.url, location);\n\n\t\t\tif (this.url.protocol != \"dropbox:\") {\n\t\t\t\tthis.url.hostname = \"dl.dropboxusercontent.com\";\n\t\t\t\tthis.url.search = this.url.search.replace(/\\bdl=0|^$/, \"raw=1\");\n\t\t\t\tthis.permissions.on(\"read\"); // TODO check if file actually is publicly readable\n\t\t\t}\n\n\t\t\tthis.permissions.on(\"login\");\n\n\t\t\tthis.ready = $.include(self.Dropbox, dropboxURL).then(function () {\n\t\t\t\tvar referrer = new URL(document.referrer, location);\n\n\t\t\t\tif (referrer.hostname === \"www.dropbox.com\" && location.hash.indexOf(\"#access_token=\") === 0) {\n\t\t\t\t\t// We’re in an OAuth response popup, do what you need then close this\n\t\t\t\t\tDropbox.AuthDriver.Popup.oauthReceiver();\n\t\t\t\t\t$.fire(window, \"load\"); // hack because dropbox.js didn't foresee use cases like ours :/\n\t\t\t\t\tclose();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Internal filename (to be used for saving)\n\t\t\t\t_this39.filename = (_this39.storage.param(\"path\") || \"\") + new URL(_this39.url).pathname.match(/[^/]*$/)[0];\n\n\t\t\t\t_this39.key = _this39.storage.param(\"key\") || \"fle6gsc61w5v79j\";\n\n\t\t\t\t_this39.client = new Dropbox.Client({ key: _this39.key });\n\t\t\t}).then(function () {\n\t\t\t\t_this39.login(true);\n\t\t\t});\n\t\t},\n\n\t\t/**\n   * Saves a file to the backend.\n   * @param {Object} file - An object with name & data keys\n   * @return {Promise} A promise that resolves when the file is saved.\n   */\n\t\tput: function put() {\n\t\t\tvar _this40 = this;\n\n\t\t\tvar file = arguments.length <= 0 || arguments[0] === undefined ? this.getFile() : arguments[0];\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t_this40.client.writeFile(file.name, file.dataString, function (error, stat) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\treturn reject(Error(error));\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log(\"File saved as revision \" + stat.versionTag);\n\t\t\t\t\tresolve(file);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tlogin: function login(passive) {\n\t\t\tvar _this41 = this;\n\n\t\t\treturn this.ready.then(function () {\n\t\t\t\treturn _this41.client.isAuthenticated() ? Promise.resolve() : new Promise(function (resolve, reject) {\n\t\t\t\t\t_this41.client.authDriver(new Dropbox.AuthDriver.Popup({\n\t\t\t\t\t\treceiverUrl: new URL(location) + \"\"\n\t\t\t\t\t}));\n\n\t\t\t\t\t_this41.client.authenticate({ interactive: !passive }, function (error, client) {\n\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\treject(Error(error));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (_this41.client.isAuthenticated()) {\n\t\t\t\t\t\t\t// TODO check if can actually edit the file\n\t\t\t\t\t\t\t_this41.permissions.on([\"logout\", \"edit\"]);\n\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this41.permissions.off([\"logout\", \"edit\", \"add\", \"delete\"]);\n\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\t// Not returning a promise here, since processes depending on login don't need to wait for this\n\t\t\t\t_this41.client.getAccountInfo(function (error, accountInfo) {\n\t\t\t\t\tif (!error) {\n\t\t\t\t\t\t$.fire(_this41.mavo.wrapper, \"mavo:login\", $.extend({ backend: _this41 }, accountInfo));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).catch(function () {});\n\t\t},\n\n\t\tlogout: function logout() {\n\t\t\tvar _this42 = this;\n\n\t\t\treturn !this.client.isAuthenticated() ? Promise.resolve() : new Promise(function (resolve, reject) {\n\t\t\t\t_this42.client.signOut(null, function () {\n\t\t\t\t\t_this42.permissions.off([\"edit\", \"add\", \"delete\"]).on(\"login\");\n\n\t\t\t\t\t_this42.mavo.wrapper._.fire(\"mavo:logout\", { backend: _this42 });\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tstatic: {\n\t\t\ttest: function test(url) {\n\t\t\t\turl = new URL(url, location);\n\t\t\t\treturn (/dropbox.com/.test(url.host) || url.protocol === \"dropbox:\"\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}));\n})(Bliss);\n\n(function ($) {\n\n\tif (!self.Mavo) {\n\t\treturn;\n\t}\n\n\tvar _ = Mavo.Storage.Backend.register($.Class({\n\t\textends: Mavo.Storage.Backend,\n\t\tid: \"Github\",\n\t\tconstructor: function constructor() {\n\t\t\tthis.permissions.on(\"login\");\n\n\t\t\tthis.key = this.storage.param(\"key\") || \"7e08e016048000bc594e\";\n\n\t\t\t// Extract info for username, repo, branch, filename, filepath from URL\n\t\t\tthis.url = new URL(this.url, location);\n\t\t\t$.extend(this, _.parseURL(this.url));\n\t\t\tthis.repo = this.repo || \"mv-data\";\n\t\t\tthis.branch = this.branch || \"master\";\n\t\t\tthis.path = this.path || this.mavo.id + \".json\";\n\t\t\tthis.filename = this.filename || this.path.match(/[^/]*$/)[0];\n\n\t\t\t// Transform the Github URL into something raw and CORS-enabled\n\t\t\tthis.url = new URL(\"https://raw.githubusercontent.com/\" + this.username + \"/\" + this.repo + \"/\" + this.branch + \"/\" + this.path + \"?ts=\" + Date.now());\n\t\t\tthis.permissions.on(\"read\"); // TODO check if file actually is publicly readable\n\n\t\t\tthis.login(true);\n\t\t},\n\n\t\tget authenticated() {\n\t\t\treturn !!this.accessToken;\n\t\t},\n\n\t\treq: function req(call, data) {\n\t\t\tvar method = arguments.length <= 2 || arguments[2] === undefined ? \"GET\" : arguments[2];\n\t\t\tvar o = arguments.length <= 3 || arguments[3] === undefined ? { method: method } : arguments[3];\n\n\t\t\tif (data) {\n\t\t\t\to.data = JSON.stringify(data);\n\t\t\t}\n\n\t\t\treturn $.fetch(\"https://api.github.com/\" + call, $.extend(o, {\n\t\t\t\tresponseType: \"json\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Authorization\": \"token \" + this.accessToken\n\t\t\t\t}\n\t\t\t})).catch(function (err) {\n\t\t\t\tif (err && err.xhr) {\n\t\t\t\t\treturn Promise.reject(err.xhr);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t\tconsole.log(err.stack);\n\t\t\t\t}\n\t\t\t}).then(function (xhr) {\n\t\t\t\treturn Promise.resolve(xhr.response);\n\t\t\t});\n\t\t},\n\n\t\tget: Mavo.Storage.Backend.Remote.prototype.get,\n\n\t\t/**\n   * Saves a file to the backend.\n   * @param {Object} file - An object with name & data keys\n   * @return {Promise} A promise that resolves when the file is saved.\n   */\n\t\tput: function put() {\n\t\t\tvar _this43 = this;\n\n\t\t\tvar file = arguments.length <= 0 || arguments[0] === undefined ? this.getFile() : arguments[0];\n\n\t\t\tvar fileCall = \"repos/\" + this.username + \"/\" + this.repo + \"/contents/\" + file.path;\n\n\t\t\treturn Promise.resolve(this.repoInfo || this.req(\"user/repos\", {\n\t\t\t\tname: this.repo\n\t\t\t}, \"POST\")).then(function (repoInfo) {\n\t\t\t\t_this43.repoInfo = repoInfo;\n\n\t\t\t\treturn _this43.req(fileCall, {\n\t\t\t\t\tref: _this43.branch\n\t\t\t\t});\n\t\t\t}).then(function (fileInfo) {\n\t\t\t\treturn _this43.req(fileCall, {\n\t\t\t\t\tmessage: \"Updated \" + (file.name || \"file\"),\n\t\t\t\t\tcontent: _.btoa(file.dataString),\n\t\t\t\t\tbranch: _this43.branch,\n\t\t\t\t\tsha: fileInfo.sha\n\t\t\t\t}, \"PUT\");\n\t\t\t}, function (xhr) {\n\t\t\t\tif (xhr.status == 404) {\n\t\t\t\t\t// File does not exist, create it\n\t\t\t\t\treturn _this43.req(fileCall, {\n\t\t\t\t\t\tmessage: \"Created file\",\n\t\t\t\t\t\tcontent: _.btoa(file.dataString),\n\t\t\t\t\t\tbranch: _this43.branch\n\t\t\t\t\t}, \"PUT\");\n\t\t\t\t}\n\t\t\t}).then(function (data) {\n\t\t\t\tconsole.log(\"success\");\n\t\t\t\treturn file;\n\t\t\t});\n\t\t},\n\n\t\tlogin: function login(passive) {\n\t\t\tvar _this44 = this;\n\n\t\t\treturn this.ready.then(function () {\n\t\t\t\tif (_this44.authenticated) {\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tif (passive) {\n\t\t\t\t\t\t_this44.accessToken = localStorage[\"mavo:githubtoken\"];\n\n\t\t\t\t\t\tif (_this44.accessToken) {\n\t\t\t\t\t\t\tresolve(_this44.accessToken);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Show window\n\t\t\t\t\t\t_this44.authPopup = open(\"https://github.com/login/oauth/authorize?client_id=\" + _this44.key + \"&scope=repo,gist&state=\" + location.href, \"popup\", \"width=900,height=500\");\n\n\t\t\t\t\t\taddEventListener(\"message\", function (evt) {\n\t\t\t\t\t\t\tif (evt.source === _this44.authPopup) {\n\t\t\t\t\t\t\t\t_this44.accessToken = localStorage[\"mavo:githubtoken\"] = evt.data;\n\n\t\t\t\t\t\t\t\tif (!_this44.accessToken) {\n\t\t\t\t\t\t\t\t\treject(Error(\"Authentication error\"));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresolve(_this44.accessToken);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}).then(function () {\n\t\t\t\t\treturn _this44.getUser();\n\t\t\t\t}).then(function (u) {\n\t\t\t\t\t_this44.permissions.on(\"logout\");\n\n\t\t\t\t\treturn _this44.req(\"repos/\" + _this44.username + \"/\" + _this44.repo);\n\t\t\t\t}).then(function (repoInfo) {\n\t\t\t\t\t_this44.repoInfo = repoInfo;\n\n\t\t\t\t\tif (repoInfo.permissions.push) {\n\t\t\t\t\t\t_this44.permissions.on([\"edit\", \"save\"]);\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (xhr) {\n\t\t\t\t\tif (xhr.status == 404) {\n\t\t\t\t\t\t// Repo does not exist so we can't check permissions\n\t\t\t\t\t\t// Just check if authenticated user is the same as our URL username\n\t\t\t\t\t\tif (_this44.user.login == _this44.username) {\n\t\t\t\t\t\t\t_this44.permissions.on(\"edit\", \"save\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tlogout: function logout() {\n\t\t\tif (this.authenticated) {\n\t\t\t\tlocalStorage.removeItem(\"mavo:githubtoken\");\n\t\t\t\tdelete this.accessToken;\n\n\t\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\", \"save\"]).on(\"login\");\n\n\t\t\t\tthis.mavo.wrapper._.fire(\"mavo:logout\", { backend: this });\n\t\t\t}\n\n\t\t\treturn Promise.resolve();\n\t\t},\n\n\t\tgetUser: function getUser() {\n\t\t\tvar _this45 = this;\n\n\t\t\treturn this.req(\"user\").then(function (accountInfo) {\n\t\t\t\t_this45.user = accountInfo;\n\n\t\t\t\tvar name = accountInfo.name || accountInfo.login;\n\t\t\t\t$.fire(_this45.mavo.wrapper, \"mavo:login\", {\n\t\t\t\t\tbackend: _this45,\n\t\t\t\t\tname: \"<a href=\\\"https://github.com/\" + accountInfo.login + \"\\\" target=\\\"_blank\\\">\\n\\t\\t\\t\\t\\t\\t\\t<img class=\\\"avatar\\\" src=\\\"\" + accountInfo.avatar_url + \"\\\" /> \" + name + \"\\n\\t\\t\\t\\t\\t\\t</a>\"\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tstatic: {\n\t\t\ttest: function test(url) {\n\t\t\t\turl = new URL(url, location);\n\t\t\t\treturn (/\\bgithub.(com|io)|raw.githubusercontent.com/.test(url.host)\n\t\t\t\t);\n\t\t\t},\n\n\t\t\t/**\n    * Parse Github URLs, return username, repo, branch, path\n    */\n\t\t\tparseURL: function parseURL(url) {\n\t\t\t\tvar ret = {};\n\n\t\t\t\turl = new URL(url, location);\n\n\t\t\t\tvar path = url.pathname.slice(1).split(\"/\");\n\n\t\t\t\tif (/github.io$/.test(url.host)) {\n\t\t\t\t\tret.username = url.host.match(/([\\w-]+)\\.github\\.io$/)[1];\n\t\t\t\t\tret.branch = \"gh-pages\";\n\t\t\t\t} else {\n\t\t\t\t\tret.username = path.shift();\n\t\t\t\t}\n\n\t\t\t\tret.repo = path.shift();\n\n\t\t\t\tif (/raw.githubusercontent.com$/.test(url.host)) {\n\t\t\t\t\tret.branch = path.shift();\n\t\t\t\t} else if (/github.com$/.test(url.host) && path[0] == \"blob\") {\n\t\t\t\t\tpath.shift();\n\t\t\t\t\tret.branch = path.shift();\n\t\t\t\t}\n\n\t\t\t\tret.filename = path[path.length - 1];\n\n\t\t\t\tret.path = path.join(\"/\");\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\tbtoa: function (_btoa) {\n\t\t\t\tfunction btoa(_x17) {\n\t\t\t\t\treturn _btoa.apply(this, arguments);\n\t\t\t\t}\n\n\t\t\t\tbtoa.toString = function () {\n\t\t\t\t\treturn _btoa.toString();\n\t\t\t\t};\n\n\t\t\t\treturn btoa;\n\t\t\t}(function (str) {\n\t\t\t\treturn btoa(unescape(encodeURIComponent(str)));\n\t\t\t})\n\t\t}\n\t}));\n})(Bliss);\n\n//# sourceMappingURL=mavo.js.map\n//# sourceMappingURL=mavo.es5.js.map\n"],"sourceRoot":"/source/"}